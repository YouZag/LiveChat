var zz=Object.defineProperty;var Gz=(ga,ot,Si)=>ot in ga?zz(ga,ot,{enumerable:!0,configurable:!0,writable:!0,value:Si}):ga[ot]=Si;var Gn=(ga,ot,Si)=>Gz(ga,typeof ot!="symbol"?ot+"":ot,Si);(function(ga,ot,Si){"use strict";var Rr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vk(e){if(e.__esModule)return e;var n=e.default;if(typeof n=="function"){var t=function r(){return this instanceof r?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};t.prototype=n.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var a=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,a.get?a:{enumerable:!0,get:function(){return e[r]}})}),t}var Ev={exports:{}},Du={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kk=ot,Yk=Symbol.for("react.element"),Jk=Symbol.for("react.fragment"),Qk=Object.prototype.hasOwnProperty,Xk=Kk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Zk={key:!0,ref:!0,__self:!0,__source:!0};function Iv(e,n,t){var r,a={},i=null,s=null;t!==void 0&&(i=""+t),n.key!==void 0&&(i=""+n.key),n.ref!==void 0&&(s=n.ref);for(r in n)Qk.call(n,r)&&!Zk.hasOwnProperty(r)&&(a[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps,n)a[r]===void 0&&(a[r]=n[r]);return{$$typeof:Yk,type:e,key:i,ref:s,props:a,_owner:Xk.current}}Du.Fragment=Jk,Du.jsx=Iv,Du.jsxs=Iv,Ev.exports=Du;var oe=Ev.exports,Rv,Ov=Si;Rv=Ov.createRoot,Ov.hydrateRoot;const e$=({onClick:e,primaryColor:n,isOpen:t})=>{const r={backgroundColor:"var(--color_8, "+(n||"#2563EB")+")"};return t?null:oe.jsx("button",{onClick:e,className:"sl-fixed sl-bottom-4 sl-right-4 sl-w-16 sl-h-16 sl-rounded-full sl-flex sl-items-center sl-justify-center sl-shadow-lg hover:sl-opacity-90 focus:sl-outline-none focus:sl-ring-2 focus:sl-ring-offset-2 sl-transition-all sl-duration-300 sl-transform hover:sl-scale-110 active:sl-scale-95 sl-text-white sl-z-50",style:r,"aria-label":"Open chat window",children:oe.jsx("svg",{className:"sl-w-8 sl-h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})})},t$=({media:e})=>{const[n,t]=ot.useState(""),[r,a]=ot.useState(!0),[i,s]=ot.useState(null),o=e.contentType.startsWith("image/"),u=(e.size/1024).toFixed(1);return ot.useEffect(()=>{(async()=>{try{if(a(!0),s(null),e.getContentTemporaryUrl){const c=await e.getContentTemporaryUrl();t(c)}else s("Media URL not available")}catch(c){console.error("Error fetching media URL:",c),s("Failed to load media")}finally{a(!1)}})()},[e]),r?oe.jsx("div",{className:"sl-flex sl-items-center sl-justify-center sl-p-4 sl-bg-gray-50 sl-rounded-lg",children:oe.jsx("div",{className:"sl-animate-spin sl-rounded-full sl-h-6 sl-w-6 sl-border-b-2 sl-border-blue-500"})}):i?oe.jsx("div",{className:"sl-p-4 sl-bg-red-50 sl-rounded-lg",children:oe.jsx("p",{className:"sl-text-sm sl-text-red-600",children:i})}):o?oe.jsxs("div",{className:"sl-relative sl-group",children:[oe.jsx("img",{src:n,alt:e.filename,className:"sl-max-w-full sl-rounded-lg sl-max-h-48 sl-object-contain sl-bg-gray-100",loading:"lazy",onError:l=>{const c=l.target;c.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>',c.className+=" sl-p-4 sl-text-gray-400"}}),oe.jsxs("div",{className:"sl-absolute sl-bottom-0 sl-left-0 sl-right-0 sl-bg-black/50 sl-text-white sl-text-xs sl-py-1 sl-px-2 sl-opacity-0 sl-group-hover:sl-opacity-100 sl-transition-opacity sl-rounded-b-lg",children:[e.filename," (",u,"KB)"]})]}):oe.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"sl-flex sl-items-center sl-space-x-2 sl-p-2 sl-rounded-lg sl-bg-gray-50 hover:sl-bg-gray-100 sl-transition-colors",onClick:l=>{l.preventDefault(),fetch(n).then(c=>c.blob()).then(c=>{const p=window.URL.createObjectURL(c),S=document.createElement("a");S.href=p,S.download=e.filename,document.body.appendChild(S),S.click(),window.URL.revokeObjectURL(p),document.body.removeChild(S)}).catch(c=>{console.error("Error downloading file:",c),alert("Failed to download file. Please try again.")})},children:[oe.jsx("div",{className:"sl-p-2 sl-bg-blue-100 sl-rounded-lg",children:oe.jsx("svg",{className:"sl-w-5 sl-h-5 sl-text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),oe.jsxs("div",{className:"sl-flex-1 sl-min-w-0",children:[oe.jsx("p",{className:"sl-text-sm sl-font-medium sl-text-gray-900 sl-truncate",children:e.filename}),oe.jsxs("p",{className:"sl-text-xs sl-text-gray-500",children:[u," KB"]})]})]})},r$=({message:e})=>oe.jsx("div",{className:"sl-w-full sl-flex sl-justify-center sl-py-2",children:oe.jsx("div",{className:"sl-text-gray-500 sl-text-sm sl-italic sl-text-center",children:e})}),n$=({messages:e,identity:n,clientName:t})=>{const r=ot.useRef(null),a=ot.useRef(null),i=(l="smooth")=>{var c;(c=r.current)==null||c.scrollIntoView({behavior:l,block:"end"})};ot.useEffect(()=>{i(e.length<=1?"auto":"smooth")},[e]);const s=l=>Array.isArray(l.media)&&l.media.length>0?l.media:Array.isArray(l.attachedMedia)&&l.attachedMedia.length>0?l.attachedMedia:[],o=l=>{var p,S;return l.author===n?t||"You":((S=(p=l.participant)==null?void 0:p.attributes)==null?void 0:S.friendlyName)||"Agent"},u=l=>{const c=s(l);return oe.jsxs("div",{className:"sl-space-y-2",children:[l.body&&oe.jsx("div",{className:"sl-break-words",children:l.body}),c.length>0&&oe.jsx("div",{className:"sl-space-y-2",children:c.map(p=>oe.jsx(t$,{media:p},p.sid))})]})};return oe.jsxs("div",{ref:a,className:"sl-flex-1 sl-p-4 sl-overflow-y-auto sl-bg-gray-50 sl-space-y-3 sl-flex sl-flex-col sl-min-h-[300px] sl-scroll-smooth",children:[e.map(l=>{var S;if((S=l.attributes)!=null&&S.isSystem)return oe.jsx(r$,{message:l.body},l.sid);const c=l.author===n,p=o(l);return oe.jsxs("div",{className:`
              ${c?"sl-self-end":"sl-self-start"}
              sl-max-w-[80%]
            `,children:[oe.jsxs("div",{className:`
              sl-rounded-lg sl-px-4 sl-py-2
              ${c?"sl-bg-blue-100 sl-text-gray-900":"sl-bg-white sl-border sl-border-gray-200 sl-text-gray-800"}
            `,children:[oe.jsx("div",{className:"sl-text-xs sl-text-gray-500 sl-mb-1",children:p}),u(l)]}),oe.jsx("div",{className:`
              sl-text-xs sl-text-gray-500 sl-mt-1
              ${c?"sl-text-right":"sl-text-left"}
            `,children:new Date(l.dateCreated).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},l.sid)}),oe.jsx("div",{ref:r})]})},a$=({onSendMessage:e})=>{const[n,t]=ot.useState(""),[r,a]=ot.useState(!1),i=ot.useRef(null),s=()=>{n.trim()&&(e(n.trim()),t(""))},o=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),s())},u=async l=>{const c=l.target.files;if(c!=null&&c.length){a(!0);try{await e("",Array.from(c)),i.current&&(i.current.value="")}catch(p){console.error("Failed to upload file:",p)}finally{a(!1)}}};return oe.jsx("div",{className:"sl-p-2 sl-border-t sl-border-gray-300",children:oe.jsxs("div",{className:"sl-flex sl-items-center sl-space-x-2",children:[oe.jsx("input",{type:"file",ref:i,onChange:u,className:"sl-hidden",accept:"image/*,.pdf,.doc,.docx,.txt",multiple:!0}),oe.jsx("button",{onClick:()=>{var l;return(l=i.current)==null?void 0:l.click()},className:"sl-p-1.5 sl-text-gray-400 hover:sl-text-gray-600 focus:sl-outline-none sl-rounded-full hover:sl-bg-gray-100 disabled:sl-opacity-50",disabled:r,title:"Attach files",children:r?oe.jsx("svg",{className:"sl-w-4 sl-h-4 sl-animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):oe.jsx("svg",{className:"sl-w-4 sl-h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),oe.jsx("input",{type:"text",placeholder:r?"Uploading...":"Type a message and press Enter...",className:"sl-flex-1 sl-px-3 sl-py-1.5 sl-text-sm sl-border sl-border-gray-300 sl-rounded-full focus:sl-outline-none focus:sl-ring-1 focus:sl-ring-blue-500 focus:sl-border-blue-500 disabled:sl-bg-gray-50 sl-text-gray-900",value:n,onChange:l=>t(l.target.value),onKeyPress:o,disabled:r})]})})},i$=({onSubmit:e})=>{const[n,t]=ot.useState(""),[r,a]=ot.useState(""),i=s=>{if(s.preventDefault(),!r||!n){alert("Please enter both name and email");return}e(n,r)};return oe.jsxs("form",{onSubmit:i,className:"sl-p-4 sl-flex sl-flex-col sl-space-y-2",children:[oe.jsxs("div",{className:"sl-text-center sl-mb-4",children:[oe.jsx("h3",{className:"sl-text-lg sl-font-semibold sl-text-gray-800",children:"Start a Conversation"}),oe.jsx("p",{className:"sl-text-sm sl-text-gray-600",children:"Please enter your details to begin"})]}),oe.jsx("input",{type:"text",name:"name",autoComplete:"name",placeholder:"Enter your name",className:"sl-text-gray-900 sl-border sl-border-gray-300 sl-rounded sl-px-3 sl-py-2 sl-text-sm focus:sl-outline-none focus:sl-ring-1 focus:sl-ring-blue-500 focus:sl-border-blue-500",value:n,onChange:s=>t(s.target.value),required:!0}),oe.jsx("input",{type:"email",name:"email",autoComplete:"email",placeholder:"Enter your email",className:"sl-text-gray-900 sl-border sl-border-gray-300 sl-rounded sl-px-3 sl-py-2 sl-text-sm focus:sl-outline-none focus:sl-ring-1 focus:sl-ring-blue-500 focus:sl-border-blue-500",value:r,onChange:s=>a(s.target.value),required:!0}),oe.jsx("button",{type:"submit",className:"sl-bg-blue-500 sl-text-white sl-py-2 sl-px-4 sl-rounded hover:sl-bg-blue-600 sl-transition-colors sl-text-sm sl-font-medium",children:"Start Chat"})]})};var Av={},ws=function(e){return e&&e.Math===Math&&e},yt=ws(typeof globalThis=="object"&&globalThis)||ws(typeof window=="object"&&window)||ws(typeof self=="object"&&self)||ws(typeof Rr=="object"&&Rr)||ws(typeof Rr=="object"&&Rr)||function(){return this}()||Function("return this")(),Hn={},at=function(e){try{return!!e()}catch{return!0}},s$=at,Lt=!s$(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),u$=at,Ss=!u$(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),o$=Ss,Bu=Function.prototype.call,Pt=o$?Bu.bind(Bu):function(){return Bu.apply(Bu,arguments)},_s={},Pv={}.propertyIsEnumerable,Mv=Object.getOwnPropertyDescriptor,l$=Mv&&!Pv.call({1:2},1);_s.f=l$?function(n){var t=Mv(this,n);return!!t&&t.enumerable}:Pv;var Ha=function(e,n){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:n}},Nv=Ss,xv=Function.prototype,Kl=xv.call,c$=Nv&&xv.bind.bind(Kl,Kl),lt=Nv?c$:function(e){return function(){return Kl.apply(e,arguments)}},Lv=lt,f$=Lv({}.toString),d$=Lv("".slice),In=function(e){return d$(f$(e),8,-1)},p$=lt,v$=at,h$=In,Yl=Object,y$=p$("".split),ks=v$(function(){return!Yl("z").propertyIsEnumerable(0)})?function(e){return h$(e)==="String"?y$(e,""):Yl(e)}:Yl,cn=function(e){return e==null},g$=cn,m$=TypeError,fn=function(e){if(g$(e))throw new m$("Can't call method on "+e);return e},b$=ks,w$=fn,Ur=function(e){return b$(w$(e))},Jl=typeof document=="object"&&document.all,Mt=typeof Jl>"u"&&Jl!==void 0?function(e){return typeof e=="function"||e===Jl}:function(e){return typeof e=="function"},S$=Mt,qt=function(e){return typeof e=="object"?e!==null:S$(e)},Ql=yt,_$=Mt,k$=function(e){return _$(e)?e:void 0},Hr=function(e,n){return arguments.length<2?k$(Ql[e]):Ql[e]&&Ql[e][n]},$$=lt,Vn=$$({}.isPrototypeOf),T$=yt,jv=T$.navigator,Uv=jv&&jv.userAgent,ma=Uv?String(Uv):"",Fv=yt,Xl=ma,Dv=Fv.process,Bv=Fv.Deno,qv=Dv&&Dv.versions||Bv&&Bv.version,Wv=qv&&qv.v8,dn,qu;Wv&&(dn=Wv.split("."),qu=dn[0]>0&&dn[0]<4?1:+(dn[0]+dn[1])),!qu&&Xl&&(dn=Xl.match(/Edge\/(\d+)/),(!dn||dn[1]>=74)&&(dn=Xl.match(/Chrome\/(\d+)/),dn&&(qu=+dn[1])));var _i=qu,zv=_i,C$=at,E$=yt,I$=E$.String,ki=!!Object.getOwnPropertySymbols&&!C$(function(){var e=Symbol("symbol detection");return!I$(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&zv&&zv<41}),R$=ki,Gv=R$&&!Symbol.sham&&typeof Symbol.iterator=="symbol",O$=Hr,A$=Mt,P$=Vn,M$=Gv,N$=Object,$i=M$?function(e){return typeof e=="symbol"}:function(e){var n=O$("Symbol");return A$(n)&&P$(n.prototype,N$(e))},x$=String,Va=function(e){try{return x$(e)}catch{return"Object"}},L$=Mt,j$=Va,U$=TypeError,Vr=function(e){if(L$(e))return e;throw new U$(j$(e)+" is not a function")},F$=Vr,D$=cn,Ka=function(e,n){var t=e[n];return D$(t)?void 0:F$(t)},Zl=Pt,ec=Mt,tc=qt,B$=TypeError,q$=function(e,n){var t,r;if(n==="string"&&ec(t=e.toString)&&!tc(r=Zl(t,e))||ec(t=e.valueOf)&&!tc(r=Zl(t,e))||n!=="string"&&ec(t=e.toString)&&!tc(r=Zl(t,e)))return r;throw new B$("Can't convert object to primitive value")},Hv={exports:{}},Vv=!1,Kv=yt,W$=Object.defineProperty,rc=function(e,n){try{W$(Kv,e,{value:n,configurable:!0,writable:!0})}catch{Kv[e]=n}return n},z$=yt,G$=rc,Yv="__core-js_shared__",Jv=Hv.exports=z$[Yv]||G$(Yv,{});(Jv.versions||(Jv.versions=[])).push({version:"3.39.0",mode:"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"});var nc=Hv.exports,Qv=nc,Ti=function(e,n){return Qv[e]||(Qv[e]=n||{})},H$=fn,V$=Object,vr=function(e){return V$(H$(e))},K$=lt,Y$=vr,J$=K$({}.hasOwnProperty),Vt=Object.hasOwn||function(n,t){return J$(Y$(n),t)},Q$=lt,X$=0,Z$=Math.random(),eT=Q$(1 .toString),$s=function(e){return"Symbol("+(e===void 0?"":e)+")_"+eT(++X$+Z$,36)},tT=yt,rT=Ti,Xv=Vt,nT=$s,aT=ki,iT=Gv,Ci=tT.Symbol,ac=rT("wks"),sT=iT?Ci.for||Ci:Ci&&Ci.withoutSetter||nT,Nt=function(e){return Xv(ac,e)||(ac[e]=aT&&Xv(Ci,e)?Ci[e]:sT("Symbol."+e)),ac[e]},uT=Pt,Zv=qt,eh=$i,oT=Ka,lT=q$,cT=Nt,fT=TypeError,dT=cT("toPrimitive"),ic=function(e,n){if(!Zv(e)||eh(e))return e;var t=oT(e,dT),r;if(t){if(n===void 0&&(n="default"),r=uT(t,e,n),!Zv(r)||eh(r))return r;throw new fT("Can't convert object to primitive value")}return n===void 0&&(n="number"),lT(e,n)},pT=ic,vT=$i,Wu=function(e){var n=pT(e,"string");return vT(n)?n:n+""},hT=yt,th=qt,sc=hT.document,yT=th(sc)&&th(sc.createElement),zu=function(e){return yT?sc.createElement(e):{}},gT=Lt,mT=at,bT=zu,rh=!gT&&!mT(function(){return Object.defineProperty(bT("div"),"a",{get:function(){return 7}}).a!==7}),wT=Lt,ST=Pt,_T=_s,kT=Ha,$T=Ur,TT=Wu,CT=Vt,ET=rh,nh=Object.getOwnPropertyDescriptor;Hn.f=wT?nh:function(n,t){if(n=$T(n),t=TT(t),ET)try{return nh(n,t)}catch{}if(CT(n,t))return kT(!ST(_T.f,n,t),n[t])};var wr={},IT=Lt,RT=at,ah=IT&&RT(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),OT=qt,AT=String,PT=TypeError,Jt=function(e){if(OT(e))return e;throw new PT(AT(e)+" is not an object")},MT=Lt,NT=rh,xT=ah,Gu=Jt,ih=Wu,LT=TypeError,uc=Object.defineProperty,jT=Object.getOwnPropertyDescriptor,oc="enumerable",lc="configurable",cc="writable";wr.f=MT?xT?function(n,t,r){if(Gu(n),t=ih(t),Gu(r),typeof n=="function"&&t==="prototype"&&"value"in r&&cc in r&&!r[cc]){var a=jT(n,t);a&&a[cc]&&(n[t]=r.value,r={configurable:lc in r?r[lc]:a[lc],enumerable:oc in r?r[oc]:a[oc],writable:!1})}return uc(n,t,r)}:uc:function(n,t,r){if(Gu(n),t=ih(t),Gu(r),NT)try{return uc(n,t,r)}catch{}if("get"in r||"set"in r)throw new LT("Accessors not supported");return"value"in r&&(n[t]=r.value),n};var UT=Lt,FT=wr,DT=Ha,Kn=UT?function(e,n,t){return FT.f(e,n,DT(1,t))}:function(e,n,t){return e[n]=t,e},sh={exports:{}},fc=Lt,BT=Vt,uh=Function.prototype,qT=fc&&Object.getOwnPropertyDescriptor,dc=BT(uh,"name"),WT=dc&&(function(){}).name==="something",zT=dc&&(!fc||fc&&qT(uh,"name").configurable),Ts={EXISTS:dc,PROPER:WT,CONFIGURABLE:zT},GT=lt,HT=Mt,pc=nc,VT=GT(Function.toString);HT(pc.inspectSource)||(pc.inspectSource=function(e){return VT(e)});var vc=pc.inspectSource,KT=yt,YT=Mt,oh=KT.WeakMap,JT=YT(oh)&&/native code/.test(String(oh)),QT=Ti,XT=$s,lh=QT("keys"),Hu=function(e){return lh[e]||(lh[e]=XT(e))},Cs={},ZT=JT,ch=yt,e1=qt,t1=Kn,hc=Vt,yc=nc,r1=Hu,n1=Cs,fh="Object already initialized",gc=ch.TypeError,a1=ch.WeakMap,Vu,Es,Ku,i1=function(e){return Ku(e)?Es(e):Vu(e,{})},s1=function(e){return function(n){var t;if(!e1(n)||(t=Es(n)).type!==e)throw new gc("Incompatible receiver, "+e+" required");return t}};if(ZT||yc.state){var Rn=yc.state||(yc.state=new a1);Rn.get=Rn.get,Rn.has=Rn.has,Rn.set=Rn.set,Vu=function(e,n){if(Rn.has(e))throw new gc(fh);return n.facade=e,Rn.set(e,n),n},Es=function(e){return Rn.get(e)||{}},Ku=function(e){return Rn.has(e)}}else{var Ei=r1("state");n1[Ei]=!0,Vu=function(e,n){if(hc(e,Ei))throw new gc(fh);return n.facade=e,t1(e,Ei,n),n},Es=function(e){return hc(e,Ei)?e[Ei]:{}},Ku=function(e){return hc(e,Ei)}}var Fr={set:Vu,get:Es,has:Ku,enforce:i1,getterFor:s1},mc=lt,u1=at,o1=Mt,Yu=Vt,bc=Lt,l1=Ts.CONFIGURABLE,c1=vc,dh=Fr,f1=dh.enforce,d1=dh.get,ph=String,Ju=Object.defineProperty,p1=mc("".slice),v1=mc("".replace),h1=mc([].join),y1=bc&&!u1(function(){return Ju(function(){},"length",{value:8}).length!==8}),g1=String(String).split("String"),m1=sh.exports=function(e,n,t){p1(ph(n),0,7)==="Symbol("&&(n="["+v1(ph(n),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),t&&t.getter&&(n="get "+n),t&&t.setter&&(n="set "+n),(!Yu(e,"name")||l1&&e.name!==n)&&(bc?Ju(e,"name",{value:n,configurable:!0}):e.name=n),y1&&t&&Yu(t,"arity")&&e.length!==t.arity&&Ju(e,"length",{value:t.arity});try{t&&Yu(t,"constructor")&&t.constructor?bc&&Ju(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch{}var r=f1(e);return Yu(r,"source")||(r.source=h1(g1,typeof n=="string"?n:"")),e};Function.prototype.toString=m1(function(){return o1(this)&&d1(this).source||c1(this)},"toString");var vh=sh.exports,b1=Mt,w1=wr,S1=vh,_1=rc,Sr=function(e,n,t,r){r||(r={});var a=r.enumerable,i=r.name!==void 0?r.name:n;if(b1(t)&&S1(t,i,r),r.global)a?e[n]=t:_1(n,t);else{try{r.unsafe?e[n]&&(a=!0):delete e[n]}catch{}a?e[n]=t:w1.f(e,n,{value:t,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},Ya={},k1=Math.ceil,$1=Math.floor,T1=Math.trunc||function(n){var t=+n;return(t>0?$1:k1)(t)},C1=T1,On=function(e){var n=+e;return n!==n||n===0?0:C1(n)},E1=On,I1=Math.max,R1=Math.min,Ja=function(e,n){var t=E1(e);return t<0?I1(t+n,0):R1(t,n)},O1=On,A1=Math.min,Yn=function(e){var n=O1(e);return n>0?A1(n,9007199254740991):0},P1=Yn,hr=function(e){return P1(e.length)},M1=Ur,N1=Ja,x1=hr,hh=function(e){return function(n,t,r){var a=M1(n),i=x1(a);if(i===0)return!e&&-1;var s=N1(r,i),o;if(e&&t!==t){for(;i>s;)if(o=a[s++],o!==o)return!0}else for(;i>s;s++)if((e||s in a)&&a[s]===t)return e||s||0;return!e&&-1}},Qu={includes:hh(!0),indexOf:hh(!1)},L1=lt,wc=Vt,j1=Ur,U1=Qu.indexOf,F1=Cs,yh=L1([].push),gh=function(e,n){var t=j1(e),r=0,a=[],i;for(i in t)!wc(F1,i)&&wc(t,i)&&yh(a,i);for(;n.length>r;)wc(t,i=n[r++])&&(~U1(a,i)||yh(a,i));return a},Sc=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],D1=gh,B1=Sc,q1=B1.concat("length","prototype");Ya.f=Object.getOwnPropertyNames||function(n){return D1(n,q1)};var Is={};Is.f=Object.getOwnPropertySymbols;var W1=Hr,z1=lt,G1=Ya,H1=Is,V1=Jt,K1=z1([].concat),mh=W1("Reflect","ownKeys")||function(n){var t=G1.f(V1(n)),r=H1.f;return r?K1(t,r(n)):t},bh=Vt,Y1=mh,J1=Hn,Q1=wr,_c=function(e,n,t){for(var r=Y1(n),a=Q1.f,i=J1.f,s=0;s<r.length;s++){var o=r[s];!bh(e,o)&&!(t&&bh(t,o))&&a(e,o,i(n,o))}},X1=at,Z1=Mt,eC=/#|\.prototype\./,Rs=function(e,n){var t=rC[tC(e)];return t===aC?!0:t===nC?!1:Z1(n)?X1(n):!!n},tC=Rs.normalize=function(e){return String(e).replace(eC,".").toLowerCase()},rC=Rs.data={},nC=Rs.NATIVE="N",aC=Rs.POLYFILL="P",Xu=Rs,Zu=yt,iC=Hn.f,sC=Kn,uC=Sr,oC=rc,lC=_c,cC=Xu,ft=function(e,n){var t=e.target,r=e.global,a=e.stat,i,s,o,u,l,c;if(r?s=Zu:a?s=Zu[t]||oC(t,{}):s=Zu[t]&&Zu[t].prototype,s)for(o in n){if(l=n[o],e.dontCallGetSet?(c=iC(s,o),u=c&&c.value):u=s[o],i=cC(r?o:t+(a?".":"#")+o,e.forced),!i&&u!==void 0){if(typeof l==typeof u)continue;lC(l,u)}(e.sham||u&&u.sham)&&sC(l,"sham",!0),uC(s,o,l,e)}},fC=wr.f,dC=Vt,pC=Nt,wh=pC("toStringTag"),An=function(e,n,t){e&&!t&&(e=e.prototype),e&&!dC(e,wh)&&fC(e,wh,{configurable:!0,value:n})},vC=ft,hC=yt,yC=An;vC({global:!0},{Reflect:{}}),yC(hC.Reflect,"Reflect",!0);var gC=Ss,Sh=Function.prototype,_h=Sh.apply,kh=Sh.call,Qa=typeof Reflect=="object"&&Reflect.apply||(gC?kh.bind(_h):function(){return kh.apply(_h,arguments)}),mC=lt,Pn=mC([].slice),$h=lt,bC=Vr,wC=qt,SC=Vt,Th=Pn,_C=Ss,Ch=Function,kC=$h([].concat),$C=$h([].join),kc={},TC=function(e,n,t){if(!SC(kc,n)){for(var r=[],a=0;a<n;a++)r[a]="a["+a+"]";kc[n]=Ch("C,a","return new C("+$C(r,",")+")")}return kc[n](e,t)},CC=_C?Ch.bind:function(n){var t=bC(this),r=t.prototype,a=Th(arguments,1),i=function(){var o=kC(a,Th(arguments));return this instanceof i?TC(t,o.length,o):t.apply(n,o)};return wC(r)&&(i.prototype=r),i},EC=Nt,IC=EC("toStringTag"),Eh={};Eh[IC]="z";var $c=String(Eh)==="[object z]",RC=$c,OC=Mt,eo=In,AC=Nt,PC=AC("toStringTag"),MC=Object,NC=eo(function(){return arguments}())==="Arguments",xC=function(e,n){try{return e[n]}catch{}},Jn=RC?eo:function(e){var n,t,r;return e===void 0?"Undefined":e===null?"Null":typeof(t=xC(n=MC(e),PC))=="string"?t:NC?eo(n):(r=eo(n))==="Object"&&OC(n.callee)?"Arguments":r},LC=lt,jC=at,Ih=Mt,UC=Jn,FC=Hr,DC=vc,Rh=function(){},Oh=FC("Reflect","construct"),Tc=/^\s*(?:class|function)\b/,BC=LC(Tc.exec),qC=!Tc.test(Rh),Os=function(n){if(!Ih(n))return!1;try{return Oh(Rh,[],n),!0}catch{return!1}},Ah=function(n){if(!Ih(n))return!1;switch(UC(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return qC||!!BC(Tc,DC(n))}catch{return!0}};Ah.sham=!0;var to=!Oh||jC(function(){var e;return Os(Os.call)||!Os(Object)||!Os(function(){e=!0})||e})?Ah:Os,WC=to,zC=Va,GC=TypeError,Cc=function(e){if(WC(e))return e;throw new GC(zC(e)+" is not a constructor")},Ec={},HC=gh,VC=Sc,As=Object.keys||function(n){return HC(n,VC)},KC=Lt,YC=ah,JC=wr,QC=Jt,XC=Ur,ZC=As;Ec.f=KC&&!YC?Object.defineProperties:function(n,t){QC(n);for(var r=XC(t),a=ZC(t),i=a.length,s=0,o;i>s;)JC.f(n,o=a[s++],r[o]);return n};var eE=Hr,Ph=eE("document","documentElement"),tE=Jt,rE=Ec,Mh=Sc,nE=Cs,aE=Ph,iE=zu,sE=Hu,Nh=">",xh="<",Ic="prototype",Rc="script",Lh=sE("IE_PROTO"),Oc=function(){},jh=function(e){return xh+Rc+Nh+e+xh+"/"+Rc+Nh},Uh=function(e){e.write(jh("")),e.close();var n=e.parentWindow.Object;return e=null,n},uE=function(){var e=iE("iframe"),n="java"+Rc+":",t;return e.style.display="none",aE.appendChild(e),e.src=String(n),t=e.contentWindow.document,t.open(),t.write(jh("document.F=Object")),t.close(),t.F},ro,no=function(){try{ro=new ActiveXObject("htmlfile")}catch{}no=typeof document<"u"?document.domain&&ro?Uh(ro):uE():Uh(ro);for(var e=Mh.length;e--;)delete no[Ic][Mh[e]];return no()};nE[Lh]=!0;var ba=Object.create||function(n,t){var r;return n!==null?(Oc[Ic]=tE(n),r=new Oc,Oc[Ic]=null,r[Lh]=n):r=no(),t===void 0?r:rE.f(r,t)},oE=ft,lE=Hr,Ac=Qa,cE=CC,Fh=Cc,fE=Jt,Dh=qt,dE=ba,Bh=at,Pc=lE("Reflect","construct"),pE=Object.prototype,vE=[].push,qh=Bh(function(){function e(){}return!(Pc(function(){},[],e)instanceof e)}),Wh=!Bh(function(){Pc(function(){})}),zh=qh||Wh;oE({target:"Reflect",stat:!0,forced:zh,sham:zh},{construct:function(n,t){Fh(n),fE(t);var r=arguments.length<3?n:Fh(arguments[2]);if(Wh&&!qh)return Pc(n,t,r);if(n===r){switch(t.length){case 0:return new n;case 1:return new n(t[0]);case 2:return new n(t[0],t[1]);case 3:return new n(t[0],t[1],t[2]);case 4:return new n(t[0],t[1],t[2],t[3])}var a=[null];return Ac(vE,a,t),new(Ac(cE,n,a))}var i=r.prototype,s=dE(Dh(i)?i:pE),o=Ac(n,s,t);return Dh(o)?o:s}});var hE=ft,yE=vr,Gh=As,gE=at,mE=gE(function(){Gh(1)});hE({target:"Object",stat:!0,forced:mE},{keys:function(n){return Gh(yE(n))}});var bE=Jn,wE=String,rr=function(e){if(bE(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return wE(e)},Mc={},SE=In,_E=Ur,Hh=Ya.f,kE=Pn,Vh=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],$E=function(e){try{return Hh(e)}catch{return kE(Vh)}};Mc.f=function(n){return Vh&&SE(n)==="Window"?$E(n):Hh(_E(n))};var Kh=vh,TE=wr,Mn=function(e,n,t){return t.get&&Kh(t.get,n,{getter:!0}),t.set&&Kh(t.set,n,{setter:!0}),TE.f(e,n,t)},Nc={},CE=Nt;Nc.f=CE;var EE=yt,Yh=EE,Jh=Yh,IE=Vt,RE=Nc,OE=wr.f,Qh=function(e){var n=Jh.Symbol||(Jh.Symbol={});IE(n,e)||OE(n,e,{value:RE.f(e)})},AE=Pt,PE=Hr,ME=Nt,NE=Sr,xE=function(){var e=PE("Symbol"),n=e&&e.prototype,t=n&&n.valueOf,r=ME("toPrimitive");n&&!n[r]&&NE(n,r,function(a){return AE(t,this)},{arity:1})},LE=In,jE=lt,xc=function(e){if(LE(e)==="Function")return jE(e)},Xh=xc,UE=Vr,FE=Ss,DE=Xh(Xh.bind),Qn=function(e,n){return UE(e),n===void 0?e:FE?DE(e,n):function(){return e.apply(n,arguments)}},BE=In,Ps=Array.isArray||function(n){return BE(n)==="Array"},Zh=Ps,qE=to,WE=qt,zE=Nt,GE=zE("species"),ey=Array,HE=function(e){var n;return Zh(e)&&(n=e.constructor,qE(n)&&(n===ey||Zh(n.prototype))?n=void 0:WE(n)&&(n=n[GE],n===null&&(n=void 0))),n===void 0?ey:n},VE=HE,Lc=function(e,n){return new(VE(e))(n===0?0:n)},KE=Qn,YE=lt,JE=ks,QE=vr,XE=hr,ZE=Lc,ty=YE([].push),wa=function(e){var n=e===1,t=e===2,r=e===3,a=e===4,i=e===6,s=e===7,o=e===5||i;return function(u,l,c,p){for(var S=QE(u),T=JE(S),I=XE(T),x=KE(l,c),U=0,F=p||ZE,V=n?F(u,I):t||s?F(u,0):void 0,Ae,de;I>U;U++)if((o||U in T)&&(Ae=T[U],de=x(Ae,U,S),e))if(n)V[U]=de;else if(de)switch(e){case 3:return!0;case 5:return Ae;case 6:return U;case 2:ty(V,Ae)}else switch(e){case 4:return!1;case 7:ty(V,Ae)}return i?-1:r||a?a:V}},Or={forEach:wa(0),map:wa(1),filter:wa(2),some:wa(3),every:wa(4),find:wa(5),findIndex:wa(6),filterReject:wa(7)},ao=ft,Ms=yt,jc=Pt,eI=lt,Ii=Lt,Ri=ki,tI=at,sr=Vt,rI=Vn,Uc=Jt,io=Ur,Fc=Wu,nI=rr,Dc=Ha,Oi=ba,ry=As,aI=Ya,ny=Mc,iI=Is,ay=Hn,iy=wr,sI=Ec,sy=_s,Bc=Sr,uI=Mn,qc=Ti,oI=Hu,uy=Cs,oy=$s,lI=Nt,cI=Nc,fI=Qh,dI=xE,pI=An,ly=Fr,so=Or.forEach,Ar=oI("hidden"),uo="Symbol",Ns="prototype",vI=ly.set,cy=ly.getterFor(uo),Kr=Object[Ns],Xa=Ms.Symbol,xs=Xa&&Xa[Ns],hI=Ms.RangeError,yI=Ms.TypeError,Wc=Ms.QObject,fy=ay.f,Za=iy.f,dy=ny.f,gI=sy.f,py=eI([].push),Xn=qc("symbols"),Ls=qc("op-symbols"),mI=qc("wks"),zc=!Wc||!Wc[Ns]||!Wc[Ns].findChild,vy=function(e,n,t){var r=fy(Kr,n);r&&delete Kr[n],Za(e,n,t),r&&e!==Kr&&Za(Kr,n,r)},Gc=Ii&&tI(function(){return Oi(Za({},"a",{get:function(){return Za(this,"a",{value:7}).a}})).a!==7})?vy:Za,Hc=function(e,n){var t=Xn[e]=Oi(xs);return vI(t,{type:uo,tag:e,description:n}),Ii||(t.description=n),t},oo=function(n,t,r){n===Kr&&oo(Ls,t,r),Uc(n);var a=Fc(t);return Uc(r),sr(Xn,a)?(r.enumerable?(sr(n,Ar)&&n[Ar][a]&&(n[Ar][a]=!1),r=Oi(r,{enumerable:Dc(0,!1)})):(sr(n,Ar)||Za(n,Ar,Dc(1,Oi(null))),n[Ar][a]=!0),Gc(n,a,r)):Za(n,a,r)},Vc=function(n,t){Uc(n);var r=io(t),a=ry(r).concat(gy(r));return so(a,function(i){(!Ii||jc(Kc,r,i))&&oo(n,i,r[i])}),n},bI=function(n,t){return t===void 0?Oi(n):Vc(Oi(n),t)},Kc=function(n){var t=Fc(n),r=jc(gI,this,t);return this===Kr&&sr(Xn,t)&&!sr(Ls,t)?!1:r||!sr(this,t)||!sr(Xn,t)||sr(this,Ar)&&this[Ar][t]?r:!0},hy=function(n,t){var r=io(n),a=Fc(t);if(!(r===Kr&&sr(Xn,a)&&!sr(Ls,a))){var i=fy(r,a);return i&&sr(Xn,a)&&!(sr(r,Ar)&&r[Ar][a])&&(i.enumerable=!0),i}},yy=function(n){var t=dy(io(n)),r=[];return so(t,function(a){!sr(Xn,a)&&!sr(uy,a)&&py(r,a)}),r},gy=function(e){var n=e===Kr,t=dy(n?Ls:io(e)),r=[];return so(t,function(a){sr(Xn,a)&&(!n||sr(Kr,a))&&py(r,Xn[a])}),r};Ri||(Xa=function(){if(rI(xs,this))throw new yI("Symbol is not a constructor");var n=!arguments.length||arguments[0]===void 0?void 0:nI(arguments[0]),t=oy(n),r=function(a){var i=this===void 0?Ms:this;i===Kr&&jc(r,Ls,a),sr(i,Ar)&&sr(i[Ar],t)&&(i[Ar][t]=!1);var s=Dc(1,a);try{Gc(i,t,s)}catch(o){if(!(o instanceof hI))throw o;vy(i,t,s)}};return Ii&&zc&&Gc(Kr,t,{configurable:!0,set:r}),Hc(t,n)},xs=Xa[Ns],Bc(xs,"toString",function(){return cy(this).tag}),Bc(Xa,"withoutSetter",function(e){return Hc(oy(e),e)}),sy.f=Kc,iy.f=oo,sI.f=Vc,ay.f=hy,aI.f=ny.f=yy,iI.f=gy,cI.f=function(e){return Hc(lI(e),e)},Ii&&(uI(xs,"description",{configurable:!0,get:function(){return cy(this).description}}),Bc(Kr,"propertyIsEnumerable",Kc,{unsafe:!0}))),ao({global:!0,constructor:!0,wrap:!0,forced:!Ri,sham:!Ri},{Symbol:Xa}),so(ry(mI),function(e){fI(e)}),ao({target:uo,stat:!0,forced:!Ri},{useSetter:function(){zc=!0},useSimple:function(){zc=!1}}),ao({target:"Object",stat:!0,forced:!Ri,sham:!Ii},{create:bI,defineProperty:oo,defineProperties:Vc,getOwnPropertyDescriptor:hy}),ao({target:"Object",stat:!0,forced:!Ri},{getOwnPropertyNames:yy}),dI(),pI(Xa,uo),uy[Ar]=!0;var wI=ki,my=wI&&!!Symbol.for&&!!Symbol.keyFor,SI=ft,_I=Hr,kI=Vt,$I=rr,by=Ti,TI=my,Yc=by("string-to-symbol-registry"),CI=by("symbol-to-string-registry");SI({target:"Symbol",stat:!0,forced:!TI},{for:function(e){var n=$I(e);if(kI(Yc,n))return Yc[n];var t=_I("Symbol")(n);return Yc[n]=t,CI[t]=n,t}});var EI=ft,II=Vt,RI=$i,OI=Va,AI=Ti,PI=my,wy=AI("symbol-to-string-registry");EI({target:"Symbol",stat:!0,forced:!PI},{keyFor:function(n){if(!RI(n))throw new TypeError(OI(n)+" is not a symbol");if(II(wy,n))return wy[n]}});var MI=lt,Sy=Ps,NI=Mt,_y=In,xI=rr,ky=MI([].push),LI=function(e){if(NI(e))return e;if(Sy(e)){for(var n=e.length,t=[],r=0;r<n;r++){var a=e[r];typeof a=="string"?ky(t,a):(typeof a=="number"||_y(a)==="Number"||_y(a)==="String")&&ky(t,xI(a))}var i=t.length,s=!0;return function(o,u){if(s)return s=!1,u;if(Sy(this))return u;for(var l=0;l<i;l++)if(t[l]===o)return u}}},jI=ft,$y=Hr,Ty=Qa,UI=Pt,js=lt,Cy=at,Ey=Mt,Iy=$i,Ry=Pn,FI=LI,DI=ki,BI=String,Sa=$y("JSON","stringify"),lo=js(/./.exec),Oy=js("".charAt),qI=js("".charCodeAt),WI=js("".replace),zI=js(1 .toString),GI=/[\uD800-\uDFFF]/g,Ay=/^[\uD800-\uDBFF]$/,Py=/^[\uDC00-\uDFFF]$/,My=!DI||Cy(function(){var e=$y("Symbol")("stringify detection");return Sa([e])!=="[null]"||Sa({a:e})!=="{}"||Sa(Object(e))!=="{}"}),Ny=Cy(function(){return Sa("\uDF06\uD834")!=='"\\udf06\\ud834"'||Sa("\uDEAD")!=='"\\udead"'}),HI=function(e,n){var t=Ry(arguments),r=FI(n);if(!(!Ey(r)&&(e===void 0||Iy(e))))return t[1]=function(a,i){if(Ey(r)&&(i=UI(r,this,BI(a),i)),!Iy(i))return i},Ty(Sa,null,t)},VI=function(e,n,t){var r=Oy(t,n-1),a=Oy(t,n+1);return lo(Ay,e)&&!lo(Py,a)||lo(Py,e)&&!lo(Ay,r)?"\\u"+zI(qI(e,0),16):e};Sa&&jI({target:"JSON",stat:!0,arity:3,forced:My||Ny},{stringify:function(n,t,r){var a=Ry(arguments),i=Ty(My?HI:Sa,null,a);return Ny&&typeof i=="string"?WI(i,GI,VI):i}});var KI=ft,YI=ki,JI=at,xy=Is,QI=vr,XI=!YI||JI(function(){xy.f(1)});KI({target:"Object",stat:!0,forced:XI},{getOwnPropertySymbols:function(n){var t=xy.f;return t?t(QI(n)):[]}});var ZI=at,eR=Nt,tR=_i,rR=eR("species"),Us=function(e){return tR>=51||!ZI(function(){var n=[],t=n.constructor={};return t[rR]=function(){return{foo:1}},n[e](Boolean).foo!==1})},nR=ft,aR=Or.filter,iR=Us,sR=iR("filter");nR({target:"Array",proto:!0,forced:!sR},{filter:function(n){return aR(this,n,arguments.length>1?arguments[1]:void 0)}});var uR=ft,oR=at,lR=Ur,Ly=Hn.f,jy=Lt,cR=!jy||oR(function(){Ly(1)});uR({target:"Object",stat:!0,forced:cR,sham:!jy},{getOwnPropertyDescriptor:function(n,t){return Ly(lR(n),t)}});var fR=Lt,dR=wr,pR=Ha,Fs=function(e,n,t){fR?dR.f(e,n,pR(0,t)):e[n]=t},vR=ft,hR=Lt,yR=mh,gR=Ur,mR=Hn,bR=Fs;vR({target:"Object",stat:!0,sham:!hR},{getOwnPropertyDescriptors:function(n){for(var t=gR(n),r=mR.f,a=yR(t),i={},s=0,o,u;a.length>s;)u=r(t,o=a[s++]),u!==void 0&&bR(i,o,u);return i}});var Uy={exports:{}};(function(e){function n(r,a,i,s,o,u,l){try{var c=r[u](l),p=c.value}catch(S){return void i(S)}c.done?a(p):Promise.resolve(p).then(s,o)}function t(r){return function(){var a=this,i=arguments;return new Promise(function(s,o){var u=r.apply(a,i);function l(p){n(u,s,o,l,c,"next",p)}function c(p){n(u,s,o,l,c,"throw",p)}l(void 0)})}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Uy);var Ds=Uy.exports,Fy={exports:{}};(function(e){function n(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Fy);var ei=Fy.exports,Dy={exports:{}},By={exports:{}};(function(e){function n(t,r){return e.exports=n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,i){return a.__proto__=i,a},e.exports.__esModule=!0,e.exports.default=e.exports,n(t,r)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(By);var Jc=By.exports;(function(e){var n=Jc;function t(r,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(a&&a.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),a&&n(r,a)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Dy);var Nn=Dy.exports,qy={exports:{}},Wy={exports:{}};(function(e){function n(t){"@babel/helpers - typeof";return e.exports=n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Wy);var Yr=Wy.exports;(function(e){var n=Yr.default,t=ei;function r(a,i){if(i&&(n(i)=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return t(a)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(qy);var xn=qy.exports,zy={exports:{}};(function(e){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(zy);var Jr=zy.exports,Gy={exports:{}},Hy={exports:{}},Vy={exports:{}};(function(e){var n=Yr.default;function t(r,a){if(n(r)!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var s=i.call(r,a||"default");if(n(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Vy);var wR=Vy.exports;(function(e){var n=Yr.default,t=wR;function r(a){var i=t(a,"string");return n(i)=="symbol"?i:i+""}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(Hy);var Ky=Hy.exports;(function(e){var n=Ky;function t(r,a,i){return(a=n(a))in r?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i,r}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Gy);var ti=Gy.exports,Yy={exports:{}};(function(e){var n=Ky;function t(a,i){for(var s=0;s<i.length;s++){var o=i[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(a,n(o.key),o)}}function r(a,i,s){return i&&t(a.prototype,i),s&&t(a,s),Object.defineProperty(a,"prototype",{writable:!1}),a}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(Yy);var _a=Yy.exports,Jy={exports:{}};(function(e){function n(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Jy);var Ln=Jy.exports,SR=ft,_R=Or.map,kR=Us,$R=kR("map");SR({target:"Array",proto:!0,forced:!$R},{map:function(n){return _R(this,n,arguments.length>1?arguments[1]:void 0)}});var TR=$c,CR=Jn,ER=TR?{}.toString:function(){return"[object "+CR(this)+"]"},IR=$c,RR=Sr,OR=ER;IR||RR(Object.prototype,"toString",OR,{unsafe:!0});var Qy={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},AR=zu,Qc=AR("span").classList,Xy=Qc&&Qc.constructor&&Qc.constructor.prototype,Zy=Xy===Object.prototype?void 0:Xy,PR=at,co=function(e,n){var t=[][e];return!!t&&PR(function(){t.call(null,n||function(){return 1},1)})},MR=Or.forEach,NR=co,xR=NR("forEach"),LR=xR?[].forEach:function(n){return MR(this,n,arguments.length>1?arguments[1]:void 0)},eg=yt,tg=Qy,jR=Zy,Xc=LR,UR=Kn,rg=function(e){if(e&&e.forEach!==Xc)try{UR(e,"forEach",Xc)}catch{e.forEach=Xc}};for(var Zc in tg)tg[Zc]&&rg(eg[Zc]&&eg[Zc].prototype);rg(jR);var Bs=yt,FR=ma,DR=In,fo=function(e){return FR.slice(0,e.length)===e},ng=function(){return fo("Bun/")?"BUN":fo("Cloudflare-Workers")?"CLOUDFLARE":fo("Deno/")?"DENO":fo("Node.js/")?"NODE":Bs.Bun&&typeof Bun.version=="string"?"BUN":Bs.Deno&&typeof Deno.version=="object"?"DENO":DR(Bs.process)==="process"?"NODE":Bs.window&&Bs.document?"BROWSER":"REST"}(),BR=ng,ef=BR==="NODE",qR=lt,WR=Vr,zR=function(e,n,t){try{return qR(WR(Object.getOwnPropertyDescriptor(e,n)[t]))}catch{}},GR=qt,HR=function(e){return GR(e)||e===null},VR=HR,KR=String,YR=TypeError,JR=function(e){if(VR(e))return e;throw new YR("Can't set "+KR(e)+" as a prototype")},QR=zR,XR=qt,ZR=fn,eO=JR,Ai=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,n={},t;try{t=QR(Object.prototype,"__proto__","set"),t(n,[]),e=n instanceof Array}catch{}return function(a,i){return ZR(a),eO(i),XR(a)&&(e?t(a,i):a.__proto__=i),a}}():void 0),tO=Hr,rO=Mn,nO=Nt,aO=Lt,ag=nO("species"),po=function(e){var n=tO(e);aO&&n&&!n[ag]&&rO(n,ag,{configurable:!0,get:function(){return this}})},iO=Vn,sO=TypeError,ka=function(e,n){if(iO(n,e))return e;throw new sO("Incorrect invocation")},ig=Jt,uO=Cc,oO=cn,lO=Nt,cO=lO("species"),sg=function(e,n){var t=ig(e).constructor,r;return t===void 0||oO(r=ig(t)[cO])?n:uO(r)},fO=TypeError,tf=function(e,n){if(e<n)throw new fO("Not enough arguments");return e},dO=ma,ug=/(?:ipad|iphone|ipod).*applewebkit/i.test(dO),Dr=yt,pO=Qa,vO=Qn,og=Mt,hO=Vt,lg=at,cg=Ph,yO=Pn,fg=zu,gO=tf,mO=ug,bO=ef,rf=Dr.setImmediate,nf=Dr.clearImmediate,wO=Dr.process,af=Dr.Dispatch,SO=Dr.Function,dg=Dr.MessageChannel,_O=Dr.String,sf=0,qs={},pg="onreadystatechange",Ws,ri,uf,of;lg(function(){Ws=Dr.location});var lf=function(e){if(hO(qs,e)){var n=qs[e];delete qs[e],n()}},cf=function(e){return function(){lf(e)}},vg=function(e){lf(e.data)},hg=function(e){Dr.postMessage(_O(e),Ws.protocol+"//"+Ws.host)};(!rf||!nf)&&(rf=function(n){gO(arguments.length,1);var t=og(n)?n:SO(n),r=yO(arguments,1);return qs[++sf]=function(){pO(t,void 0,r)},ri(sf),sf},nf=function(n){delete qs[n]},bO?ri=function(e){wO.nextTick(cf(e))}:af&&af.now?ri=function(e){af.now(cf(e))}:dg&&!mO?(uf=new dg,of=uf.port2,uf.port1.onmessage=vg,ri=vO(of.postMessage,of)):Dr.addEventListener&&og(Dr.postMessage)&&!Dr.importScripts&&Ws&&Ws.protocol!=="file:"&&!lg(hg)?(ri=hg,Dr.addEventListener("message",vg,!1)):pg in fg("script")?ri=function(e){cg.appendChild(fg("script"))[pg]=function(){cg.removeChild(this),lf(e)}}:ri=function(e){setTimeout(cf(e),0)});var yg={set:rf,clear:nf},gg=yt,kO=Lt,$O=Object.getOwnPropertyDescriptor,mg=function(e){if(!kO)return gg[e];var n=$O(gg,e);return n&&n.value},bg=function(){this.head=null,this.tail=null};bg.prototype={add:function(e){var n={item:e,next:null},t=this.tail;t?t.next=n:this.head=n,this.tail=n},get:function(){var e=this.head;if(e){var n=this.head=e.next;return n===null&&(this.tail=null),e.item}}};var wg=bg,TO=ma,CO=/ipad|iphone|ipod/i.test(TO)&&typeof Pebble<"u",EO=ma,IO=/web0s(?!.*chrome)/i.test(EO),Pi=yt,RO=mg,Sg=Qn,ff=yg.set,OO=wg,AO=ug,PO=CO,MO=IO,df=ef,_g=Pi.MutationObserver||Pi.WebKitMutationObserver,kg=Pi.document,$g=Pi.process,vo=Pi.Promise,pf=RO("queueMicrotask"),Mi,vf,hf,ho,Tg;if(!pf){var yo=new OO,go=function(){var e,n;for(df&&(e=$g.domain)&&e.exit();n=yo.get();)try{n()}catch(t){throw yo.head&&Mi(),t}e&&e.enter()};!AO&&!df&&!MO&&_g&&kg?(vf=!0,hf=kg.createTextNode(""),new _g(go).observe(hf,{characterData:!0}),Mi=function(){hf.data=vf=!vf}):!PO&&vo&&vo.resolve?(ho=vo.resolve(void 0),ho.constructor=vo,Tg=Sg(ho.then,ho),Mi=function(){Tg(go)}):df?Mi=function(){$g.nextTick(go)}:(ff=Sg(ff,Pi),Mi=function(){ff(go)}),pf=function(e){yo.head||Mi(),yo.add(e)}}var NO=pf,xO=function(e,n){try{arguments.length===1?console.error(e):console.error(e,n)}catch{}},yf=function(e){try{return{error:!1,value:e()}}catch(n){return{error:!0,value:n}}},LO=yt,mo=LO.Promise,jO=yt,zs=mo,UO=Mt,FO=Xu,DO=vc,BO=Nt,Cg=ng,gf=_i;zs&&zs.prototype;var qO=BO("species"),mf=!1,Eg=UO(jO.PromiseRejectionEvent),WO=FO("Promise",function(){var e=DO(zs),n=e!==String(zs);if(!n&&gf===66)return!0;if(!gf||gf<51||!/native code/.test(e)){var t=new zs(function(i){i(1)}),r=function(i){i(function(){},function(){})},a=t.constructor={};if(a[qO]=r,mf=t.then(function(){})instanceof r,!mf)return!0}return!n&&(Cg==="BROWSER"||Cg==="DENO")&&!Eg}),Gs={CONSTRUCTOR:WO,REJECTION_EVENT:Eg,SUBCLASSING:mf},Ni={},Ig=Vr,zO=TypeError,GO=function(e){var n,t;this.promise=new e(function(r,a){if(n!==void 0||t!==void 0)throw new zO("Bad Promise constructor");n=r,t=a}),this.resolve=Ig(n),this.reject=Ig(t)};Ni.f=function(e){return new GO(e)};var HO=ft,bo=ef,$a=yt,xi=Pt,Rg=Sr,Og=Ai,VO=An,KO=po,YO=Vr,wo=Mt,JO=qt,QO=ka,XO=sg,Ag=yg.set,bf=NO,ZO=xO,eA=yf,tA=wg,Pg=Fr,So=mo,wf=Gs,Mg=Ni,_o="Promise",Ng=wf.CONSTRUCTOR,rA=wf.REJECTION_EVENT,nA=wf.SUBCLASSING,Sf=Pg.getterFor(_o),aA=Pg.set,Li=So&&So.prototype,ni=So,ko=Li,xg=$a.TypeError,_f=$a.document,kf=$a.process,$f=Mg.f,iA=$f,sA=!!(_f&&_f.createEvent&&$a.dispatchEvent),Lg="unhandledrejection",uA="rejectionhandled",jg=0,Ug=1,oA=2,Tf=1,Fg=2,$o,Dg,lA,Bg,qg=function(e){var n;return JO(e)&&wo(n=e.then)?n:!1},Wg=function(e,n){var t=n.value,r=n.state===Ug,a=r?e.ok:e.fail,i=e.resolve,s=e.reject,o=e.domain,u,l,c;try{a?(r||(n.rejection===Fg&&fA(n),n.rejection=Tf),a===!0?u=t:(o&&o.enter(),u=a(t),o&&(o.exit(),c=!0)),u===e.promise?s(new xg("Promise-chain cycle")):(l=qg(u))?xi(l,u,i,s):i(u)):s(t)}catch(p){o&&!c&&o.exit(),s(p)}},zg=function(e,n){e.notified||(e.notified=!0,bf(function(){for(var t=e.reactions,r;r=t.get();)Wg(r,e);e.notified=!1,n&&!e.rejection&&cA(e)}))},Gg=function(e,n,t){var r,a;sA?(r=_f.createEvent("Event"),r.promise=n,r.reason=t,r.initEvent(e,!1,!0),$a.dispatchEvent(r)):r={promise:n,reason:t},!rA&&(a=$a["on"+e])?a(r):e===Lg&&ZO("Unhandled promise rejection",t)},cA=function(e){xi(Ag,$a,function(){var n=e.facade,t=e.value,r=Hg(e),a;if(r&&(a=eA(function(){bo?kf.emit("unhandledRejection",t,n):Gg(Lg,n,t)}),e.rejection=bo||Hg(e)?Fg:Tf,a.error))throw a.value})},Hg=function(e){return e.rejection!==Tf&&!e.parent},fA=function(e){xi(Ag,$a,function(){var n=e.facade;bo?kf.emit("rejectionHandled",n):Gg(uA,n,e.value)})},ji=function(e,n,t){return function(r){e(n,r,t)}},Ui=function(e,n,t){e.done||(e.done=!0,t&&(e=t),e.value=n,e.state=oA,zg(e,!0))},Cf=function(e,n,t){if(!e.done){e.done=!0,t&&(e=t);try{if(e.facade===n)throw new xg("Promise can't be resolved itself");var r=qg(n);r?bf(function(){var a={done:!1};try{xi(r,n,ji(Cf,a,e),ji(Ui,a,e))}catch(i){Ui(a,i,e)}}):(e.value=n,e.state=Ug,zg(e,!1))}catch(a){Ui({done:!1},a,e)}}};if(Ng&&(ni=function(n){QO(this,ko),YO(n),xi($o,this);var t=Sf(this);try{n(ji(Cf,t),ji(Ui,t))}catch(r){Ui(t,r)}},ko=ni.prototype,$o=function(n){aA(this,{type:_o,done:!1,notified:!1,parent:!1,reactions:new tA,rejection:!1,state:jg,value:null})},$o.prototype=Rg(ko,"then",function(n,t){var r=Sf(this),a=$f(XO(this,ni));return r.parent=!0,a.ok=wo(n)?n:!0,a.fail=wo(t)&&t,a.domain=bo?kf.domain:void 0,r.state===jg?r.reactions.add(a):bf(function(){Wg(a,r)}),a.promise}),Dg=function(){var e=new $o,n=Sf(e);this.promise=e,this.resolve=ji(Cf,n),this.reject=ji(Ui,n)},Mg.f=$f=function(e){return e===ni||e===lA?new Dg(e):iA(e)},wo(So)&&Li!==Object.prototype)){Bg=Li.then,nA||Rg(Li,"then",function(n,t){var r=this;return new ni(function(a,i){xi(Bg,r,a,i)}).then(n,t)},{unsafe:!0});try{delete Li.constructor}catch{}Og&&Og(Li,ko)}HO({global:!0,constructor:!0,wrap:!0,forced:Ng},{Promise:ni}),VO(ni,_o,!1),KO(_o);var Hs={},dA=Nt,pA=Hs,vA=dA("iterator"),hA=Array.prototype,Ef=function(e){return e!==void 0&&(pA.Array===e||hA[vA]===e)},yA=Jn,Vg=Ka,gA=cn,mA=Hs,bA=Nt,wA=bA("iterator"),Vs=function(e){if(!gA(e))return Vg(e,wA)||Vg(e,"@@iterator")||mA[yA(e)]},SA=Pt,_A=Vr,kA=Jt,$A=Va,TA=Vs,CA=TypeError,To=function(e,n){var t=arguments.length<2?TA(e):n;if(_A(t))return kA(SA(t,e));throw new CA($A(e)+" is not iterable")},EA=Pt,Kg=Jt,IA=Ka,Yg=function(e,n,t){var r,a;Kg(e);try{if(r=IA(e,"return"),!r){if(n==="throw")throw t;return t}r=EA(r,e)}catch(i){a=!0,r=i}if(n==="throw")throw t;if(a)throw r;return Kg(r),t},RA=Qn,OA=Pt,AA=Jt,PA=Va,MA=Ef,NA=hr,Jg=Vn,xA=To,LA=Vs,Qg=Yg,jA=TypeError,Co=function(e,n){this.stopped=e,this.result=n},Xg=Co.prototype,Ks=function(e,n,t){var r=t&&t.that,a=!!(t&&t.AS_ENTRIES),i=!!(t&&t.IS_RECORD),s=!!(t&&t.IS_ITERATOR),o=!!(t&&t.INTERRUPTED),u=RA(n,r),l,c,p,S,T,I,x,U=function(V){return l&&Qg(l,"normal",V),new Co(!0,V)},F=function(V){return a?(AA(V),o?u(V[0],V[1],U):u(V[0],V[1])):o?u(V,U):u(V)};if(i)l=e.iterator;else if(s)l=e;else{if(c=LA(e),!c)throw new jA(PA(e)+" is not iterable");if(MA(c)){for(p=0,S=NA(e);S>p;p++)if(T=F(e[p]),T&&Jg(Xg,T))return T;return new Co(!1)}l=xA(e,c)}for(I=i?e.next:l.next;!(x=OA(I,l)).done;){try{T=F(x.value)}catch(V){Qg(l,"throw",V)}if(typeof T=="object"&&T&&Jg(Xg,T))return T}return new Co(!1)},UA=Nt,Zg=UA("iterator"),em=!1;try{var FA=0,tm={next:function(){return{done:!!FA++}},return:function(){em=!0}};tm[Zg]=function(){return this},Array.from(tm,function(){throw 2})}catch{}var Eo=function(e,n){try{if(!n&&!em)return!1}catch{return!1}var t=!1;try{var r={};r[Zg]=function(){return{next:function(){return{done:t=!0}}}},e(r)}catch{}return t},DA=mo,BA=Eo,qA=Gs.CONSTRUCTOR,rm=qA||!BA(function(e){DA.all(e).then(void 0,function(){})}),WA=ft,zA=Pt,GA=Vr,HA=Ni,VA=yf,KA=Ks,YA=rm;WA({target:"Promise",stat:!0,forced:YA},{all:function(n){var t=this,r=HA.f(t),a=r.resolve,i=r.reject,s=VA(function(){var o=GA(t.resolve),u=[],l=0,c=1;KA(n,function(p){var S=l++,T=!1;c++,zA(o,t,p).then(function(I){T||(T=!0,u[S]=I,--c||a(u))},i)}),--c||a(u)});return s.error&&i(s.value),r.promise}});var JA=ft,QA=Gs.CONSTRUCTOR,If=mo,XA=Hr,ZA=Mt,eP=Sr,nm=If&&If.prototype;if(JA({target:"Promise",proto:!0,forced:QA,real:!0},{catch:function(e){return this.then(void 0,e)}}),ZA(If)){var am=XA("Promise").prototype.catch;nm.catch!==am&&eP(nm,"catch",am,{unsafe:!0})}var tP=ft,rP=Pt,nP=Vr,aP=Ni,iP=yf,sP=Ks,uP=rm;tP({target:"Promise",stat:!0,forced:uP},{race:function(n){var t=this,r=aP.f(t),a=r.reject,i=iP(function(){var s=nP(t.resolve);sP(n,function(o){rP(s,t,o).then(r.resolve,a)})});return i.error&&a(i.value),r.promise}});var oP=ft,lP=Ni,cP=Gs.CONSTRUCTOR;oP({target:"Promise",stat:!0,forced:cP},{reject:function(n){var t=lP.f(this),r=t.reject;return r(n),t.promise}});var fP=Jt,dP=qt,pP=Ni,vP=function(e,n){if(fP(e),dP(n)&&n.constructor===e)return n;var t=pP.f(e),r=t.resolve;return r(n),t.promise},hP=ft,yP=Hr,gP=Gs.CONSTRUCTOR,mP=vP;yP("Promise"),hP({target:"Promise",stat:!0,forced:gP},{resolve:function(n){return mP(this,n)}});var im={exports:{}};(function(e){var n=Yr.default;function t(){e.exports=t=function(){return a},e.exports.__esModule=!0,e.exports.default=e.exports;var r,a={},i=Object.prototype,s=i.hasOwnProperty,o=Object.defineProperty||function(se,ie,O){se[ie]=O.value},u=typeof Symbol=="function"?Symbol:{},l=u.iterator||"@@iterator",c=u.asyncIterator||"@@asyncIterator",p=u.toStringTag||"@@toStringTag";function S(se,ie,O){return Object.defineProperty(se,ie,{value:O,enumerable:!0,configurable:!0,writable:!0}),se[ie]}try{S({},"")}catch{S=function(O,Ie,Je){return O[Ie]=Je}}function T(se,ie,O,Ie){var Je=ie&&ie.prototype instanceof de?ie:de,Me=Object.create(Je.prototype),be=new mt(Ie||[]);return o(Me,"_invoke",{value:Z(se,O,be)}),Me}function I(se,ie,O){try{return{type:"normal",arg:se.call(ie,O)}}catch(Ie){return{type:"throw",arg:Ie}}}a.wrap=T;var x="suspendedStart",U="suspendedYield",F="executing",V="completed",Ae={};function de(){}function Ge(){}function Ee(){}var Ue={};S(Ue,l,function(){return this});var B=Object.getPrototypeOf,ce=B&&B(B(Ce([])));ce&&ce!==i&&s.call(ce,l)&&(Ue=ce);var ke=Ee.prototype=de.prototype=Object.create(Ue);function pe(se){["next","throw","return"].forEach(function(ie){S(se,ie,function(O){return this._invoke(ie,O)})})}function Le(se,ie){function O(Je,Me,be,z){var xt=I(se[Je],se,Me);if(xt.type!=="throw"){var ye=xt.arg,te=ye.value;return te&&n(te)=="object"&&s.call(te,"__await")?ie.resolve(te.__await).then(function(St){O("next",St,be,z)},function(St){O("throw",St,be,z)}):ie.resolve(te).then(function(St){ye.value=St,be(ye)},function(St){return O("throw",St,be,z)})}z(xt.arg)}var Ie;o(this,"_invoke",{value:function(Me,be){function z(){return new ie(function(xt,ye){O(Me,be,xt,ye)})}return Ie=Ie?Ie.then(z,z):z()}})}function Z(se,ie,O){var Ie=x;return function(Je,Me){if(Ie===F)throw Error("Generator is already running");if(Ie===V){if(Je==="throw")throw Me;return{value:r,done:!0}}for(O.method=Je,O.arg=Me;;){var be=O.delegate;if(be){var z=Pe(be,O);if(z){if(z===Ae)continue;return z}}if(O.method==="next")O.sent=O._sent=O.arg;else if(O.method==="throw"){if(Ie===x)throw Ie=V,O.arg;O.dispatchException(O.arg)}else O.method==="return"&&O.abrupt("return",O.arg);Ie=F;var xt=I(se,ie,O);if(xt.type==="normal"){if(Ie=O.done?V:U,xt.arg===Ae)continue;return{value:xt.arg,done:O.done}}xt.type==="throw"&&(Ie=V,O.method="throw",O.arg=xt.arg)}}}function Pe(se,ie){var O=ie.method,Ie=se.iterator[O];if(Ie===r)return ie.delegate=null,O==="throw"&&se.iterator.return&&(ie.method="return",ie.arg=r,Pe(se,ie),ie.method==="throw")||O!=="return"&&(ie.method="throw",ie.arg=new TypeError("The iterator does not provide a '"+O+"' method")),Ae;var Je=I(Ie,se.iterator,ie.arg);if(Je.type==="throw")return ie.method="throw",ie.arg=Je.arg,ie.delegate=null,Ae;var Me=Je.arg;return Me?Me.done?(ie[se.resultName]=Me.value,ie.next=se.nextLoc,ie.method!=="return"&&(ie.method="next",ie.arg=r),ie.delegate=null,Ae):Me:(ie.method="throw",ie.arg=new TypeError("iterator result is not an object"),ie.delegate=null,Ae)}function Fe(se){var ie={tryLoc:se[0]};1 in se&&(ie.catchLoc=se[1]),2 in se&&(ie.finallyLoc=se[2],ie.afterLoc=se[3]),this.tryEntries.push(ie)}function wt(se){var ie=se.completion||{};ie.type="normal",delete ie.arg,se.completion=ie}function mt(se){this.tryEntries=[{tryLoc:"root"}],se.forEach(Fe,this),this.reset(!0)}function Ce(se){if(se||se===""){var ie=se[l];if(ie)return ie.call(se);if(typeof se.next=="function")return se;if(!isNaN(se.length)){var O=-1,Ie=function Je(){for(;++O<se.length;)if(s.call(se,O))return Je.value=se[O],Je.done=!1,Je;return Je.value=r,Je.done=!0,Je};return Ie.next=Ie}}throw new TypeError(n(se)+" is not iterable")}return Ge.prototype=Ee,o(ke,"constructor",{value:Ee,configurable:!0}),o(Ee,"constructor",{value:Ge,configurable:!0}),Ge.displayName=S(Ee,p,"GeneratorFunction"),a.isGeneratorFunction=function(se){var ie=typeof se=="function"&&se.constructor;return!!ie&&(ie===Ge||(ie.displayName||ie.name)==="GeneratorFunction")},a.mark=function(se){return Object.setPrototypeOf?Object.setPrototypeOf(se,Ee):(se.__proto__=Ee,S(se,p,"GeneratorFunction")),se.prototype=Object.create(ke),se},a.awrap=function(se){return{__await:se}},pe(Le.prototype),S(Le.prototype,c,function(){return this}),a.AsyncIterator=Le,a.async=function(se,ie,O,Ie,Je){Je===void 0&&(Je=Promise);var Me=new Le(T(se,ie,O,Ie),Je);return a.isGeneratorFunction(ie)?Me:Me.next().then(function(be){return be.done?be.value:Me.next()})},pe(ke),S(ke,p,"Generator"),S(ke,l,function(){return this}),S(ke,"toString",function(){return"[object Generator]"}),a.keys=function(se){var ie=Object(se),O=[];for(var Ie in ie)O.push(Ie);return O.reverse(),function Je(){for(;O.length;){var Me=O.pop();if(Me in ie)return Je.value=Me,Je.done=!1,Je}return Je.done=!0,Je}},a.values=Ce,mt.prototype={constructor:mt,reset:function(ie){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(wt),!ie)for(var O in this)O.charAt(0)==="t"&&s.call(this,O)&&!isNaN(+O.slice(1))&&(this[O]=r)},stop:function(){this.done=!0;var ie=this.tryEntries[0].completion;if(ie.type==="throw")throw ie.arg;return this.rval},dispatchException:function(ie){if(this.done)throw ie;var O=this;function Ie(ye,te){return be.type="throw",be.arg=ie,O.next=ye,te&&(O.method="next",O.arg=r),!!te}for(var Je=this.tryEntries.length-1;Je>=0;--Je){var Me=this.tryEntries[Je],be=Me.completion;if(Me.tryLoc==="root")return Ie("end");if(Me.tryLoc<=this.prev){var z=s.call(Me,"catchLoc"),xt=s.call(Me,"finallyLoc");if(z&&xt){if(this.prev<Me.catchLoc)return Ie(Me.catchLoc,!0);if(this.prev<Me.finallyLoc)return Ie(Me.finallyLoc)}else if(z){if(this.prev<Me.catchLoc)return Ie(Me.catchLoc,!0)}else{if(!xt)throw Error("try statement without catch or finally");if(this.prev<Me.finallyLoc)return Ie(Me.finallyLoc)}}}},abrupt:function(ie,O){for(var Ie=this.tryEntries.length-1;Ie>=0;--Ie){var Je=this.tryEntries[Ie];if(Je.tryLoc<=this.prev&&s.call(Je,"finallyLoc")&&this.prev<Je.finallyLoc){var Me=Je;break}}Me&&(ie==="break"||ie==="continue")&&Me.tryLoc<=O&&O<=Me.finallyLoc&&(Me=null);var be=Me?Me.completion:{};return be.type=ie,be.arg=O,Me?(this.method="next",this.next=Me.finallyLoc,Ae):this.complete(be)},complete:function(ie,O){if(ie.type==="throw")throw ie.arg;return ie.type==="break"||ie.type==="continue"?this.next=ie.arg:ie.type==="return"?(this.rval=this.arg=ie.arg,this.method="return",this.next="end"):ie.type==="normal"&&O&&(this.next=O),Ae},finish:function(ie){for(var O=this.tryEntries.length-1;O>=0;--O){var Ie=this.tryEntries[O];if(Ie.finallyLoc===ie)return this.complete(Ie.completion,Ie.afterLoc),wt(Ie),Ae}},catch:function(ie){for(var O=this.tryEntries.length-1;O>=0;--O){var Ie=this.tryEntries[O];if(Ie.tryLoc===ie){var Je=Ie.completion;if(Je.type==="throw"){var Me=Je.arg;wt(Ie)}return Me}}throw Error("illegal catch attempt")},delegateYield:function(ie,O,Ie){return this.delegate={iterator:Ce(ie),resultName:O,nextLoc:Ie},this.method==="next"&&(this.arg=r),Ae}},a}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(im);var bP=im.exports,Io=bP(),Ys=Io;try{regeneratorRuntime=Io}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=Io:Function("r","regeneratorRuntime = r")(Io)}var wP=TypeError,SP=9007199254740991,sm=function(e){if(e>SP)throw wP("Maximum allowed index exceeded");return e},_P=ft,kP=at,$P=Ps,TP=qt,CP=vr,EP=hr,um=sm,om=Fs,IP=Lc,RP=Us,OP=Nt,AP=_i,lm=OP("isConcatSpreadable"),PP=AP>=51||!kP(function(){var e=[];return e[lm]=!1,e.concat()[0]!==e}),MP=function(e){if(!TP(e))return!1;var n=e[lm];return n!==void 0?!!n:$P(e)},NP=!PP||!RP("concat");_P({target:"Array",proto:!0,arity:1,forced:NP},{concat:function(n){var t=CP(this),r=IP(t,0),a=0,i,s,o,u,l;for(i=-1,o=arguments.length;i<o;i++)if(l=i===-1?t:arguments[i],MP(l))for(u=EP(l),um(a+u),s=0;s<u;s++,a++)s in l&&om(r,a,l[s]);else um(a+1),om(r,a++,l);return r.length=a,r}});var xP=Jt,LP=Yg,jP=function(e,n,t,r){try{return r?n(xP(t)[0],t[1]):n(t)}catch(a){LP(e,"throw",a)}},UP=Qn,FP=Pt,DP=vr,BP=jP,qP=Ef,WP=to,zP=hr,cm=Fs,GP=To,HP=Vs,fm=Array,dm=function(n){var t=DP(n),r=WP(this),a=arguments.length,i=a>1?arguments[1]:void 0,s=i!==void 0;s&&(i=UP(i,a>2?arguments[2]:void 0));var o=HP(t),u=0,l,c,p,S,T,I;if(o&&!(this===fm&&qP(o)))for(c=r?new this:[],S=GP(t,o),T=S.next;!(p=FP(T,S)).done;u++)I=s?BP(S,i,[p.value,u],!0):p.value,cm(c,u,I);else for(l=zP(t),c=r?new this(l):fm(l);l>u;u++)I=s?i(t[u],u):t[u],cm(c,u,I);return c.length=u,c},VP=ft,KP=dm,YP=Eo,JP=!YP(function(e){Array.from(e)});VP({target:"Array",stat:!0,forced:JP},{from:KP});var Rf=lt,QP=On,XP=rr,ZP=fn,e2=Rf("".charAt),pm=Rf("".charCodeAt),t2=Rf("".slice),vm=function(e){return function(n,t){var r=XP(ZP(n)),a=QP(t),i=r.length,s,o;return a<0||a>=i?e?"":void 0:(s=pm(r,a),s<55296||s>56319||a+1===i||(o=pm(r,a+1))<56320||o>57343?e?e2(r,a):s:e?t2(r,a,a+2):(s-55296<<10)+(o-56320)+65536)}},Of={codeAt:vm(!1),charAt:vm(!0)},r2=at,n2=!r2(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),a2=Vt,i2=Mt,s2=vr,u2=Hu,o2=n2,hm=u2("IE_PROTO"),Af=Object,l2=Af.prototype,Js=o2?Af.getPrototypeOf:function(e){var n=s2(e);if(a2(n,hm))return n[hm];var t=n.constructor;return i2(t)&&n instanceof t?t.prototype:n instanceof Af?l2:null},c2=at,f2=Mt,d2=qt,ym=Js,p2=Sr,v2=Nt,Pf=v2("iterator"),gm=!1,ai,Mf,Nf;[].keys&&(Nf=[].keys(),"next"in Nf?(Mf=ym(ym(Nf)),Mf!==Object.prototype&&(ai=Mf)):gm=!0);var h2=!d2(ai)||c2(function(){var e={};return ai[Pf].call(e)!==e});h2&&(ai={}),f2(ai[Pf])||p2(ai,Pf,function(){return this});var mm={IteratorPrototype:ai,BUGGY_SAFARI_ITERATORS:gm},y2=mm.IteratorPrototype,g2=ba,m2=Ha,b2=An,w2=Hs,S2=function(){return this},bm=function(e,n,t,r){var a=n+" Iterator";return e.prototype=g2(y2,{next:m2(+!r,t)}),b2(e,a,!1),w2[a]=S2,e},_2=ft,k2=Pt,wm=Ts,$2=Mt,T2=bm,Sm=Js,_m=Ai,C2=An,E2=Kn,xf=Sr,I2=Nt,R2=Hs,km=mm,O2=wm.PROPER,A2=wm.CONFIGURABLE,$m=km.IteratorPrototype,Ro=km.BUGGY_SAFARI_ITERATORS,Qs=I2("iterator"),Tm="keys",Xs="values",Cm="entries",P2=function(){return this},Lf=function(e,n,t,r,a,i,s){T2(t,n,r);var o=function(F){if(F===a&&S)return S;if(!Ro&&F&&F in c)return c[F];switch(F){case Tm:return function(){return new t(this,F)};case Xs:return function(){return new t(this,F)};case Cm:return function(){return new t(this,F)}}return function(){return new t(this)}},u=n+" Iterator",l=!1,c=e.prototype,p=c[Qs]||c["@@iterator"]||a&&c[a],S=!Ro&&p||o(a),T=n==="Array"&&c.entries||p,I,x,U;if(T&&(I=Sm(T.call(new e)),I!==Object.prototype&&I.next&&(Sm(I)!==$m&&(_m?_m(I,$m):$2(I[Qs])||xf(I,Qs,P2)),C2(I,u,!0))),O2&&a===Xs&&p&&p.name!==Xs&&(A2?E2(c,"name",Xs):(l=!0,S=function(){return k2(p,this)})),a)if(x={values:o(Xs),keys:i?S:o(Tm),entries:o(Cm)},s)for(U in x)(Ro||l||!(U in c))&&xf(c,U,x[U]);else _2({target:n,proto:!0,forced:Ro||l},x);return c[Qs]!==S&&xf(c,Qs,S,{name:a}),R2[n]=S,x},Oo=function(e,n){return{value:e,done:n}},M2=Of.charAt,N2=rr,Em=Fr,x2=Lf,Im=Oo,Rm="String Iterator",L2=Em.set,j2=Em.getterFor(Rm);x2(String,"String",function(e){L2(this,{type:Rm,string:N2(e),index:0})},function(){var n=j2(this),t=n.string,r=n.index,a;return r>=t.length?Im(void 0,!0):(a=M2(t,r),n.index+=a.length,Im(a,!1))});var Om={exports:{}};(function(e){(function(n,t){e.exports?e.exports=t():n.log=t()})(Rr,function(){var n=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"],i={},s=null;function o(x,U){var F=x[U];if(typeof F.bind=="function")return F.bind(x);try{return Function.prototype.bind.call(F,x)}catch{return function(){return Function.prototype.apply.apply(F,[x,arguments])}}}function u(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(x){return x==="debug"&&(x="log"),typeof console===t?!1:x==="trace"&&r?u:console[x]!==void 0?o(console,x):console.log!==void 0?o(console,"log"):n}function c(){for(var x=this.getLevel(),U=0;U<a.length;U++){var F=a[U];this[F]=U<x?n:this.methodFactory(F,x,this.name)}if(this.log=this.debug,typeof console===t&&x<this.levels.SILENT)return"No console available for logging"}function p(x){return function(){typeof console!==t&&(c.call(this),this[x].apply(this,arguments))}}function S(x,U,F){return l(x)||p.apply(this,arguments)}function T(x,U){var F=this,V,Ae,de,Ge="loglevel";typeof x=="string"?Ge+=":"+x:typeof x=="symbol"&&(Ge=void 0);function Ee(pe){var Le=(a[pe]||"silent").toUpperCase();if(!(typeof window===t||!Ge)){try{window.localStorage[Ge]=Le;return}catch{}try{window.document.cookie=encodeURIComponent(Ge)+"="+Le+";"}catch{}}}function Ue(){var pe;if(!(typeof window===t||!Ge)){try{pe=window.localStorage[Ge]}catch{}if(typeof pe===t)try{var Le=window.document.cookie,Z=encodeURIComponent(Ge),Pe=Le.indexOf(Z+"=");Pe!==-1&&(pe=/^([^;]+)/.exec(Le.slice(Pe+Z.length+1))[1])}catch{}return F.levels[pe]===void 0&&(pe=void 0),pe}}function B(){if(!(typeof window===t||!Ge)){try{window.localStorage.removeItem(Ge)}catch{}try{window.document.cookie=encodeURIComponent(Ge)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function ce(pe){var Le=pe;if(typeof Le=="string"&&F.levels[Le.toUpperCase()]!==void 0&&(Le=F.levels[Le.toUpperCase()]),typeof Le=="number"&&Le>=0&&Le<=F.levels.SILENT)return Le;throw new TypeError("log.setLevel() called with invalid level: "+pe)}F.name=x,F.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},F.methodFactory=U||S,F.getLevel=function(){return de??Ae??V},F.setLevel=function(pe,Le){return de=ce(pe),Le!==!1&&Ee(de),c.call(F)},F.setDefaultLevel=function(pe){Ae=ce(pe),Ue()||F.setLevel(pe,!1)},F.resetLevel=function(){de=null,B(),c.call(F)},F.enableAll=function(pe){F.setLevel(F.levels.TRACE,pe)},F.disableAll=function(pe){F.setLevel(F.levels.SILENT,pe)},F.rebuild=function(){if(s!==F&&(V=ce(s.getLevel())),c.call(F),s===F)for(var pe in i)i[pe].rebuild()},V=ce(s?s.getLevel():"WARN");var ke=Ue();ke!=null&&(de=ce(ke)),c.call(F)}s=new T,s.getLogger=function(U){if(typeof U!="symbol"&&typeof U!="string"||U==="")throw new TypeError("You must supply a name when creating a logger.");var F=i[U];return F||(F=i[U]=new T(U,s.methodFactory)),F};var I=typeof window!==t?window.log:void 0;return s.noConflict=function(){return typeof window!==t&&window.log===s&&(window.log=I),s},s.getLoggers=function(){return i},s.default=s,s})})(Om);var Zs=Om.exports;const ii="\\d+(?:[\\.,]\\d+)?",U2=`(${ii}W)`,F2=`(${ii}Y)?(${ii}M)?(${ii}D)?`,D2=`T(${ii}H)?(${ii}M)?(${ii}S)?`,B2=`P(?:${U2}|${F2}(?:${D2})?)`,q2=["weeks","years","months","days","hours","minutes","seconds"],jf=new RegExp(B2),Am=e=>e.match(jf).slice(1).reduce((n,t,r)=>(n[q2[r]]=parseFloat(t)||0,n),{}),Uf=(e,n)=>{const t=n?n.getTime():Date.now(),r=new Date(t);return r.setFullYear(r.getFullYear()+e.years),r.setMonth(r.getMonth()+e.months),r.setDate(r.getDate()+e.days),r.setHours(r.getHours()+e.hours),r.setMinutes(r.getMinutes()+e.minutes),r.setMilliseconds(r.getMilliseconds()+e.seconds*1e3),r.setDate(r.getDate()+e.weeks*7),r},Pm=(e,n)=>{const t=n?n.getTime():Date.now(),r=new Date(t);return(Uf(e,r).getTime()-r.getTime())/1e3},W2=Vk(Object.freeze(Object.defineProperty({__proto__:null,default:{end:Uf,toSeconds:Pm,pattern:jf,parse:Am},end:Uf,parse:Am,pattern:jf,toSeconds:Pm},Symbol.toStringTag,{value:"Module"})));var z2=Nt,G2=ba,H2=wr.f,Ff=z2("unscopables"),Df=Array.prototype;Df[Ff]===void 0&&H2(Df,Ff,{configurable:!0,value:G2(null)});var Bf=function(e){Df[Ff][e]=!0},V2=Ur,qf=Bf,Mm=Hs,Nm=Fr,K2=wr.f,Y2=Lf,Ao=Oo,J2=Lt,xm="Array Iterator",Q2=Nm.set,X2=Nm.getterFor(xm),Lm=Y2(Array,"Array",function(e,n){Q2(this,{type:xm,target:V2(e),index:0,kind:n})},function(){var e=X2(this),n=e.target,t=e.index++;if(!n||t>=n.length)return e.target=null,Ao(void 0,!0);switch(e.kind){case"keys":return Ao(t,!1);case"values":return Ao(n[t],!1)}return Ao([t,n[t]],!1)},"values"),jm=Mm.Arguments=Mm.Array;if(qf("keys"),qf("values"),qf("entries"),J2&&jm.name!=="values")try{K2(jm,"name",{value:"values"})}catch{}var Um=yt,Fm=Qy,Z2=Zy,eu=Lm,Dm=Kn,eM=An,tM=Nt,Wf=tM("iterator"),zf=eu.values,Bm=function(e,n){if(e){if(e[Wf]!==zf)try{Dm(e,Wf,zf)}catch{e[Wf]=zf}if(eM(e,n,!0),Fm[n]){for(var t in eu)if(e[t]!==eu[t])try{Dm(e,t,eu[t])}catch{e[t]=eu[t]}}}};for(var Gf in Fm)Bm(Um[Gf]&&Um[Gf].prototype,Gf);Bm(Z2,"DOMTokenList");var rM=Mt,nM=qt,qm=Ai,Po=function(e,n,t){var r,a;return qm&&rM(r=n.constructor)&&r!==t&&nM(a=r.prototype)&&a!==t.prototype&&qm(e,a),e},aM=lt,iM=aM(1 .valueOf),sM=`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF`,uM=lt,oM=fn,lM=rr,Hf=sM,Wm=uM("".replace),cM=RegExp("^["+Hf+"]+"),fM=RegExp("(^|[^"+Hf+"])["+Hf+"]+$"),Vf=function(e){return function(n){var t=lM(oM(n));return e&1&&(t=Wm(t,cM,"")),e&2&&(t=Wm(t,fM,"$1")),t}},dM={start:Vf(1),end:Vf(2),trim:Vf(3)},pM=ft,zm=Vv,vM=Lt,Gm=yt,Hm=Yh,Vm=lt,hM=Xu,Km=Vt,yM=Po,gM=Vn,mM=$i,Ym=ic,bM=at,wM=Ya.f,SM=Hn.f,_M=wr.f,kM=iM,$M=dM.trim,Mo="Number",Fi=Gm[Mo];Hm[Mo];var Kf=Fi.prototype,TM=Gm.TypeError,CM=Vm("".slice),No=Vm("".charCodeAt),EM=function(e){var n=Ym(e,"number");return typeof n=="bigint"?n:IM(n)},IM=function(e){var n=Ym(e,"number"),t,r,a,i,s,o,u,l;if(mM(n))throw new TM("Cannot convert a Symbol value to a number");if(typeof n=="string"&&n.length>2){if(n=$M(n),t=No(n,0),t===43||t===45){if(r=No(n,2),r===88||r===120)return NaN}else if(t===48){switch(No(n,1)){case 66:case 98:a=2,i=49;break;case 79:case 111:a=8,i=55;break;default:return+n}for(s=CM(n,2),o=s.length,u=0;u<o;u++)if(l=No(s,u),l<48||l>i)return NaN;return parseInt(s,a)}}return+n},Yf=hM(Mo,!Fi(" 0o1")||!Fi("0b1")||Fi("+0x1")),RM=function(e){return gM(Kf,e)&&bM(function(){kM(e)})},xo=function(n){var t=arguments.length<1?0:Fi(EM(n));return RM(this)?yM(Object(t),this,xo):t};xo.prototype=Kf,Yf&&!zm&&(Kf.constructor=xo),pM({global:!0,constructor:!0,wrap:!0,forced:Yf},{Number:xo});var OM=function(e,n){for(var t=vM?wM(n):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),r=0,a;t.length>r;r++)Km(n,a=t[r])&&!Km(e,a)&&_M(e,a,SM(n,a))};(Yf||zm)&&OM(Hm[Mo],Fi);var AM=Jt,Jm=function(){var e=AM(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},Jf=at,PM=yt,Qf=PM.RegExp,Xf=Jf(function(){var e=Qf("a","y");return e.lastIndex=2,e.exec("abcd")!==null}),MM=Xf||Jf(function(){return!Qf("a","y").sticky}),NM=Xf||Jf(function(){var e=Qf("^r","gy");return e.lastIndex=2,e.exec("str")!==null}),Qm={BROKEN_CARET:NM,MISSED_STICKY:MM,UNSUPPORTED_Y:Xf},xM=at,LM=yt,jM=LM.RegExp,UM=xM(function(){var e=jM(".","s");return!(e.dotAll&&e.test(`
`)&&e.flags==="s")}),FM=at,DM=yt,BM=DM.RegExp,qM=FM(function(){var e=BM("(?<a>b)","g");return e.exec("b").groups.a!=="b"||"b".replace(e,"$<a>c")!=="bc"}),Di=Pt,Lo=lt,WM=rr,zM=Jm,GM=Qm,HM=Ti,VM=ba,KM=Fr.get,YM=UM,JM=qM,QM=HM("native-string-replace",String.prototype.replace),jo=RegExp.prototype.exec,Zf=jo,XM=Lo("".charAt),ZM=Lo("".indexOf),eN=Lo("".replace),ed=Lo("".slice),td=function(){var e=/a/,n=/b*/g;return Di(jo,e,"a"),Di(jo,n,"a"),e.lastIndex!==0||n.lastIndex!==0}(),Xm=GM.BROKEN_CARET,rd=/()??/.exec("")[1]!==void 0,tN=td||rd||Xm||YM||JM;tN&&(Zf=function(n){var t=this,r=KM(t),a=WM(n),i=r.raw,s,o,u,l,c,p,S;if(i)return i.lastIndex=t.lastIndex,s=Di(Zf,i,a),t.lastIndex=i.lastIndex,s;var T=r.groups,I=Xm&&t.sticky,x=Di(zM,t),U=t.source,F=0,V=a;if(I&&(x=eN(x,"y",""),ZM(x,"g")===-1&&(x+="g"),V=ed(a,t.lastIndex),t.lastIndex>0&&(!t.multiline||t.multiline&&XM(a,t.lastIndex-1)!==`
`)&&(U="(?: "+U+")",V=" "+V,F++),o=new RegExp("^(?:"+U+")",x)),rd&&(o=new RegExp("^"+U+"$(?!\\s)",x)),td&&(u=t.lastIndex),l=Di(jo,I?o:t,V),I?l?(l.input=ed(l.input,F),l[0]=ed(l[0],F),l.index=t.lastIndex,t.lastIndex+=l[0].length):t.lastIndex=0:td&&l&&(t.lastIndex=t.global?l.index+l[0].length:u),rd&&l&&l.length>1&&Di(QM,l[0],o,function(){for(c=1;c<arguments.length-2;c++)arguments[c]===void 0&&(l[c]=void 0)}),l&&T)for(l.groups=p=VM(null),c=0;c<T.length;c++)S=T[c],p[S[0]]=l[S[1]];return l});var nd=Zf,rN=ft,Zm=nd;rN({target:"RegExp",proto:!0,forced:/./.exec!==Zm},{exec:Zm});var eb=Pt,tb=Sr,nN=nd,rb=at,nb=Nt,aN=Kn,iN=nb("species"),ad=RegExp.prototype,Uo=function(e,n,t,r){var a=nb(e),i=!rb(function(){var l={};return l[a]=function(){return 7},""[e](l)!==7}),s=i&&!rb(function(){var l=!1,c=/a/;return e==="split"&&(c={},c.constructor={},c.constructor[iN]=function(){return c},c.flags="",c[a]=/./[a]),c.exec=function(){return l=!0,null},c[a](""),!l});if(!i||!s||t){var o=/./[a],u=n(a,""[e],function(l,c,p,S,T){var I=c.exec;return I===nN||I===ad.exec?i&&!T?{done:!0,value:eb(o,c,p,S)}:{done:!0,value:eb(l,p,c,S)}:{done:!1}});tb(String.prototype,e,u[0]),tb(ad,a,u[1])}r&&aN(ad[a],"sham",!0)},sN=Of.charAt,id=function(e,n,t){return n+(t?sN(e,n).length:1)},sd=lt,uN=vr,oN=Math.floor,ud=sd("".charAt),lN=sd("".replace),od=sd("".slice),cN=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,fN=/\$([$&'`]|\d{1,2})/g,dN=function(e,n,t,r,a,i){var s=t+e.length,o=r.length,u=fN;return a!==void 0&&(a=uN(a),u=cN),lN(i,u,function(l,c){var p;switch(ud(c,0)){case"$":return"$";case"&":return e;case"`":return od(n,0,t);case"'":return od(n,s);case"<":p=a[od(c,1,-1)];break;default:var S=+c;if(S===0)return l;if(S>o){var T=oN(S/10);return T===0?l:T<=o?r[T-1]===void 0?ud(c,1):r[T-1]+ud(c,1):l}p=r[S-1]}return p===void 0?"":p})},ab=Pt,pN=Jt,vN=Mt,hN=In,yN=nd,gN=TypeError,Fo=function(e,n){var t=e.exec;if(vN(t)){var r=ab(t,e,n);return r!==null&&pN(r),r}if(hN(e)==="RegExp")return ab(yN,e,n);throw new gN("RegExp#exec called on incompatible receiver")},mN=Qa,ib=Pt,Do=lt,bN=Uo,wN=at,SN=Jt,_N=Mt,kN=cn,$N=On,TN=Yn,Bi=rr,CN=fn,EN=id,IN=Ka,RN=dN,ON=Fo,AN=Nt,ld=AN("replace"),PN=Math.max,MN=Math.min,NN=Do([].concat),cd=Do([].push),sb=Do("".indexOf),ub=Do("".slice),xN=function(e){return e===void 0?e:String(e)},LN=function(){return"a".replace(/./,"$0")==="$0"}(),ob=function(){return/./[ld]?/./[ld]("a","$0")==="":!1}(),jN=!wN(function(){var e=/./;return e.exec=function(){var n=[];return n.groups={a:"7"},n},"".replace(e,"$<a>")!=="7"});bN("replace",function(e,n,t){var r=ob?"$":"$0";return[function(i,s){var o=CN(this),u=kN(i)?void 0:IN(i,ld);return u?ib(u,i,o,s):ib(n,Bi(o),i,s)},function(a,i){var s=SN(this),o=Bi(a);if(typeof i=="string"&&sb(i,r)===-1&&sb(i,"$<")===-1){var u=t(n,s,o,i);if(u.done)return u.value}var l=_N(i);l||(i=Bi(i));var c=s.global,p;c&&(p=s.unicode,s.lastIndex=0);for(var S=[],T;T=ON(s,o),!(T===null||(cd(S,T),!c));){var I=Bi(T[0]);I===""&&(s.lastIndex=EN(o,TN(s.lastIndex),p))}for(var x="",U=0,F=0;F<S.length;F++){T=S[F];for(var V=Bi(T[0]),Ae=PN(MN($N(T.index),o.length),0),de=[],Ge,Ee=1;Ee<T.length;Ee++)cd(de,xN(T[Ee]));var Ue=T.groups;if(l){var B=NN([V],de,Ae,o);Ue!==void 0&&cd(B,Ue),Ge=Bi(mN(i,void 0,B))}else Ge=RN(V,o,Ae,de,Ue,i);Ae>=U&&(x+=ub(o,U,Ae)+Ge,U=Ae+V.length)}return x+ub(o,U)}]},!jN||!LN||ob);var UN=ft,FN=lt,DN=ks,BN=Ur,qN=co,WN=FN([].join),zN=DN!==Object,GN=zN||!qN("join",",");UN({target:"Array",proto:!0,forced:GN},{join:function(n){return WN(BN(this),n===void 0?",":n)}});var ur={},HN=Lt,VN=Ts.EXISTS,lb=lt,KN=Mn,cb=Function.prototype,YN=lb(cb.toString),fb=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,JN=lb(fb.exec),QN="name";HN&&!VN&&KN(cb,QN,{configurable:!0,get:function(){try{return JN(fb,YN(this))[1]}catch{return""}}});var db={exports:{}},pb={exports:{}};(function(e){function n(t){if(Array.isArray(t))return t}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(pb);var XN=pb.exports,vb={exports:{}};(function(e){function n(t,r){var a=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(a!=null){var i,s,o,u,l=[],c=!0,p=!1;try{if(o=(a=a.call(t)).next,r===0){if(Object(a)!==a)return;c=!1}else for(;!(c=(i=o.call(a)).done)&&(l.push(i.value),l.length!==r);c=!0);}catch(S){p=!0,s=S}finally{try{if(!c&&a.return!=null&&(u=a.return(),Object(u)!==u))return}finally{if(p)throw s}}return l}}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(vb);var ZN=vb.exports,hb={exports:{}},yb={exports:{}};(function(e){function n(t,r){(r==null||r>t.length)&&(r=t.length);for(var a=0,i=Array(r);a<r;a++)i[a]=t[a];return i}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(yb);var gb=yb.exports;(function(e){var n=gb;function t(r,a){if(r){if(typeof r=="string")return n(r,a);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(r,a):void 0}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(hb);var mb=hb.exports,bb={exports:{}};(function(e){function n(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(bb);var ex=bb.exports;(function(e){var n=XN,t=ZN,r=mb,a=ex;function i(s,o){return n(s)||t(s,o)||r(s,o)||a()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports})(db);var qi=db.exports,tx=ft,wb=Ps,rx=to,nx=qt,Sb=Ja,ax=hr,ix=Ur,sx=Fs,ux=Nt,ox=Us,lx=Pn,cx=ox("slice"),fx=ux("species"),fd=Array,dx=Math.max;tx({target:"Array",proto:!0,forced:!cx},{slice:function(n,t){var r=ix(this),a=ax(r),i=Sb(n,a),s=Sb(t===void 0?a:t,a),o,u,l;if(wb(r)&&(o=r.constructor,rx(o)&&(o===fd||wb(o.prototype))?o=void 0:nx(o)&&(o=o[fx],o===null&&(o=void 0)),o===fd||o===void 0))return lx(r,i,s);for(u=new(o===void 0?fd:o)(dx(s-i,0)),l=0;i<s;i++,l++)i in r&&sx(u,l,r[i]);return u.length=l,u}});var px=ft,_b=Pt,vx=Mt,kb=Jt,hx=rr,yx=function(){var e=!1,n=/[ac]/;return n.exec=function(){return e=!0,/./.exec.apply(this,arguments)},n.test("abc")===!0&&e}(),gx=/./.test;px({target:"RegExp",proto:!0,forced:!yx},{test:function(e){var n=kb(this),t=hx(e),r=n.exec;if(!vx(r))return _b(gx,n,t);var a=_b(r,n,t);return a===null?!1:(kb(a),!0)}});var mx=ft,bx=Lt,wx=yt,Bo=lt,Sx=Vt,_x=Mt,kx=Vn,$x=rr,Tx=Mn,Cx=_c,Zn=wx.Symbol,si=Zn&&Zn.prototype;if(bx&&_x(Zn)&&(!("description"in si)||Zn().description!==void 0)){var $b={},qo=function(){var n=arguments.length<1||arguments[0]===void 0?void 0:$x(arguments[0]),t=kx(si,this)?new Zn(n):n===void 0?Zn():Zn(n);return n===""&&($b[t]=!0),t};Cx(qo,Zn),qo.prototype=si,si.constructor=qo;var Ex=String(Zn("description detection"))==="Symbol(description detection)",Ix=Bo(si.valueOf),Rx=Bo(si.toString),Ox=/^Symbol\((.*)\)[^)]+$/,Ax=Bo("".replace),Px=Bo("".slice);Tx(si,"description",{configurable:!0,get:function(){var n=Ix(this);if(Sx($b,n))return"";var t=Rx(n),r=Ex?Px(t,7,-1):Ax(t,Ox,"$1");return r===""?void 0:r}}),mx({global:!0,constructor:!0,forced:!0},{Symbol:qo})}var Mx=Qh;Mx("iterator");var Tb={exports:{}},Cb={exports:{}};(function(e){var n=gb;function t(r){if(Array.isArray(r))return n(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Cb);var Nx=Cb.exports,Eb={exports:{}};(function(e){function n(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Eb);var xx=Eb.exports,Ib={exports:{}};(function(e){function n(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Ib);var Lx=Ib.exports;(function(e){var n=Nx,t=xx,r=mb,a=Lx;function i(s){return n(s)||t(s)||r(s)||a()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports})(Tb);var Wi=Tb.exports,jx=ft,Ux=Qu.includes,Fx=at,Dx=Bf,Bx=Fx(function(){return!Array(1).includes()});jx({target:"Array",proto:!0,forced:Bx},{includes:function(n){return Ux(this,n,arguments.length>1?arguments[1]:void 0)}}),Dx("includes");var qx=qt,Wx=Math.floor,Rb=Number.isInteger||function(n){return!qx(n)&&isFinite(n)&&Wx(n)===n},zx=ft,Gx=Rb;zx({target:"Number",stat:!0},{isInteger:Gx});var Ob=Lt,Hx=at,Ab=lt,Vx=Js,Kx=As,Yx=Ur,Jx=_s.f,Pb=Ab(Jx),Qx=Ab([].push),Xx=Ob&&Hx(function(){var e=Object.create(null);return e[2]=2,!Pb(e,2)}),Mb=function(e){return function(n){for(var t=Yx(n),r=Kx(t),a=Xx&&Vx(t)===null,i=r.length,s=0,o=[],u;i>s;)u=r[s++],(!Ob||(a?u in t:Pb(t,u)))&&Qx(o,e?[u,t[u]]:t[u]);return o}},Zx={entries:Mb(!0),values:Mb(!1)},eL=ft,tL=Zx.entries;eL({target:"Object",stat:!0},{entries:function(n){return tL(n)}});/*
	@license
	Copyright (c) 2021 Twilio Inc.

	Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


	*/Object.defineProperty(ur,"__esModule",{value:!0});var rL=Yr,nL=qi,aL=Wi,iL=_a,sL=Ln,uL=Nn,oL=xn,lL=Jr;function Ta(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var zi=Ta(rL),ea=Ta(nL),dd=Ta(aL),cL=Ta(iL),fL=Ta(sL),dL=Ta(uL),pL=Ta(oL),Nb=Ta(lL),ta=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return{checks:t}},xb=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return ta(function(a){for(var i=!1,s=[],o=0,u=t;o<u.length;o++){var l=u[o];if(typeof l=="string"){i=i||zi.default(a)===l,s.push("of type ".concat(l));continue}i=i||a instanceof l,s.push("an instance of ".concat(l.name))}return[i,s]})},vL=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return ta(function(a){for(var i=!1,s=[],o=0,u=t;o<u.length;o++){var l=u[o];i=i||a===l,s.push(typeof l=="string"?'"'.concat(l,'"'):"".concat(l))}return[i,s]})};function hL(e){var n=yL();return function(){var r=Nb.default(e),a;if(n){var i=Nb.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return pL.default(this,a)}}function yL(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function tu(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=gL(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function gL(e,n){if(e){if(typeof e=="string")return Lb(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Lb(e,n)}}function Lb(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var Wo=function(n,t){if(t.length>n.length)throw new Error("Expected at most ".concat(n.length," argument(s), but got ").concat(t.length));for(;t.length<n.length;)t.push(void 0);var r=tu(t.entries()),a;try{for(r.s();!(a=r.n()).done;){var i=ea.default(a.value,2),s=i[0],o=i[1],u=Go(n[s],o),l=ea.default(u,4),c=l[0],p=l[1],S=l[2],T=l[3];if(!c){var I=s+1;throw new Error("Argument ".concat(I," is expected to be ").concat(S).concat(T," but got ").concat(p))}}}catch(x){r.e(x)}finally{r.f()}},jb=function(n){var t,r,a=["undefined","boolean","number","bigint","string"];if(a.includes(zi.default(n))&&(r=typeof n=="string"?'"'.concat(n,'"'):"".concat(n)),zi.default(n)==="object"&&(n==null||(t=n.constructor)===null||t===void 0?void 0:t.name)!=="Object"){var i;r=n===null?"null":"instance of ".concat(n==null||(i=n.constructor)===null||i===void 0?void 0:i.name)}return r||(r=zi.default(n)),r},mL=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=pd(t);return function(i){return function(s){dL.default(u,s);var o=hL(u);function u(){fL.default(this,u);for(var l=arguments.length,c=new Array(l),p=0;p<l;p++)c[p]=arguments[p];return Wo(a,c),o.call.apply(o,[this].concat(c))}return cL.default(u)}(i)}},bL=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=pd(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypes decorator can only be applied to methods");var u=o.value;o.value=function(){for(var l=arguments.length,c=new Array(l),p=0;p<l;p++)c[p]=arguments[p];return Wo(a,c),u.apply(this,c)}}},wL=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=pd(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypesAsync decorator can only be applied to methods");var u=o.value;o.value=function(){for(var l=arguments.length,c=new Array(l),p=0;p<l;p++)c[p]=arguments[p];try{Wo(a,c)}catch(S){return Promise.reject(S)}return u.apply(this,c)}}},pd=function(n){var t=[],r=tu(n),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;t.push(zo(i))}}catch(s){r.e(s)}finally{r.f()}return t},zo=function(n){var t=[],r=Array.isArray(n)?n:[n],a=tu(r),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;if(typeof s=="string"||typeof s=="function"){t.push(xb(s));continue}t.push(s)}}catch(o){a.e(o)}finally{a.f()}return t},Go=function(n,t){var r=[],a,i=!1,s=tu(n),o;try{for(s.s();!(o=s.n()).done;){var u=o.value,l=tu(u.checks),c;try{for(l.s();!(c=l.n()).done;){var p=c.value,S=p(t),T=ea.default(S,3),I=T[0],x=T[1],U=T[2];i=i||I,!a&&U&&(a=U),x&&(r=typeof x=="string"?[].concat(dd.default(r),[x]):[].concat(dd.default(r),dd.default(x)))}}catch(de){l.e(de)}finally{l.f()}}}catch(de){s.e(de)}finally{s.f()}if(i)return[!0];var F=a||jb(t),V=r.length-1,Ae=V>0?"".concat(r.slice(0,V).join(", ")," or ").concat(r[V]):r.join(", ");return[!1,F,Ae,V>1?";":","]};function SL(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_L(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function _L(e,n){if(e){if(typeof e=="string")return Ub(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ub(e,n)}}function Ub(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var kL=function(n,t){return ta(function(r){if(!Array.isArray(r)||r.length<1)return[!1,"a non-empty array of ".concat(n)];var a=SL(r.entries()),i;try{for(a.s();!(i=a.n()).done;){var s=ea.default(i.value,2),o=s[0],u=s[1],l=Go(zo(t),u),c=ea.default(l,3),p=c[0],S=c[1],T=c[2];if(!p)return[!1,"a valid non-empty array of ".concat(n," (index ").concat(o," should be ").concat(T,")"),"malformed array of ".concat(n," (index ").concat(o," is ").concat(S,")")]}}catch(I){a.e(I)}finally{a.f()}return[!0]})},$L=ta(function(e){return[typeof e=="string"&&e.length>0,"a non-empty string"]}),TL=ta(function(e){return[typeof e=="number"&&Number.isInteger(e)&&e>=0,"a non-negative integer"]}),CL=ta(function(e){return[zi.default(e)==="object"&&e!==null&&!Array.isArray(e),"a pure object (non-null and non-array)"]}),EL=function(n,t){return ta(function(r){if(zi.default(r)!=="object"||r===null||Array.isArray(r))return[!1,"valid ".concat(n," (should be a pure object)")];for(var a=0,i=Object.entries(t);a<i.length;a++){var s=ea.default(i[a],2),o=s[0],u=s[1],l=Go(zo(u),r[o]),c=ea.default(l,3),p=c[0],S=c[1],T=c[2];if(!p)return[!1,"valid ".concat(n,' (key "').concat(o,'" should be ').concat(T,")"),"malformed ".concat(n,' (key "').concat(o,'" is ').concat(S,")")]}return[!0]})};function IL(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=RL(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function RL(e,n){if(e){if(typeof e=="string")return Fb(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Fb(e,n)}}function Fb(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var OL=function(n,t){return ta(function(r){if(!Array.isArray(r))return[!1,"an array of ".concat(n)];var a=IL(r.entries()),i;try{for(a.s();!(i=a.n()).done;){var s=ea.default(i.value,2),o=s[0],u=s[1],l=Go(zo(t),u),c=ea.default(l,3),p=c[0],S=c[1],T=c[2];if(!p)return[!1,"a valid array of ".concat(n," (index ").concat(o," should be ").concat(T,")"),"malformed array of ".concat(n," (index ").concat(o," is ").concat(S,")")]}}catch(I){a.e(I)}finally{a.f()}return[!0]})};ur.array=OL,ur.custom=ta,ur.literal=vL,ur.nonEmptyArray=kL,ur.nonEmptyString=$L,ur.nonNegativeInteger=TL,ur.objectSchema=EL,ur.pureObject=CL,ur.runtimeTypeValidation=Wo,ur.stringifyReceivedType=jb,ur.type=xb,ur.validateConstructorTypes=mL,ur.validateTypes=bL,ur.validateTypesAsync=wL;var vd={},Db={exports:{}},Bb={exports:{}};(function(e){var n=Jr;function t(r,a){for(;!{}.hasOwnProperty.call(r,a)&&(r=n(r))!==null;);return r}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Bb);var AL=Bb.exports;(function(e){var n=AL;function t(){return e.exports=t=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,a,i){var s=n(r,a);if(s){var o=Object.getOwnPropertyDescriptor(s,a);return o.get?o.get.call(arguments.length<3?r:i):o.value}},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Db);var hd=Db.exports;/*
	@license
	Copyright (c) 2021 Twilio Inc.

	Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

	*/Object.defineProperty(vd,"__esModule",{value:!0});var PL=Wi,ML=Ln,NL=_a,xL=ei,LL=hd,jL=Nn,UL=xn,FL=Jr,DL=ti;function ra(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var qb=ra(PL),BL=ra(ML),qL=ra(NL),WL=ra(xL),ui=ra(LL),zL=ra(jL),GL=ra(UL),na=ra(FL),HL=ra(DL),VL;function Ca(){}Ca.prototype=Object.create(null);function jt(){jt.init.call(this)}jt.EventEmitter=jt,jt.usingDomains=!1,jt.prototype.domain=void 0,jt.prototype._events=void 0,jt.prototype._maxListeners=void 0,jt.defaultMaxListeners=10,jt.init=function(){this.domain=null,jt.usingDomains&&VL.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new Ca,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},jt.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this};function Wb(e){return e._maxListeners===void 0?jt.defaultMaxListeners:e._maxListeners}jt.prototype.getMaxListeners=function(){return Wb(this)};function KL(e,n,t){if(n)e.call(t);else for(var r=e.length,a=ru(e,r),i=0;i<r;++i)a[i].call(t)}function YL(e,n,t,r){if(n)e.call(t,r);else for(var a=e.length,i=ru(e,a),s=0;s<a;++s)i[s].call(t,r)}function JL(e,n,t,r,a){if(n)e.call(t,r,a);else for(var i=e.length,s=ru(e,i),o=0;o<i;++o)s[o].call(t,r,a)}function QL(e,n,t,r,a,i){if(n)e.call(t,r,a,i);else for(var s=e.length,o=ru(e,s),u=0;u<s;++u)o[u].call(t,r,a,i)}function XL(e,n,t,r){if(n)e.apply(t,r);else for(var a=e.length,i=ru(e,a),s=0;s<a;++s)i[s].apply(t,r)}jt.prototype.emit=function(n){var t,r,a,i,s,o,u,l=n==="error";if(o=this._events,o)l=l&&o.error==null;else if(!l)return!1;if(u=this.domain,l){if(t=arguments[1],u)t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=u,t.domainThrown=!1,u.emit("error",t);else{if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return!1}if(r=o[n],!r)return!1;var p=typeof r=="function";switch(a=arguments.length,a){case 1:KL(r,p,this);break;case 2:YL(r,p,this,arguments[1]);break;case 3:JL(r,p,this,arguments[1],arguments[2]);break;case 4:QL(r,p,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(a-1),s=1;s<a;s++)i[s-1]=arguments[s];XL(r,p,this,i)}return!0};function zb(e,n,t,r){var a,i,s;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(i=e._events,i?(i.newListener&&(e.emit("newListener",n,t.listener?t.listener:t),i=e._events),s=i[n]):(i=e._events=new Ca,e._eventsCount=0),!s)s=i[n]=t,++e._eventsCount;else if(typeof s=="function"?s=i[n]=r?[t,s]:[s,t]:r?s.unshift(t):s.push(t),!s.warned&&(a=Wb(e),a&&a>0&&s.length>a)){s.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=n,o.count=s.length,ZL(o)}return e}function ZL(e){typeof console.warn=="function"?console.warn(e):console.log(e)}jt.prototype.addListener=function(n,t){return zb(this,n,t,!1)},jt.prototype.on=jt.prototype.addListener,jt.prototype.prependListener=function(n,t){return zb(this,n,t,!0)};function Gb(e,n,t){var r=!1;function a(){e.removeListener(n,a),r||(r=!0,t.apply(e,arguments))}return a.listener=t,a}jt.prototype.once=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.on(n,Gb(this,n,t)),this},jt.prototype.prependOnceListener=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(n,Gb(this,n,t)),this},jt.prototype.removeListener=function(n,t){var r,a,i,s,o;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(a=this._events,!a)return this;if(r=a[n],!r)return this;if(r===t||r.listener&&r.listener===t)--this._eventsCount===0?this._events=new Ca:(delete a[n],a.removeListener&&this.emit("removeListener",n,r.listener||t));else if(typeof r!="function"){for(i=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;if(r.length===1){if(r[0]=void 0,--this._eventsCount===0)return this._events=new Ca,this;delete a[n]}else ej(r,i);a.removeListener&&this.emit("removeListener",n,o||t)}return this},jt.prototype.off=function(e,n){return this.removeListener(e,n)},jt.prototype.removeAllListeners=function(n){var t,r;if(r=this._events,!r)return this;if(!r.removeListener)return arguments.length===0?(this._events=new Ca,this._eventsCount=0):r[n]&&(--this._eventsCount===0?this._events=new Ca:delete r[n]),this;if(arguments.length===0){for(var a=Object.keys(r),i=0,s;i<a.length;++i)s=a[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new Ca,this._eventsCount=0,this}if(t=r[n],typeof t=="function")this.removeListener(n,t);else if(t)do this.removeListener(n,t[t.length-1]);while(t[0]);return this},jt.prototype.listeners=function(n){var t,r,a=this._events;return a?(t=a[n],t?typeof t=="function"?r=[t.listener||t]:r=tj(t):r=[]):r=[],r},jt.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):Hb.call(e,n)},jt.prototype.listenerCount=Hb;function Hb(e){var n=this._events;if(n){var t=n[e];if(typeof t=="function")return 1;if(t)return t.length}return 0}jt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function ej(e,n){for(var t=n,r=t+1,a=e.length;r<a;t+=1,r+=1)e[t]=e[r];e.pop()}function ru(e,n){for(var t=new Array(n);n--;)t[n]=e[n];return t}function tj(e){for(var n=new Array(e.length),t=0;t<n.length;++t)n[t]=e[t].listener||e[t];return n}function rj(e){var n=nj();return function(){var r=na.default(e),a;if(n){var i=na.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return GL.default(this,a)}}function nj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var aj=function(e){zL.default(t,e);var n=rj(t);function t(){var r;return BL.default(this,t),r=n.call(this),HL.default(WL.default(r),"eventHistory",new Map),r}return qL.default(t,[{key:"on",value:function(a,i){return ui.default(na.default(t.prototype),"on",this).call(this,a,i)}},{key:"once",value:function(a,i){return ui.default(na.default(t.prototype),"once",this).call(this,a,i)}},{key:"off",value:function(a,i){return ui.default(na.default(t.prototype),"off",this).call(this,a,i)}},{key:"emit",value:function(a){for(var i,s=arguments.length,o=new Array(s>1?s-1:0),u=1;u<s;u++)o[u-1]=arguments[u];return this.eventHistory.set(a,o),(i=ui.default(na.default(t.prototype),"emit",this)).call.apply(i,[this,a].concat(o))}},{key:"addListener",value:function(a,i){return ui.default(na.default(t.prototype),"addListener",this).call(this,a,i)}},{key:"removeListener",value:function(a,i){return ui.default(na.default(t.prototype),"removeListener",this).call(this,a,i)}},{key:"addListenerWithReplay",value:function(a,i){var s=this.eventHistory.get(a);return s!==void 0&&i.apply(void 0,qb.default(s)),this.addListener(a,i)}},{key:"onWithReplay",value:function(a,i){return this.addListenerWithReplay(a,i)}},{key:"onceWithReplay",value:function(a,i){var s=this.eventHistory.get(a);return s!==void 0?(i.apply(void 0,qb.default(s)),this):ui.default(na.default(t.prototype),"once",this).call(this,a,i)}}]),t}(jt);vd.ReplayEventEmitter=aj;var Ho={exports:{}};Ho.exports,function(e,n){var t=200,r="__lodash_hash_undefined__",a=1,i=2,s=9007199254740991,o="[object Arguments]",u="[object Array]",l="[object AsyncFunction]",c="[object Boolean]",p="[object Date]",S="[object Error]",T="[object Function]",I="[object GeneratorFunction]",x="[object Map]",U="[object Number]",F="[object Null]",V="[object Object]",Ae="[object Promise]",de="[object Proxy]",Ge="[object RegExp]",Ee="[object Set]",Ue="[object String]",B="[object Symbol]",ce="[object Undefined]",ke="[object WeakMap]",pe="[object ArrayBuffer]",Le="[object DataView]",Z="[object Float32Array]",Pe="[object Float64Array]",Fe="[object Int8Array]",wt="[object Int16Array]",mt="[object Int32Array]",Ce="[object Uint8Array]",se="[object Uint8ClampedArray]",ie="[object Uint16Array]",O="[object Uint32Array]",Ie=/[\\^$.*+?()[\]{}|]/g,Je=/^\[object .+?Constructor\]$/,Me=/^(?:0|[1-9]\d*)$/,be={};be[Z]=be[Pe]=be[Fe]=be[wt]=be[mt]=be[Ce]=be[se]=be[ie]=be[O]=!0,be[o]=be[u]=be[pe]=be[c]=be[Le]=be[p]=be[S]=be[T]=be[x]=be[U]=be[V]=be[Ge]=be[Ee]=be[Ue]=be[ke]=!1;var z=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr,xt=typeof self=="object"&&self&&self.Object===Object&&self,ye=z||xt||Function("return this")(),te=n&&!n.nodeType&&n,St=te&&!0&&e&&!e.nodeType&&e,Ne=St&&St.exports===te,zt=Ne&&z.process,dt=function(){try{return zt&&zt.binding&&zt.binding("util")}catch{}}(),_e=dt&&dt.isTypedArray;function it(M,K){for(var ve=-1,qe=M==null?0:M.length,Bt=0,vt=[];++ve<qe;){var Gt=M[ve];K(Gt,ve,M)&&(vt[Bt++]=Gt)}return vt}function bt(M,K){for(var ve=-1,qe=K.length,Bt=M.length;++ve<qe;)M[Bt+ve]=K[ve];return M}function $e(M,K){for(var ve=-1,qe=M==null?0:M.length;++ve<qe;)if(K(M[ve],ve,M))return!0;return!1}function Kt(M,K){for(var ve=-1,qe=Array(M);++ve<M;)qe[ve]=K(ve);return qe}function pt(M){return function(K){return M(K)}}function Wt(M,K){return M.has(K)}function er(M,K){return M==null?void 0:M[K]}function xe(M){var K=-1,ve=Array(M.size);return M.forEach(function(qe,Bt){ve[++K]=[Bt,qe]}),ve}function zr(M,K){return function(ve){return M(K(ve))}}function bn(M){var K=-1,ve=Array(M.size);return M.forEach(function(qe){ve[++K]=qe}),ve}var Ct=Array.prototype,Dt=Function.prototype,gt=Object.prototype,tt=ye["__core-js_shared__"],Ft=Dt.toString,At=gt.hasOwnProperty,ar=function(){var M=/[^.]+$/.exec(tt&&tt.keys&&tt.keys.IE_PROTO||"");return M?"Symbol(src)_1."+M:""}(),Gr=gt.toString,wn=RegExp("^"+Ft.call(At).replace(Ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qn=Ne?ye.Buffer:void 0,xr=ye.Symbol,or=ye.Uint8Array,ue=gt.propertyIsEnumerable,fe=Ct.splice,J=xr?xr.toStringTag:void 0,ne=Object.getOwnPropertySymbols,X=qn?qn.isBuffer:void 0,le=zr(Object.keys,Object),ge=dr(ye,"DataView"),H=dr(ye,"Map"),ee=dr(ye,"Promise"),D=dr(ye,"Set"),Y=dr(ye,"WeakMap"),q=dr(Object,"create"),Re=k(ge),me=k(H),De=k(ee),je=k(D),Be=k(Y),Ve=xr?xr.prototype:void 0,Ke=Ve?Ve.valueOf:void 0;function ze(M){var K=-1,ve=M==null?0:M.length;for(this.clear();++K<ve;){var qe=M[K];this.set(qe[0],qe[1])}}function He(){this.__data__=q?q(null):{},this.size=0}function Qe(M){var K=this.has(M)&&delete this.__data__[M];return this.size-=K?1:0,K}function rt(M){var K=this.__data__;if(q){var ve=K[M];return ve===r?void 0:ve}return At.call(K,M)?K[M]:void 0}function fr(M){var K=this.__data__;return q?K[M]!==void 0:At.call(K,M)}function Lr(M,K){var ve=this.__data__;return this.size+=this.has(M)?0:1,ve[M]=q&&K===void 0?r:K,this}ze.prototype.clear=He,ze.prototype.delete=Qe,ze.prototype.get=rt,ze.prototype.has=fr,ze.prototype.set=Lr;function nt(M){var K=-1,ve=M==null?0:M.length;for(this.clear();++K<ve;){var qe=M[K];this.set(qe[0],qe[1])}}function an(){this.__data__=[],this.size=0}function qa(M){var K=this.__data__,ve=Yt(K,M);if(ve<0)return!1;var qe=K.length-1;return ve==qe?K.pop():fe.call(K,ve,1),--this.size,!0}function mi(M){var K=this.__data__,ve=Yt(K,M);return ve<0?void 0:K[ve][1]}function Sn(M){return Yt(this.__data__,M)>-1}function Wa(M,K){var ve=this.__data__,qe=Yt(ve,M);return qe<0?(++this.size,ve.push([M,K])):ve[qe][1]=K,this}nt.prototype.clear=an,nt.prototype.delete=qa,nt.prototype.get=mi,nt.prototype.has=Sn,nt.prototype.set=Wa;function _n(M){var K=-1,ve=M==null?0:M.length;for(this.clear();++K<ve;){var qe=M[K];this.set(qe[0],qe[1])}}function Wn(){this.size=0,this.__data__={hash:new ze,map:new(H||nt),string:new ze}}function bi(M){var K=ya(this,M).delete(M);return this.size-=K?1:0,K}function yr(M){return ya(this,M).get(M)}function va(M){return ya(this,M).has(M)}function ds(M,K){var ve=ya(this,M),qe=ve.size;return ve.set(M,K),this.size+=ve.size==qe?0:1,this}_n.prototype.clear=Wn,_n.prototype.delete=bi,_n.prototype.get=yr,_n.prototype.has=va,_n.prototype.set=ds;function ha(M){var K=-1,ve=M==null?0:M.length;for(this.__data__=new _n;++K<ve;)this.add(M[K])}function ps(M){return this.__data__.set(M,r),this}function Au(M){return this.__data__.has(M)}ha.prototype.add=ha.prototype.push=ps,ha.prototype.has=Au;function sn(M){var K=this.__data__=new nt(M);this.size=K.size}function vs(){this.__data__=new nt,this.size=0}function Pu(M){var K=this.__data__,ve=K.delete(M);return this.size=K.size,ve}function Mu(M){return this.__data__.get(M)}function Ir(M){return this.__data__.has(M)}function Nu(M,K){var ve=this.__data__;if(ve instanceof nt){var qe=ve.__data__;if(!H||qe.length<t-1)return qe.push([M,K]),this.size=++ve.size,this;ve=this.__data__=new _n(qe)}return ve.set(M,K),this.size=ve.size,this}sn.prototype.clear=vs,sn.prototype.delete=Pu,sn.prototype.get=Mu,sn.prototype.has=Ir,sn.prototype.set=Nu;function hs(M,K){var ve=R(M),qe=!ve&&P(M),Bt=!ve&&!qe&&re(M),vt=!ve&&!qe&&!Bt&&tr(M),Gt=ve||qe||Bt||vt,Xt=Gt?Kt(M.length,String):[],ir=Xt.length;for(var Ze in M)At.call(M,Ze)&&!(Gt&&(Ze=="length"||Bt&&(Ze=="offset"||Ze=="parent")||vt&&(Ze=="buffer"||Ze=="byteLength"||Ze=="byteOffset")||Tn(Ze,ir)))&&Xt.push(Ze);return Xt}function Yt(M,K){for(var ve=M.length;ve--;)if(_(M[ve][0],K))return ve;return-1}function xu(M,K,ve){var qe=K(M);return R(M)?qe:bt(qe,ve(M))}function kn(M){return M==null?M===void 0?ce:F:J&&J in Object(M)?bs(M):$(M)}function wi(M){return Cn(M)&&kn(M)==o}function ys(M,K,ve,qe,Bt){return M===K?!0:M==null||K==null||!Cn(M)&&!Cn(K)?M!==M&&K!==K:Lu(M,K,ve,qe,ys,Bt)}function Lu(M,K,ve,qe,Bt,vt){var Gt=R(M),Xt=R(K),ir=Gt?u:un(M),Ze=Xt?u:un(K);ir=ir==o?V:ir,Ze=Ze==o?V:Ze;var mr=ir==V,br=Ze==V,lr=ir==Ze;if(lr&&re(M)){if(!re(K))return!1;Gt=!0,mr=!1}if(lr&&!mr)return vt||(vt=new sn),Gt||tr(M)?gs(M,K,ve,qe,Bt,vt):Uu(M,K,ir,ve,qe,Bt,vt);if(!(ve&a)){var jr=mr&&At.call(M,"__wrapped__"),st=br&&At.call(K,"__wrapped__");if(jr||st){var zn=jr?M.value():M,C=st?K.value():K;return vt||(vt=new sn),Bt(zn,C,ve,qe,vt)}}return lr?(vt||(vt=new sn),ms(M,K,ve,qe,Bt,vt)):!1}function $n(M){if(!pr(M)||A(M))return!1;var K=Oe(M)?wn:Je;return K.test(k(M))}function _t(M){return Cn(M)&&Xe(M.length)&&!!be[kn(M)]}function ju(M){if(!N(M))return le(M);var K=[];for(var ve in Object(M))At.call(M,ve)&&ve!="constructor"&&K.push(ve);return K}function gs(M,K,ve,qe,Bt,vt){var Gt=ve&a,Xt=M.length,ir=K.length;if(Xt!=ir&&!(Gt&&ir>Xt))return!1;var Ze=vt.get(M);if(Ze&&vt.get(K))return Ze==K;var mr=-1,br=!0,lr=ve&i?new ha:void 0;for(vt.set(M,K),vt.set(K,M);++mr<Xt;){var jr=M[mr],st=K[mr];if(qe)var zn=Gt?qe(st,jr,mr,K,M,vt):qe(jr,st,mr,M,K,vt);if(zn!==void 0){if(zn)continue;br=!1;break}if(lr){if(!$e(K,function(C,E){if(!Wt(lr,E)&&(jr===C||Bt(jr,C,ve,qe,vt)))return lr.push(E)})){br=!1;break}}else if(!(jr===st||Bt(jr,st,ve,qe,vt))){br=!1;break}}return vt.delete(M),vt.delete(K),br}function Uu(M,K,ve,qe,Bt,vt,Gt){switch(ve){case Le:if(M.byteLength!=K.byteLength||M.byteOffset!=K.byteOffset)return!1;M=M.buffer,K=K.buffer;case pe:return!(M.byteLength!=K.byteLength||!vt(new or(M),new or(K)));case c:case p:case U:return _(+M,+K);case S:return M.name==K.name&&M.message==K.message;case Ge:case Ue:return M==K+"";case x:var Xt=xe;case Ee:var ir=qe&a;if(Xt||(Xt=bn),M.size!=K.size&&!ir)return!1;var Ze=Gt.get(M);if(Ze)return Ze==K;qe|=i,Gt.set(M,K);var mr=gs(Xt(M),Xt(K),qe,Bt,vt,Gt);return Gt.delete(M),mr;case B:if(Ke)return Ke.call(M)==Ke.call(K)}return!1}function ms(M,K,ve,qe,Bt,vt){var Gt=ve&a,Xt=za(M),ir=Xt.length,Ze=za(K),mr=Ze.length;if(ir!=mr&&!Gt)return!1;for(var br=ir;br--;){var lr=Xt[br];if(!(Gt?lr in K:At.call(K,lr)))return!1}var jr=vt.get(M);if(jr&&vt.get(K))return jr==K;var st=!0;vt.set(M,K),vt.set(K,M);for(var zn=Gt;++br<ir;){lr=Xt[br];var C=M[lr],E=K[lr];if(qe)var g=Gt?qe(E,C,lr,K,M,vt):qe(C,E,lr,M,K,vt);if(!(g===void 0?C===E||Bt(C,E,ve,qe,vt):g)){st=!1;break}zn||(zn=lr=="constructor")}if(st&&!zn){var d=M.constructor,f=K.constructor;d!=f&&"constructor"in M&&"constructor"in K&&!(typeof d=="function"&&d instanceof d&&typeof f=="function"&&f instanceof f)&&(st=!1)}return vt.delete(M),vt.delete(K),st}function za(M){return xu(M,En,gr)}function ya(M,K){var ve=M.__data__;return Fu(K)?ve[typeof K=="string"?"string":"hash"]:ve.map}function dr(M,K){var ve=er(M,K);return $n(ve)?ve:void 0}function bs(M){var K=At.call(M,J),ve=M[J];try{M[J]=void 0;var qe=!0}catch{}var Bt=Gr.call(M);return qe&&(K?M[J]=ve:delete M[J]),Bt}var gr=ne?function(M){return M==null?[]:(M=Object(M),it(ne(M),function(K){return ue.call(M,K)}))}:Hl,un=kn;(ge&&un(new ge(new ArrayBuffer(1)))!=Le||H&&un(new H)!=x||ee&&un(ee.resolve())!=Ae||D&&un(new D)!=Ee||Y&&un(new Y)!=ke)&&(un=function(M){var K=kn(M),ve=K==V?M.constructor:void 0,qe=ve?k(ve):"";if(qe)switch(qe){case Re:return Le;case me:return x;case De:return Ae;case je:return Ee;case Be:return ke}return K});function Tn(M,K){return K=K??s,!!K&&(typeof M=="number"||Me.test(M))&&M>-1&&M%1==0&&M<K}function Fu(M){var K=typeof M;return K=="string"||K=="number"||K=="symbol"||K=="boolean"?M!=="__proto__":M===null}function A(M){return!!ar&&ar in M}function N(M){var K=M&&M.constructor,ve=typeof K=="function"&&K.prototype||gt;return M===ve}function $(M){return Gr.call(M)}function k(M){if(M!=null){try{return Ft.call(M)}catch{}try{return M+""}catch{}}return""}function _(M,K){return M===K||M!==M&&K!==K}var P=wi(function(){return arguments}())?wi:function(M){return Cn(M)&&At.call(M,"callee")&&!ue.call(M,"callee")},R=Array.isArray;function ae(M){return M!=null&&Xe(M.length)&&!Oe(M)}var re=X||Cv;function Se(M,K){return ys(M,K)}function Oe(M){if(!pr(M))return!1;var K=kn(M);return K==T||K==I||K==l||K==de}function Xe(M){return typeof M=="number"&&M>-1&&M%1==0&&M<=s}function pr(M){var K=typeof M;return M!=null&&(K=="object"||K=="function")}function Cn(M){return M!=null&&typeof M=="object"}var tr=_e?pt(_e):_t;function En(M){return ae(M)?hs(M):ju(M)}function Hl(){return[]}function Cv(){return!1}e.exports=Se}(Ho,Ho.exports);var ij=Ho.exports,Vb={exports:{}},sj=at,uj=sj(function(){if(typeof ArrayBuffer=="function"){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}),oj=at,lj=qt,cj=In,Kb=uj,Vo=Object.isExtensible,fj=oj(function(){Vo(1)}),dj=fj||Kb?function(n){return!lj(n)||Kb&&cj(n)==="ArrayBuffer"?!1:Vo?Vo(n):!0}:Vo,pj=at,Yb=!pj(function(){return Object.isExtensible(Object.preventExtensions({}))}),vj=ft,hj=lt,yj=Cs,gj=qt,yd=Vt,mj=wr.f,Jb=Ya,bj=Mc,gd=dj,wj=$s,Sj=Yb,Qb=!1,aa=wj("meta"),_j=0,md=function(e){mj(e,aa,{value:{objectID:"O"+_j++,weakData:{}}})},kj=function(e,n){if(!gj(e))return typeof e=="symbol"?e:(typeof e=="string"?"S":"P")+e;if(!yd(e,aa)){if(!gd(e))return"F";if(!n)return"E";md(e)}return e[aa].objectID},$j=function(e,n){if(!yd(e,aa)){if(!gd(e))return!0;if(!n)return!1;md(e)}return e[aa].weakData},Tj=function(e){return Sj&&Qb&&gd(e)&&!yd(e,aa)&&md(e),e},Cj=function(){Ej.enable=function(){},Qb=!0;var e=Jb.f,n=hj([].splice),t={};t[aa]=1,e(t).length&&(Jb.f=function(r){for(var a=e(r),i=0,s=a.length;i<s;i++)if(a[i]===aa){n(a,i,1);break}return a},vj({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:bj.f}))},Ej=Vb.exports={enable:Cj,fastKey:kj,getWeakData:$j,onFreeze:Tj};yj[aa]=!0;var Ko=Vb.exports,Ij=ft,Rj=yt,Oj=lt,Xb=Xu,Aj=Sr,Pj=Ko,Mj=Ks,Nj=ka,xj=Mt,Lj=cn,bd=qt,wd=at,jj=Eo,Uj=An,Fj=Po,Sd=function(e,n,t){var r=e.indexOf("Map")!==-1,a=e.indexOf("Weak")!==-1,i=r?"set":"add",s=Rj[e],o=s&&s.prototype,u=s,l={},c=function(F){var V=Oj(o[F]);Aj(o,F,F==="add"?function(de){return V(this,de===0?0:de),this}:F==="delete"?function(Ae){return a&&!bd(Ae)?!1:V(this,Ae===0?0:Ae)}:F==="get"?function(de){return a&&!bd(de)?void 0:V(this,de===0?0:de)}:F==="has"?function(de){return a&&!bd(de)?!1:V(this,de===0?0:de)}:function(de,Ge){return V(this,de===0?0:de,Ge),this})},p=Xb(e,!xj(s)||!(a||o.forEach&&!wd(function(){new s().entries().next()})));if(p)u=t.getConstructor(n,e,r,i),Pj.enable();else if(Xb(e,!0)){var S=new u,T=S[i](a?{}:-0,1)!==S,I=wd(function(){S.has(1)}),x=jj(function(F){new s(F)}),U=!a&&wd(function(){for(var F=new s,V=5;V--;)F[i](V,V);return!F.has(-0)});x||(u=n(function(F,V){Nj(F,o);var Ae=Fj(new s,F,u);return Lj(V)||Mj(V,Ae[i],{that:Ae,AS_ENTRIES:r}),Ae}),u.prototype=o,o.constructor=u),(I||U)&&(c("delete"),c("has"),r&&c("get")),(U||T)&&c(i),a&&o.clear&&delete o.clear}return l[e]=u,Ij({global:!0,constructor:!0,forced:u!==s},l),Uj(u,e),a||t.setStrong(u,e,r),u},Dj=Sr,Yo=function(e,n,t){for(var r in n)Dj(e,r,n[r],t);return e},Zb=ba,Bj=Mn,ew=Yo,qj=Qn,Wj=ka,zj=cn,Gj=Ks,Hj=Lf,Jo=Oo,Vj=po,nu=Lt,tw=Ko.fastKey,rw=Fr,nw=rw.set,_d=rw.getterFor,aw={getConstructor:function(e,n,t,r){var a=e(function(l,c){Wj(l,i),nw(l,{type:n,index:Zb(null),first:null,last:null,size:0}),nu||(l.size=0),zj(c)||Gj(c,l[r],{that:l,AS_ENTRIES:t})}),i=a.prototype,s=_d(n),o=function(l,c,p){var S=s(l),T=u(l,c),I,x;return T?T.value=p:(S.last=T={index:x=tw(c,!0),key:c,value:p,previous:I=S.last,next:null,removed:!1},S.first||(S.first=T),I&&(I.next=T),nu?S.size++:l.size++,x!=="F"&&(S.index[x]=T)),l},u=function(l,c){var p=s(l),S=tw(c),T;if(S!=="F")return p.index[S];for(T=p.first;T;T=T.next)if(T.key===c)return T};return ew(i,{clear:function(){for(var c=this,p=s(c),S=p.first;S;)S.removed=!0,S.previous&&(S.previous=S.previous.next=null),S=S.next;p.first=p.last=null,p.index=Zb(null),nu?p.size=0:c.size=0},delete:function(l){var c=this,p=s(c),S=u(c,l);if(S){var T=S.next,I=S.previous;delete p.index[S.index],S.removed=!0,I&&(I.next=T),T&&(T.previous=I),p.first===S&&(p.first=T),p.last===S&&(p.last=I),nu?p.size--:c.size--}return!!S},forEach:function(c){for(var p=s(this),S=qj(c,arguments.length>1?arguments[1]:void 0),T;T=T?T.next:p.first;)for(S(T.value,T.key,this);T&&T.removed;)T=T.previous},has:function(c){return!!u(this,c)}}),ew(i,t?{get:function(c){var p=u(this,c);return p&&p.value},set:function(c,p){return o(this,c===0?0:c,p)}}:{add:function(c){return o(this,c=c===0?0:c,c)}}),nu&&Bj(i,"size",{configurable:!0,get:function(){return s(this).size}}),a},setStrong:function(e,n,t){var r=n+" Iterator",a=_d(n),i=_d(r);Hj(e,n,function(s,o){nw(this,{type:r,target:s,state:a(s),kind:o,last:null})},function(){for(var s=i(this),o=s.kind,u=s.last;u&&u.removed;)u=u.previous;return!s.target||!(s.last=u=u?u.next:s.state.first)?(s.target=null,Jo(void 0,!0)):Jo(o==="keys"?u.key:o==="values"?u.value:[u.key,u.value],!1)},t?"entries":"values",!t,!0),Vj(n)}},Kj=Sd,Yj=aw;Kj("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Yj);var ia={};/*
	@license
	Copyright (c) 2016, Twilio, Inc.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted, provided that the above
	copyright notice and this permission notice appear in all copies.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
	WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
	MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
	SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
	WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
	OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
	CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

	*/Object.defineProperty(ia,"__esModule",{value:!0});var Jj=Ln,Qj=_a,Xj=ei,Zj=Nn,eU=xn,tU=Jr,rU=ti;function oi(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var kd=oi(Jj),$d=oi(Qj),sa=oi(Xj),Td=oi(Zj),iw=oi(eU),Qo=oi(tU),ua=oi(rU),nU;function Ea(){}Ea.prototype=Object.create(null);function It(){It.init.call(this)}It.EventEmitter=It,It.usingDomains=!1,It.prototype.domain=void 0,It.prototype._events=void 0,It.prototype._maxListeners=void 0,It.defaultMaxListeners=10,It.init=function(){this.domain=null,It.usingDomains&&nU.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new Ea,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},It.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this};function sw(e){return e._maxListeners===void 0?It.defaultMaxListeners:e._maxListeners}It.prototype.getMaxListeners=function(){return sw(this)};function aU(e,n,t){if(n)e.call(t);else for(var r=e.length,a=au(e,r),i=0;i<r;++i)a[i].call(t)}function iU(e,n,t,r){if(n)e.call(t,r);else for(var a=e.length,i=au(e,a),s=0;s<a;++s)i[s].call(t,r)}function sU(e,n,t,r,a){if(n)e.call(t,r,a);else for(var i=e.length,s=au(e,i),o=0;o<i;++o)s[o].call(t,r,a)}function uU(e,n,t,r,a,i){if(n)e.call(t,r,a,i);else for(var s=e.length,o=au(e,s),u=0;u<s;++u)o[u].call(t,r,a,i)}function oU(e,n,t,r){if(n)e.apply(t,r);else for(var a=e.length,i=au(e,a),s=0;s<a;++s)i[s].apply(t,r)}It.prototype.emit=function(n){var t,r,a,i,s,o,u,l=n==="error";if(o=this._events,o)l=l&&o.error==null;else if(!l)return!1;if(u=this.domain,l){if(t=arguments[1],u)t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=u,t.domainThrown=!1,u.emit("error",t);else{if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return!1}if(r=o[n],!r)return!1;var p=typeof r=="function";switch(a=arguments.length,a){case 1:aU(r,p,this);break;case 2:iU(r,p,this,arguments[1]);break;case 3:sU(r,p,this,arguments[1],arguments[2]);break;case 4:uU(r,p,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(a-1),s=1;s<a;s++)i[s-1]=arguments[s];oU(r,p,this,i)}return!0};function uw(e,n,t,r){var a,i,s;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(i=e._events,i?(i.newListener&&(e.emit("newListener",n,t.listener?t.listener:t),i=e._events),s=i[n]):(i=e._events=new Ea,e._eventsCount=0),!s)s=i[n]=t,++e._eventsCount;else if(typeof s=="function"?s=i[n]=r?[t,s]:[s,t]:r?s.unshift(t):s.push(t),!s.warned&&(a=sw(e),a&&a>0&&s.length>a)){s.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=n,o.count=s.length,lU(o)}return e}function lU(e){typeof console.warn=="function"?console.warn(e):console.log(e)}It.prototype.addListener=function(n,t){return uw(this,n,t,!1)},It.prototype.on=It.prototype.addListener,It.prototype.prependListener=function(n,t){return uw(this,n,t,!0)};function ow(e,n,t){var r=!1;function a(){e.removeListener(n,a),r||(r=!0,t.apply(e,arguments))}return a.listener=t,a}It.prototype.once=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.on(n,ow(this,n,t)),this},It.prototype.prependOnceListener=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(n,ow(this,n,t)),this},It.prototype.removeListener=function(n,t){var r,a,i,s,o;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(a=this._events,!a)return this;if(r=a[n],!r)return this;if(r===t||r.listener&&r.listener===t)--this._eventsCount===0?this._events=new Ea:(delete a[n],a.removeListener&&this.emit("removeListener",n,r.listener||t));else if(typeof r!="function"){for(i=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;if(r.length===1){if(r[0]=void 0,--this._eventsCount===0)return this._events=new Ea,this;delete a[n]}else cU(r,i);a.removeListener&&this.emit("removeListener",n,o||t)}return this},It.prototype.off=function(e,n){return this.removeListener(e,n)},It.prototype.removeAllListeners=function(n){var t,r;if(r=this._events,!r)return this;if(!r.removeListener)return arguments.length===0?(this._events=new Ea,this._eventsCount=0):r[n]&&(--this._eventsCount===0?this._events=new Ea:delete r[n]),this;if(arguments.length===0){for(var a=Object.keys(r),i=0,s;i<a.length;++i)s=a[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new Ea,this._eventsCount=0,this}if(t=r[n],typeof t=="function")this.removeListener(n,t);else if(t)do this.removeListener(n,t[t.length-1]);while(t[0]);return this},It.prototype.listeners=function(n){var t,r,a=this._events;return a?(t=a[n],t?typeof t=="function"?r=[t.listener||t]:r=fU(t):r=[]):r=[],r},It.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):lw.call(e,n)},It.prototype.listenerCount=lw;function lw(e){var n=this._events;if(n){var t=n[e];if(typeof t=="function")return 1;if(t)return t.length}return 0}It.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function cU(e,n){for(var t=n,r=t+1,a=e.length;r<a;t+=1,r+=1)e[t]=e[r];e.pop()}function au(e,n){for(var t=new Array(n);n--;)t[n]=e[n];return t}function fU(e){for(var n=new Array(e.length),t=0;t<n.length;++t)n[t]=e[t].listener||e[t];return n}function cw(e){var n=dU();return function(){var r=Qo.default(e),a;if(n){var i=Qo.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return iw.default(this,a)}}function dU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fw=function(e){Td.default(t,e);var n=cw(t);function t(r){var a;return kd.default(this,t),a=n.call(this),ua.default(sa.default(a),"timeout",null),ua.default(sa.default(a),"startTimestamp",-1),a.minDelay=r.min,a.maxDelay=r.max,a.initialDelay=r.initial||0,a.maxAttemptsCount=r.maxAttemptsCount||0,a.maxAttemptsTime=r.maxAttemptsTime||0,a.randomness=r.randomness||0,a.inProgress=!1,a.attemptNum=0,a.prevDelay=0,a.currDelay=0,a}return $d.default(t,[{key:"attempt",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.attemptNum++,this.emit("attempt",this)}},{key:"nextDelay",value:function(a){if(typeof a=="number")return this.prevDelay=0,this.currDelay=a,a;if(this.attemptNum==0)return this.initialDelay;if(this.attemptNum==1)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var i=this.currDelay+this.prevDelay;return this.maxDelay&&i>this.maxDelay&&(this.currDelay=this.maxDelay,i=this.maxDelay),this.currDelay=i,i}},{key:"randomize",value:function(a){var i=a*this.randomness,s=Math.round(Math.random()*i*2-i);return Math.max(0,a+s)}},{key:"scheduleAttempt",value:function(a){var i=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount){this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached"));return}var s=this.nextDelay(a);if(s=this.randomize(s),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+s){this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached"));return}this.timeout=setTimeout(function(){return i.attempt()},s)}},{key:"cleanup",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){if(this.inProgress)throw new Error("Retrier is already in progress");this.inProgress=!0,this.startTimestamp=Date.now(),this.scheduleAttempt(this.initialDelay)}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"))}},{key:"succeeded",value:function(a){this.emit("succeeded",a)}},{key:"failed",value:function(a,i){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(i)}}]),t}(It),pU=function(e){Td.default(t,e);var n=cw(t);function t(r){var a;return kd.default(this,t),a=n.call(this),ua.default(sa.default(a),"resolve",function(){}),ua.default(sa.default(a),"reject",function(){}),a.retrier=new fw(r),a}return $d.default(t,[{key:"run",value:function(a){var i=this;return this.retrier.on("attempt",function(){a().then(function(s){return i.retrier.succeeded(s)}).catch(function(s){return i.retrier.failed(s)})}),this.retrier.on("succeeded",function(s){return i.resolve(s)}),this.retrier.on("cancelled",function(){return i.reject(new Error("Cancelled"))}),this.retrier.on("failed",function(s){return i.reject(s)}),new Promise(function(s,o){i.resolve=s,i.reject=o,i.retrier.start()})}},{key:"cancel",value:function(){this.retrier.cancel()}}]),t}(It);function vU(e){var n=hU();return function(){var r=Qo.default(e),a;if(n){var i=Qo.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return iw.default(this,a)}}function hU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Xo(e){return e!=null}var yU=function(e){Td.default(t,e);var n=vU(t);function t(r){var a;kd.default(this,t),a=n.call(this),ua.default(sa.default(a),"backoffDelay",0),ua.default(sa.default(a),"nextBackoffDelay",0),ua.default(sa.default(a),"backoffNumber",0),ua.default(sa.default(a),"timeoutID",null),ua.default(sa.default(a),"maxNumberOfRetry",-1),r=r||{};var i=r,s=i.initialDelay,o=i.maxDelay,u=i.randomisationFactor,l=i.factor;if(Xo(s)&&s<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(Xo(o)&&o<=1)throw new Error("The maximal timeout must be greater than 1.");if(Xo(u)&&(u<0||u>1))throw new Error("The randomisation factor must be between 0 and 1.");if(Xo(l)&&l<=1)throw new Error("Exponential factor should be greater than 1.");if(a.initialDelay=s||100,a.maxDelay=o||1e4,a.maxDelay<=a.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return a.randomisationFactor=u||0,a.factor=l||2,a.reset(),a}return $d.default(t,[{key:"backoff",value:function(a){this.timeoutID==null&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",a),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,a)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(a){if(a<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(a));this.maxNumberOfRetry=a}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var a=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*a))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(a){return new t(a)}}]),t}(It);ia.AsyncRetrier=pU,ia.Backoff=yU,ia.Retrier=fw;var Zo={},gU=Pt,mU=Vt,bU=Vn,wU=Jm,dw=RegExp.prototype,SU=function(e){var n=e.flags;return n===void 0&&!("flags"in dw)&&!mU(e,"flags")&&bU(dw,e)?gU(wU,e):n},_U=Ts.PROPER,kU=Sr,$U=Jt,pw=rr,TU=at,CU=SU,Cd="toString",vw=RegExp.prototype,hw=vw[Cd],EU=TU(function(){return hw.call({source:"a",flags:"b"})!=="/a/b"}),IU=_U&&hw.name!==Cd;(EU||IU)&&kU(vw,Cd,function(){var n=$U(this),t=pw(n.source),r=pw(CU(n));return"/"+t+"/"+r},{unsafe:!0});var _r={};/*
	@license
	Copyright (c) 2021 Twilio Inc.

	Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


	*/Object.defineProperty(_r,"__esModule",{value:!0});var RU=Yr,OU=qi,AU=Wi,PU=Ln,MU=Nn,NU=xn,xU=Jr;function li(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var Gi=li(RU),ci=li(OU),Ed=li(AU),LU=li(PU),jU=li(MU),UU=li(NU),yw=li(xU),Ia=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return{checks:t}};function FU(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=DU(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function DU(e,n){if(e){if(typeof e=="string")return gw(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return gw(e,n)}}function gw(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var mw=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return Ia(function(a){var i=!1,s=[],o=FU(t),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;if(typeof l=="string"){i=i||Gi.default(a)===l,s.push("of type ".concat(l));continue}i=i||a instanceof l,s.push("an instance of ".concat(l.name))}}catch(c){o.e(c)}finally{o.f()}return[i,s]})};function BU(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=qU(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function qU(e,n){if(e){if(typeof e=="string")return bw(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return bw(e,n)}}function bw(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var WU=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return Ia(function(a){var i=!1,s=[],o=BU(t),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;i=i||a===l,s.push(typeof l=="string"?'"'.concat(l,'"'):"".concat(l))}}catch(c){o.e(c)}finally{o.f()}return[i,s]})},zU=Ia(function(e){return[typeof e=="string"&&e.length>0,"a non-empty string"]}),GU=Ia(function(e){return[typeof e=="number"&&Number.isInteger(e)&&e>=0,"a non-negative integer"]}),HU=Ia(function(e){return[Gi.default(e)==="object"&&e!==null&&!Array.isArray(e),"a pure object (non-null and non-array)"]});function VU(e){var n=KU();return function(){var r=yw.default(e),a;if(n){var i=yw.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return UU.default(this,a)}}function KU(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function iu(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=YU(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function YU(e,n){if(e){if(typeof e=="string")return ww(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ww(e,n)}}function ww(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var el=function(n,t){if(t.length>n.length)throw new Error("Expected at most ".concat(n.length," argument(s), but got ").concat(t.length));for(;t.length<n.length;)t.push(void 0);var r=iu(t.entries()),a;try{for(r.s();!(a=r.n()).done;){var i=ci.default(a.value,2),s=i[0],o=i[1],u=Od(n[s],o),l=ci.default(u,4),c=l[0],p=l[1],S=l[2],T=l[3];if(!c){var I=s+1;throw new Error("Argument ".concat(I," is expected to be ").concat(S).concat(T," but got ").concat(p))}}}catch(x){r.e(x)}finally{r.f()}},Sw=function(n){var t,r,a=["undefined","boolean","number","bigint","string"];if(a.includes(Gi.default(n))&&(r=typeof n=="string"?'"'.concat(n,'"'):"".concat(n)),Gi.default(n)==="object"&&(n==null||(t=n.constructor)===null||t===void 0?void 0:t.name)!=="Object"){var i;r=n===null?"null":"instance of ".concat(n==null||(i=n.constructor)===null||i===void 0?void 0:i.name)}return r||(r=Gi.default(n)),r},JU=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Id(t);return function(i){return function(s){jU.default(u,s);var o=VU(u);function u(){LU.default(this,u);for(var l=arguments.length,c=new Array(l),p=0;p<l;p++)c[p]=arguments[p];return el(a,c),o.call.apply(o,[this].concat(c))}return u}(i)}},QU=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Id(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypes decorator can only be applied to methods");var u=o.value;o.value=function(){for(var l=arguments.length,c=new Array(l),p=0;p<l;p++)c[p]=arguments[p];return el(a,c),u.apply(this,c)}}},XU=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Id(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypesAsync decorator can only be applied to methods");var u=o.value;o.value=function(){for(var l=arguments.length,c=new Array(l),p=0;p<l;p++)c[p]=arguments[p];try{el(a,c)}catch(S){return Promise.reject(S)}return u.apply(this,c)}}},Id=function(n){var t=[],r=iu(n),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;t.push(Rd(i))}}catch(s){r.e(s)}finally{r.f()}return t},Rd=function(n){var t=[],r=Array.isArray(n)?n:[n],a=iu(r),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;if(typeof s=="string"||typeof s=="function"){t.push(mw(s));continue}t.push(s)}}catch(o){a.e(o)}finally{a.f()}return t},Od=function(n,t){var r=[],a,i=!1,s=iu(n),o;try{for(s.s();!(o=s.n()).done;){var u=o.value,l=iu(u.checks),c;try{for(l.s();!(c=l.n()).done;){var p=c.value,S=p(t),T=ci.default(S,3),I=T[0],x=T[1],U=T[2];i=i||I,!a&&U&&(a=U),x&&(r=typeof x=="string"?[].concat(Ed.default(r),[x]):[].concat(Ed.default(r),Ed.default(x)))}}catch(de){l.e(de)}finally{l.f()}}}catch(de){s.e(de)}finally{s.f()}if(i)return[!0];var F=a||Sw(t),V=r.length-1,Ae=V>0?"".concat(r.slice(0,V).join(", ")," or ").concat(r[V]):r.join(", ");return[!1,F,Ae,V>1?";":","]},ZU=function(n,t){return Ia(function(r){if(Gi.default(r)!=="object"||r===null||Array.isArray(r))return[!1,"valid ".concat(n," (should be a pure object)")];for(var a=0,i=Object.entries(t);a<i.length;a++){var s=ci.default(i[a],2),o=s[0],u=s[1],l=Od(Rd(u),r[o]),c=ci.default(l,3),p=c[0],S=c[1],T=c[2];if(!p)return[!1,"valid ".concat(n,' (key "').concat(o,'" should be ').concat(T,")"),"malformed ".concat(n,' (key "').concat(o,'" is ').concat(S,")")]}return[!0]})};function eF(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=tF(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function tF(e,n){if(e){if(typeof e=="string")return _w(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _w(e,n)}}function _w(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var rF=function(n,t){return Ia(function(r){if(!Array.isArray(r))return[!1,"an array of ".concat(n)];var a=eF(r.entries()),i;try{for(a.s();!(i=a.n()).done;){var s=ci.default(i.value,2),o=s[0],u=s[1],l=Od(Rd(t),u),c=ci.default(l,3),p=c[0],S=c[1],T=c[2];if(!p)return[!1,"a valid array of ".concat(n," (index ").concat(o," should be ").concat(T,")"),"malformed array of ".concat(n," (index ").concat(o," is ").concat(S,")")]}}catch(I){a.e(I)}finally{a.f()}return[!0]})};_r.array=rF,_r.custom=Ia,_r.literal=WU,_r.nonEmptyString=zU,_r.nonNegativeInteger=GU,_r.objectSchema=ZU,_r.pureObject=HU,_r.runtimeTypeValidation=el,_r.stringifyReceivedType=Sw,_r.type=mw,_r.validateConstructorTypes=JU,_r.validateTypes=QU,_r.validateTypesAsync=XU;var nF=Sd,aF=aw;nF("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},aF);var kw={exports:{}};(function(e,n){(function(r,a){e.exports=a()})(Rr,function(){return function(t){var r={};function a(i){if(r[i])return r[i].exports;var s=r[i]={i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=t,a.c=r,a.i=function(i){return i},a.d=function(i,s,o){a.o(i,s)||Object.defineProperty(i,s,{configurable:!1,enumerable:!0,get:o})},a.n=function(i){var s=i&&i.__esModule?function(){return i.default}:function(){return i};return a.d(s,"a",s),s},a.o=function(i,s){return Object.prototype.hasOwnProperty.call(i,s)},a.p="",a(a.s=5)}([function(t,r,a){t.exports=function(i,s){var o,u,l;for(o=1;o<arguments.length;o++){u=arguments[o];for(l in u)u.hasOwnProperty(l)&&(i[l]=u[l])}return i}},function(t,r,a){var i=a(0);t.exports={build:function(s,o){var u,l,c,p=o.plugins;for(u=0,l=p.length;u<l;u++)c=p[u],c.methods&&i(s,c.methods),c.properties&&Object.defineProperties(s,c.properties)},hook:function(s,o,u){var l,c,p,S,T=s.config.plugins,I=[s.context];for(u&&(I=I.concat(u)),l=0,c=T.length;l<c;l++)S=T[l],p=T[l][o],p&&p.apply(S,I)}}},function(t,r,a){function i(s){if(s.length===0)return s;var o,u,l=s.split(/[_-]/);if(l.length===1&&l[0][0].toLowerCase()===l[0][0])return s;for(u=l[0].toLowerCase(),o=1;o<l.length;o++)u=u+l[o].charAt(0).toUpperCase()+l[o].substring(1).toLowerCase();return u}i.prepended=function(s,o){return o=i(o),s+o[0].toUpperCase()+o.substring(1)},t.exports=i},function(t,r,a){var i=a(0),s=a(2);function o(u,l){u=u||{},this.options=u,this.defaults=l.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(u.init),this.data=this.configureData(u.data),this.methods=this.configureMethods(u.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(u.transitions||[]),this.plugins=this.configurePlugins(u.plugins,l.plugin)}i(o.prototype,{addState:function(u){this.map[u]||(this.states.push(u),this.addStateLifecycleNames(u),this.map[u]={})},addStateLifecycleNames:function(u){this.lifecycle.onEnter[u]=s.prepended("onEnter",u),this.lifecycle.onLeave[u]=s.prepended("onLeave",u),this.lifecycle.on[u]=s.prepended("on",u)},addTransition:function(u){this.transitions.indexOf(u)<0&&(this.transitions.push(u),this.addTransitionLifecycleNames(u))},addTransitionLifecycleNames:function(u){this.lifecycle.onBefore[u]=s.prepended("onBefore",u),this.lifecycle.onAfter[u]=s.prepended("onAfter",u),this.lifecycle.on[u]=s.prepended("on",u)},mapTransition:function(u){var l=u.name,c=u.from,p=u.to;return this.addState(c),typeof p!="function"&&this.addState(p),this.addTransition(l),this.map[c][l]=u,u},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(u){return typeof u=="string"?this.mapTransition(i({},this.defaults.init,{to:u,active:!0})):typeof u=="object"?this.mapTransition(i({},this.defaults.init,u,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(u){return typeof u=="function"?u:typeof u=="object"?function(){return u}:function(){return{}}},configureMethods:function(u){return u||{}},configurePlugins:function(u,l){u=u||[];var c,p,S;for(c=0,p=u.length;c<p;c++)S=u[c],typeof S=="function"&&(u[c]=S=S()),S.configure&&S.configure(this);return u},configureTransitions:function(u){var l,c,p,S,T,I=this.defaults.wildcard;for(c=0;c<u.length;c++)for(p=u[c],S=Array.isArray(p.from)?p.from:[p.from||I],T=p.to||I,l=0;l<S.length;l++)this.mapTransition({name:p.name,from:S[l],to:T})},transitionFor:function(u,l){var c=this.defaults.wildcard;return this.map[u][l]||this.map[c][l]},transitionsFor:function(u){var l=this.defaults.wildcard;return Object.keys(this.map[u]).concat(Object.keys(this.map[l]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),t.exports=o},function(t,r,a){var i=a(0),s=a(6),o=a(1),u=[null,[]];function l(c,p){this.context=c,this.config=p,this.state=p.init.from,this.observers=[c]}i(l.prototype,{init:function(c){if(i(this.context,this.config.data.apply(this.context,c)),o.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(c){return Array.isArray(c)?c.indexOf(this.state)>=0:this.state===c},isPending:function(){return this.pending},can:function(c){return!this.isPending()&&!!this.seek(c)},cannot:function(c){return!this.can(c)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(c,p){var S=this.config.defaults.wildcard,T=this.config.transitionFor(this.state,c),I=T&&T.to;return typeof I=="function"?I.apply(this.context,p):I===S?this.state:I},fire:function(c,p){return this.transit(c,this.state,this.seek(c,p),p)},transit:function(c,p,S,T){var I=this.config.lifecycle,x=this.config.options.observeUnchangedState||p!==S;return S?this.isPending()?this.context.onPendingTransition(c,p,S):(this.config.addState(S),this.beginTransit(),T.unshift({transition:c,from:p,to:S,fsm:this.context}),this.observeEvents([this.observersForEvent(I.onBefore.transition),this.observersForEvent(I.onBefore[c]),x?this.observersForEvent(I.onLeave.state):u,x?this.observersForEvent(I.onLeave[p]):u,this.observersForEvent(I.on.transition),x?["doTransit",[this]]:u,x?this.observersForEvent(I.onEnter.state):u,x?this.observersForEvent(I.onEnter[S]):u,x?this.observersForEvent(I.on[S]):u,this.observersForEvent(I.onAfter.transition),this.observersForEvent(I.onAfter[c]),this.observersForEvent(I.on[c])],T)):this.context.onInvalidTransition(c,p,S)},beginTransit:function(){this.pending=!0},endTransit:function(c){return this.pending=!1,c},failTransit:function(c){throw this.pending=!1,c},doTransit:function(c){this.state=c.to},observe:function(c){if(c.length===2){var p={};p[c[0]]=c[1],this.observers.push(p)}else this.observers.push(c[0])},observersForEvent:function(c){for(var p=0,S=this.observers.length,T,I=[];p<S;p++)T=this.observers[p],T[c]&&I.push(T);return[c,I,!0]},observeEvents:function(c,p,S,T){if(c.length===0)return this.endTransit(T===void 0?!0:T);var I=c[0][0],x=c[0][1],U=c[0][2];if(p[0].event=I,I&&U&&I!==S&&o.hook(this,"lifecycle",p),x.length===0)return c.shift(),this.observeEvents(c,p,I,T);var F=x.shift(),V=F[I].apply(F,p);return V&&typeof V.then=="function"?V.then(this.observeEvents.bind(this,c,p,I)).catch(this.failTransit.bind(this)):V===!1?this.endTransit(!1):this.observeEvents(c,p,I,V)},onInvalidTransition:function(c,p,S){throw new s("transition is invalid in current state",c,p,S,this.state)},onPendingTransition:function(c,p,S){throw new s("transition is invalid while previous transition is still in progress",c,p,S,this.state)}}),t.exports=l},function(t,r,a){var i=a(0),s=a(2),o=a(1),u=a(3),l=a(4),c={is:function(U){return this._fsm.is(U)},can:function(U){return this._fsm.can(U)},cannot:function(U){return this._fsm.cannot(U)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(U,F,V){return this._fsm.onInvalidTransition(U,F,V)},onPendingTransition:function(U,F,V){return this._fsm.onPendingTransition(U,F,V)}},p={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(U){throw Error("use transitions to change state")}}};function S(U){return I(this||{},U)}function T(){var U,F;typeof arguments[0]=="function"?(U=arguments[0],F=arguments[1]||{}):(U=function(){this._fsm.apply(this,arguments)},F=arguments[0]||{});var V=new u(F,S);return x(U.prototype,V),U.prototype._fsm.config=V,U}function I(U,F){var V=new u(F,S);return x(U,V),U._fsm(),U}function x(U,F){if(typeof U!="object"||Array.isArray(U))throw Error("StateMachine can only be applied to objects");o.build(U,F),Object.defineProperties(U,p),i(U,c),i(U,F.methods),F.allTransitions().forEach(function(V){U[s(V)]=function(){return this._fsm.fire(V,[].slice.call(arguments))}}),U._fsm=function(){this._fsm=new l(this,F),this._fsm.init(arguments)}}S.version="3.0.1",S.factory=T,S.apply=I,S.defaults={wildcard:"*",init:{name:"init",from:"none"}},t.exports=S},function(t,r,a){t.exports=function(i,s,o,u,l){this.message=i,this.transition=s,this.from=o,this.to=u,this.current=l}}])})})(kw);var iF=kw.exports,Ad={exports:{}},$w=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if($w){var Tw=new Uint8Array(16);Ad.exports=function(){return $w(Tw),Tw}}else{var Cw=new Array(16);Ad.exports=function(){for(var n=0,t;n<16;n++)n&3||(t=Math.random()*4294967296),Cw[n]=t>>>((n&3)<<3)&255;return Cw}}for(var Ew=Ad.exports,Iw=[],tl=0;tl<256;++tl)Iw[tl]=(tl+256).toString(16).substr(1);function sF(e,n){var t=n||0,r=Iw;return[r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]]].join("")}var Rw=sF,uF=Ew,oF=Rw,Ow,Pd,Md=0,Nd=0;function lF(e,n,t){var r=n&&t||0,a=n||[];e=e||{};var i=e.node||Ow,s=e.clockseq!==void 0?e.clockseq:Pd;if(i==null||s==null){var o=uF();i==null&&(i=Ow=[o[0]|1,o[1],o[2],o[3],o[4],o[5]]),s==null&&(s=Pd=(o[6]<<8|o[7])&16383)}var u=e.msecs!==void 0?e.msecs:new Date().getTime(),l=e.nsecs!==void 0?e.nsecs:Nd+1,c=u-Md+(l-Nd)/1e4;if(c<0&&e.clockseq===void 0&&(s=s+1&16383),(c<0||u>Md)&&e.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Md=u,Nd=l,Pd=s,u+=122192928e5;var p=((u&268435455)*1e4+l)%4294967296;a[r++]=p>>>24&255,a[r++]=p>>>16&255,a[r++]=p>>>8&255,a[r++]=p&255;var S=u/4294967296*1e4&268435455;a[r++]=S>>>8&255,a[r++]=S&255,a[r++]=S>>>24&15|16,a[r++]=S>>>16&255,a[r++]=s>>>8|128,a[r++]=s&255;for(var T=0;T<6;++T)a[r+T]=i[T];return n||oF(a)}var cF=lF,fF=Ew,dF=Rw;function pF(e,n,t){var r=n&&t||0;typeof e=="string"&&(n=e==="binary"?new Array(16):null,e=null),e=e||{};var a=e.random||(e.rng||fF)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,n)for(var i=0;i<16;++i)n[r+i]=a[i];return n||dF(a)}var vF=pF,hF=cF,Aw=vF,xd=Aw;xd.v1=hF,xd.v4=Aw;var rl=xd,Ld={exports:{}},Pw=typeof ArrayBuffer<"u"&&typeof DataView<"u",yF=Pw,jd=Lt,kr=yt,Mw=Mt,nl=qt,Ra=Vt,Ud=Jn,gF=Va,mF=Kn,Fd=Sr,bF=Mn,wF=Vn,al=Js,Hi=Ai,SF=Nt,_F=$s,Nw=Fr,xw=Nw.enforce,kF=Nw.get,il=kr.Int8Array,Dd=il&&il.prototype,Lw=kr.Uint8ClampedArray,jw=Lw&&Lw.prototype,jn=il&&al(il),pn=Dd&&al(Dd),$F=Object.prototype,Bd=kr.TypeError,Uw=SF("toStringTag"),qd=_F("TYPED_ARRAY_TAG"),sl="TypedArrayConstructor",oa=yF&&!!Hi&&Ud(kr.opera)!=="Opera",Fw=!1,Pr,Oa,Vi,la={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Wd={BigInt64Array:8,BigUint64Array:8},TF=function(n){if(!nl(n))return!1;var t=Ud(n);return t==="DataView"||Ra(la,t)||Ra(Wd,t)},Dw=function(e){var n=al(e);if(nl(n)){var t=kF(n);return t&&Ra(t,sl)?t[sl]:Dw(n)}},Bw=function(e){if(!nl(e))return!1;var n=Ud(e);return Ra(la,n)||Ra(Wd,n)},CF=function(e){if(Bw(e))return e;throw new Bd("Target is not a typed array")},EF=function(e){if(Mw(e)&&(!Hi||wF(jn,e)))return e;throw new Bd(gF(e)+" is not a typed array constructor")},IF=function(e,n,t,r){if(jd){if(t)for(var a in la){var i=kr[a];if(i&&Ra(i.prototype,e))try{delete i.prototype[e]}catch{try{i.prototype[e]=n}catch{}}}(!pn[e]||t)&&Fd(pn,e,t?n:oa&&Dd[e]||n,r)}},RF=function(e,n,t){var r,a;if(jd){if(Hi){if(t){for(r in la)if(a=kr[r],a&&Ra(a,e))try{delete a[e]}catch{}}if(!jn[e]||t)try{return Fd(jn,e,t?n:oa&&jn[e]||n)}catch{}else return}for(r in la)a=kr[r],a&&(!a[e]||t)&&Fd(a,e,n)}};for(Pr in la)Oa=kr[Pr],Vi=Oa&&Oa.prototype,Vi?xw(Vi)[sl]=Oa:oa=!1;for(Pr in Wd)Oa=kr[Pr],Vi=Oa&&Oa.prototype,Vi&&(xw(Vi)[sl]=Oa);if((!oa||!Mw(jn)||jn===Function.prototype)&&(jn=function(){throw new Bd("Incorrect invocation")},oa))for(Pr in la)kr[Pr]&&Hi(kr[Pr],jn);if((!oa||!pn||pn===$F)&&(pn=jn.prototype,oa))for(Pr in la)kr[Pr]&&Hi(kr[Pr].prototype,pn);if(oa&&al(jw)!==pn&&Hi(jw,pn),jd&&!Ra(pn,Uw)){Fw=!0,bF(pn,Uw,{configurable:!0,get:function(){return nl(this)?this[qd]:void 0}});for(Pr in la)kr[Pr]&&mF(kr[Pr],qd,Pr)}var Ut={NATIVE_ARRAY_BUFFER_VIEWS:oa,TYPED_ARRAY_TAG:Fw&&qd,aTypedArray:CF,aTypedArrayConstructor:EF,exportTypedArrayMethod:IF,exportTypedArrayStaticMethod:RF,getTypedArrayConstructor:Dw,isView:TF,isTypedArray:Bw,TypedArray:jn,TypedArrayPrototype:pn},qw=yt,zd=at,OF=Eo,AF=Ut.NATIVE_ARRAY_BUFFER_VIEWS,PF=qw.ArrayBuffer,fi=qw.Int8Array,MF=!AF||!zd(function(){fi(1)})||!zd(function(){new fi(-1)})||!OF(function(e){new fi,new fi(null),new fi(1.5),new fi(e)},!0)||zd(function(){return new fi(new PF(2),1,void 0).length!==1}),NF=On,xF=Yn,LF=RangeError,Ww=function(e){if(e===void 0)return 0;var n=NF(e),t=xF(n);if(n!==t)throw new LF("Wrong length or index");return t},jF=Math.sign||function(n){var t=+n;return t===0||t!==t?t:t<0?-1:1},UF=jF,FF=Math.abs,zw=2220446049250313e-31,Gw=1/zw,DF=function(e){return e+Gw-Gw},BF=function(e,n,t,r){var a=+e,i=FF(a),s=UF(a);if(i<r)return s*DF(i/r/n)*r*n;var o=(1+n/zw)*i,u=o-(o-i);return u>t||u!==u?s*(1/0):s*u},qF=BF,WF=11920928955078125e-23,zF=34028234663852886e22,GF=11754943508222875e-54,HF=Math.fround||function(n){return qF(n,WF,zF,GF)},VF=Array,KF=Math.abs,ca=Math.pow,YF=Math.floor,JF=Math.log,QF=Math.LN2,XF=function(e,n,t){var r=VF(t),a=t*8-n-1,i=(1<<a)-1,s=i>>1,o=n===23?ca(2,-24)-ca(2,-77):0,u=e<0||e===0&&1/e<0?1:0,l=0,c,p,S;for(e=KF(e),e!==e||e===1/0?(p=e!==e?1:0,c=i):(c=YF(JF(e)/QF),S=ca(2,-c),e*S<1&&(c--,S*=2),c+s>=1?e+=o/S:e+=o*ca(2,1-s),e*S>=2&&(c++,S/=2),c+s>=i?(p=0,c=i):c+s>=1?(p=(e*S-1)*ca(2,n),c+=s):(p=e*ca(2,s-1)*ca(2,n),c=0));n>=8;)r[l++]=p&255,p/=256,n-=8;for(c=c<<n|p,a+=n;a>0;)r[l++]=c&255,c/=256,a-=8;return r[l-1]|=u*128,r},ZF=function(e,n){var t=e.length,r=t*8-n-1,a=(1<<r)-1,i=a>>1,s=r-7,o=t-1,u=e[o--],l=u&127,c;for(u>>=7;s>0;)l=l*256+e[o--],s-=8;for(c=l&(1<<-s)-1,l>>=-s,s+=n;s>0;)c=c*256+e[o--],s-=8;if(l===0)l=1-i;else{if(l===a)return c?NaN:u?-1/0:1/0;c+=ca(2,n),l-=i}return(u?-1:1)*c*ca(2,l-n)},eD={pack:XF,unpack:ZF},tD=vr,Hw=Ja,rD=hr,Vw=function(n){for(var t=tD(this),r=rD(t),a=arguments.length,i=Hw(a>1?arguments[1]:void 0,r),s=a>2?arguments[2]:void 0,o=s===void 0?r:Hw(s,r);o>i;)t[i++]=n;return t},ul=yt,Gd=lt,Hd=Lt,nD=Pw,Kw=Ts,aD=Kn,iD=Mn,Yw=Yo,Vd=at,ol=ka,sD=On,uD=Yn,ll=Ww,oD=HF,Jw=eD,lD=Js,Qw=Ai,cD=Vw,fD=Pn,dD=Po,pD=_c,Xw=An,Kd=Fr,vD=Kw.PROPER,Zw=Kw.CONFIGURABLE,Ki="ArrayBuffer",cl="DataView",Yi="prototype",hD="Wrong length",e0="Wrong index",t0=Kd.getterFor(Ki),su=Kd.getterFor(cl),r0=Kd.set,vn=ul[Ki],Br=vn,Ji=Br&&Br[Yi],Un=ul[cl],di=Un&&Un[Yi],n0=Object.prototype,yD=ul.Array,fl=ul.RangeError,gD=Gd(cD),mD=Gd([].reverse),a0=Jw.pack,i0=Jw.unpack,s0=function(e){return[e&255]},u0=function(e){return[e&255,e>>8&255]},o0=function(e){return[e&255,e>>8&255,e>>16&255,e>>24&255]},l0=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},bD=function(e){return a0(oD(e),23,4)},wD=function(e){return a0(e,52,8)},dl=function(e,n,t){iD(e[Yi],n,{configurable:!0,get:function(){return t(this)[n]}})},Aa=function(e,n,t,r){var a=su(e),i=ll(t),s=!!r;if(i+n>a.byteLength)throw new fl(e0);var o=a.bytes,u=i+a.byteOffset,l=fD(o,u,u+n);return s?l:mD(l)},Pa=function(e,n,t,r,a,i){var s=su(e),o=ll(t),u=r(+a),l=!!i;if(o+n>s.byteLength)throw new fl(e0);for(var c=s.bytes,p=o+s.byteOffset,S=0;S<n;S++)c[p+S]=u[l?S:n-S-1]};if(!nD)Br=function(n){ol(this,Ji);var t=ll(n);r0(this,{type:Ki,bytes:gD(yD(t),0),byteLength:t}),Hd||(this.byteLength=t,this.detached=!1)},Ji=Br[Yi],Un=function(n,t,r){ol(this,di),ol(n,Ji);var a=t0(n),i=a.byteLength,s=sD(t);if(s<0||s>i)throw new fl("Wrong offset");if(r=r===void 0?i-s:uD(r),s+r>i)throw new fl(hD);r0(this,{type:cl,buffer:n,byteLength:r,byteOffset:s,bytes:a.bytes}),Hd||(this.buffer=n,this.byteLength=r,this.byteOffset=s)},di=Un[Yi],Hd&&(dl(Br,"byteLength",t0),dl(Un,"buffer",su),dl(Un,"byteLength",su),dl(Un,"byteOffset",su)),Yw(di,{getInt8:function(n){return Aa(this,1,n)[0]<<24>>24},getUint8:function(n){return Aa(this,1,n)[0]},getInt16:function(n){var t=Aa(this,2,n,arguments.length>1?arguments[1]:!1);return(t[1]<<8|t[0])<<16>>16},getUint16:function(n){var t=Aa(this,2,n,arguments.length>1?arguments[1]:!1);return t[1]<<8|t[0]},getInt32:function(n){return l0(Aa(this,4,n,arguments.length>1?arguments[1]:!1))},getUint32:function(n){return l0(Aa(this,4,n,arguments.length>1?arguments[1]:!1))>>>0},getFloat32:function(n){return i0(Aa(this,4,n,arguments.length>1?arguments[1]:!1),23)},getFloat64:function(n){return i0(Aa(this,8,n,arguments.length>1?arguments[1]:!1),52)},setInt8:function(n,t){Pa(this,1,n,s0,t)},setUint8:function(n,t){Pa(this,1,n,s0,t)},setInt16:function(n,t){Pa(this,2,n,u0,t,arguments.length>2?arguments[2]:!1)},setUint16:function(n,t){Pa(this,2,n,u0,t,arguments.length>2?arguments[2]:!1)},setInt32:function(n,t){Pa(this,4,n,o0,t,arguments.length>2?arguments[2]:!1)},setUint32:function(n,t){Pa(this,4,n,o0,t,arguments.length>2?arguments[2]:!1)},setFloat32:function(n,t){Pa(this,4,n,bD,t,arguments.length>2?arguments[2]:!1)},setFloat64:function(n,t){Pa(this,8,n,wD,t,arguments.length>2?arguments[2]:!1)}});else{var c0=vD&&vn.name!==Ki;!Vd(function(){vn(1)})||!Vd(function(){new vn(-1)})||Vd(function(){return new vn,new vn(1.5),new vn(NaN),vn.length!==1||c0&&!Zw})?(Br=function(n){return ol(this,Ji),dD(new vn(ll(n)),this,Br)},Br[Yi]=Ji,Ji.constructor=Br,pD(Br,vn)):c0&&Zw&&aD(vn,"name",Ki),Qw&&lD(di)!==n0&&Qw(di,n0);var pl=new Un(new Br(2)),f0=Gd(di.setInt8);pl.setInt8(0,2147483648),pl.setInt8(1,2147483649),(pl.getInt8(0)||!pl.getInt8(1))&&Yw(di,{setInt8:function(n,t){f0(this,n,t<<24>>24)},setUint8:function(n,t){f0(this,n,t<<24>>24)}},{unsafe:!0})}Xw(Br,Ki),Xw(Un,cl);var d0={ArrayBuffer:Br,DataView:Un},SD=On,_D=RangeError,kD=function(e){var n=SD(e);if(n<0)throw new _D("The argument can't be less than 0");return n},$D=kD,TD=RangeError,p0=function(e,n){var t=$D(e);if(t%n)throw new TD("Wrong offset");return t},CD=Math.round,ED=function(e){var n=CD(e);return n<0?0:n>255?255:n&255},ID=Jn,RD=function(e){var n=ID(e);return n==="BigInt64Array"||n==="BigUint64Array"},OD=ic,AD=TypeError,v0=function(e){var n=OD(e,"number");if(typeof n=="number")throw new AD("Can't convert number to bigint");return BigInt(n)},PD=Qn,MD=Pt,ND=Cc,xD=vr,LD=hr,jD=To,UD=Vs,FD=Ef,DD=RD,BD=Ut.aTypedArrayConstructor,qD=v0,WD=function(n){var t=ND(this),r=xD(n),a=arguments.length,i=a>1?arguments[1]:void 0,s=i!==void 0,o=UD(r),u,l,c,p,S,T,I,x;if(o&&!FD(o))for(I=jD(r,o),x=I.next,r=[];!(T=MD(x,I)).done;)r.push(T.value);for(s&&a>2&&(i=PD(i,arguments[2])),l=LD(r),c=new(BD(t))(l),p=DD(c),u=0;l>u;u++)S=s?i(r[u],u):r[u],c[u]=p?qD(S):+S;return c},zD=hr,h0=function(e,n,t){for(var r=0,a=arguments.length>2?t:zD(n),i=new e(a);a>r;)i[r]=n[r++];return i},y0=ft,g0=yt,m0=Pt,GD=Lt,HD=MF,uu=Ut,b0=d0,w0=ka,VD=Ha,ou=Kn,KD=Rb,YD=Yn,S0=Ww,Yd=p0,JD=ED,_0=Wu,lu=Vt,QD=Jn,Jd=qt,XD=$i,ZD=ba,e3=Vn,vl=Ai,t3=Ya.f,k0=WD,r3=Or.forEach,n3=po,a3=Mn,$0=wr,T0=Hn,C0=h0,Qd=Fr,i3=Po,Xd=Qd.get,s3=Qd.set,u3=Qd.enforce,E0=$0.f,o3=T0.f,Zd=g0.RangeError,I0=b0.ArrayBuffer,l3=I0.prototype,c3=b0.DataView,hl=uu.NATIVE_ARRAY_BUFFER_VIEWS,R0=uu.TYPED_ARRAY_TAG,O0=uu.TypedArray,cu=uu.TypedArrayPrototype,ep=uu.isTypedArray,yl="BYTES_PER_ELEMENT",tp="Wrong length",gl=function(e,n){a3(e,n,{configurable:!0,get:function(){return Xd(this)[n]}})},A0=function(e){var n;return e3(l3,e)||(n=QD(e))==="ArrayBuffer"||n==="SharedArrayBuffer"},P0=function(e,n){return ep(e)&&!XD(n)&&n in e&&KD(+n)&&n>=0},M0=function(n,t){return t=_0(t),P0(n,t)?VD(2,n[t]):o3(n,t)},N0=function(n,t,r){return t=_0(t),P0(n,t)&&Jd(r)&&lu(r,"value")&&!lu(r,"get")&&!lu(r,"set")&&!r.configurable&&(!lu(r,"writable")||r.writable)&&(!lu(r,"enumerable")||r.enumerable)?(n[t]=r.value,n):E0(n,t,r)};GD?(hl||(T0.f=M0,$0.f=N0,gl(cu,"buffer"),gl(cu,"byteOffset"),gl(cu,"byteLength"),gl(cu,"length")),y0({target:"Object",stat:!0,forced:!hl},{getOwnPropertyDescriptor:M0,defineProperty:N0}),Ld.exports=function(e,n,t){var r=e.match(/\d+/)[0]/8,a=e+(t?"Clamped":"")+"Array",i="get"+e,s="set"+e,o=g0[a],u=o,l=u&&u.prototype,c={},p=function(x,U){var F=Xd(x);return F.view[i](U*r+F.byteOffset,!0)},S=function(x,U,F){var V=Xd(x);V.view[s](U*r+V.byteOffset,t?JD(F):F,!0)},T=function(x,U){E0(x,U,{get:function(){return p(this,U)},set:function(F){return S(this,U,F)},enumerable:!0})};hl?HD&&(u=n(function(x,U,F,V){return w0(x,l),i3(function(){return Jd(U)?A0(U)?V!==void 0?new o(U,Yd(F,r),V):F!==void 0?new o(U,Yd(F,r)):new o(U):ep(U)?C0(u,U):m0(k0,u,U):new o(S0(U))}(),x,u)}),vl&&vl(u,O0),r3(t3(o),function(x){x in u||ou(u,x,o[x])}),u.prototype=l):(u=n(function(x,U,F,V){w0(x,l);var Ae=0,de=0,Ge,Ee,Ue;if(!Jd(U))Ue=S0(U),Ee=Ue*r,Ge=new I0(Ee);else if(A0(U)){Ge=U,de=Yd(F,r);var B=U.byteLength;if(V===void 0){if(B%r)throw new Zd(tp);if(Ee=B-de,Ee<0)throw new Zd(tp)}else if(Ee=YD(V)*r,Ee+de>B)throw new Zd(tp);Ue=Ee/r}else return ep(U)?C0(u,U):m0(k0,u,U);for(s3(x,{buffer:Ge,byteOffset:de,byteLength:Ee,length:Ue,view:new c3(Ge)});Ae<Ue;)T(x,Ae++)}),vl&&vl(u,O0),l=u.prototype=ZD(cu)),l.constructor!==u&&ou(l,"constructor",u),u3(l).TypedArrayConstructor=u,R0&&ou(l,R0,a);var I=u!==o;c[a]=u,y0({global:!0,constructor:!0,forced:I,sham:!hl},c),yl in u||ou(u,yl,r),yl in l||ou(l,yl,r),n3(a)}):Ld.exports=function(){};var f3=Ld.exports,d3=f3;d3("Uint8",function(e){return function(t,r,a){return e(this,t,r,a)}});var x0=Va,p3=TypeError,rp=function(e,n){if(!delete e[n])throw new p3("Cannot delete property "+x0(n)+" of "+x0(e))},v3=vr,np=Ja,h3=hr,y3=rp,g3=Math.min,m3=[].copyWithin||function(n,t){var r=v3(this),a=h3(r),i=np(n,a),s=np(t,a),o=arguments.length>2?arguments[2]:void 0,u=g3((o===void 0?a:np(o,a))-s,a-i),l=1;for(s<i&&i<s+u&&(l=-1,s+=u-1,i+=u-1);u-- >0;)s in r?r[i]=r[s]:y3(r,i),i+=l,s+=l;return r},b3=lt,L0=Ut,w3=m3,S3=b3(w3),_3=L0.aTypedArray,k3=L0.exportTypedArrayMethod;k3("copyWithin",function(n,t){return S3(_3(this),n,t,arguments.length>2?arguments[2]:void 0)});var j0=Ut,$3=Or.every,T3=j0.aTypedArray,C3=j0.exportTypedArrayMethod;C3("every",function(n){return $3(T3(this),n,arguments.length>1?arguments[1]:void 0)});var U0=Ut,E3=Vw,I3=v0,R3=Jn,O3=Pt,A3=lt,P3=at,M3=U0.aTypedArray,N3=U0.exportTypedArrayMethod,x3=A3("".slice),L3=P3(function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),e!==1});N3("fill",function(n){var t=arguments.length;M3(this);var r=x3(R3(this),0,3)==="Big"?I3(n):+n;return O3(E3,this,r,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)},L3);var j3=h0,U3=Ut.getTypedArrayConstructor,F3=function(e,n){return j3(U3(e),n)},F0=Ut,D3=Or.filter,B3=F3,q3=F0.aTypedArray,W3=F0.exportTypedArrayMethod;W3("filter",function(n){var t=D3(q3(this),n,arguments.length>1?arguments[1]:void 0);return B3(this,t)});var D0=Ut,z3=Or.find,G3=D0.aTypedArray,H3=D0.exportTypedArrayMethod;H3("find",function(n){return z3(G3(this),n,arguments.length>1?arguments[1]:void 0)});var B0=Ut,V3=Or.findIndex,K3=B0.aTypedArray,Y3=B0.exportTypedArrayMethod;Y3("findIndex",function(n){return V3(K3(this),n,arguments.length>1?arguments[1]:void 0)});var q0=Ut,J3=Or.forEach,Q3=q0.aTypedArray,X3=q0.exportTypedArrayMethod;X3("forEach",function(n){J3(Q3(this),n,arguments.length>1?arguments[1]:void 0)});var W0=Ut,Z3=Qu.includes,eB=W0.aTypedArray,tB=W0.exportTypedArrayMethod;tB("includes",function(n){return Z3(eB(this),n,arguments.length>1?arguments[1]:void 0)});var z0=Ut,rB=Qu.indexOf,nB=z0.aTypedArray,aB=z0.exportTypedArrayMethod;aB("indexOf",function(n){return rB(nB(this),n,arguments.length>1?arguments[1]:void 0)});var iB=yt,sB=at,ap=lt,G0=Ut,ip=Lm,uB=Nt,sp=uB("iterator"),H0=iB.Uint8Array,oB=ap(ip.values),lB=ap(ip.keys),cB=ap(ip.entries),up=G0.aTypedArray,ml=G0.exportTypedArrayMethod,Qi=H0&&H0.prototype,bl=!sB(function(){Qi[sp].call([1])}),V0=!!Qi&&Qi.values&&Qi[sp]===Qi.values&&Qi.values.name==="values",K0=function(){return oB(up(this))};ml("entries",function(){return cB(up(this))},bl),ml("keys",function(){return lB(up(this))},bl),ml("values",K0,bl||!V0,{name:"values"}),ml(sp,K0,bl||!V0,{name:"values"});var Y0=Ut,fB=lt,dB=Y0.aTypedArray,pB=Y0.exportTypedArrayMethod,vB=fB([].join);pB("join",function(n){return vB(dB(this),n)});var hB=Qa,yB=Ur,gB=On,mB=hr,bB=co,wB=Math.min,op=[].lastIndexOf,J0=!!op&&1/[1].lastIndexOf(1,-0)<0,SB=bB("lastIndexOf"),_B=J0||!SB,kB=_B?function(n){if(J0)return hB(op,this,arguments)||0;var t=yB(this),r=mB(t);if(r===0)return-1;var a=r-1;for(arguments.length>1&&(a=wB(a,gB(arguments[1]))),a<0&&(a=r+a);a>=0;a--)if(a in t&&t[a]===n)return a||0;return-1}:op,Q0=Ut,$B=Qa,TB=kB,CB=Q0.aTypedArray,EB=Q0.exportTypedArrayMethod;EB("lastIndexOf",function(n){var t=arguments.length;return $B(TB,CB(this),t>1?[n,arguments[1]]:[n])});var lp=Ut,IB=Or.map,RB=lp.aTypedArray,OB=lp.getTypedArrayConstructor,AB=lp.exportTypedArrayMethod;AB("map",function(n){return IB(RB(this),n,arguments.length>1?arguments[1]:void 0,function(t,r){return new(OB(t))(r)})});var PB=Vr,MB=vr,NB=ks,xB=hr,X0=TypeError,Z0="Reduce of empty array with no initial value",eS=function(e){return function(n,t,r,a){var i=MB(n),s=NB(i),o=xB(i);if(PB(t),o===0&&r<2)throw new X0(Z0);var u=e?o-1:0,l=e?-1:1;if(r<2)for(;;){if(u in s){a=s[u],u+=l;break}if(u+=l,e?u<0:o<=u)throw new X0(Z0)}for(;e?u>=0:o>u;u+=l)u in s&&(a=t(a,s[u],u,i));return a}},tS={left:eS(!1),right:eS(!0)},rS=Ut,LB=tS.left,jB=rS.aTypedArray,UB=rS.exportTypedArrayMethod;UB("reduce",function(n){var t=arguments.length;return LB(jB(this),n,t,t>1?arguments[1]:void 0)});var nS=Ut,FB=tS.right,DB=nS.aTypedArray,BB=nS.exportTypedArrayMethod;BB("reduceRight",function(n){var t=arguments.length;return FB(DB(this),n,t,t>1?arguments[1]:void 0)});var aS=Ut,qB=aS.aTypedArray,WB=aS.exportTypedArrayMethod,zB=Math.floor;WB("reverse",function(){for(var n=this,t=qB(n).length,r=zB(t/2),a=0,i;a<r;)i=n[a],n[a++]=n[--t],n[t]=i;return n});var iS=yt,sS=Pt,cp=Ut,GB=hr,HB=p0,VB=vr,uS=at,KB=iS.RangeError,fp=iS.Int8Array,oS=fp&&fp.prototype,lS=oS&&oS.set,YB=cp.aTypedArray,JB=cp.exportTypedArrayMethod,dp=!uS(function(){var e=new Uint8ClampedArray(2);return sS(lS,e,{length:1,0:3},1),e[1]!==3}),QB=dp&&cp.NATIVE_ARRAY_BUFFER_VIEWS&&uS(function(){var e=new fp(2);return e.set(1),e.set("2",1),e[0]!==0||e[1]!==2});JB("set",function(n){YB(this);var t=HB(arguments.length>1?arguments[1]:void 0,1),r=VB(n);if(dp)return sS(lS,this,r,t);var a=this.length,i=GB(r),s=0;if(i+t>a)throw new KB("Wrong length");for(;s<i;)this[t+s]=r[s++]},!dp||QB);var pp=Ut,XB=at,ZB=Pn,e4=pp.aTypedArray,t4=pp.getTypedArrayConstructor,r4=pp.exportTypedArrayMethod,n4=XB(function(){new Int8Array(1).slice()});r4("slice",function(n,t){for(var r=ZB(e4(this),n,t),a=t4(this),i=0,s=r.length,o=new a(s);s>i;)o[i]=r[i++];return o},n4);var cS=Ut,a4=Or.some,i4=cS.aTypedArray,s4=cS.exportTypedArrayMethod;s4("some",function(n){return a4(i4(this),n,arguments.length>1?arguments[1]:void 0)});var fS=Pn,u4=Math.floor,vp=function(e,n){var t=e.length;if(t<8)for(var r=1,a,i;r<t;){for(i=r,a=e[r];i&&n(e[i-1],a)>0;)e[i]=e[--i];i!==r++&&(e[i]=a)}else for(var s=u4(t/2),o=vp(fS(e,0,s),n),u=vp(fS(e,s),n),l=o.length,c=u.length,p=0,S=0;p<l||S<c;)e[p+S]=p<l&&S<c?n(o[p],u[S])<=0?o[p++]:u[S++]:p<l?o[p++]:u[S++];return e},hp=vp,o4=ma,dS=o4.match(/firefox\/(\d+)/i),pS=!!dS&&+dS[1],l4=ma,vS=/MSIE|Trident/.test(l4),c4=ma,hS=c4.match(/AppleWebKit\/(\d+)\./),yS=!!hS&&+hS[1],f4=yt,d4=xc,yp=at,p4=Vr,v4=hp,gS=Ut,mS=pS,h4=vS,bS=_i,wS=yS,y4=gS.aTypedArray,g4=gS.exportTypedArrayMethod,fu=f4.Uint16Array,Xi=fu&&d4(fu.prototype.sort),m4=!!Xi&&!(yp(function(){Xi(new fu(2),null)})&&yp(function(){Xi(new fu(2),{})})),SS=!!Xi&&!yp(function(){if(bS)return bS<74;if(mS)return mS<67;if(h4)return!0;if(wS)return wS<602;var e=new fu(516),n=Array(516),t,r;for(t=0;t<516;t++)r=t%4,e[t]=515-t,n[t]=t-2*r+3;for(Xi(e,function(a,i){return(a/4|0)-(i/4|0)}),t=0;t<516;t++)if(e[t]!==n[t])return!0}),b4=function(e){return function(n,t){return e!==void 0?+e(n,t)||0:t!==t?-1:n!==n?1:n===0&&t===0?1/n>0&&1/t<0?1:-1:n>t}};g4("sort",function(n){return n!==void 0&&p4(n),SS?Xi(this,n):v4(y4(this),b4(n))},!SS||m4);var gp=Ut,w4=Yn,_S=Ja,S4=gp.aTypedArray,_4=gp.getTypedArrayConstructor,k4=gp.exportTypedArrayMethod;k4("subarray",function(n,t){var r=S4(this),a=r.length,i=_S(n,a),s=_4(r);return new s(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,w4((t===void 0?a:_S(t,a))-i))});var $4=yt,T4=Qa,kS=Ut,mp=at,$S=Pn,wl=$4.Int8Array,TS=kS.aTypedArray,C4=kS.exportTypedArrayMethod,CS=[].toLocaleString,E4=!!wl&&mp(function(){CS.call(new wl(1))}),I4=mp(function(){return[1,2].toLocaleString()!==new wl([1,2]).toLocaleString()})||!mp(function(){wl.prototype.toLocaleString.call([1,2])});C4("toLocaleString",function(){return T4(CS,E4?$S(TS(this)):TS(this),$S(arguments))},I4);var R4=Ut.exportTypedArrayMethod,O4=at,A4=yt,P4=lt,ES=A4.Uint8Array,M4=ES&&ES.prototype||{},Sl=[].toString,N4=P4([].join);O4(function(){Sl.call({})})&&(Sl=function(){return N4(this)});var x4=M4.toString!==Sl;R4("toString",Sl,x4);var bp=Pt,IS=lt,L4=Uo,j4=Jt,U4=cn,F4=fn,D4=sg,B4=id,q4=Yn,RS=rr,W4=Ka,OS=Fo,z4=Qm,G4=at,Zi=z4.UNSUPPORTED_Y,H4=4294967295,V4=Math.min,wp=IS([].push),Sp=IS("".slice),K4=!G4(function(){var e=/(?:)/,n=e.exec;e.exec=function(){return n.apply(this,arguments)};var t="ab".split(e);return t.length!==2||t[0]!=="a"||t[1]!=="b"}),AS="abbc".split(/(b)*/)[1]==="c"||"test".split(/(?:)/,-1).length!==4||"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||".".split(/()()/).length>1||"".split(/.?/).length;L4("split",function(e,n,t){var r="0".split(void 0,0).length?function(a,i){return a===void 0&&i===0?[]:bp(n,this,a,i)}:n;return[function(i,s){var o=F4(this),u=U4(i)?void 0:W4(i,e);return u?bp(u,i,o,s):bp(r,RS(o),i,s)},function(a,i){var s=j4(this),o=RS(a);if(!AS){var u=t(r,s,o,i,r!==n);if(u.done)return u.value}var l=D4(s,RegExp),c=s.unicode,p=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(Zi?"g":"y"),S=new l(Zi?"^(?:"+s.source+")":s,p),T=i===void 0?H4:i>>>0;if(T===0)return[];if(o.length===0)return OS(S,o)===null?[o]:[];for(var I=0,x=0,U=[];x<o.length;){S.lastIndex=Zi?0:x;var F=OS(S,Zi?Sp(o,x):o),V;if(F===null||(V=V4(q4(S.lastIndex+(Zi?x:0)),o.length))===I)x=B4(o,x,c);else{if(wp(U,Sp(o,I,x)),U.length===T)return U;for(var Ae=1;Ae<=F.length-1;Ae++)if(wp(U,F[Ae]),U.length===T)return U;x=I=V}}return wp(U,Sp(o,I)),U}]},AS||!K4,Zi);var PS={exports:{}},MS={exports:{}};(function(e){function n(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(MS);var Y4=MS.exports,NS={exports:{}},xS={exports:{}};(function(e){function n(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(e.exports=n=function(){return!!t},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(xS);var J4=xS.exports;(function(e){var n=J4,t=Jc;function r(a,i,s){if(n())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,i);var u=new(a.bind.apply(a,o));return s&&t(u,s.prototype),u}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(NS);var Q4=NS.exports;(function(e){var n=Jr,t=Jc,r=Y4,a=Q4;function i(s){var o=typeof Map=="function"?new Map:void 0;return e.exports=i=function(l){if(l===null||!r(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(l))return o.get(l);o.set(l,c)}function c(){return a(l,arguments,n(this).constructor)}return c.prototype=Object.create(l.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),t(c,l)},e.exports.__esModule=!0,e.exports.default=e.exports,i(s)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports})(PS);var _l=PS.exports,kl={exports:{}};/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */kl.exports,function(e,n){(function(){var t={function:!0,object:!0},r=t[typeof window]&&window||this,a=n,i=e&&!e.nodeType&&e,s=a&&i&&typeof Rr=="object"&&Rr;s&&(s.global===s||s.window===s||s.self===s)&&(r=s);var o=Math.pow(2,53)-1,u=/\bOpera/,l=Object.prototype,c=l.hasOwnProperty,p=l.toString;function S(B){return B=String(B),B.charAt(0).toUpperCase()+B.slice(1)}function T(B,ce,ke){var pe={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return ce&&ke&&/^Win/i.test(B)&&!/^Windows Phone /i.test(B)&&(pe=pe[/[\d.]+$/.exec(B)])&&(B="Windows "+pe),B=String(B),ce&&ke&&(B=B.replace(RegExp(ce,"i"),ke)),B=x(B.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]),B}function I(B,ce){var ke=-1,pe=B?B.length:0;if(typeof pe=="number"&&pe>-1&&pe<=o)for(;++ke<pe;)ce(B[ke],ke,B);else U(B,ce)}function x(B){return B=Ge(B),/^(?:webOS|i(?:OS|P))/.test(B)?B:S(B)}function U(B,ce){for(var ke in B)c.call(B,ke)&&ce(B[ke],ke,B)}function F(B){return B==null?S(B):p.call(B).slice(8,-1)}function V(B,ce){var ke=B!=null?typeof B[ce]:"number";return!/^(?:boolean|number|string|undefined)$/.test(ke)&&(ke=="object"?!!B[ce]:!0)}function Ae(B){return String(B).replace(/([ -])(?!$)/g,"$1?")}function de(B,ce){var ke=null;return I(B,function(pe,Le){ke=ce(ke,pe,Le,B)}),ke}function Ge(B){return String(B).replace(/^ +| +$/g,"")}function Ee(B){var ce=r,ke=B&&typeof B=="object"&&F(B)!="String";ke&&(ce=B,B=null);var pe=ce.navigator||{},Le=pe.userAgent||"";B||(B=Le);var Z=ke?!!pe.likeChrome:/\bChrome\b/.test(B)&&!/internal|\n/i.test(p.toString()),Pe="Object",Fe=ke?Pe:"ScriptBridgingProxyObject",wt=ke?Pe:"Environment",mt=ke&&ce.java?"JavaPackage":F(ce.java),Ce=ke?Pe:"RuntimeObject",se=/\bJava/.test(mt)&&ce.java,ie=se&&F(ce.environment)==wt,O=se?"a":"Î±",Ie=se?"b":"Î²",Je=ce.document||{},Me=ce.operamini||ce.opera,be=u.test(be=ke&&Me?Me["[[Class]]"]:F(Me))?be:Me=null,z,xt=B,ye=[],te=null,St=B==Le,Ne=St&&Me&&typeof Me.version=="function"&&Me.version(),zt,dt=Kt([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),_e=Wt(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),it=xe([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),bt=pt({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),$e=er(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function Kt(Dt){return de(Dt,function(gt,tt){return gt||RegExp("\\b"+(tt.pattern||Ae(tt))+"\\b","i").exec(B)&&(tt.label||tt)})}function pt(Dt){return de(Dt,function(gt,tt,Ft){return gt||(tt[it]||tt[/^[a-z]+(?: +[a-z]+\b)*/i.exec(it)]||RegExp("\\b"+Ae(Ft)+"(?:\\b|\\w*\\d)","i").exec(B))&&Ft})}function Wt(Dt){return de(Dt,function(gt,tt){return gt||RegExp("\\b"+(tt.pattern||Ae(tt))+"\\b","i").exec(B)&&(tt.label||tt)})}function er(Dt){return de(Dt,function(gt,tt){var Ft=tt.pattern||Ae(tt);return!gt&&(gt=RegExp("\\b"+Ft+"(?:/[\\d.]+|[ \\w.]*)","i").exec(B))&&(gt=T(gt,Ft,tt.label||tt)),gt})}function xe(Dt){return de(Dt,function(gt,tt){var Ft=tt.pattern||Ae(tt);return!gt&&(gt=RegExp("\\b"+Ft+" *\\d+[.\\w_]*","i").exec(B)||RegExp("\\b"+Ft+" *\\w+-[\\w]*","i").exec(B)||RegExp("\\b"+Ft+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(B))&&((gt=String(tt.label&&!RegExp(Ft,"i").test(tt.label)?tt.label:gt).split("/"))[1]&&!/[\d.]+/.test(gt[0])&&(gt[0]+=" "+gt[1]),tt=tt.label||tt,gt=x(gt[0].replace(RegExp(Ft,"i"),tt).replace(RegExp("; *(?:"+tt+"[_-])?","i")," ").replace(RegExp("("+tt+")[-_.]?(\\w)","i"),"$1 $2"))),gt})}function zr(Dt){return de(Dt,function(gt,tt){return gt||(RegExp(tt+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(B)||0)[1]||null})}function bn(){return this.description||""}if(dt&&(dt=[dt]),/\bAndroid\b/.test($e)&&!it&&(z=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(B))&&(it=Ge(z[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),bt&&!it?it=xe([bt]):bt&&it&&(it=it.replace(RegExp("^("+Ae(bt)+")[-_.\\s]","i"),bt+" ").replace(RegExp("^("+Ae(bt)+")[-_.]?(\\w)","i"),bt+" $2")),(z=/\bGoogle TV\b/.exec(it))&&(it=z[0]),/\bSimulator\b/i.test(B)&&(it=(it?it+" ":"")+"Simulator"),_e=="Opera Mini"&&/\bOPiOS\b/.test(B)&&ye.push("running in Turbo/Uncompressed mode"),_e=="IE"&&/\blike iPhone OS\b/.test(B)?(z=Ee(B.replace(/like iPhone OS/,"")),bt=z.manufacturer,it=z.product):/^iP/.test(it)?(_e||(_e="Safari"),$e="iOS"+((z=/ OS ([\d_]+)/i.exec(B))?" "+z[1].replace(/_/g,"."):"")):_e=="Konqueror"&&/^Linux\b/i.test($e)?$e="Kubuntu":bt&&bt!="Google"&&(/Chrome/.test(_e)&&!/\bMobile Safari\b/i.test(B)||/\bVita\b/.test(it))||/\bAndroid\b/.test($e)&&/^Chrome/.test(_e)&&/\bVersion\//i.test(B)?(_e="Android Browser",$e=/\bAndroid\b/.test($e)?$e:"Android"):_e=="Silk"?(/\bMobi/i.test(B)||($e="Android",ye.unshift("desktop mode")),/Accelerated *= *true/i.test(B)&&ye.unshift("accelerated")):_e=="UC Browser"&&/\bUCWEB\b/.test(B)?ye.push("speed mode"):_e=="PaleMoon"&&(z=/\bFirefox\/([\d.]+)\b/.exec(B))?ye.push("identifying as Firefox "+z[1]):_e=="Firefox"&&(z=/\b(Mobile|Tablet|TV)\b/i.exec(B))?($e||($e="Firefox OS"),it||(it=z[1])):!_e||(z=!/\bMinefield\b/i.test(B)&&/\b(?:Firefox|Safari)\b/.exec(_e))?(_e&&!it&&/[\/,]|^[^(]+?\)/.test(B.slice(B.indexOf(z+"/")+8))&&(_e=null),(z=it||bt||$e)&&(it||bt||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test($e))&&(_e=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test($e)?$e:z)+" Browser")):_e=="Electron"&&(z=(/\bChrome\/([\d.]+)\b/.exec(B)||0)[1])&&ye.push("Chromium "+z),Ne||(Ne=zr(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",Ae(_e),"(?:Firefox|Minefield|NetFront)"])),(z=dt=="iCab"&&parseFloat(Ne)>3&&"WebKit"||/\bOpera\b/.test(_e)&&(/\bOPR\b/.test(B)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(B)&&!/^(?:Trident|EdgeHTML)$/.test(dt)&&"WebKit"||!dt&&/\bMSIE\b/i.test(B)&&($e=="Mac OS"?"Tasman":"Trident")||dt=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(_e)&&"NetFront")&&(dt=[z]),_e=="IE"&&(z=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(B)||0)[1])?(_e+=" Mobile",$e="Windows Phone "+(/\+$/.test(z)?z:z+".x"),ye.unshift("desktop mode")):/\bWPDesktop\b/i.test(B)?(_e="IE Mobile",$e="Windows Phone 8.x",ye.unshift("desktop mode"),Ne||(Ne=(/\brv:([\d.]+)/.exec(B)||0)[1])):_e!="IE"&&dt=="Trident"&&(z=/\brv:([\d.]+)/.exec(B))&&(_e&&ye.push("identifying as "+_e+(Ne?" "+Ne:"")),_e="IE",Ne=z[1]),St){if(V(ce,"global"))if(se&&(z=se.lang.System,xt=z.getProperty("os.arch"),$e=$e||z.getProperty("os.name")+" "+z.getProperty("os.version")),ie){try{Ne=ce.require("ringo/engine").version.join("."),_e="RingoJS"}catch{(z=ce.system)&&z.global.system==ce.system&&(_e="Narwhal",$e||($e=z[0].os||null))}_e||(_e="Rhino")}else typeof ce.process=="object"&&!ce.process.browser&&(z=ce.process)&&(typeof z.versions=="object"&&(typeof z.versions.electron=="string"?(ye.push("Node "+z.versions.node),_e="Electron",Ne=z.versions.electron):typeof z.versions.nw=="string"&&(ye.push("Chromium "+Ne,"Node "+z.versions.node),_e="NW.js",Ne=z.versions.nw)),_e||(_e="Node.js",xt=z.arch,$e=z.platform,Ne=/[\d.]+/.exec(z.version),Ne=Ne?Ne[0]:null));else F(z=ce.runtime)==Fe?(_e="Adobe AIR",$e=z.flash.system.Capabilities.os):F(z=ce.phantom)==Ce?(_e="PhantomJS",Ne=(z=z.version||null)&&z.major+"."+z.minor+"."+z.patch):typeof Je.documentMode=="number"&&(z=/\bTrident\/(\d+)/i.exec(B))?(Ne=[Ne,Je.documentMode],(z=+z[1]+4)!=Ne[1]&&(ye.push("IE "+Ne[1]+" mode"),dt&&(dt[1]=""),Ne[1]=z),Ne=_e=="IE"?String(Ne[1].toFixed(1)):Ne[0]):typeof Je.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(_e)&&(ye.push("masking as "+_e+" "+Ne),_e="IE",Ne="11.0",dt=["Trident"],$e="Windows");$e=$e&&x($e)}if(Ne&&(z=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(Ne)||/(?:alpha|beta)(?: ?\d)?/i.exec(B+";"+(St&&pe.appMinorVersion))||/\bMinefield\b/i.test(B)&&"a")&&(te=/b/i.test(z)?"beta":"alpha",Ne=Ne.replace(RegExp(z+"\\+?$"),"")+(te=="beta"?Ie:O)+(/\d+\+?/.exec(z)||"")),_e=="Fennec"||_e=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test($e))_e="Firefox Mobile";else if(_e=="Maxthon"&&Ne)Ne=Ne.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(it))it=="Xbox 360"&&($e=null),it=="Xbox 360"&&/\bIEMobile\b/.test(B)&&ye.unshift("mobile mode");else if((/^(?:Chrome|IE|Opera)$/.test(_e)||_e&&!it&&!/Browser|Mobi/.test(_e))&&($e=="Windows CE"||/Mobi/i.test(B)))_e+=" Mobile";else if(_e=="IE"&&St)try{ce.external===null&&ye.unshift("platform preview")}catch{ye.unshift("embedded")}else(/\bBlackBerry\b/.test(it)||/\bBB10\b/.test(B))&&(z=(RegExp(it.replace(/ +/g," *")+"/([.\\d]+)","i").exec(B)||0)[1]||Ne)?(z=[z,/BB10/.test(B)],$e=(z[1]?(it=null,bt="BlackBerry"):"Device Software")+" "+z[0],Ne=null):this!=U&&it!="Wii"&&(St&&Me||/Opera/.test(_e)&&/\b(?:MSIE|Firefox)\b/i.test(B)||_e=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test($e)||_e=="IE"&&($e&&!/^Win/.test($e)&&Ne>5.5||/\bWindows XP\b/.test($e)&&Ne>8||Ne==8&&!/\bTrident\b/.test(B)))&&!u.test(z=Ee.call(U,B.replace(u,"")+";"))&&z.name&&(z="ing as "+z.name+((z=z.version)?" "+z:""),u.test(_e)?(/\bIE\b/.test(z)&&$e=="Mac OS"&&($e=null),z="identify"+z):(z="mask"+z,be?_e=x(be.replace(/([a-z])([A-Z])/g,"$1 $2")):_e="Opera",/\bIE\b/.test(z)&&($e=null),St||(Ne=null)),dt=["Presto"],ye.push(z));(z=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(B)||0)[1])&&(z=[parseFloat(z.replace(/\.(\d)$/,".0$1")),z],_e=="Safari"&&z[1].slice(-1)=="+"?(_e="WebKit Nightly",te="alpha",Ne=z[1].slice(0,-1)):(Ne==z[1]||Ne==(z[2]=(/\bSafari\/([\d.]+\+?)/i.exec(B)||0)[1]))&&(Ne=null),z[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(B)||0)[1],z[0]==537.36&&z[2]==537.36&&parseFloat(z[1])>=28&&dt=="WebKit"&&(dt=["Blink"]),!St||!Z&&!z[1]?(dt&&(dt[1]="like Safari"),z=(z=z[0],z<400?1:z<500?2:z<526?3:z<533?4:z<534?"4+":z<535?5:z<537?6:z<538?7:z<601?8:z<602?9:z<604?10:z<606?11:z<608?12:"12")):(dt&&(dt[1]="like Chrome"),z=z[1]||(z=z[0],z<530?1:z<532?2:z<532.05?3:z<533?4:z<534.03?5:z<534.07?6:z<534.1?7:z<534.13?8:z<534.16?9:z<534.24?10:z<534.3?11:z<535.01?12:z<535.02?"13+":z<535.07?15:z<535.11?16:z<535.19?17:z<536.05?18:z<536.1?19:z<537.01?20:z<537.11?"21+":z<537.13?23:z<537.18?24:z<537.24?25:z<537.36?26:dt!="Blink"?"27":"28")),dt&&(dt[1]+=" "+(z+=typeof z=="number"?".x":/[.+]/.test(z)?"":"+")),_e=="Safari"&&(!Ne||parseInt(Ne)>45)?Ne=z:_e=="Chrome"&&/\bHeadlessChrome/i.test(B)&&ye.unshift("headless")),_e=="Opera"&&(z=/\bzbov|zvav$/.exec($e))?(_e+=" ",ye.unshift("desktop mode"),z=="zvav"?(_e+="Mini",Ne=null):_e+="Mobile",$e=$e.replace(RegExp(" *"+z+"$"),"")):_e=="Safari"&&/\bChrome\b/.exec(dt&&dt[1])?(ye.unshift("desktop mode"),_e="Chrome Mobile",Ne=null,/\bOS X\b/.test($e)?(bt="Apple",$e="iOS 4.3+"):$e=null):/\bSRWare Iron\b/.test(_e)&&!Ne&&(Ne=zr("Chrome")),Ne&&Ne.indexOf(z=/[\d.]+$/.exec($e))==0&&B.indexOf("/"+z+"-")>-1&&($e=Ge($e.replace(z,""))),$e&&$e.indexOf(_e)!=-1&&!RegExp(_e+" OS").test($e)&&($e=$e.replace(RegExp(" *"+Ae(_e)+" *"),"")),dt&&!/\b(?:Avant|Nook)\b/.test(_e)&&(/Browser|Lunascape|Maxthon/.test(_e)||_e!="Safari"&&/^iOS/.test($e)&&/\bSafari\b/.test(dt[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(_e)&&dt[1])&&(z=dt[dt.length-1])&&ye.push(z),ye.length&&(ye=["("+ye.join("; ")+")"]),bt&&it&&it.indexOf(bt)<0&&ye.push("on "+bt),it&&ye.push((/^on /.test(ye[ye.length-1])?"":"on ")+it),$e&&(z=/ ([\d.+]+)$/.exec($e),zt=z&&$e.charAt($e.length-z[0].length-1)=="/",$e={architecture:32,family:z&&!zt?$e.replace(z[0],""):$e,version:z?z[1]:null,toString:function(){var Dt=this.version;return this.family+(Dt&&!zt?" "+Dt:"")+(this.architecture==64?" 64-bit":"")}}),(z=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(xt))&&!/\bi686\b/i.test(xt)?($e&&($e.architecture=64,$e.family=$e.family.replace(RegExp(" *"+z),"")),_e&&(/\bWOW64\b/i.test(B)||St&&/\w(?:86|32)$/.test(pe.cpuClass||pe.platform)&&!/\bWin64; x64\b/i.test(B))&&ye.unshift("32-bit")):$e&&/^OS X/.test($e.family)&&_e=="Chrome"&&parseFloat(Ne)>=39&&($e.architecture=64),B||(B=null);var Ct={};return Ct.description=B,Ct.layout=dt&&dt[0],Ct.manufacturer=bt,Ct.name=_e,Ct.prerelease=te,Ct.product=it,Ct.ua=B,Ct.version=_e&&Ne,Ct.os=$e||{architecture:null,family:null,version:null,toString:function(){return"null"}},Ct.parse=Ee,Ct.toString=bn,Ct.version&&ye.unshift(Ne),Ct.name&&ye.unshift(_e),$e&&_e&&!($e==String($e).split(" ")[0]&&($e==_e.split(" ")[0]||it))&&ye.push(it?"("+$e+")":"on "+$e),ye.length&&(Ct.description=ye.join(" ")),Ct}var Ue=Ee();a&&i?U(Ue,function(B,ce){a[ce]=B}):r.platform=Ue}).call(Rr)}(kl,kl.exports);var LS=kl.exports,X4=Pt,Z4=Uo,e6=Jt,t6=cn,r6=Yn,_p=rr,n6=fn,a6=Ka,i6=id,jS=Fo;Z4("match",function(e,n,t){return[function(a){var i=n6(this),s=t6(a)?void 0:a6(a,e);return s?X4(s,a,i):new RegExp(a)[e](_p(i))},function(r){var a=e6(this),i=_p(r),s=t(n,a,i);if(s.done)return s.value;if(!a.global)return jS(a,i);var o=a.unicode;a.lastIndex=0;for(var u=[],l=0,c;(c=jS(a,i))!==null;){var p=_p(c[0]);u[l]=p,p===""&&(a.lastIndex=i6(i,r6(a.lastIndex),o)),l++}return l===0?null:u}]});var s6=Object.is||function(n,t){return n===t?n!==0||1/n===1/t:n!==n&&t!==t},u6=Pt,o6=Uo,l6=Jt,c6=cn,f6=fn,US=s6,FS=rr,d6=Ka,p6=Fo;o6("search",function(e,n,t){return[function(a){var i=f6(this),s=c6(a)?void 0:d6(a,e);return s?u6(s,a,i):new RegExp(a)[e](FS(i))},function(r){var a=l6(this),i=FS(r),s=t(n,a,i);if(s.done)return s.value;var o=a.lastIndex;US(o,0)||(a.lastIndex=0);var u=p6(a,i);return US(a.lastIndex,o)||(a.lastIndex=o),u===null?-1:u.index}]});var v6=Lt,h6=Ps,y6=TypeError,g6=Object.getOwnPropertyDescriptor,m6=v6&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}(),b6=m6?function(e,n){if(h6(e)&&!g6(e,"length").writable)throw new y6("Cannot set read only .length");return e.length=n}:function(e,n){return e.length=n},w6=ft,S6=vr,_6=Ja,k6=On,$6=hr,T6=b6,C6=sm,E6=Lc,I6=Fs,kp=rp,R6=Us,O6=R6("splice"),A6=Math.max,P6=Math.min;w6({target:"Array",proto:!0,forced:!O6},{splice:function(n,t){var r=S6(this),a=$6(r),i=_6(n,a),s=arguments.length,o,u,l,c,p,S;for(s===0?o=u=0:s===1?(o=0,u=a-i):(o=s-2,u=P6(A6(k6(t),0),a-i)),C6(a+o-u),l=E6(r,u),c=0;c<u;c++)p=i+c,p in r&&I6(l,c,r[p]);if(l.length=u,o<u){for(c=i;c<a-u;c++)p=c+u,S=c+o,p in r?r[S]=r[p]:kp(r,S);for(c=a;c>a-u+o;c--)kp(r,c-1)}else if(o>u)for(c=a-u;c>i;c--)p=c+u-1,S=c+o-1,p in r?r[S]=r[p]:kp(r,S);for(c=0;c<o;c++)r[c+i]=arguments[c+2];return T6(r,a-u+o),l}});/*
	@license
	The following license applies to all parts of this software except as
	documented below.

	    Copyright (c) 2016, Twilio, inc.
	    All rights reserved.

	    Redistribution and use in source and binary forms, with or without
	    modification, are permitted provided that the following conditions are
	    met:

	      1. Redistributions of source code must retain the above copyright
	         notice, this list of conditions and the following disclaimer.

	      2. Redistributions in binary form must reproduce the above copyright
	         notice, this list of conditions and the following disclaimer in
	         the documentation and/or other materials provided with the
	         distribution.

	      3. Neither the name of Twilio nor the names of its contributors may
	         be used to endorse or promote products derived from this software
	         without specific prior written permission.

	    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
	    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
	    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
	    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
	    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
	    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
	    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
	    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
	    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
	    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
	    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

	This software includes javascript-state-machine under the following license.

	    Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

	    Permission is hereby granted, free of charge, to any person obtaining a copy
	    of this software and associated documentation files (the "Software"), to deal
	    in the Software without restriction, including without limitation the rights
	    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	    copies of the Software, and to permit persons to whom the Software is
	    furnished to do so, subject to the following conditions:

	    The above copyright notice and this permission notice shall be included in all
	    copies or substantial portions of the Software.

	    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

	This software includes loglevel under the following license.

	    Copyright (c) 2013 Tim Perry

	    Permission is hereby granted, free of charge, to any person
	    obtaining a copy of this software and associated documentation
	    files (the "Software"), to deal in the Software without
	    restriction, including without limitation the rights to use,
	    copy, modify, merge, publish, distribute, sublicense, and/or sell
	    copies of the Software, and to permit persons to whom the
	    Software is furnished to do so, subject to the following
	    conditions:

	    The above copyright notice and this permission notice shall be
	    included in all copies or substantial portions of the Software.

	    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
	    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
	    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
	    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
	    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
	    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
	    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
	    OTHER DEALINGS IN THE SOFTWARE.


	*/(function(e){var n=typeof n<"u"?n:typeof self<"u"?self:typeof window<"u"?window:{};Object.defineProperty(e,"__esModule",{value:!0});var t=Ds,r=_a,a=ei,i=hd,s=Nn,o=xn,u=Jr,l=Ln,c=ti,p=Ys,S=Yr,T=_r,I=Zs,x=iF,U=rl,F=_l,V=ia,Ae=LS;function de(A){return A&&typeof A=="object"&&"default"in A?A:{default:A}}function Ge(A){if(A&&A.__esModule)return A;var N=Object.create(null);return A&&Object.keys(A).forEach(function($){if($!=="default"){var k=Object.getOwnPropertyDescriptor(A,$);Object.defineProperty(N,$,k.get?k:{enumerable:!0,get:function(){return A[$]}})}}),N.default=A,Object.freeze(N)}var Ee=de(t),Ue=de(r),B=de(a),ce=de(i),ke=de(s),pe=de(o),Le=de(u),Z=de(l),Pe=de(c),Fe=de(p),wt=de(S),mt=Ge(I),Ce=Ge(x),se=de(F),ie=Ge(Ae);function O(A,N,$,k){var _=arguments.length,P=_<3?N:k===null?k=Object.getOwnPropertyDescriptor(N,$):k,R;if((typeof Reflect>"u"?"undefined":wt.default(Reflect))==="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(A,N,$,k);else for(var ae=A.length-1;ae>=0;ae--)(R=A[ae])&&(P=(_<3?R(P):_>3?R(N,$,P):R(N,$))||P);return _>3&&P&&Object.defineProperty(N,$,P),P}function Ie(A,N){if((typeof Reflect>"u"?"undefined":wt.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(A,N)}var Je;function Me(){}Me.prototype=Object.create(null);function be(){be.init.call(this)}be.EventEmitter=be,be.usingDomains=!1,be.prototype.domain=void 0,be.prototype._events=void 0,be.prototype._maxListeners=void 0,be.defaultMaxListeners=10,be.init=function(){this.domain=null,be.usingDomains&&Je.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new Me,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},be.prototype.setMaxListeners=function(N){if(typeof N!="number"||N<0||isNaN(N))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=N,this};function z(A){return A._maxListeners===void 0?be.defaultMaxListeners:A._maxListeners}be.prototype.getMaxListeners=function(){return z(this)};function xt(A,N,$){if(N)A.call($);else for(var k=A.length,_=$e(A,k),P=0;P<k;++P)_[P].call($)}function ye(A,N,$,k){if(N)A.call($,k);else for(var _=A.length,P=$e(A,_),R=0;R<_;++R)P[R].call($,k)}function te(A,N,$,k,_){if(N)A.call($,k,_);else for(var P=A.length,R=$e(A,P),ae=0;ae<P;++ae)R[ae].call($,k,_)}function St(A,N,$,k,_,P){if(N)A.call($,k,_,P);else for(var R=A.length,ae=$e(A,R),re=0;re<R;++re)ae[re].call($,k,_,P)}function Ne(A,N,$,k){if(N)A.apply($,k);else for(var _=A.length,P=$e(A,_),R=0;R<_;++R)P[R].apply($,k)}be.prototype.emit=function(N){var $,k,_,P,R,ae,re,Se=N==="error";if(ae=this._events,ae)Se=Se&&ae.error==null;else if(!Se)return!1;if(re=this.domain,Se){if($=arguments[1],re)$||($=new Error('Uncaught, unspecified "error" event')),$.domainEmitter=this,$.domain=re,$.domainThrown=!1,re.emit("error",$);else{if($ instanceof Error)throw $;var Oe=new Error('Uncaught, unspecified "error" event. ('+$+")");throw Oe.context=$,Oe}return!1}if(k=ae[N],!k)return!1;var Xe=typeof k=="function";switch(_=arguments.length,_){case 1:xt(k,Xe,this);break;case 2:ye(k,Xe,this,arguments[1]);break;case 3:te(k,Xe,this,arguments[1],arguments[2]);break;case 4:St(k,Xe,this,arguments[1],arguments[2],arguments[3]);break;default:for(P=new Array(_-1),R=1;R<_;R++)P[R-1]=arguments[R];Ne(k,Xe,this,P)}return!0};function zt(A,N,$,k){var _,P,R;if(typeof $!="function")throw new TypeError('"listener" argument must be a function');if(P=A._events,P?(P.newListener&&(A.emit("newListener",N,$.listener?$.listener:$),P=A._events),R=P[N]):(P=A._events=new Me,A._eventsCount=0),!R)R=P[N]=$,++A._eventsCount;else if(typeof R=="function"?R=P[N]=k?[$,R]:[R,$]:k?R.unshift($):R.push($),!R.warned&&(_=z(A),_&&_>0&&R.length>_)){R.warned=!0;var ae=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+N+" listeners added. Use emitter.setMaxListeners() to increase limit");ae.name="MaxListenersExceededWarning",ae.emitter=A,ae.type=N,ae.count=R.length,dt(ae)}return A}function dt(A){typeof console.warn=="function"?console.warn(A):console.log(A)}be.prototype.addListener=function(N,$){return zt(this,N,$,!1)},be.prototype.on=be.prototype.addListener,be.prototype.prependListener=function(N,$){return zt(this,N,$,!0)};function _e(A,N,$){var k=!1;function _(){A.removeListener(N,_),k||(k=!0,$.apply(A,arguments))}return _.listener=$,_}be.prototype.once=function(N,$){if(typeof $!="function")throw new TypeError('"listener" argument must be a function');return this.on(N,_e(this,N,$)),this},be.prototype.prependOnceListener=function(N,$){if(typeof $!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(N,_e(this,N,$)),this},be.prototype.removeListener=function(N,$){var k,_,P,R,ae;if(typeof $!="function")throw new TypeError('"listener" argument must be a function');if(_=this._events,!_)return this;if(k=_[N],!k)return this;if(k===$||k.listener&&k.listener===$)--this._eventsCount===0?this._events=new Me:(delete _[N],_.removeListener&&this.emit("removeListener",N,k.listener||$));else if(typeof k!="function"){for(P=-1,R=k.length;R-- >0;)if(k[R]===$||k[R].listener&&k[R].listener===$){ae=k[R].listener,P=R;break}if(P<0)return this;if(k.length===1){if(k[0]=void 0,--this._eventsCount===0)return this._events=new Me,this;delete _[N]}else bt(k,P);_.removeListener&&this.emit("removeListener",N,ae||$)}return this},be.prototype.off=function(A,N){return this.removeListener(A,N)},be.prototype.removeAllListeners=function(N){var $,k;if(k=this._events,!k)return this;if(!k.removeListener)return arguments.length===0?(this._events=new Me,this._eventsCount=0):k[N]&&(--this._eventsCount===0?this._events=new Me:delete k[N]),this;if(arguments.length===0){for(var _=Object.keys(k),P=0,R;P<_.length;++P)R=_[P],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=new Me,this._eventsCount=0,this}if($=k[N],typeof $=="function")this.removeListener(N,$);else if($)do this.removeListener(N,$[$.length-1]);while($[0]);return this},be.prototype.listeners=function(N){var $,k,_=this._events;return _?($=_[N],$?typeof $=="function"?k=[$.listener||$]:k=Kt($):k=[]):k=[],k},be.listenerCount=function(A,N){return typeof A.listenerCount=="function"?A.listenerCount(N):it.call(A,N)},be.prototype.listenerCount=it;function it(A){var N=this._events;if(N){var $=N[A];if(typeof $=="function")return 1;if($)return $.length}return 0}be.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function bt(A,N){for(var $=N,k=$+1,_=A.length;k<_;$+=1,k+=1)A[$]=A[k];A.pop()}function $e(A,N){for(var $=new Array(N);N--;)$[N]=A[N];return $}function Kt(A){for(var N=new Array(A.length),$=0;$<N.length;++$)N[$]=A[$].listener||A[$];return N}var pt=mt.getLogger("twilsock");function Wt(A,N){return["".concat(new Date().toISOString()," Twilsock ").concat(A,":")].concat(Array.from(N))}var er=function(){function A(N){Z.default(this,A),Pe.default(this,"prefix",""),this.prefix=N!=null&&N.length>0?" "+N+":":""}return Ue.default(A,[{key:"setLevel",value:function($){pt.setLevel($)}},{key:"trace",value:function(){for(var $=arguments.length,k=new Array($),_=0;_<$;_++)k[_]=arguments[_];pt.trace.apply(null,Wt("T",k))}},{key:"debug",value:function(){for(var $=arguments.length,k=new Array($),_=0;_<$;_++)k[_]=arguments[_];pt.debug.apply(null,Wt("D",k))}},{key:"info",value:function(){for(var $=arguments.length,k=new Array($),_=0;_<$;_++)k[_]=arguments[_];pt.info.apply(null,Wt("I",k))}},{key:"warn",value:function(){for(var $=arguments.length,k=new Array($),_=0;_<$;_++)k[_]=arguments[_];pt.warn.apply(null,Wt("W",k))}},{key:"error",value:function(){for(var $=arguments.length,k=new Array($),_=0;_<$;_++)k[_]=arguments[_];pt.error.apply(null,Wt("E",k))}}],[{key:"setLevel",value:function($){pt.setLevel($)}},{key:"trace",value:function(){for(var $=arguments.length,k=new Array($),_=0;_<$;_++)k[_]=arguments[_];pt.trace.apply(null,Wt("T",k))}},{key:"debug",value:function(){for(var $=arguments.length,k=new Array($),_=0;_<$;_++)k[_]=arguments[_];pt.debug.apply(null,Wt("D",k))}},{key:"info",value:function(){for(var $=arguments.length,k=new Array($),_=0;_<$;_++)k[_]=arguments[_];pt.info.apply(null,Wt("I",k))}},{key:"warn",value:function(){for(var $=arguments.length,k=new Array($),_=0;_<$;_++)k[_]=arguments[_];pt.warn.apply(null,Wt("W",k))}},{key:"error",value:function(){for(var $=arguments.length,k=new Array($),_=0;_<$;_++)k[_]=arguments[_];pt.error.apply(null,Wt("E",k))}}]),A}(),xe=new er(""),zr="0.12.2",bn=function(){function A(N,$,k){Z.default(this,A),Pe.default(this,"confirmedCapabilities",new Set),this.activeGrant=$,this._token=N;var _=k.region||"us1",P="wss://tsock.".concat(_,".twilio.com/v3/wsconnect"),R=k.twilsock||k.Twilsock||{};this.url=R.uri||P,this._continuationToken=k.continuationToken?k.continuationToken:null,this.logLevel=k.logLevel?k.logLevel:"error",this.retryPolicy=k.retryPolicy?k.retryPolicy:{min:1*1e3,max:2*60*1e3,randomness:.2},this.clientMetadata=k.clientMetadata?k.clientMetadata:{},this.clientMetadata.ver=zr,this.initRegistrations=k.initRegistrations?k.initRegistrations:null,this.tweaks=k.tweaks?k.tweaks:null}return Ue.default(A,[{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}},{key:"updateToken",value:function($){this._token=$}},{key:"updateContinuationToken",value:function($){this._continuationToken=$}}]),A}(),Ct=function A(N){Z.default(this,A),this.id=N||"TM".concat(U.v4())};function Dt(A){var N=gt();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function gt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var tt=function(A){ke.default($,A);var N=Dt($);function $(k,_,P,R,ae){var re;return Z.default(this,$),re=N.call(this),Pe.default(B.default(re),"method","init"),re.token=k,re.continuation_token=_,re.metadata=P,re.registrations=R,re.tweaks=ae,re.capabilities=["client_update","offline_storage","telemetry.v1"],re}return $}(Ct);function Ft(A){var N=At();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function At(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ar=function(A){ke.default($,A);var N=Ft($);function $(k,_,P,R,ae,re,Se){var Oe;return Z.default(this,$),Oe=N.call(this,k),Oe.continuationToken=_,Oe.continuationTokenStatus=R,Oe.offlineStorage=ae,Oe.initRegistrations=re,Oe.debugInfo=Se,Oe.confirmedCapabilities=P,Oe}return $}(Ct);function Gr(A){var N=wn();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function wn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var qn=function(A){ke.default($,A);var N=Gr($);function $(k){var _;return Z.default(this,$),_=N.call(this),Pe.default(B.default(_),"method","update"),_.token=k,_}return $}(Ct);function xr(A){var N=or();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function or(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ue=function(A){ke.default($,A);var N=xr($);function $(k,_,P){var R;return Z.default(this,$),R=N.call(this),Pe.default(B.default(R),"method","message"),R.active_grant=k,R.payload_type=_,R.http_request=P,R}return $}(Ct);function fe(A){var N=J();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function J(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ne=function(A){ke.default($,A);var N=fe($);function $(k){var _;return Z.default(this,$),_=N.call(this,k),Pe.default(B.default(_),"method","reply"),Pe.default(B.default(_),"payload_type","application/json"),Pe.default(B.default(_),"status",{code:200,status:"OK"}),_}return $}(Ct);function X(A){var N=le();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function le(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ge=function(A){ke.default($,A);var N=X($);function $(){var k;return Z.default(this,$),k=N.call(this),Pe.default(B.default(k),"method","close"),k}return $}(Ct);function H(A){var N=ee();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function ee(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var D=function A(N,$,k,_,P,R){Z.default(this,A),this.start=N,this.end=$,this.title=k,this.details=_,this.id=P,this.type=R},Y=function(A){ke.default($,A);var N=H($);function $(k){var _;return Z.default(this,$),_=N.call(this),Pe.default(B.default(_),"method","telemetry.v1"),_.events=k,_}return $}(Ct);function q(A){var N=encodeURIComponent(A),$=N.replace(/%([0-9A-F]{2})/g,function(k,_){return String.fromCharCode(+("0x"+_))});return $.length}function Re(A){var N=encodeURIComponent(A),$=N.replace(/%([0-9A-F]{2})/g,function(_,P){return String.fromCharCode(+("0x"+P))}),k=new Uint8Array($.length);return Array.prototype.forEach.call($,function(_,P){k[P]=_.charCodeAt(0)}),k}function me(A){var N=Array.prototype.map.call(A,function(k){return String.fromCharCode(k)}).join(""),$=N.replace(/(.)/g,function(k,_){var P=_.charCodeAt(0).toString(16).toUpperCase();return P.length<2&&(P="0"+P),"%"+P});return decodeURIComponent($)}function De(A){return JSON.parse(me(A))}function je(A){for(var N="",$=0;$<A.length;++$){var k=String.fromCharCode(A[$]);if(N+=k,k==="\r"){$+=2;break}}var _=N.split(" ");return{size:$,protocol:_[0],version:_[1],headerSize:Number(_[2])}}var Be=function(){function A(){Z.default(this,A)}return Ue.default(A,null,[{key:"parse",value:function($){var k=2,_=new Uint8Array($),P=je(_);if(P.protocol!=="TWILSOCK"||P.version!=="V3.0")return xe.error("unsupported protocol: ".concat(P.protocol," ver ").concat(P.version)),null;var R;try{R=De(_.subarray(P.size,P.size+P.headerSize))}catch(Oe){return xe.error("failed to parse message header",Oe,$),null}xe.debug("message received: ",R.method),xe.trace("message received: ",R);var ae;if(R.payload_size>0){var re=k+P.size+P.headerSize,Se=R.payload_size;if(!R.hasOwnProperty("payload_type")||R.payload_type.indexOf("application/json")===0)try{ae=De(_.subarray(re,re+Se))}catch(Oe){return xe.error("failed to parse message body",Oe,$),null}else R.payload_type.indexOf("text/plain")===0&&(ae=me(_.subarray(re,re+Se)))}return{method:R.method,header:R,payload:ae}}},{key:"createPacket",value:function($){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";$.payload_size=q(k);var _=JSON.stringify($),P="TWILSOCK V3.0 "+q(_);xe.debug("send request:",P+_+k);var R=Re(P+`\r
`+_+`\r
`+k);return R.buffer}}]),A}();function Ve(A){var N=Ke();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function Ke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ze=function(A){ke.default($,A);var N=Ve($);function $(k){return Z.default(this,$),N.call(this,k)}return $}(se.default(Error));function He(A){var N=Qe();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function Qe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rt=function(A){ke.default($,A);var N=He($);function $(k,_){var P;return Z.default(this,$),P=N.call(this,k),P.reply=_,P}return $}(ze);function fr(A,N){var $=Object.keys(A);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(A);N&&(k=k.filter(function(_){return Object.getOwnPropertyDescriptor(A,_).enumerable})),$.push.apply($,k)}return $}function Lr(A){for(var N=1;N<arguments.length;N++){var $=arguments[N]!=null?arguments[N]:{};N%2?fr(Object($),!0).forEach(function(k){Pe.default(A,k,$[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors($)):fr(Object($)).forEach(function(k){Object.defineProperty(A,k,Object.getOwnPropertyDescriptor($,k))})}return A}function nt(A){var N=an();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function an(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var qa=function(A){ke.default($,A);var N=nt($);function $(k){var _;return Z.default(this,$),_=N.call(this),Pe.default(B.default(_),"newBackoff",null),Pe.default(B.default(_),"usedBackoff",null),Pe.default(B.default(_),"retrier",null),_.options=k?Lr({},k):{},_}return Ue.default($,[{key:"inProgress",get:function(){return!!this.retrier}},{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(_){this.newBackoff=_}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");if(this.newBackoff){var _=!this.usedBackoff||this.usedBackoff<this.newBackoff;if(_)this.createRetrier();else{var P;(P=this.retrier)===null||P===void 0||P.failed(new Error)}}else{var R;(R=this.retrier)===null||R===void 0||R.failed(new Error)}}},{key:"cancel",value:function(){var _;(_=this.retrier)===null||_===void 0||_.cancel()}},{key:"cleanRetrier",value:function(){var _,P;(_=this.retrier)===null||_===void 0||_.removeAllListeners(),(P=this.retrier)===null||P===void 0||P.cancel(),this.retrier=null}},{key:"getRetryPolicy",value:function(){var _=Lr({},this.options);return this.newBackoff&&(_.min=this.newBackoff,_.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),_.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,_}},{key:"createRetrier",value:function(){var _=this;this.cleanRetrier();var P=this.getRetryPolicy();this.retrier=new V.Retrier(P),this.retrier.once("attempt",function(){var R,ae;(R=_.retrier)===null||R===void 0||R.on("attempt",function(){return _.emit("attempt")}),(ae=_.retrier)===null||ae===void 0||ae.failed(new Error("Skipping first attempt"))}),this.retrier.on("failed",function(R){return _.emit("failed",R)}),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start()}}]),$}(be);function mi(A){var N=Sn();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function Sn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Wa=3e3;function _n(A){setTimeout(A,0)}var Wn=function(A){ke.default($,A);var N=mi($);function $(k,_,P){var R;Z.default(this,$),R=N.call(this),Pe.default(B.default(R),"disconnectingTimer",null),Pe.default(B.default(R),"disconnectedPromiseResolve",null),Pe.default(B.default(R),"terminalStates",["disconnected","rejected"]),Pe.default(B.default(R),"tokenExpiredSasCode",20104),Pe.default(B.default(R),"terminationReason","Connection is not initialized"),R.websocket=k,R.websocket.on("connected",function(){return R.fsm.socketConnected()}),R.websocket.on("disconnected",function(){return R.fsm.socketClosed()}),R.websocket.on("message",function(re){return R.onIncomingMessage(re)}),R.websocket.on("socketError",function(re){return R.emit("connectionError",{terminal:!1,message:"Socket error: ".concat(re.message),httpStatusCode:null,errorCode:null})}),R.transport=_,R.config=P,R.retrier=new qa(P.retryPolicy),R.retrier.on("attempt",function(){return R.retry()}),R.retrier.on("failed",function(re){xe.warn("Retrying failed: ".concat(re.message)),R.disconnect()}),typeof window<"u"&&typeof window.addEventListener<"u"&&(window.addEventListener("online",function(){xe.debug("Browser reported connectivity state: online"),R.resetBackoff(),R.fsm.systemOnline()}),window.addEventListener("offline",function(){xe.debug("Browser reported connectivity state: offline"),R.websocket.close(),R.fsm.socketClosed()}));var ae=Ce.factory({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){R.setupSocket(),R.emit("connecting")},onEnterInitialising:function(){R.sendInit()},onLeaveInitialising:function(){R.cancelInit()},onEnterUpdating:function(){R.sendUpdate()},onLeaveUpdating:function(){R.cancelUpdate()},onEnterRetrying:function(){R.initRetry(),R.emit("connecting")},onEnterConnected:function(){R.resetBackoff(),R.onConnected()},onUserUpdateToken:function(){R.resetBackoff()},onTokenRejected:function(){R.resetBackoff(),R.closeSocket(!0),R.finalizeSocket()},onUserDisconnect:function(){R.closeSocket(!0)},onEnterDisconnecting:function(){R.startDisconnectTimer()},onLeaveDisconnecting:function(){R.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){R.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){R.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){R.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){R.cancelDisconnectTimer()},onDisconnected:function(){R.resetBackoff(),R.finalizeSocket()},onReceiveClose:function(){R.onCloseReceived()},onReceiveOffload:function(Se,Oe){xe.debug("onreceiveoffload: ",Oe),R.modifyBackoff(Oe.body),R.onCloseReceived()},onUnsupported:function(){R.closeSocket(!0),R.finalizeSocket()},onError:function(Se,Oe){R.closeSocket(Oe),R.finalizeSocket()},onEnterState:function(Se){Se.from!=="none"&&R.changeState(Se)},onInvalidTransition:function(Se,Oe,Xe){xe.warn("FSM: unexpected transition",Oe,Xe)}}});return R.fsm=new ae,R}return Ue.default($,[{key:"changeState",value:function(_){xe.debug("FSM: ".concat(_.transition,": ").concat(_.from," --> ").concat(_.to)),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){xe.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(_){xe.trace("modifyBackoff",_);var P=_?_.backoff_policy:null;P&&typeof P.reconnect_min_ms=="number"&&this.retrier.modifyBackoff(P.reconnect_min_ms)}},{key:"startDisconnectTimer",value:function(){var _=this;xe.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout(function(){xe.debug("disconnecting is timed out"),_.closeSocket(!0)},Wa)}},{key:"cancelDisconnectTimer",value:function(){xe.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"isConnected",get:function(){return this.state==="connected"&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"denied";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}},{key:"initRetry",value:function(){xe.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}},{key:"retry",value:function(){this.fsm.state!="connecting"?(xe.trace("retry"),this.websocket.close(),this.fsm.userRetry()):xe.trace("can	 retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){xe.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){xe.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}},{key:"onIncomingMessage",value:function(_){var P=Be.parse(_);if(P){var R=P.method,ae=P.header,re=P.payload;if(R!=="reply"&&this.confirmReceiving(ae),R==="notification")this.emit("message",ae.message_type,re);else if(ae.method==="reply")this.transport.processReply({id:ae.id,status:ae.status,header:ae,body:re});else if(ae.method==="client_update")ae.client_update_type==="token_about_to_expire"&&this.emit("tokenAboutToExpire");else if(ae.method==="close")if(ae.status.code===308)xe.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:ae.status.status,body:re});else if(ae.status.code===406){var Se="Server closed connection because can't parse protocol: ".concat(JSON.stringify(ae.status));this.emitReplyConnectionError(Se,ae,!0),xe.error(Se),this.fsm.receiveFatalClose()}else ae.status.code===417?(xe.error("Server closed connection because can't parse client reply: ".concat(JSON.stringify(ae.status))),this.fsm.receiveFatalClose(ae.status.status)):ae.status.code===410?(xe.warn("Server closed connection: ".concat(JSON.stringify(ae.status))),this.fsm.receiveClose(ae.status.status),this.emit("tokenExpired")):ae.status.code===401?(xe.error("Server closed connection: ".concat(JSON.stringify(ae.status))),this.fsm.receiveClose(ae.status.status)):(xe.warn("unexpected message: ",ae.status),this.fsm.receiveOffload({status:ae.status.status,body:null}))}}},{key:"sendInit",value:function(){var k=Ee.default(Fe.default.mark(function P(){var R,ae;return Fe.default.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return xe.trace("sendInit"),Se.prev=1,this.emit("beforeSendInit"),Se.next=5,this.transport.sendInit();case 5:R=Se.sent,this.config.updateContinuationToken(R.continuationToken),this.config.confirmedCapabilities=R.confirmedCapabilities,this.fsm.initSuccess(R),this.emit("initialized",R),this.emit("tokenUpdated"),Se.next=17;break;case 13:Se.prev=13,Se.t0=Se.catch(1),Se.t0 instanceof rt?(ae=!1,xe.warn("Init rejected by server: ".concat(JSON.stringify(Se.t0.reply.status))),this.emit("sendInitFailed"),Se.t0.reply.status.code===401||Se.t0.reply.status.code===403?(ae=!0,this.fsm.tokenRejected(Se.t0.reply.status),Se.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):Se.t0.reply.status.code===429?(this.modifyBackoff(Se.t0.reply.body),this.fsm.initError(!0)):Se.t0.reply.status.code===500?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(Se.t0.message,Se.t0.reply,ae)):(this.terminationReason=Se.t0.message,this.emit("connectionError",{terminal:!0,message:"Unknown error during connection initialisation: ".concat(Se.t0.message,`
`).concat(JSON.stringify(Se.t0,null,2)),httpStatusCode:null,errorCode:null}),this.fsm.initError(!0)),this.emit("tokenUpdated",Se.t0);case 17:case"end":return Se.stop()}},P,this,[[1,13]])}));function _(){return k.apply(this,arguments)}return _}()},{key:"sendUpdate",value:function(){var k=Ee.default(Fe.default.mark(function P(){var R,ae,re;return Fe.default.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return xe.trace("sendUpdate"),R=new qn(this.config.token),Oe.prev=2,Oe.next=5,this.transport.sendWithReply(R);case 5:ae=Oe.sent,this.fsm.updateSuccess(ae.body),this.emit("tokenUpdated"),Oe.next=14;break;case 10:Oe.prev=10,Oe.t0=Oe.catch(2),Oe.t0 instanceof rt?(re=!1,xe.warn("Token update rejected by server: ".concat(JSON.stringify(Oe.t0.reply.status))),Oe.t0.reply.status.code===401||Oe.t0.reply.status.code===403?(re=!0,this.fsm.tokenRejected(Oe.t0.reply.status),Oe.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):Oe.t0.reply.status.code===429?(this.modifyBackoff(Oe.t0.reply.body),this.fsm.updateError(Oe.t0.reply.status)):this.fsm.updateError(Oe.t0.reply.status),this.emitReplyConnectionError(Oe.t0.message,Oe.t0.reply,re)):(this.emit("error",!1,Oe.t0.message,null,null),this.fsm.updateError(Oe.t0)),this.emit("tokenUpdated",Oe.t0);case 14:case"end":return Oe.stop()}},P,this,[[2,10]])}));function _(){return k.apply(this,arguments)}return _}()},{key:"emitReplyConnectionError",value:function(_,P,R){var ae=P.status&&P.status.description?P.status.description:_,re=P.status.code,Se=P.status&&P.status.errorCode?P.status.errorCode:null;R&&(this.terminationReason=ae),this.emit("connectionError",{terminal:R,message:"Connection error: ".concat(ae),httpStatusCode:re,errorCode:Se})}},{key:"cancelInit",value:function(){xe.trace("cancelInit")}},{key:"cancelUpdate",value:function(){xe.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(_){xe.trace("confirmReceiving");try{this.transport.send(new ne(_.id))}catch(P){xe.debug("failed to confirm packet receiving",P)}}},{key:"closeSocket",value:function(_){var P=this;xe.trace("closeSocket (graceful: ".concat(_,")")),_&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),_n(function(){return P.fsm.socketClosed()})}},{key:"connect",value:function(){xe.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var _=this;return xe.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise(function(P){_.disconnectedPromiseResolve=P,_.fsm.userDisconnect()})}},{key:"updateToken",value:function(_){var P=this;return xe.trace("updateToken:",_),new Promise(function(R,ae){P.once("tokenUpdated",function(re){re?ae(re):R()}),P.fsm.userUpdateToken()})}},{key:"isTerminalState",get:function(){return this.terminalStates.indexOf(this.fsm.state)!==-1}},{key:"getTerminationReason",get:function(){return this.terminationReason}},{key:"onCloseReceived",value:function(){this.websocket.close()}}]),$}(be),bi=function(){function A(){Z.default(this,A)}return Ue.default(A,null,[{key:"getMetadata",value:function($){var k,_,P,R,ae,re,Se,Oe,Xe=$&&$.clientMetadata?$.clientMetadata:{},pr=["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"],Cn={env:(k=ie.name)!==null&&k!==void 0?k:"unknown",envv:(_=ie.version)!==null&&_!==void 0?_:"unknown",os:(P=(R=ie.os)===null||R===void 0?void 0:R.family)!==null&&P!==void 0?P:"unknown",osv:(ae=(re=ie.os)===null||re===void 0?void 0:re.version)!==null&&ae!==void 0?ae:"unknown",osa:(Se=(Oe=ie.os)===null||Oe===void 0?void 0:Oe.architecture)!==null&&Se!==void 0?Se:"unknown",sdk:"js-default"},tr={};return pr.filter(function(En){return En in Xe||En in Cn}).forEach(function(En){return tr[En]=En in Xe?Xe[En]:Cn[En]}),tr}}]),A}(),yr=3e4;function va(A){return A>=200&&A<300}function ds(A){switch(wt.default(A)){case"undefined":return"";case"object":return JSON.stringify(A);default:return A}}var ha=function(){function A(N,$){var k=this;Z.default(this,A),this.config=$,this.activeRequests=new Map,this.channel=N,this.channel.on("reply",function(_){return k.processReply(_)}),this.channel.on("disconnected",function(){k.activeRequests.forEach(function(_){clearTimeout(_.timeout),_.reject(new ze("disconnected"))}),k.activeRequests.clear()})}return Ue.default(A,[{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"processReply",value:function($){var k=this.activeRequests.get($.id);k&&(clearTimeout(k.timeout),this.activeRequests.delete($.id),va($.status.code)?k.resolve($):(k.reject(new rt("Transport failure: "+$.status.status,$)),xe.trace("message rejected")))}},{key:"storeRequest",value:function($,k,_){var P={resolve:k,reject:_,timeout:setTimeout(function(){xe.trace("request",$,"is timed out"),_(new ze("Twilsock: request timeout: "+$))},yr)};this.activeRequests.set($,P)}},{key:"shutdown",value:function(){this.activeRequests.forEach(function($){clearTimeout($.timeout),$.reject(new ze("Twilsock: request cancelled by user"))}),this.activeRequests.clear()}},{key:"sendInit",value:function(){var N=Ee.default(Fe.default.mark(function k(){var _,P,R;return Fe.default.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return xe.trace("sendInit"),_=bi.getMetadata(this.config),P=new tt(this.config.token,this.config.continuationToken,_,this.config.initRegistrations,this.config.tweaks),re.next=5,this.sendWithReply(P);case 5:return R=re.sent,re.abrupt("return",new ar(R.id,R.header.continuation_token,new Set(R.header.capabilities),R.header.continuation_token_status,R.header.offline_storage,R.header.init_registrations,R.header.debug_info));case 7:case"end":return re.stop()}},k,this)}));function $(){return N.apply(this,arguments)}return $}()},{key:"sendClose",value:function(){var $=new ge;this.send($)}},{key:"sendWithReply",value:function($,k){var _=this;return new Promise(function(P,R){var ae=_.send($,k);_.storeRequest(ae,P,R)})}},{key:"send",value:function($,k){$.id=$.id||"TM".concat(U.v4());var _=Be.createPacket($,ds(k));try{return this.channel.send(_),$.id}catch(P){throw xe.debug("failed to send ",$,P),xe.trace(P.stack),P}}}]),A}();function ps(A){var N=Au();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function Au(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sn=function(A){ke.default($,A);var N=ps($);function $(k){var _;return Z.default(this,$),_=N.call(this),Pe.default(B.default(_),"socket",null),_.url=k,_.url=k,_.WebSocket=n.WebSocket||n.MozWebSocket||{},_}return Ue.default($,[{key:"isConnected",get:function(){return!!this.socket&&this.socket.readyState===1}},{key:"connect",value:function(){var _=this;xe.trace("connecting to socket");var P;try{P=new this.WebSocket(this.url)}catch(R){xe.debug("Socket error: ".concat(this.url)),this.emit("socketError",R);return}P.binaryType="arraybuffer",P.onopen=function(){xe.debug("socket opened ".concat(_.url)),_.emit("connected")},P.onclose=function(R){xe.debug("socket closed",R),_.emit("disconnected",R)},P.onerror=function(R){xe.debug("Socket error:",R),_.emit("socketError",R)},P.onmessage=function(R){_.emit("message",R.data)},this.socket=P}},{key:"send",value:function(_){return this.socket&&this.socket.send(_)}},{key:"close",value:function(){if(xe.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}]),$}(be);function vs(A){var N=Pu();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function Pu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Mu=function(A){ke.default($,A);var N=vs($);function $(k){var _;return Z.default(this,$),_=N.call(this),_.transport=k,_.registrations=new Map,_.registrationsInProgress=new Map,_}return Ue.default($,[{key:"putNotificationContext",value:function(){var k=Ee.default(Fe.default.mark(function P(R,ae){var re;return Fe.default.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return re={method:"put_notification_ctx",notification_ctx_id:R},Oe.next=3,this.transport.sendWithReply(re,ae);case 3:case"end":return Oe.stop()}},P,this)}));function _(P,R){return k.apply(this,arguments)}return _}()},{key:"deleteNotificationContext",value:function(){var k=Ee.default(Fe.default.mark(function P(R){var ae;return Fe.default.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return ae={method:"delete_notification_ctx",notification_ctx_id:R},Se.next=3,this.transport.sendWithReply(ae);case 3:case"end":return Se.stop()}},P,this)}));function _(P){return k.apply(this,arguments)}return _}()},{key:"updateRegistration",value:function(){var k=Ee.default(Fe.default.mark(function P(R,ae){var re,Se;return Fe.default.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return xe.debug("update registration for context",R),re=this.registrationsInProgress.get(R),re||(re=new Set,this.registrationsInProgress.set(R,re)),Se=U.v4(),re.add(Se),Xe.prev=5,Xe.next=8,this.putNotificationContext(R,ae);case 8:xe.debug("registration attempt succeeded for context",ae),re.delete(Se),re.size===0&&(this.registrationsInProgress.delete(R),this.emit("registered",R)),Xe.next=19;break;case 13:Xe.prev=13,Xe.t0=Xe.catch(5),xe.warn("registration attempt failed for context",ae),xe.debug(Xe.t0),re.delete(Se),re.size===0&&(this.registrationsInProgress.delete(R),this.emit("registrationFailed",R,Xe.t0));case 19:case"end":return Xe.stop()}},P,this,[[5,13]])}));function _(P,R){return k.apply(this,arguments)}return _}()},{key:"updateRegistrations",value:function(){var k=Ee.default(Fe.default.mark(function P(){var R=this,ae;return Fe.default.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return xe.trace("refreshing ".concat(this.registrations.size," registrations")),ae=[],this.registrations.forEach(function(Oe,Xe){ae.push(R.updateRegistration(Xe,Oe))}),Se.next=5,Promise.all(ae);case 5:case"end":return Se.stop()}},P,this)}));function _(){return k.apply(this,arguments)}return _}()},{key:"setNotificationsContext",value:function(){var k=Ee.default(Fe.default.mark(function P(R,ae){return Fe.default.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(!(!R||!ae)){Se.next=2;break}throw new ze("Invalid arguments provided");case 2:return this.registrations.set(R,ae),Se.next=5,this.updateRegistration(R,ae);case 5:return Se.abrupt("return",Se.sent);case 6:case"end":return Se.stop()}},P,this)}));function _(P,R){return k.apply(this,arguments)}return _}()},{key:"removeNotificationsContext",value:function(){var k=Ee.default(Fe.default.mark(function P(R){return Fe.default.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(this.registrations.has(R)){re.next=2;break}return re.abrupt("return");case 2:return re.next=4,this.deleteNotificationContext(R);case 4:this.transport.isConnected&&this.registrations.delete(R);case 5:case"end":return re.stop()}},P,this)}));function _(P){return k.apply(this,arguments)}return _}()}]),$}(be);function Ir(A){var N=Nu();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function Nu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hs=function(A){ke.default($,A);var N=Ir($);function $(k,_,P){var R;return Z.default(this,$),R=N.call(this,_),R.status=k,R.description=_,R.body=P,R}return $}(ze);function Yt(A){var N=xu();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function xu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kn=function(A){ke.default($,A);var N=Yt($);function $(k){return Z.default(this,$),N.call(this,k)}return $}(ze),wi=2e4;function ys(A){return A>=200&&A<300}function Lu(A){return A&&A.header&&A.header.http_status}function $n(A){var N=A.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(N){var $={protocol:N[1],host:N[2],hostname:N[3],port:N[4],pathname:N[5],search:N[6],hash:N[7],params:{}};if($.search.length>0){var k=$.search.substring(1);$.params=k.split("&").map(function(_){return _.split("=")}).reduce(function(_,P){return _.hasOwnProperty(P[0])?Array.isArray(_[P[0]])?_[P[0]].push(P[1]):_[P[0]]=[_[P[0]],P[1]]:_[P[0]]=P[1],_},{})}return $}throw new ze("Incorrect URI: "+A)}function _t(A,N){var $=$n(N),k={method:A,host:$.host,path:$.pathname};return $.params&&(k.params=$.params),k}function ju(A,N,$,k,_){return{to:_t(A,N),headers:$,body:k,grant:_}}var gs=function(){function A(N,$,k){Z.default(this,A),this.config=k,this.transport=N,this.pendingMessages=[],this.twilsock=$}return Ue.default(A,[{key:"saveMessage",value:function($){var k=this;return new Promise(function(_,P){var R={message:$,resolve:_,reject:P,alreadyRejected:!1,timeout:setTimeout(function(){xe.debug("request is timed out"),P(new ze("request '".concat($.to.method,"' to '").concat($.to.host,"' timed out"))),R.alreadyRejected=!0},wi)};k.pendingMessages.push(R)})}},{key:"sendPendingMessages",value:function(){for(var $=this,k=function(){var R=$.pendingMessages[0];if(!R.alreadyRejected)try{var ae=R.message;$.actualSend(ae).then(function(re){return R.resolve(re)}).catch(function(re){return R.reject(re)}),clearTimeout(R.timeout)}catch(re){return xe.debug("Failed to send pending message",re),"break"}$.pendingMessages.splice(0,1)};this.pendingMessages.length>0;){var _=k();if(_==="break")break}}},{key:"rejectPendingMessages",value:function(){var $=this;this.pendingMessages.forEach(function(k){k.reject(new kn("Unable to connect: "+$.twilsock.getTerminationReason)),k.alreadyRejected=!0,clearTimeout(k.timeout)}),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:function(){var N=Ee.default(Fe.default.mark(function k(_){var P,R,ae,re,Se,Oe,Xe,pr;return Fe.default.wrap(function(tr){for(;;)switch(tr.prev=tr.next){case 0:return R=_.to,ae=_.headers,re=_.body,Se=(P=_.grant)!==null&&P!==void 0?P:this.config.activeGrant,Oe={host:R.host,path:R.path,method:R.method,params:R.params,headers:ae},Xe=new ue(Se,ae["Content-Type"]||"application/json",Oe),xe.trace("Sending upstream message",Xe),tr.next=9,this.transport.sendWithReply(Xe,re);case 9:if(pr=tr.sent,xe.trace("Received upstream message response",pr),!(Lu(pr)&&!ys(pr.header.http_status.code))){tr.next=13;break}throw new hs(pr.header.http_status.code,pr.header.http_status.status,pr.body);case 13:return tr.abrupt("return",{status:pr.header.http_status,headers:pr.header.http_headers,body:pr.body});case 14:case"end":return tr.stop()}},k,this)}));function $(k){return N.apply(this,arguments)}return $}()},{key:"send",value:function($,k){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},P=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0;if(this.twilsock.isTerminalState)return Promise.reject(new kn("Unable to connect: "+this.twilsock.getTerminationReason));var ae=ju($,k,_,P,R);return this.twilsock.isConnected?this.actualSend(ae):this.saveMessage(ae)}}]),A}(),Uu=function(){function A(){var N=this;Z.default(this,A),this._promise=new Promise(function($,k){N._resolve=$,N._reject=k})}return Ue.default(A,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function($){this._resolve($)}},{key:"set",value:function($){this._resolve($)}},{key:"fail",value:function($){this._reject($)}}]),A}(),ms=function(){function A(N){Z.default(this,A),this.id=N}return Ue.default(A,null,[{key:"create",value:function($){if($ instanceof Object&&"storage_id"in $)return new A($.storage_id);throw new ze('Field "storage_id" is missing')}}]),A}(),za=function(){function A(){return Z.default(this,A),Pe.default(this,"initializedFlag","twilio_twilsock_token_storage"),Pe.default(this,"tokenStoragePrefix","twilio_continuation_token_"),A._instance||(this.initialize(),A._instance=this),A._instance}return Ue.default(A,[{key:"sessionStorage",value:function(){try{return n.sessionStorage}catch{return null}}},{key:"window",value:function(){try{return n.window}catch{return null}}},{key:"storeToken",value:function($,k){this.canStore()&&this.sessionStorage.setItem(this.getKeyName(k),$)}},{key:"getStoredToken",value:function($){return this.canStore()?this.sessionStorage.getItem(this.getKeyName($)):null}},{key:"initialize",value:function(){var $=this;if(this.canStore()){var k=this.sessionStorage.getItem(this.initializedFlag);k&&this.clear(),this.sessionStorage.setItem(this.initializedFlag,"true");var _=this.sessionStorage.removeItem;this.window.addEventListener("unload",function(){_($.initializedFlag)})}}},{key:"clear",value:function(){if(this.canStore()){for(var $=[],k=0;k<this.sessionStorage.length;k++){var _=this.sessionStorage.key(k);_&&_.indexOf(this.tokenStoragePrefix)===0&&$.push(_)}var P=this.sessionStorage.removeItem;$.forEach(function(R){return P(R)}),P(this.initializedFlag)}}},{key:"getKeyName",value:function($){return"".concat(this.tokenStoragePrefix).concat($)}},{key:"canStore",value:function(){return!!(this.sessionStorage&&this.sessionStorage.length&&this.window)}}]),A}();Pe.default(za,"_instance",null);var ya=new za,dr=function(){function A(N,$,k,_,P,R){Z.default(this,A),this.title=N,this.details=$,this.start=k,this.type=P,this.id=R,this.end=_}return Ue.default(A,[{key:"toTelemetryEvent",value:function(){var $=new Date,k=this.start,_=this.end?this.end:$;if(_<k){var P=_;_=k,k=P}var R=k.getTime()-$.getTime(),ae=_.getTime()-$.getTime(),re=new D(R,ae,this.title,this.details,this.id,this.type);return re}}]),A}();e.TelemetryPoint=void 0,function(A){A[A.Start=0]="Start",A[A.End=1]="End"}(e.TelemetryPoint||(e.TelemetryPoint={})),e.EventSendingLimitation=void 0,function(A){A[A.MinEventsPortion=0]="MinEventsPortion",A[A.AnyEvents=1]="AnyEvents",A[A.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished"}(e.EventSendingLimitation||(e.EventSendingLimitation={}));var bs=function(){function A(N,$){Z.default(this,A),Pe.default(this,"minEventsPortionToSend",50),Pe.default(this,"maxEventsPortionToSend",100),Pe.default(this,"pendingEvents",new Map),Pe.default(this,"readyEvents",[]),Pe.default(this,"hasInitializationFinished",!1),Pe.default(this,"_canSendTelemetry",!1),this.config=N,this.packetInterface=$}return Ue.default(A,[{key:"isTelemetryEnabled",get:function(){return this.config.confirmedCapabilities.has("telemetry.v1")}},{key:"canSendTelemetry",get:function(){return this._canSendTelemetry&&this.isTelemetryEnabled},set:function($){xe.debug("TelemetryTracker.canSendTelemetry: ".concat($," TelemetryTracker.isTelemetryEnabled: ").concat(this.isTelemetryEnabled)),this._canSendTelemetry&&!$&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=$,$&&this.sendTelemetry(e.EventSendingLimitation.AnyEvents),$&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}},{key:"addTelemetryEvent",value:function($){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push($)}},{key:"addPartialEvent",value:function($,k,_){xe.debug("Adding ".concat(_===e.TelemetryPoint.Start?"starting":"ending"," timepoint for '").concat(k,"' event"));var P=this.pendingEvents.has(k);if(_===e.TelemetryPoint.Start)P&&xe.debug("Overwriting starting point for '".concat(k,"' event")),this.pendingEvents.set(k,$);else{if(!P){xe.info("Could not find started event for '".concat(k,"' event"));return}this.addTelemetryEvent(this.merge(this.pendingEvents.get(k),$)),this.pendingEvents.delete(k)}}},{key:"getTelemetryToSend",value:function($){return!this.canSendTelemetry||this.readyEvents.length==0?[]:$==e.EventSendingLimitation.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion($==e.EventSendingLimitation.AnyEventsIncludingUnfinished)}},{key:"getTelemetryPortion",value:function($){var k=this,_=Math.min(this.readyEvents.length,this.maxEventsPortionToSend),P=this.readyEvents.splice(0,_);return $&&P.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach(function(R,ae){if(!(P.length>=k.maxEventsPortionToSend)){var re=k.pendingEvents.get(ae);k.pendingEvents.delete(ae),P.push(new dr("[UNFINISHED] ".concat(re.title),re.details,re.start,null,re.type,re.id))}}),P}},{key:"merge",value:function($,k){return new dr(k.title?k.title:$.title,k.details?k.details:$.details,$.start,k.end,k.type?k.type:$.type,k.id?k.id:$.id)}},{key:"sendTelemetryIfMinimalPortionCollected",value:function(){this.sendTelemetry(e.EventSendingLimitation.MinEventsPortion)}},{key:"sendTelemetry",value:function($){var k=this.getTelemetryToSend($);if(k.length!==0)try{this.packetInterface.send(new Y(k.map(function(_){return _.toTelemetryEvent()})))}catch(_){xe.debug("Error while sending ".concat(k.length," telemetry events due to ").concat(_,"; they will be resubmitted")),this.readyEvents=this.readyEvents.concat(k)}}}]),A}();function gr(A){var N=un();return function(){var k=Le.default(A),_;if(N){var P=Le.default(this).constructor;_=Reflect.construct(k,arguments,P)}else _=k.apply(this,arguments);return pe.default(this,_)}}function un(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Tn=function A(){Z.default(this,A)};Pe.default(Tn,"TWILSOCK_CONNECT","twilsock.sdk.connect"),Pe.default(Tn,"TWILSOCK_INIT","twilsock.sdk.init"),e.TwilsockClient=function(A){ke.default($,A);var N=gr($);function $(k,_,P){var R;Z.default(this,$),R=N.call(this),Pe.default(B.default(R),"version",zr),Pe.default(B.default(R),"offlineStorageDeferred",new Uu),P.continuationToken=P.continuationToken?P.continuationToken:ya.getStoredToken(_);var ae=R.config=new bn(k,_,P);xe.setLevel(ae.logLevel);var re=new sn(ae.url),Se=new ha(re,ae);return R.channel=new Wn(re,Se,ae),R.registrations=new Mu(Se),R.upstream=new gs(Se,R.channel,ae),R.telemetryTracker=new bs(ae,Se),R.channel.on("initialized",function(){return R.telemetryTracker.canSendTelemetry=!0}),re.on("disconnected",function(){return R.telemetryTracker.canSendTelemetry=!1}),R.registrations.on("registered",function(Oe){return R.emit("registered",Oe)}),R.channel.on("message",function(Oe,Xe){return setTimeout(function(){return R.emit("message",Oe,Xe)},0)}),R.channel.on("stateChanged",function(Oe){return setTimeout(function(){return R.emit("stateChanged",Oe)},0)}),R.channel.on("connectionError",function(Oe){return setTimeout(function(){return R.emit("connectionError",Oe)},0)}),R.channel.on("tokenAboutToExpire",function(){return setTimeout(function(){return R.emit("tokenAboutToExpire")},0)}),R.channel.on("tokenExpired",function(){return setTimeout(function(){return R.emit("tokenExpired")},0)}),R.channel.on("connected",function(){return R.registrations.updateRegistrations()}),R.channel.on("connected",function(){return R.upstream.sendPendingMessages()}),R.channel.on("connected",function(){return setTimeout(function(){return R.emit("connected")},0)}),R.channel.on("beforeConnect",function(){return R.telemetryTracker.addPartialEvent(new dr("Establish WebSocket connection","",new Date),Tn.TWILSOCK_CONNECT,e.TelemetryPoint.Start)}),R.channel.on("connected",function(){return R.telemetryTracker.addPartialEvent(new dr("Establish WebSocket connection","",new Date,new Date),Tn.TWILSOCK_CONNECT,e.TelemetryPoint.End)}),R.channel.on("beforeSendInit",function(){return R.telemetryTracker.addPartialEvent(new dr("Send Twilsock init","",new Date),Tn.TWILSOCK_INIT,e.TelemetryPoint.Start)}),R.channel.on("initialized",function(){return R.telemetryTracker.addPartialEvent(new dr("Send Twilsock init","Succeeded",new Date,new Date),Tn.TWILSOCK_INIT,e.TelemetryPoint.End)}),R.channel.on("sendInitFailed",function(){return R.telemetryTracker.addPartialEvent(new dr("Send Twilsock init","Failed",new Date,new Date),Tn.TWILSOCK_INIT,e.TelemetryPoint.End)}),R.channel.on("initialized",function(Oe){R.handleStorageId(_,Oe),ya.storeToken(Oe.continuationToken,_),setTimeout(function(){return R.emit("initialized",Oe)},0)}),R.channel.on("disconnected",function(){return setTimeout(function(){return R.emit("disconnected")},0)}),R.channel.on("disconnected",function(){return R.upstream.rejectPendingMessages()}),R.channel.on("disconnected",function(){return R.offlineStorageDeferred.fail(new ze("Client disconnected"))}),R.offlineStorageDeferred.promise.catch(function(){}),R}return Ue.default($,[{key:"emit",value:function(_){for(var P,R=arguments.length,ae=new Array(R>1?R-1:0),re=1;re<R;re++)ae[re-1]=arguments[re];return xe.debug("Emitting ".concat(_.toString(),"(").concat(ae.map(function(Se){return JSON.stringify(Se)}).join(", "),")")),(P=ce.default(Le.default($.prototype),"emit",this)).call.apply(P,[this,_].concat(ae))}},{key:"handleStorageId",value:function(_,P){if(!P.offlineStorage)this.offlineStorageDeferred.fail(new ze("No offline storage id"));else if(P.offlineStorage.hasOwnProperty(_))try{this.offlineStorageDeferred.set(ms.create(P.offlineStorage[_])),xe.debug("Offline storage for '".concat(_,"' product: ").concat(JSON.stringify(P.offlineStorage[_]),"."))}catch(R){this.offlineStorageDeferred.fail(new ze("Failed to parse offline storage for ".concat(_," ").concat(JSON.stringify(P.offlineStorage[_]),". ").concat(R,".")))}else this.offlineStorageDeferred.fail(new ze("No offline storage id for '".concat(_,"' product: ").concat(JSON.stringify(P.offlineStorage))))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}},{key:"updateToken",value:function(){var k=Ee.default(Fe.default.mark(function P(R){return Fe.default.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(xe.trace("updating token '".concat(R,"'")),this.config.token!==R){re.next=3;break}return re.abrupt("return");case 3:return this.config.updateToken(R),re.next=6,this.channel.updateToken(R);case 6:return re.abrupt("return",re.sent);case 7:case"end":return re.stop()}},P,this)}));function _(P){return k.apply(this,arguments)}return _}()},{key:"setNotificationsContext",value:function(){var k=Ee.default(Fe.default.mark(function P(R,ae){return Fe.default.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return Se.next=2,this.registrations.setNotificationsContext(R,ae);case 2:case"end":return Se.stop()}},P,this)}));function _(P,R){return k.apply(this,arguments)}return _}()},{key:"removeNotificationsContext",value:function(){var k=Ee.default(Fe.default.mark(function P(R){return Fe.default.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return re.next=2,this.registrations.removeNotificationsContext(R);case 2:case"end":return re.stop()}},P,this)}));function _(P){return k.apply(this,arguments)}return _}()},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:function(){var k=Ee.default(Fe.default.mark(function P(){return Fe.default.wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEventsIncludingUnfinished),ae.next=3,this.channel.disconnect();case 3:return ae.abrupt("return",ae.sent);case 4:case"end":return ae.stop()}},P,this)}));function _(){return k.apply(this,arguments)}return _}()},{key:"get",value:function(){var k=Ee.default(Fe.default.mark(function P(R,ae,re){return Fe.default.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),Oe.next=3,this.upstream.send("GET",R,ae,void 0,re);case 3:return Oe.abrupt("return",Oe.sent);case 4:case"end":return Oe.stop()}},P,this)}));function _(P,R,ae){return k.apply(this,arguments)}return _}()},{key:"post",value:function(){var k=Ee.default(Fe.default.mark(function P(R,ae,re,Se){return Fe.default.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),Xe.next=3,this.upstream.send("POST",R,ae,re,Se);case 3:return Xe.abrupt("return",Xe.sent);case 4:case"end":return Xe.stop()}},P,this)}));function _(P,R,ae,re){return k.apply(this,arguments)}return _}()},{key:"put",value:function(){var k=Ee.default(Fe.default.mark(function P(R,ae,re,Se){return Fe.default.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),Xe.next=3,this.upstream.send("PUT",R,ae,re,Se);case 3:return Xe.abrupt("return",Xe.sent);case 4:case"end":return Xe.stop()}},P,this)}));function _(P,R,ae,re){return k.apply(this,arguments)}return _}()},{key:"delete",value:function(){var k=Ee.default(Fe.default.mark(function P(R,ae,re,Se){return Fe.default.wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),Xe.next=3,this.upstream.send("DELETE",R,ae,re,Se);case 3:return Xe.abrupt("return",Xe.sent);case 4:case"end":return Xe.stop()}},P,this)}));function _(P,R,ae,re){return k.apply(this,arguments)}return _}()},{key:"addTelemetryEvent",value:function(_){this.telemetryTracker.addTelemetryEvent(_),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"addPartialTelemetryEvent",value:function(_,P,R){this.telemetryTracker.addPartialEvent(_,P,R),R===e.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}}]),$}(be),e.TwilsockClient=O([T.validateConstructorTypes(T.nonEmptyString,T.nonEmptyString,[T.pureObject,"undefined",T.literal(null)]),Ie("design:paramtypes",[String,String,Object])],e.TwilsockClient);var Fu=function(){function A(N){Z.default(this,A),this.product=N,this.type="ers",this.notification_protocol_version=0,this.message_types=[]}return Ue.default(A,[{key:"populateInitRegistrations",value:function($){var k=new Set(this.message_types);for(var _ in $)k.add($[_]);this.message_types=Array.from(k)}}]),A}();e.InitRegistration=Fu,e.TelemetryEventDescription=dr,e.TelemetryTracker=bs,e.TransportUnavailableError=kn,e.Twilsock=e.TwilsockClient,e.TwilsockError=ze})(Zo);var DS={},BS=Lt,M6=lt,N6=Pt,x6=at,$p=As,L6=Is,j6=_s,U6=vr,F6=ks,es=Object.assign,qS=Object.defineProperty,D6=M6([].concat),WS=!es||x6(function(){if(BS&&es({b:1},es(qS({},"a",{enumerable:!0,get:function(){qS(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},n={},t=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[t]=7,r.split("").forEach(function(a){n[a]=a}),es({},e)[t]!==7||$p(es({},n)).join("")!==r})?function(n,t){for(var r=U6(n),a=arguments.length,i=1,s=L6.f,o=j6.f;a>i;)for(var u=F6(arguments[i++]),l=s?D6($p(u),s(u)):$p(u),c=l.length,p=0,S;c>p;)S=l[p++],(!BS||N6(o,u,S))&&(r[S]=u[S]);return r}:es,B6=ft,zS=WS;B6({target:"Object",stat:!0,arity:2,forced:Object.assign!==zS},{assign:zS});/*
	@license
	The MIT License (MIT)

	Copyright (c) 2016 Twilio Inc.

	Permission is hereby granted, free of charge, to any person obtaining a copy
	of this software and associated documentation files (the "Software"), to deal
	in the Software without restriction, including without limitation the rights
	to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	copies of the Software, and to permit persons to whom the Software is
	furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in all
	copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
	SOFTWARE.

	*/(function(e){Object.defineProperty(e,"__esModule",{value:!0});var n=Ds,t=Ln,r=_a,a=Nn,i=xn,s=Jr,o=Ys,u=Yr,l=Zo,c=ei,p=ti,S=ia,T=qi,I=Wi,x=Zs,U=rl,F=ur;function V(ue){return ue&&typeof ue=="object"&&"default"in ue?ue:{default:ue}}function Ae(ue){if(ue&&ue.__esModule)return ue;var fe=Object.create(null);return ue&&Object.keys(ue).forEach(function(J){if(J!=="default"){var ne=Object.getOwnPropertyDescriptor(ue,J);Object.defineProperty(fe,J,ne.get?ne:{enumerable:!0,get:function(){return ue[J]}})}}),fe.default=ue,Object.freeze(fe)}var de=V(n),Ge=V(t),Ee=V(r),Ue=V(a),B=V(i),ce=V(s),ke=V(o),pe=V(u),Le=V(c),Z=V(p),Pe=V(T),Fe=V(I),wt=Ae(x),mt=Ae(U);function Ce(ue,fe,J,ne){var X=arguments.length,le=X<3?fe:ne===null?ne=Object.getOwnPropertyDescriptor(fe,J):ne,ge;if((typeof Reflect>"u"?"undefined":pe.default(Reflect))==="object"&&typeof Reflect.decorate=="function")le=Reflect.decorate(ue,fe,J,ne);else for(var H=ue.length-1;H>=0;H--)(ge=ue[H])&&(le=(X<3?ge(le):X>3?ge(fe,J,le):ge(fe,J))||le);return X>3&&le&&Object.defineProperty(fe,J,le),le}function se(ue,fe){if((typeof Reflect>"u"?"undefined":pe.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(ue,fe)}var ie;function O(){}O.prototype=Object.create(null);function Ie(){Ie.init.call(this)}Ie.EventEmitter=Ie,Ie.usingDomains=!1,Ie.prototype.domain=void 0,Ie.prototype._events=void 0,Ie.prototype._maxListeners=void 0,Ie.defaultMaxListeners=10,Ie.init=function(){this.domain=null,Ie.usingDomains&&ie.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new O,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ie.prototype.setMaxListeners=function(fe){if(typeof fe!="number"||fe<0||isNaN(fe))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=fe,this};function Je(ue){return ue._maxListeners===void 0?Ie.defaultMaxListeners:ue._maxListeners}Ie.prototype.getMaxListeners=function(){return Je(this)};function Me(ue,fe,J){if(fe)ue.call(J);else for(var ne=ue.length,X=_e(ue,ne),le=0;le<ne;++le)X[le].call(J)}function be(ue,fe,J,ne){if(fe)ue.call(J,ne);else for(var X=ue.length,le=_e(ue,X),ge=0;ge<X;++ge)le[ge].call(J,ne)}function z(ue,fe,J,ne,X){if(fe)ue.call(J,ne,X);else for(var le=ue.length,ge=_e(ue,le),H=0;H<le;++H)ge[H].call(J,ne,X)}function xt(ue,fe,J,ne,X,le){if(fe)ue.call(J,ne,X,le);else for(var ge=ue.length,H=_e(ue,ge),ee=0;ee<ge;++ee)H[ee].call(J,ne,X,le)}function ye(ue,fe,J,ne){if(fe)ue.apply(J,ne);else for(var X=ue.length,le=_e(ue,X),ge=0;ge<X;++ge)le[ge].apply(J,ne)}Ie.prototype.emit=function(fe){var J,ne,X,le,ge,H,ee,D=fe==="error";if(H=this._events,H)D=D&&H.error==null;else if(!D)return!1;if(ee=this.domain,D){if(J=arguments[1],ee)J||(J=new Error('Uncaught, unspecified "error" event')),J.domainEmitter=this,J.domain=ee,J.domainThrown=!1,ee.emit("error",J);else{if(J instanceof Error)throw J;var Y=new Error('Uncaught, unspecified "error" event. ('+J+")");throw Y.context=J,Y}return!1}if(ne=H[fe],!ne)return!1;var q=typeof ne=="function";switch(X=arguments.length,X){case 1:Me(ne,q,this);break;case 2:be(ne,q,this,arguments[1]);break;case 3:z(ne,q,this,arguments[1],arguments[2]);break;case 4:xt(ne,q,this,arguments[1],arguments[2],arguments[3]);break;default:for(le=new Array(X-1),ge=1;ge<X;ge++)le[ge-1]=arguments[ge];ye(ne,q,this,le)}return!0};function te(ue,fe,J,ne){var X,le,ge;if(typeof J!="function")throw new TypeError('"listener" argument must be a function');if(le=ue._events,le?(le.newListener&&(ue.emit("newListener",fe,J.listener?J.listener:J),le=ue._events),ge=le[fe]):(le=ue._events=new O,ue._eventsCount=0),!ge)ge=le[fe]=J,++ue._eventsCount;else if(typeof ge=="function"?ge=le[fe]=ne?[J,ge]:[ge,J]:ne?ge.unshift(J):ge.push(J),!ge.warned&&(X=Je(ue),X&&X>0&&ge.length>X)){ge.warned=!0;var H=new Error("Possible EventEmitter memory leak detected. "+ge.length+" "+fe+" listeners added. Use emitter.setMaxListeners() to increase limit");H.name="MaxListenersExceededWarning",H.emitter=ue,H.type=fe,H.count=ge.length,St(H)}return ue}function St(ue){typeof console.warn=="function"?console.warn(ue):console.log(ue)}Ie.prototype.addListener=function(fe,J){return te(this,fe,J,!1)},Ie.prototype.on=Ie.prototype.addListener,Ie.prototype.prependListener=function(fe,J){return te(this,fe,J,!0)};function Ne(ue,fe,J){var ne=!1;function X(){ue.removeListener(fe,X),ne||(ne=!0,J.apply(ue,arguments))}return X.listener=J,X}Ie.prototype.once=function(fe,J){if(typeof J!="function")throw new TypeError('"listener" argument must be a function');return this.on(fe,Ne(this,fe,J)),this},Ie.prototype.prependOnceListener=function(fe,J){if(typeof J!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(fe,Ne(this,fe,J)),this},Ie.prototype.removeListener=function(fe,J){var ne,X,le,ge,H;if(typeof J!="function")throw new TypeError('"listener" argument must be a function');if(X=this._events,!X)return this;if(ne=X[fe],!ne)return this;if(ne===J||ne.listener&&ne.listener===J)--this._eventsCount===0?this._events=new O:(delete X[fe],X.removeListener&&this.emit("removeListener",fe,ne.listener||J));else if(typeof ne!="function"){for(le=-1,ge=ne.length;ge-- >0;)if(ne[ge]===J||ne[ge].listener&&ne[ge].listener===J){H=ne[ge].listener,le=ge;break}if(le<0)return this;if(ne.length===1){if(ne[0]=void 0,--this._eventsCount===0)return this._events=new O,this;delete X[fe]}else dt(ne,le);X.removeListener&&this.emit("removeListener",fe,H||J)}return this},Ie.prototype.off=function(ue,fe){return this.removeListener(ue,fe)},Ie.prototype.removeAllListeners=function(fe){var J,ne;if(ne=this._events,!ne)return this;if(!ne.removeListener)return arguments.length===0?(this._events=new O,this._eventsCount=0):ne[fe]&&(--this._eventsCount===0?this._events=new O:delete ne[fe]),this;if(arguments.length===0){for(var X=Object.keys(ne),le=0,ge;le<X.length;++le)ge=X[le],ge!=="removeListener"&&this.removeAllListeners(ge);return this.removeAllListeners("removeListener"),this._events=new O,this._eventsCount=0,this}if(J=ne[fe],typeof J=="function")this.removeListener(fe,J);else if(J)do this.removeListener(fe,J[J.length-1]);while(J[0]);return this},Ie.prototype.listeners=function(fe){var J,ne,X=this._events;return X?(J=X[fe],J?typeof J=="function"?ne=[J.listener||J]:ne=it(J):ne=[]):ne=[],ne},Ie.listenerCount=function(ue,fe){return typeof ue.listenerCount=="function"?ue.listenerCount(fe):zt.call(ue,fe)},Ie.prototype.listenerCount=zt;function zt(ue){var fe=this._events;if(fe){var J=fe[ue];if(typeof J=="function")return 1;if(J)return J.length}return 0}Ie.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function dt(ue,fe){for(var J=fe,ne=J+1,X=ue.length;ne<X;J+=1,ne+=1)ue[J]=ue[ne];ue.pop()}function _e(ue,fe){for(var J=new Array(fe);fe--;)J[fe]=ue[fe];return J}function it(ue){for(var fe=new Array(ue.length),J=0;J<fe.length;++J)fe[J]=ue[J].listener||ue[J];return fe}var bt=wt.getLogger("twilio-notificatiions");function $e(ue,fe){return["".concat(new Date().toISOString()," Twilio.Notifications ").concat(ue,":")].concat(Array.from(fe))}var Kt=function(){function ue(){Ge.default(this,ue)}return Ee.default(ue,[{key:"setLevel",value:function(J){bt.setLevel(J)}},{key:"trace",value:function(){if(bt.getLevel()==bt.levels.TRACE){for(var J=arguments.length,ne=new Array(J),X=0;X<J;X++)ne[X]=arguments[X];bt.debug.apply(null,$e("T",ne))}}},{key:"debug",value:function(){for(var J=arguments.length,ne=new Array(J),X=0;X<J;X++)ne[X]=arguments[X];bt.debug.apply(null,$e("D",ne))}},{key:"info",value:function(){for(var J=arguments.length,ne=new Array(J),X=0;X<J;X++)ne[X]=arguments[X];bt.info.apply(null,$e("I",ne))}},{key:"warn",value:function(){for(var J=arguments.length,ne=new Array(J),X=0;X<J;X++)ne[X]=arguments[X];bt.warn.apply(null,$e("W",ne))}},{key:"error",value:function(){for(var J=arguments.length,ne=new Array(J),X=0;X<J;X++)ne[X]=arguments[X];bt.error.apply(null,$e("E",ne))}}]),ue}(),pt=new Kt;function Wt(ue){var fe=er();return function(){var ne=ce.default(ue),X;if(fe){var le=ce.default(this).constructor;X=Reflect.construct(ne,arguments,le)}else X=ne.apply(this,arguments);return B.default(this,X)}}function er(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xe=Ee.default(function ue(){var fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",ne=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Set;Ge.default(this,ue),this.token=fe,this.notificationId=J,this.messageTypes=ne});function zr(ue,fe){return[].concat(Fe.default(Fe.default(ue).filter(function(J){return!fe.has(J)})),Fe.default(Fe.default(fe).filter(function(J){return!ue.has(J)})))}function bn(ue,fe){var J=new Set;return ue.notificationId!==fe.notificationId&&J.add("notificationId"),ue.token!==fe.token&&J.add("token"),zr(ue.messageTypes,fe.messageTypes).length>0&&J.add("messageType"),[J.size>0,J]}var Ct=function(ue){Ue.default(J,ue);var fe=Wt(J);function J(ne){var X;return Ge.default(this,J),X=fe.call(this),Z.default(Le.default(X),"desiredState",new xe),Z.default(Le.default(X),"currentState",new xe),Z.default(Le.default(X),"_hasActiveAttempt",!1),X.channelType=ne,X}return Ee.default(J,[{key:"setNotificationId",value:function(X){this.desiredState.notificationId=X}},{key:"isActive",value:function(){return this.desiredState.notificationId!==""}},{key:"subscribe",value:function(X){if(this.desiredState.messageTypes.has(X)){pt.debug("message type '".concat(X,"' for channel ").concat(this.channelType," is already registered"));return}this.desiredState.messageTypes.add(X)}},{key:"unsubscribe",value:function(X){this.desiredState.messageTypes.has(X)&&this.desiredState.messageTypes.delete(X)}},{key:"updateToken",value:function(X){this.desiredState.token=X}},{key:"commitChanges",value:function(){var ne=de.default(ke.default.mark(function le(){var ge,H,ee,D,Y,q;return ke.default.wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(!this._hasActiveAttempt){me.next=3;break}throw pt.error("One registration attempt is already in progress"),new Error("One registration attempt is already in progress");case 3:if(ge=bn(this.desiredState,this.currentState),H=Pe.default(ge,2),ee=H[0],D=H[1],ee){me.next=6;break}return me.abrupt("return");case 6:if(this.currentState.notificationId||D.delete("notificationId"),pt.trace("Persisting ".concat(this.channelType," registration"),D,this.desiredState),me.prev=8,this._hasActiveAttempt=!0,Y=new xe,Y.token=this.desiredState.token,Y.notificationId=this.desiredState.notificationId,Y.messageTypes=new Set(this.desiredState.messageTypes),!(Y.messageTypes.size>0)){me.next=24;break}return me.next=17,this.updateRegistration(Y,D);case 17:q=me.sent,this.currentState.token=q.token,this.currentState.notificationId=q.notificationId,this.currentState.messageTypes=new Set(q.messageTypes),this.emit("stateChanged",this.channelType,"registered",this.currentState),me.next=30;break;case 24:return me.next=26,this.removeRegistration();case 26:this.currentState.token=Y.token,this.currentState.notificationId=Y.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged",this.channelType,"unregistered",this.currentState);case 30:me.next=35;break;case 32:throw me.prev=32,me.t0=me.catch(8),me.t0;case 35:return me.prev=35,this._hasActiveAttempt=!1,me.finish(35);case 38:case"end":return me.stop()}},le,this,[[8,32,35,38]])}));function X(){return ne.apply(this,arguments)}return X}()}]),J}(Ie);function Dt(ue){var fe=gt();return function(){var ne=ce.default(ue),X;if(fe){var le=ce.default(this).constructor;X=Reflect.construct(ne,arguments,le)}else X=ne.apply(this,arguments);return B.default(this,X)}}function gt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var tt={min:2e3,max:12e4,randomness:.2},Ft=function(ue){Ue.default(J,ue);var fe=Dt(J);function J(ne,X,le,ge){var H;return Ge.default(this,J),H=fe.call(this,ne),Z.default(Le.default(H),"registrationId",null),H.context=X,H.twilsock=le,H.registrarUrl=ge,H}return Ee.default(J,[{key:"updateRegistration",value:function(){var ne=de.default(ke.default.mark(function le(ge,H){var ee=this,D,Y,q,Re,me;return ke.default.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:if(!H.has("notificationId")){je.next=3;break}return je.next=3,this.removeRegistration();case 3:if(!(!ge.notificationId||!ge.notificationId.length)){je.next=6;break}throw pt.error("No push notification ID for registration"),new Error("No push notification ID for registration");case 6:return pt.trace("Registering",this.channelType,ge),D={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:Array.from(ge.messageTypes),data:{registration_id:ge.notificationId}},Y=this.context.productId,q="".concat(this.registrarUrl,"?productId=").concat(Y),Re={"Content-Type":"application/json"},pt.trace("Creating registration for channel ".concat(this.channelType)),je.prev=12,je.next=15,new S.AsyncRetrier(tt).run(function(){return ee.twilsock.post(q,Re,D,Y)});case 15:me=je.sent,this.registrationId=me.body.id,pt.debug("Registration created: ",me),je.next=24;break;case 20:throw je.prev=20,je.t0=je.catch(12),pt.error("Registration failed: ",je.t0),je.t0;case 24:return je.abrupt("return",ge);case 25:case"end":return je.stop()}},le,this,[[12,20]])}));function X(le,ge){return ne.apply(this,arguments)}return X}()},{key:"removeRegistration",value:function(){var ne=de.default(ke.default.mark(function le(){var ge=this,H,ee,D;return ke.default.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(this.registrationId){q.next=2;break}return q.abrupt("return");case 2:return H=this.context.productId,ee="".concat(this.registrarUrl,"/").concat(this.registrationId,"?productId=").concat(H),D={"Content-Type":"application/json"},pt.trace("Removing registration for ".concat(this.channelType)),q.prev=6,q.next=9,new S.AsyncRetrier(Object.assign(tt,{maxAttemptsCount:3})).run(function(){return ge.twilsock.delete(ee,D,{},H)});case 9:this.registrationId=null,this.currentState.notificationId="",pt.debug("Registration removed for ".concat(this.channelType)),q.next=18;break;case 14:throw q.prev=14,q.t0=q.catch(6),pt.error("Failed to remove registration ",this.channelType,q.t0),q.t0;case 18:case"end":return q.stop()}},le,this,[[6,14]])}));function X(){return ne.apply(this,arguments)}return X}()},{key:"sendDeviceRemoveRequest",value:function(){var ne=de.default(ke.default.mark(function le(ge){var H=this,ee,D,Y,q;return ke.default.wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(ge!==""){me.next=2;break}throw new Error("Empty registration ID");case 2:return ee=this.context.productId,D="".concat(this.registrarUrl,"?productId=").concat(ee),Y={"Content-Type":"application/json"},q={binding_type:this.channelType,address:ge},me.prev=6,pt.trace("Removing old registrations for ".concat(this.channelType)),me.next=10,new S.AsyncRetrier(Object.assign(tt,{maxAttemptsCount:3})).run(function(){return H.twilsock.delete(D,Y,q,ee)});case 10:this.registrationId=null,this.currentState.notificationId="",pt.debug("Registration removed for ".concat(this.channelType)),me.next=19;break;case 15:throw me.prev=15,me.t0=me.catch(6),pt.error("Failed to remove registration ",this.channelType,me.t0),me.t0;case 19:case"end":return me.stop()}},le,this,[[6,15]])}));function X(le){return ne.apply(this,arguments)}return X}()}]),J}(Ct);function At(ue){var fe=ar();return function(){var ne=ce.default(ue),X;if(fe){var le=ce.default(this).constructor;X=Reflect.construct(ne,arguments,le)}else X=ne.apply(this,arguments);return B.default(this,X)}}function ar(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Gr=function(ue){Ue.default(J,ue);var fe=At(J);function J(ne,X,le){var ge;return Ge.default(this,J),ge=fe.call(this,"twilsock"),Z.default(Le.default(ge),"contextId",mt.v4()),ge.productId=ne,ge.platform=X,ge.twilsock=le,ge}return Ee.default(J,[{key:"updateRegistration",value:function(){var ne=de.default(ke.default.mark(function le(ge,H){var ee,D;return ke.default.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(H.has("messageType")){q.next=2;break}return q.abrupt("return",ge);case 2:return ee=Array.from(ge.messageTypes),D={product_id:this.productId,notification_protocol_version:4,endpoint_platform:this.platform,message_types:ee},q.prev=4,q.next=7,this.twilsock.setNotificationsContext(this.contextId,D);case 7:q.next=13;break;case 9:throw q.prev=9,q.t0=q.catch(4),pt.error("Failed to update twilsock notification context: ".concat(q.t0)),q.t0;case 13:return q.abrupt("return",ge);case 14:case"end":return q.stop()}},le,this,[[4,9]])}));function X(le,ge){return ne.apply(this,arguments)}return X}()},{key:"removeRegistration",value:function(){var ne=de.default(ke.default.mark(function le(){return ke.default.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.prev=0,H.next=3,this.twilsock.removeNotificationsContext(this.contextId);case 3:H.next=9;break;case 5:throw H.prev=5,H.t0=H.catch(0),pt.error("Failed to remove twilsock notification context: ".concat(H.t0)),H.t0;case 9:case"end":return H.stop()}},le,this,[[0,5]])}));function X(){return ne.apply(this,arguments)}return X}()},{key:"sendDeviceRemoveRequest",value:function(){var ne=de.default(ke.default.mark(function le(ge){return ke.default.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:case"end":return ee.stop()}},le)}));function X(le){return ne.apply(this,arguments)}return X}()}]),J}(Ct);function wn(ue){var fe=qn();return function(){var ne=ce.default(ue),X;if(fe){var le=ce.default(this).constructor;X=Reflect.construct(ne,arguments,le)}else X=ne.apply(this,arguments);return B.default(this,X)}}function qn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xr,or=F.literal("apn","fcm","twilsock");e.Notifications=xr=function(ue){Ue.default(J,ue);var fe=wn(J);function J(ne){var X,le,ge,H,ee,D,Y,q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ge.default(this,J),Y=fe.call(this),q.logLevel=(X=q.logLevel)!==null&&X!==void 0?X:"error",pt.setLevel(q.logLevel);var Re=(le=q.productId)!==null&&le!==void 0?le:"notifications",me=!q.twilsockClient,De=q.twilsockClient=(ge=q.twilsockClient)!==null&&ge!==void 0?ge:new l.TwilsockClient(ne,Re,q),je=(H=q.notifications)!==null&&H!==void 0?H:{},Be=(ee=(D=je.region)!==null&&D!==void 0?D:q.region)!==null&&ee!==void 0?ee:"us1",Ve="https://ers.".concat(Be,".twilio.com/v1/registrations"),Ke=je.ersUrl||Ve;Y.connectors=new Map;var ze=xr._detectPlatform();return Y.connectors.set("apn",new Ft("apn",{protocolVersion:4,productId:Re,platform:ze},De,Ke)),Y.connectors.set("fcm",new Ft("fcm",{protocolVersion:3,productId:Re,platform:ze},De,Ke)),Y.connectors.set("twilsock",new Gr(Re,ze,De)),De.on("stateChanged",function(He){return Y.emit("transportState",He)}),Y._connector("twilsock").on("stateChanged",function(He,Qe,rt){return Y.emit("stateChanged",He,Qe,rt)}),Y._connector("apn").on("stateChanged",function(He,Qe,rt){return Y.emit("stateChanged",He,Qe,rt)}),Y._connector("fcm").on("stateChanged",function(He,Qe,rt){return Y.emit("stateChanged",He,Qe,rt)}),De.on("message",function(He,Qe){return Y._routeMessage(He,Qe)}),Y.updateToken(ne),me&&(De.connect(),Y.twilsock=De),Y}return Ee.default(J,[{key:"shutdown",value:function(){var ne=de.default(ke.default.mark(function le(){return ke.default.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(this.connectors.clear(),!this.twilsock){H.next=4;break}return H.next=4,this.twilsock.disconnect();case 4:case"end":return H.stop()}},le,this)}));function X(){return ne.apply(this,arguments)}return X}()},{key:"setPushRegistrationId",value:function(X,le){pt.debug("Set ".concat(X," push registration id '").concat(le,"'")),this._connector(X).setNotificationId(le)}},{key:"subscribe",value:function(X,le){pt.debug("Add ".concat(X," subscriptions for message type ").concat(le)),this._connector(X).subscribe(le)}},{key:"unsubscribe",value:function(X,le){pt.debug("Remove ".concat(X," subscriptions for message type ").concat(le)),this._connector(X).unsubscribe(le)}},{key:"updateToken",value:function(X){this.connectors.forEach(function(le){return le.updateToken(X)})}},{key:"commitChanges",value:function(){var ne=de.default(ke.default.mark(function le(){var ge;return ke.default.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ge=[],this.connectors.forEach(function(D){D.isActive()&&ge.push(D.commitChanges())}),ee.next=4,Promise.all(ge);case 4:case"end":return ee.stop()}},le,this)}));function X(){return ne.apply(this,arguments)}return X}()},{key:"removeRegistrations",value:function(){var ne=de.default(ke.default.mark(function le(ge,H){return ke.default.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,this._connector(ge).sendDeviceRemoveRequest(H);case 2:case"end":return D.stop()}},le,this)}));function X(le,ge){return ne.apply(this,arguments)}return X}()},{key:"handlePushNotification",value:function(X){return{messageType:X.twi_message_type,payload:X.payload}}},{key:"_routeMessage",value:function(X,le){pt.debug("Notification message arrived: ",X,le),this.emit("message",X,le)}},{key:"_connector",value:function(X){var le=this.connectors.get(X);if(!le)throw new Error("Unknown channel type: ".concat(X));return le}}],[{key:"_detectPlatform",value:function(){var X="";return typeof navigator<"u"?(X="unknown",typeof navigator.product<"u"&&(X=navigator.product),typeof navigator.userAgent<"u"&&(X=navigator.userAgent)):X="web",X.substring(0,128)}}]),J}(Ie),Ce([F.validateTypes(or,F.nonEmptyString),se("design:type",Function),se("design:paramtypes",[String,String]),se("design:returntype",void 0)],e.Notifications.prototype,"setPushRegistrationId",null),Ce([F.validateTypes(or,F.nonEmptyString),se("design:type",Function),se("design:paramtypes",[String,String]),se("design:returntype",void 0)],e.Notifications.prototype,"subscribe",null),Ce([F.validateTypes(or,F.nonEmptyString),se("design:type",Function),se("design:paramtypes",[String,String]),se("design:returntype",void 0)],e.Notifications.prototype,"unsubscribe",null),Ce([F.validateTypes(F.nonEmptyString),se("design:type",Function),se("design:paramtypes",[String]),se("design:returntype",void 0)],e.Notifications.prototype,"updateToken",null),Ce([F.validateTypesAsync(or,F.nonEmptyString),se("design:type",Function),se("design:paramtypes",[String,String]),se("design:returntype",Promise)],e.Notifications.prototype,"removeRegistrations",null),e.Notifications=xr=Ce([F.validateConstructorTypes(F.nonEmptyString,[F.pureObject,"undefined",F.literal(null)]),se("design:paramtypes",[String,Object])],e.Notifications)})(DS);var Mr={},$r={};/*
	@license
	Copyright (c) 2021 Twilio Inc.

	Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


	*/Object.defineProperty($r,"__esModule",{value:!0});var q6=Yr,W6=qi,z6=Wi,G6=Ln,H6=Nn,V6=xn,K6=Jr;function pi(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var ts=pi(q6),vi=pi(W6),Tp=pi(z6),Y6=pi(G6),J6=pi(H6),Q6=pi(V6),GS=pi(K6),Ma=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return{checks:t}};function X6(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Z6(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function Z6(e,n){if(e){if(typeof e=="string")return HS(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return HS(e,n)}}function HS(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var VS=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return Ma(function(a){var i=!1,s=[],o=X6(t),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;if(typeof l=="string"){i=i||ts.default(a)===l,s.push("of type ".concat(l));continue}i=i||a instanceof l,s.push("an instance of ".concat(l.name))}}catch(c){o.e(c)}finally{o.f()}return[i,s]})};function e5(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=t5(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function t5(e,n){if(e){if(typeof e=="string")return KS(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return KS(e,n)}}function KS(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var r5=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return Ma(function(a){var i=!1,s=[],o=e5(t),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;i=i||a===l,s.push(typeof l=="string"?'"'.concat(l,'"'):"".concat(l))}}catch(c){o.e(c)}finally{o.f()}return[i,s]})},n5=Ma(function(e){return[typeof e=="string"&&e.length>0,"a non-empty string"]}),a5=Ma(function(e){return[typeof e=="number"&&Number.isInteger(e)&&e>=0,"a non-negative integer"]}),i5=Ma(function(e){return[ts.default(e)==="object"&&e!==null&&!Array.isArray(e),"a pure object (non-null and non-array)"]});function s5(e){var n=u5();return function(){var r=GS.default(e),a;if(n){var i=GS.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return Q6.default(this,a)}}function u5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function du(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=o5(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function o5(e,n){if(e){if(typeof e=="string")return YS(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return YS(e,n)}}function YS(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var $l=function(n,t){if(t.length>n.length)throw new Error("Expected at most ".concat(n.length," argument(s), but got ").concat(t.length));for(;t.length<n.length;)t.push(void 0);var r=du(t.entries()),a;try{for(r.s();!(a=r.n()).done;){var i=vi.default(a.value,2),s=i[0],o=i[1],u=Ip(n[s],o),l=vi.default(u,4),c=l[0],p=l[1],S=l[2],T=l[3];if(!c){var I=s+1;throw new Error("Argument ".concat(I," is expected to be ").concat(S).concat(T," but got ").concat(p))}}}catch(x){r.e(x)}finally{r.f()}},JS=function(n){var t,r,a=["undefined","boolean","number","bigint","string"];if(a.includes(ts.default(n))&&(r=typeof n=="string"?'"'.concat(n,'"'):"".concat(n)),ts.default(n)==="object"&&(n==null||(t=n.constructor)===null||t===void 0?void 0:t.name)!=="Object"){var i;r=n===null?"null":"instance of ".concat(n==null||(i=n.constructor)===null||i===void 0?void 0:i.name)}return r||(r=ts.default(n)),r},l5=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Cp(t);return function(i){return function(s){J6.default(u,s);var o=s5(u);function u(){Y6.default(this,u);for(var l=arguments.length,c=new Array(l),p=0;p<l;p++)c[p]=arguments[p];return $l(a,c),o.call.apply(o,[this].concat(c))}return u}(i)}},c5=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Cp(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypes decorator can only be applied to methods");var u=o.value;o.value=function(){for(var l=arguments.length,c=new Array(l),p=0;p<l;p++)c[p]=arguments[p];return $l(a,c),u.apply(this,c)}}},f5=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Cp(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypesAsync decorator can only be applied to methods");var u=o.value;o.value=function(){for(var l=arguments.length,c=new Array(l),p=0;p<l;p++)c[p]=arguments[p];try{$l(a,c)}catch(S){return Promise.reject(S)}return u.apply(this,c)}}},Cp=function(n){var t=[],r=du(n),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;t.push(Ep(i))}}catch(s){r.e(s)}finally{r.f()}return t},Ep=function(n){var t=[],r=Array.isArray(n)?n:[n],a=du(r),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;if(typeof s=="string"||typeof s=="function"){t.push(VS(s));continue}t.push(s)}}catch(o){a.e(o)}finally{a.f()}return t},Ip=function(n,t){var r=[],a,i=!1,s=du(n),o;try{for(s.s();!(o=s.n()).done;){var u=o.value,l=du(u.checks),c;try{for(l.s();!(c=l.n()).done;){var p=c.value,S=p(t),T=vi.default(S,3),I=T[0],x=T[1],U=T[2];i=i||I,!a&&U&&(a=U),x&&(r=typeof x=="string"?[].concat(Tp.default(r),[x]):[].concat(Tp.default(r),Tp.default(x)))}}catch(de){l.e(de)}finally{l.f()}}}catch(de){s.e(de)}finally{s.f()}if(i)return[!0];var F=a||JS(t),V=r.length-1,Ae=V>0?"".concat(r.slice(0,V).join(", ")," or ").concat(r[V]):r.join(", ");return[!1,F,Ae,V>1?";":","]},d5=function(n,t){return Ma(function(r){if(ts.default(r)!=="object"||r===null||Array.isArray(r))return[!1,"valid ".concat(n," (should be a pure object)")];for(var a=0,i=Object.entries(t);a<i.length;a++){var s=vi.default(i[a],2),o=s[0],u=s[1],l=Ip(Ep(u),r[o]),c=vi.default(l,3),p=c[0],S=c[1],T=c[2];if(!p)return[!1,"valid ".concat(n,' (key "').concat(o,'" should be ').concat(T,")"),"malformed ".concat(n,' (key "').concat(o,'" is ').concat(S,")")]}return[!0]})};function p5(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=v5(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function v5(e,n){if(e){if(typeof e=="string")return QS(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return QS(e,n)}}function QS(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var h5=function(n,t){return Ma(function(r){if(!Array.isArray(r))return[!1,"an array of ".concat(n)];var a=p5(r.entries()),i;try{for(a.s();!(i=a.n()).done;){var s=vi.default(i.value,2),o=s[0],u=s[1],l=Ip(Ep(t),u),c=vi.default(l,3),p=c[0],S=c[1],T=c[2];if(!p)return[!1,"a valid array of ".concat(n," (index ").concat(o," should be ").concat(T,")"),"malformed array of ".concat(n," (index ").concat(o," is ").concat(S,")")]}}catch(I){a.e(I)}finally{a.f()}return[!0]})};$r.array=h5,$r.custom=Ma,$r.literal=r5,$r.nonEmptyString=n5,$r.nonNegativeInteger=a5,$r.objectSchema=d5,$r.pureObject=i5,$r.runtimeTypeValidation=$l,$r.stringifyReceivedType=JS,$r.type=VS,$r.validateConstructorTypes=l5,$r.validateTypes=c5,$r.validateTypesAsync=f5;/*
	@license
	The following license applies to all parts of this software except as
	documented below.

	    Copyright (c) 2016, Twilio, inc.
	    All rights reserved.

	    Redistribution and use in source and binary forms, with or without
	    modification, are permitted provided that the following conditions are
	    met:

	      1. Redistributions of source code must retain the above copyright
	         notice, this list of conditions and the following disclaimer.

	      2. Redistributions in binary form must reproduce the above copyright
	         notice, this list of conditions and the following disclaimer in
	         the documentation and/or other materials provided with the
	         distribution.

	      3. Neither the name of Twilio nor the names of its contributors may
	         be used to endorse or promote products derived from this software
	         without specific prior written permission.

	    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
	    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
	    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
	    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
	    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
	    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
	    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
	    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
	    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
	    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
	    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

	This software includes loglevel under the following license.

	    Copyright (c) 2013 Tim Perry

	    Permission is hereby granted, free of charge, to any person
	    obtaining a copy of this software and associated documentation
	    files (the "Software"), to deal in the Software without
	    restriction, including without limitation the rights to use,
	    copy, modify, merge, publish, distribute, sublicense, and/or sell
	    copies of the Software, and to permit persons to whom the
	    Software is furnished to do so, subject to the following
	    conditions:

	    The above copyright notice and this permission notice shall be
	    included in all copies or substantial portions of the Software.

	    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
	    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
	    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
	    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
	    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
	    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
	    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
	    OTHER DEALINGS IN THE SOFTWARE.

	This software includes Backoff library under the following license

	    Copyright (C) 2012 Mathieu Turcotte

	    Permission is hereby granted, free of charge, to any person obtaining a copy of
	    this software and associated documentation files (the "Software"), to deal in
	    the Software without restriction, including without limitation the rights to
	    use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
	    of the Software, and to permit persons to whom the Software is furnished to do
	    so, subject to the following conditions:

	    The above copyright notice and this permission notice shall be included in all
	    copies or substantial portions of the Software.

	    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
	    SOFTWARE.

	This software includes Event-to-Promise library under the following license

	    Copyright (c) 2014, Julien Fontanet <julien.fontanet@isonoe.net>.

	    Permission to use, copy, modify, and/or distribute this software for any purpose
	    with or without fee is hereby granted, provided that the above copyright notice
	    and this permission notice appear in all copies.

	    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
	    FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
	    OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
	    TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
	    THIS SOFTWARE.

	*/Object.defineProperty(Mr,"__esModule",{value:!0});var y5=Ds,g5=Ln,m5=_a,b5=ei,w5=Nn,S5=xn,_5=Jr,k5=ti,$5=Ys,T5=Yr,he=$r,Tl=Zo,C5=_l,E5=Zs,I5=qi,XS=ia,ZS=rl,R5=hd,O5=LS;function qr(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function Rp(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}}),n.default=e,Object.freeze(n)}var Te=qr(y5),kt=qr(g5),Et=qr(m5),Fn=qr(b5),Tr=qr(w5),Na=qr(S5),Qt=qr(_5),Rt=qr(k5),G=qr($5),e_=qr(T5),A5=qr(C5),P5=Rp(E5),t_=qr(I5),M5=Rp(ZS),pu=qr(R5),Cl=Rp(O5);function $t(e,n,t,r){var a=arguments.length,i=a<3?n:r===null?r=Object.getOwnPropertyDescriptor(n,t):r,s;if((typeof Reflect>"u"?"undefined":e_.default(Reflect))==="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(i=(a<3?s(i):a>3?s(n,t,i):s(n,t))||i);return a>3&&i&&Object.defineProperty(n,t,i),i}function we(e,n){if((typeof Reflect>"u"?"undefined":e_.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,n)}var N5;function xa(){}xa.prototype=Object.create(null);function Ot(){Ot.init.call(this)}Ot.EventEmitter=Ot,Ot.usingDomains=!1,Ot.prototype.domain=void 0,Ot.prototype._events=void 0,Ot.prototype._maxListeners=void 0,Ot.defaultMaxListeners=10,Ot.init=function(){this.domain=null,Ot.usingDomains&&N5.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new xa,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ot.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this};function r_(e){return e._maxListeners===void 0?Ot.defaultMaxListeners:e._maxListeners}Ot.prototype.getMaxListeners=function(){return r_(this)};function x5(e,n,t){if(n)e.call(t);else for(var r=e.length,a=vu(e,r),i=0;i<r;++i)a[i].call(t)}function L5(e,n,t,r){if(n)e.call(t,r);else for(var a=e.length,i=vu(e,a),s=0;s<a;++s)i[s].call(t,r)}function j5(e,n,t,r,a){if(n)e.call(t,r,a);else for(var i=e.length,s=vu(e,i),o=0;o<i;++o)s[o].call(t,r,a)}function U5(e,n,t,r,a,i){if(n)e.call(t,r,a,i);else for(var s=e.length,o=vu(e,s),u=0;u<s;++u)o[u].call(t,r,a,i)}function F5(e,n,t,r){if(n)e.apply(t,r);else for(var a=e.length,i=vu(e,a),s=0;s<a;++s)i[s].apply(t,r)}Ot.prototype.emit=function(n){var t,r,a,i,s,o,u,l=n==="error";if(o=this._events,o)l=l&&o.error==null;else if(!l)return!1;if(u=this.domain,l){if(t=arguments[1],u)t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=u,t.domainThrown=!1,u.emit("error",t);else{if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return!1}if(r=o[n],!r)return!1;var p=typeof r=="function";switch(a=arguments.length,a){case 1:x5(r,p,this);break;case 2:L5(r,p,this,arguments[1]);break;case 3:j5(r,p,this,arguments[1],arguments[2]);break;case 4:U5(r,p,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(a-1),s=1;s<a;s++)i[s-1]=arguments[s];F5(r,p,this,i)}return!0};function n_(e,n,t,r){var a,i,s;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(i=e._events,i?(i.newListener&&(e.emit("newListener",n,t.listener?t.listener:t),i=e._events),s=i[n]):(i=e._events=new xa,e._eventsCount=0),!s)s=i[n]=t,++e._eventsCount;else if(typeof s=="function"?s=i[n]=r?[t,s]:[s,t]:r?s.unshift(t):s.push(t),!s.warned&&(a=r_(e),a&&a>0&&s.length>a)){s.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=n,o.count=s.length,D5(o)}return e}function D5(e){typeof console.warn=="function"?console.warn(e):console.log(e)}Ot.prototype.addListener=function(n,t){return n_(this,n,t,!1)},Ot.prototype.on=Ot.prototype.addListener,Ot.prototype.prependListener=function(n,t){return n_(this,n,t,!0)};function a_(e,n,t){var r=!1;function a(){e.removeListener(n,a),r||(r=!0,t.apply(e,arguments))}return a.listener=t,a}Ot.prototype.once=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.on(n,a_(this,n,t)),this},Ot.prototype.prependOnceListener=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(n,a_(this,n,t)),this},Ot.prototype.removeListener=function(n,t){var r,a,i,s,o;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(a=this._events,!a)return this;if(r=a[n],!r)return this;if(r===t||r.listener&&r.listener===t)--this._eventsCount===0?this._events=new xa:(delete a[n],a.removeListener&&this.emit("removeListener",n,r.listener||t));else if(typeof r!="function"){for(i=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;if(r.length===1){if(r[0]=void 0,--this._eventsCount===0)return this._events=new xa,this;delete a[n]}else B5(r,i);a.removeListener&&this.emit("removeListener",n,o||t)}return this},Ot.prototype.off=function(e,n){return this.removeListener(e,n)},Ot.prototype.removeAllListeners=function(n){var t,r;if(r=this._events,!r)return this;if(!r.removeListener)return arguments.length===0?(this._events=new xa,this._eventsCount=0):r[n]&&(--this._eventsCount===0?this._events=new xa:delete r[n]),this;if(arguments.length===0){for(var a=Object.keys(r),i=0,s;i<a.length;++i)s=a[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new xa,this._eventsCount=0,this}if(t=r[n],typeof t=="function")this.removeListener(n,t);else if(t)do this.removeListener(n,t[t.length-1]);while(t[0]);return this},Ot.prototype.listeners=function(n){var t,r,a=this._events;return a?(t=a[n],t?typeof t=="function"?r=[t.listener||t]:r=q5(t):r=[]):r=[],r},Ot.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):i_.call(e,n)},Ot.prototype.listenerCount=i_;function i_(e){var n=this._events;if(n){var t=n[e];if(typeof t=="function")return 1;if(t)return t.length}return 0}Ot.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function B5(e,n){for(var t=n,r=t+1,a=e.length;r<a;t+=1,r+=1)e[t]=e[r];e.pop()}function vu(e,n){for(var t=new Array(n);n--;)t[n]=e[n];return t}function q5(e){for(var n=new Array(e.length),t=0;t<n.length;++t)n[t]=e[t].listener||e[t];return n}var rs=function(){function e(n){kt.default(this,e),this.base=n,this.args=new Array,this.paths=new Array}return Et.default(e,[{key:"pathSegment",value:function(t){return this.paths.push(encodeURIComponent(t)),this}},{key:"queryParam",value:function(t,r){return typeof r<"u"&&this.args.push(encodeURIComponent(t)+"="+encodeURIComponent(r)),this}},{key:"build",value:function(){var t=this.base;return this.paths.length&&(t+="/"+this.paths.join("/")),this.args.length&&(t+="?"+this.args.join("&")),t}}]),e}();function s_(e){var n=W5();return function(){var r=Qt.default(e),a;if(n){var i=Qt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return Na.default(this,a)}}function W5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Nr=function(e){Tr.default(t,e);var n=s_(t);function t(r){var a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return kt.default(this,t),a=n.call(this),a.name=a.constructor.name,a.message="".concat(r," (status: ").concat(i,", code: ").concat(s,")"),a.status=i,a.code=s,a}return t}(A5.default(Error)),z5=function(e){Tr.default(t,e);var n=s_(t);function t(r){var a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;return kt.default(this,t),a=n.call(this,r,i,s),a.body=o,a}return t}(Nr);function hn(e){return JSON.parse(JSON.stringify(e))}function u_(e){var n=e===void 0||Op(e);if(!n)throw new Nr("Invalid pageSize parameter. Expected a positive integer, was '".concat(e,"'."),400,20007)}function G5(e){return!isNaN(parseInt(e))&&isFinite(e)}function Op(e){return G5(e)&&e>0}var ns=P5.getLogger("twilio-sync");function hu(e,n){return["".concat(new Date().toISOString()," Sync ").concat(e,":")].concat(Array.from(n))}var Tt={setLevel:function(n){ns.setLevel(n)},trace:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];ns.trace.apply(null,hu("T",t))},debug:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];ns.debug.apply(null,hu("D",t))},info:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];ns.info.apply(null,hu("I",t))},warn:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];ns.warn.apply(null,hu("W",t))},error:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];ns.error.apply(null,hu("E",t))}},H5="/v4/Subscriptions",V5="/v3/Maps",K5="/v3/Lists",Y5="/v3/Documents",J5="/v3/Streams",Q5="/v3/Insights";function X5(e,n,t){return e&&typeof e[n]<"u"?e[n]:t}var Z5=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};kt.default(this,e);var t=n.region||"us1",r="https://cds.".concat(t,".twilio.com"),a=n.cdsUri||r;this.settings={subscriptionsUri:a+H5,documentsUri:a+Y5,listsUri:a+K5,mapsUri:a+V5,streamsUri:a+J5,insightsUri:a+Q5,sessionStorageEnabled:X5(n.Sync,"enableSessionStorage",!0),productId:n.productId}}return Et.default(e,[{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"insightsUri",get:function(){return this.settings.insightsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}},{key:"productId",get:function(){return this.settings.productId}}]),e}();function yu(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=e8(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function e8(e,n){if(e){if(typeof e=="string")return o_(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return o_(e,n)}}function o_(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var t8=function(){function e(n){kt.default(this,e),this.localObject=n,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return Et.default(e,[{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"indexName",get:function(){return this.localObject.indexName}},{key:"queryString",get:function(){return this.localObject.queryString}},{key:"isEstablished",get:function(){return this.established}},{key:"update",value:function(t,r){this.localObject._update(t,r)}},{key:"updatePending",value:function(t,r){this.pendingAction=t,this.pendingCorrelationId=r}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}},{key:"markAsFailed",value:function(t){this.rejectedWithError=t.error,this.updatePending(null,null),this.localObject.reportFailure(new Nr("Failed to subscribe on service events: ".concat(t.error.message),t.error.status,t.error.code))}},{key:"complete",value:function(t){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(t)}},{key:"setSubscriptionState",value:function(t){this.localObject._setSubscriptionState(t)}}]),e}(),r8=function(){function e(n){var t=this;kt.default(this,e),Rt.default(this,"isConnected",!1),Rt.default(this,"maxBatchSize",100),Rt.default(this,"subscriptionTtlTimer",null),Rt.default(this,"pendingPokeReason",null),this.services=n,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;var r={randomisationFactor:.2,initialDelay:100,maxDelay:2*60*1e3};this.backoff=XS.Backoff.exponential(Object.assign(r,this.services.config.backoffConfig)),this.backoff.on("ready",function(){var a=t.getSubscriptionUpdateBatch(),i=a.action,s=a.subscriptions;i?t.applyNewSubscriptionUpdateBatch(i,s):(t.backoff.reset(),Tt.debug("All subscriptions resolved."))})}return Et.default(e,[{key:"getSubscriptionUpdateBatch",value:function(){function t(i,s,o,u){var l=[],c=yu(i),p;try{for(c.s();!(p=c.n()).done;){var S=t_.default(p.value,2),T=S[0],I=S[1],x=s.get(T);if(!x&&o!==I.pendingAction&&!I.rejectedWithError&&(l.push(I),u&&l.length>=u))break}}catch(U){c.e(U)}finally{c.f()}return l}var r=t(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(r.length>0)return{action:"establish",subscriptions:r};var a=t(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return a.length>0?{action:"cancel",subscriptions:a}:{action:null,subscriptions:null}}},{key:"persist",value:function(){this.backoff.backoff()}},{key:"applyNewSubscriptionUpdateBatch",value:function(){var n=Te.default(G.default.mark(function r(a,i){var s=this,o,u,l,c,p,S,T,I,x,U,F,V,Ae,de,Ge,Ee;return G.default.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(this.isConnected){B.next=4;break}return Tt.debug("Twilsock connection (required for subscription) not ready; waitingâ¦"),this.backoff.reset(),B.abrupt("return");case 4:i=this.processLocalActions(a,i),o=new Date().getTime(),u=yu(i);try{for(u.s();!(l=u.n()).done;)c=l.value,this.recordActionAttemptOn(c,a,o)}catch(ce){u.e(ce)}finally{u.f()}return p=this.pendingPokeReason,this.pendingPokeReason=null,B.prev=10,B.next=13,this.request(a,o,p,i);case 13:S=B.sent,T=S.body.max_batch_size,!isNaN(parseInt(T))&&isFinite(T)&&T>0&&(this.maxBatchSize=T),this.subscriptionTtlTimer||(I=S.body.ttl_in_s,x=!isNaN(parseFloat(I))&&isFinite(I),U=x&&I>0,U&&(this.subscriptionTtlTimer=setTimeout(function(){return s.onSubscriptionTtlElapsed()},I*1e3))),a==="establish"&&(F=S.body.estimated_delivery_in_ms,V=!isNaN(parseFloat(F))&&isFinite(F),Ae=V&&F>0,Ae?setTimeout(function(){return s.verifyPokeDelivery(o,F,i)},F):Tt.error("Invalid timeout: ".concat(F)),i.filter(function(ce){return ce.pendingCorrelationId===o}).forEach(function(ce){return ce.setSubscriptionState("response_in_flight")})),this.backoff.reset(),B.next=26;break;case 21:B.prev=21,B.t0=B.catch(10),de=yu(i);try{for(de.s();!(Ge=de.n()).done;)Ee=Ge.value,this.recordActionFailureOn(Ee,a)}catch(ce){de.e(ce)}finally{de.f()}B.t0 instanceof Tl.TransportUnavailableError?(Tt.debug("Twilsock connection (required for subscription) not ready (c:".concat(o,"); waitingâ¦")),this.backoff.reset()):(Tt.debug("Failed an attempt to ".concat(a," subscriptions (c:").concat(o,"); retrying"),B.t0),this.persist());case 26:case"end":return B.stop()}},r,this,[[10,21]])}));function t(r,a){return n.apply(this,arguments)}return t}()},{key:"verifyPokeDelivery",value:function(t,r,a){var i=this,s=this.latestPokeResponseArrivalTimestampByCorrelationId.get(t),o=s?new Date().getTime()-s:r;if(o>=r)a.filter(function(l){return l.pendingCorrelationId===t}).forEach(function(l){l.updatePending(null,null),l.retryCount++,i.persisted.delete(l.sid)}),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(t);else{var u=r-o;setTimeout(function(){return i.verifyPokeDelivery(t,r,a)},u)}}},{key:"processLocalActions",value:function(t,r){return t==="cancel"?r.filter(function(a){return!a.rejectedWithError}):r}},{key:"recordActionAttemptOn",value:function(t,r,a){if(t.setSubscriptionState("request_in_flight"),r==="establish")this.persisted.set(t.sid,t),t.updatePending(r,a);else{var i=this.persisted.get(t.sid);i&&i.updatePending(r,a)}}},{key:"recordActionFailureOn",value:function(t,r){t.setSubscriptionState("none"),t.updatePending(null,null),r==="establish"&&this.persisted.delete(t.sid)}},{key:"request",value:function(t,r,a,i){var s=i.map(function(l){return{object_sid:l.sid,object_type:l.type,last_event_id:t==="establish"?l.lastEventId:void 0,index_name:t==="establish"?l.indexName:void 0,query_string:t==="establish"?l.queryString:void 0}}),o=i.filter(function(l){return l.retryCount>0}).length;Tt.debug("Attempting '".concat(t,"' request (c:").concat(r,"):"),s);var u={event_protocol_version:4,action:t,correlation_id:r,retried_requests:o,ttl_in_s:-1,requests:s};return a==="ttl"&&(u.reason=a),this.services.network.post(this.services.config.subscriptionsUri,u)}},{key:"add",value:function(t,r){Tt.debug("Establishing intent to subscribe to ".concat(t));var a=this.subscriptions.get(t);a&&r&&a.lastEventId===r.lastEventId||(this.persisted.delete(t),this.subscriptions.set(t,new t8(r)),this.persist())}},{key:"remove",value:function(t){Tt.debug("Establishing intent to unsubscribe from ".concat(t));var r=this.subscriptions.delete(t);r&&this.persist()}},{key:"acceptMessage",value:function(t,r){Tt.trace("Subscriptions received",t);var a=t.event_type,i=typeof t.events<"u"?t.events:[t.event],s=t.correlation_id;s&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(s,new Date().getTime());var o=yu(i),u;try{for(o.s();!(u=o.n()).done;){var l=u.value,c=void 0;switch(t.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(l,s);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(l,s);break;case"subscription_failed":this.applySubscriptionFailedMessage(l,s);break;case(c=a.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:{var p=void 0;switch(c[0]){case"map_":p=l.map_sid;break;case"list_":p=l.list_sid;break;case"document_":p=l.document_sid;break;case"stream_":p=l.stream_sid;break;case"live_query_":p=l.query_id,r=!1,t.strictly_ordered===!0&&(r=!0);break;default:p=void 0}this.applyEventToSubscribedEntity(p,l,a,r);break}default:Tt.debug("Dropping unknown message type ".concat(a));break}}}catch(S){o.e(S)}finally{o.f()}}},{key:"applySubscriptionEstablishedMessage",value:function(t,r){var a=t.object_sid,i=this.persisted.get(t.object_sid);i&&i.pendingCorrelationId===r?t.replay_status==="interrupted"?(Tt.debug("Event Replay for subscription to ".concat(a," (c:").concat(r,") interrupted; continuing eagerly.")),i.updatePending(null,null),this.persisted.delete(i.sid),this.backoff.reset()):t.replay_status==="completed"&&(Tt.debug("Event Replay for subscription to ".concat(a," (c:").concat(r,") completed. Subscription is ready.")),i.complete(t.last_event_id),this.persisted.set(t.object_sid,i),i.setSubscriptionState("established"),this.backoff.reset()):Tt.debug("Late message for ".concat(t.object_sid," (c:").concat(r,") dropped.")),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(t,r){var a=this.persisted.get(t.object_sid);a&&a.pendingCorrelationId===r?(a.updatePending(null,null),a.setSubscriptionState("none"),this.persisted.delete(t.object_sid)):Tt.debug("Late message for ".concat(t.object_sid," (c:").concat(r,") dropped.")),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(t,r){var a=t.object_sid,i=this.subscriptions.get(a),s=this.persisted.get(a);i&&s?s.pendingCorrelationId===r&&(Tt.error("Failed to subscribe on ".concat(s.sid),t.error),s.markAsFailed(t),s.setSubscriptionState("none")):!i&&s&&(this.persisted.delete(a),s.setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(t,r,a,i){var s=this;if(t){i=i||function(){var u=s.persisted.get(t);return u&&u.isEstablished}();var o=this.subscriptions.get(t);o?(r.type=a,o.update(r,i)):Tt.debug("Message dropped for SID '".concat(t,"', for which there is no subscription."))}}},{key:"onConnectionStateChanged",value:function(t){this.isConnected=t,t&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(t){Tt.debug("Triggering event replay for all subscriptions, reason=".concat(t)),this.pendingPokeReason=t,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var r=[],a=yu(this.persisted.values()),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;s.reset(),s.rejectedWithError&&r.push(s)}}catch(c){a.e(c)}finally{a.f()}this.persisted.clear();for(var o=0,u=r;o<u.length;o++){var l=u[o];this.persisted.set(l.sid,l)}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}(),n8=4e3,a8=6e4,i8=9e4,s8=.2;function l_(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function c_(e){return e.body?e.body.code:0}function gu(e){return e.status===409?new z5(l_(e),e.status,c_(e),e.body):e.status?new Nr(l_(e),e.status,c_(e)):e instanceof Tl.TransportUnavailableError?e:new Nr(e.message,0,0)}var u8=function(){function e(n,t,r){kt.default(this,e),this.clientInfo=n,this.config=t,this.transport=r}return Et.default(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+M5.v4().replace(/-/g,"")}}},{key:"backoffConfig",value:function(){return Object.assign({min:n8,max:a8,maxAttemptsTime:i8,randomness:s8},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(t){var r=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return new Promise(function(i,s){var o=[502,503,504];a&&o.push(429);var u=new XS.Retrier(r.backoffConfig());u.on("attempt",function(){t().then(function(l){return u.succeeded(l)}).catch(function(l){if(o.includes(l.status)){var c=parseInt(l.headers?l.headers["Retry-After"]:null);u.failed(gu(l),isNaN(c)?null:c*1e3)}else l.message==="Twilsock disconnected"?u.failed(gu(l)):(u.removeAllListeners(),u.cancel(),s(gu(l)))})}),u.on("succeeded",function(l){i(l)}),u.on("cancelled",function(l){return s(gu(l))}),u.on("failed",function(l){return s(gu(l))}),u.start()})}},{key:"get",value:function(t){var r=this,a=this.createHeaders();return Tt.debug("GET",t,"ID:",a["Twilio-Request-Id"]),this.executeWithRetry(function(){return r.transport.get(t,a,r.config.productId)},!0)}},{key:"post",value:function(t,r,a){var i=this,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=this.createHeaders();return typeof a<"u"&&a!==null&&(o["If-Match"]=a),Tt.debug("POST",t,"ID:",o["Twilio-Request-Id"]),this.executeWithRetry(function(){return i.transport.post(t,o,r,i.config.productId)},s)}},{key:"put",value:function(t,r,a){var i=this,s=this.createHeaders();return typeof a<"u"&&a!==null&&(s["If-Match"]=a),Tt.debug("PUT",t,"ID:",s["Twilio-Request-Id"]),this.executeWithRetry(function(){return i.transport.put(t,s,r,i.config.productId)},!1)}},{key:"delete",value:function(t){var r=this,a=this.createHeaders();return Tt.debug("DELETE",t,"ID:",a["Twilio-Request-Id"]),this.executeWithRetry(function(){return r.transport.delete(t,a,r.config.productId)},!1)}}]),e}(),o8=function(){function e(n,t){kt.default(this,e),this.config=n,this.storageId=null;try{this.storage=t||sessionStorage}catch{}}return Et.default(e,[{key:"storageKey",value:function(t,r){return"".concat(this.storageId,"::").concat(t,"::").concat(r)}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}},{key:"updateStorageId",value:function(t){this.storageId=t}},{key:"store",value:function(t,r,a){return this.isReady?this._store(this.storageKey(t,r),a):null}},{key:"read",value:function(t,r){return this.isReady?this._read(this.storageKey(t,r)):null}},{key:"remove",value:function(t,r,a){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(t,r)),a&&this.storage.removeItem(this.storageKey(t,a))}catch{}}},{key:"update",value:function(t,r,a,i){if(!this.isReady)return null;this._apply(this.storageKey(t,r),i),a&&this._apply(this.storageKey(t,a),i)}},{key:"_store",value:function(t,r){try{this.storage.setItem(t,JSON.stringify(r))}catch{}}},{key:"_read",value:function(t){try{var r=this.storage.getItem(t);if(r)return JSON.parse(r)}catch{}return null}},{key:"_apply",value:function(t,r){var a=this._read(t);if(!a)return!1;this._store(t,Object.assign(a,r))}}]),e}();function l8(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=c8(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function c8(e,n){if(e){if(typeof e=="string")return f_(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f_(e,n)}}function f_(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var mu=function(){function e(n,t){kt.default(this,e),this.services=n,this.removalHandler=t,this.subscriptionState="none",this._attachedListeners=new Map}return Et.default(e,[{key:"_advanceLastEventId",value:function(t,r){}},{key:"reportFailure",value:function(t){t.status===404?this.onRemoved(!1):this.broadcastEventToListeners("failure",t)}},{key:"_subscribe",value:function(){this.services.router._subscribe(this.sid,this)}},{key:"_unsubscribe",value:function(){this.services.router._unsubscribe(this.sid)}},{key:"_setSubscriptionState",value:function(t){this.subscriptionState=t,this.broadcastEventToListeners("_subscriptionStateChanged",t)}},{key:"close",value:function(){this._unsubscribe(),this.removalHandler!=null&&this.removalHandler(this.type,this.sid,this.uniqueName)}},{key:"attach",value:function(t){var r=t.listenerUuid,a=this._attachedListeners.get(r);a||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(r,t))}},{key:"detach",value:function(t){this._attachedListeners.delete(t),this._attachedListeners.size||this.close()}},{key:"broadcastEventToListeners",value:function(t,r){var a=l8(this._attachedListeners.values()),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;s.emit(t,r)}}catch(o){a.e(o)}finally{a.f()}}}]),e}(),d_=function(){function e(n){kt.default(this,e),Rt.default(this,"queuedRequests",[]),Rt.default(this,"isRequestInFlight",!1),this.inputMergingFunction=n}return Et.default(e,[{key:"add",value:function(t,r){var a=this,i=new Promise(function(s,o){return a.queuedRequests.push({input:t,requestFunction:r,resolve:s,reject:o})});return this.wakeupQueue(),i}},{key:"squashAndAdd",value:function(t,r){var a=this.queuedRequests;this.queuedRequests=[];var i;a.length>0?(i=a.map(function(o){return o.input}).reduce(this.inputMergingFunction),i=this.inputMergingFunction(i,t)):i=t;var s=this.add(i,r);return a.forEach(function(o){return s.then(o.resolve,o.reject)}),s}},{key:"isEmpty",value:function(){return this.queuedRequests.length===0&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var t=this;if(!(this.queuedRequests.length===0||this.isRequestInFlight)){var r=this.queuedRequests.shift();this.isRequestInFlight=!0,r.requestFunction(r.input).then(r.resolve,r.reject).then(function(a){t.isRequestInFlight=!1,t.wakeupQueue()})}}}]),e}(),p_=function(){function e(n){kt.default(this,e),Rt.default(this,"queueByNamespaceKey",new Map),this.inputReducer=n}return Et.default(e,[{key:"add",value:function(){var n=Te.default(G.default.mark(function r(a,i,s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.invokeQueueMethod(a,function(l){return l.add(i,s)}));case 1:case"end":return u.stop()}},r,this)}));function t(r,a,i){return n.apply(this,arguments)}return t}()},{key:"squashAndAdd",value:function(){var n=Te.default(G.default.mark(function r(a,i,s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.invokeQueueMethod(a,function(l){return l.squashAndAdd(i,s)}));case 1:case"end":return u.stop()}},r,this)}));function t(r,a,i){return n.apply(this,arguments)}return t}()},{key:"invokeQueueMethod",value:function(){var n=Te.default(G.default.mark(function r(a,i){var s,o;return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.queueByNamespaceKey.has(a)||this.queueByNamespaceKey.set(a,new d_(this.inputReducer)),s=this.queueByNamespaceKey.get(a),o=i(s),this.queueByNamespaceKey.get(a).isEmpty()&&this.queueByNamespaceKey.delete(a),l.abrupt("return",o);case 5:case"end":return l.stop()}},r,this)}));function t(r,a){return n.apply(this,arguments)}return t}()}]),e}();function f8(e){var n=d8();return function(){var r=Qt.default(e),a;if(n){var i=Qt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return Na.default(this,a)}}function d8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bu=function(e){Tr.default(t,e);var n=f8(t);function t(){var r;return kt.default(this,t),r=n.call(this),r.closed=!1,r.uuid=ZS.v4(),r}return Et.default(t,[{key:"listenerUuid",get:function(){return this.uuid}},{key:"close",value:function(){this.removeAllListeners(),this.closed=!0}},{key:"ensureNotClosed",value:function(){if(this.closed)throw new Error("Invalid operation on closed object")}}]),t}(Ot);function v_(e){var n=p8();return function(){var r=Qt.default(e),a;if(n){var i=Qt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return Na.default(this,a)}}function p8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ap=function(e){Tr.default(t,e);var n=v_(t);function t(r,a,i){var s;kt.default(this,t),s=n.call(this,r,i),Rt.default(Fn.default(s),"isDeleted",!1);var o=function(l,c){return typeof c.ttl=="number"?{ttl:c.ttl}:l};return s.updateMergingQueue=new d_(o),s.descriptor=a,s.descriptor.data=s.descriptor.data||{},s.descriptor.date_updated=new Date(s.descriptor.date_updated),s}return Et.default(t,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"_update",value:function(a){switch(a.date_created=new Date(a.date_created),a.type){case"document_updated":if(a.id<=this.lastEventId){Tt.trace("Document update skipped, current:",this.lastEventId,", remote:",a.id);break}var i=this.descriptor.data!==void 0?hn(this.descriptor.data):null;this.descriptor.last_event_id=a.id,this.descriptor.revision=a.document_revision,this.descriptor.date_updated=a.date_created,this.descriptor.data=a.document_data,this.broadcastEventToListeners("updated",{data:a.document_data,isLocal:!1,previousData:i}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:a.id,revision:a.document_revision,date_updated:a.date_created,data:a.document_data});break;case"document_removed":this.onRemoved(!1);break}}},{key:"set",value:function(){var r=Te.default(G.default.mark(function i(s,o){var u=this,l;return G.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return l=o||{},p.abrupt("return",this.updateMergingQueue.squashAndAdd(l,function(S){return u._setUnconditionally(s,S.ttl)}));case 2:case"end":return p.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=Te.default(G.default.mark(function i(s,o){var u=this,l;return G.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return l=o||{},p.abrupt("return",this.updateMergingQueue.add(l,function(S){return u._setWithIfMatch(s,S.ttl)}));case 2:case"end":return p.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=Te.default(G.default.mark(function i(s,o){return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.mutate(function(c){return Object.assign(c,s)},o));case 1:case"end":return l.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=Te.default(G.default.mark(function i(s){var o;return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._postUpdateToServer({ttl:s});case 2:o=l.sent,this.descriptor.date_expires=o.date_expires;case 4:case"end":return l.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_setUnconditionally",value:function(){var r=Te.default(G.default.mark(function i(s,o){var u;return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this._postUpdateToServer({data:s,revision:void 0,ttl:o});case 2:return u=c.sent,this._handleSuccessfulUpdateResult(u),c.abrupt("return",this.descriptor.data);case 5:case"end":return c.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"_setWithIfMatch",value:function(){var r=Te.default(G.default.mark(function i(s,o){var u,l,c;return G.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(u=s(hn(this.descriptor.data)),!u){S.next=22;break}return l=this.revision,S.prev=3,S.next=6,this._postUpdateToServer({data:u,revision:l,ttl:o});case 6:return c=S.sent,this._handleSuccessfulUpdateResult(c),S.abrupt("return",this.descriptor.data);case 11:if(S.prev=11,S.t0=S.catch(3),S.t0.status!==412){S.next=19;break}return S.next=16,this._softSync();case 16:return S.abrupt("return",this._setWithIfMatch(s));case 19:throw S.t0;case 20:S.next=23;break;case 22:return S.abrupt("return",this.descriptor.data);case 23:case"end":return S.stop()}},i,this,[[3,11]])}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"_handleSuccessfulUpdateResult",value:function(a){if(!(a.last_event_id<=this.descriptor.last_event_id)){var i=this.descriptor.data!==void 0?hn(this.descriptor.data):null;this.descriptor.revision=a.revision,this.descriptor.data=a.data,this.descriptor.last_event_id=a.last_event_id,this.descriptor.date_expires=a.date_expires,this.descriptor.date_updated=new Date(a.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:a.last_event_id,revision:a.revision,date_updated:a.date_updated,data:a.data}),this.broadcastEventToListeners("updated",{data:this.descriptor.data,isLocal:!0,previousData:i})}}},{key:"_postUpdateToServer",value:function(){var r=Te.default(G.default.mark(function i(s){var o,u,l;return G.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.isDeleted){p.next=17;break}return o={data:s.data},s.ttl!==void 0&&(o.ttl=s.ttl),u=s.revision,p.prev=4,p.next=7,this.services.network.post(this.uri,o,u);case 7:return l=p.sent,p.abrupt("return",{revision:l.body.revision,data:s.data,last_event_id:l.body.last_event_id,date_updated:l.body.date_updated,date_expires:l.body.date_expires});case 11:throw p.prev=11,p.t0=p.catch(4),p.t0.status===404&&this.onRemoved(!1),p.t0;case 15:p.next=18;break;case 17:return p.abrupt("return",Promise.reject(new Nr("The Document has been removed",404,54100)));case 18:case"end":return p.stop()}},i,this,[[4,11]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_softSync",value:function(){var r=Te.default(G.default.mark(function i(){var s=this;return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.services.network.get(this.uri).then(function(l){var c={type:"document_updated",id:l.body.last_event_id,document_revision:l.body.revision,document_data:l.body.data,date_created:l.body.date_updated};return s._update(c),s}).catch(function(l){l.status===404?s.onRemoved(!1):Tt.error("Can't get updates for ".concat(s.sid,":"),l)}));case 1:case"end":return u.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"onRemoved",value:function(a){if(!this.isDeleted){var i=this.descriptor.data!==void 0?hn(this.descriptor.data):null;this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a,previousData:i})}}},{key:"removeDocument",value:function(){var r=Te.default(G.default.mark(function i(){return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.isDeleted){o.next=6;break}return o.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),o.next=7;break;case 6:return o.abrupt("return",Promise.reject(new Nr("The Document has been removed",404,54100)));case 7:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()}],[{key:"type",get:function(){return"document"}}]),t}(mu),Qr=function(e){Tr.default(t,e);var n=v_(t);function t(r){var a;return kt.default(this,t),a=n.call(this),a.syncDocumentImpl=r,a.syncDocumentImpl.attach(Fn.default(a)),a}return Et.default(t,[{key:"uri",get:function(){return this.syncDocumentImpl.uri}},{key:"revision",get:function(){return this.syncDocumentImpl.revision}},{key:"lastEventId",get:function(){return this.syncDocumentImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncDocumentImpl.dateExpires}},{key:"type",get:function(){return Ap.type}},{key:"sid",get:function(){return this.syncDocumentImpl.sid}},{key:"data",get:function(){return this.syncDocumentImpl.data}},{key:"dateUpdated",get:function(){return this.syncDocumentImpl.dateUpdated}},{key:"uniqueName",get:function(){return this.syncDocumentImpl.uniqueName}},{key:"set",value:function(){var r=Te.default(G.default.mark(function i(s,o){return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.ensureNotClosed(),l.abrupt("return",this.syncDocumentImpl.set(s,o));case 2:case"end":return l.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=Te.default(G.default.mark(function i(s,o){return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.ensureNotClosed(),l.abrupt("return",this.syncDocumentImpl.mutate(s,o));case 2:case"end":return l.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=Te.default(G.default.mark(function i(s,o){return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.ensureNotClosed(),l.abrupt("return",this.syncDocumentImpl.update(s,o));case 2:case"end":return l.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncDocumentImpl.setTtl(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"removeDocument",value:function(){var r=Te.default(G.default.mark(function i(){return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.ensureNotClosed(),o.abrupt("return",this.syncDocumentImpl.removeDocument());case 2:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"close",value:function(){pu.default(Qt.default(t.prototype),"close",this).call(this),this.syncDocumentImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return Ap.type}}]),t}(bu);Rt.default(Qr,"removed","removed"),Rt.default(Qr,"updated","updated"),$t([he.validateTypesAsync(he.pureObject,["undefined",he.objectSchema("document metadata",{ttl:[he.nonNegativeInteger,"undefined"]})]),we("design:type",Function),we("design:paramtypes",[Object,Object]),we("design:returntype",Promise)],Qr.prototype,"set",null),$t([he.validateTypesAsync("function",["undefined",he.objectSchema("document metadata",{ttl:[he.nonNegativeInteger,"undefined"]})]),we("design:type",Function),we("design:paramtypes",[Function,Object]),we("design:returntype",Promise)],Qr.prototype,"mutate",null),$t([he.validateTypesAsync(he.pureObject,["undefined",he.objectSchema("document metadata",{ttl:[he.nonNegativeInteger,"undefined"]})]),we("design:type",Function),we("design:paramtypes",[Object,Object]),we("design:returntype",Promise)],Qr.prototype,"update",null),$t([he.validateTypesAsync(he.nonNegativeInteger),we("design:type",Function),we("design:paramtypes",[Number]),we("design:returntype",Promise)],Qr.prototype,"setTtl",null);var Pp=function(){function e(n){kt.default(this,e),this.descriptor=n}return Et.default(e,[{key:"uri",get:function(){return this.descriptor.uri}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.lastEventId}},{key:"dateUpdated",get:function(){return this.descriptor.dateUpdated}},{key:"dateExpires",get:function(){return this.descriptor.dateExpires}},{key:"index",get:function(){return this.descriptor.index}},{key:"data",get:function(){return this.descriptor.data}},{key:"update",value:function(t,r,a,i){return this.descriptor.lastEventId=t,this.descriptor.revision=r,this.descriptor.data=a,this.descriptor.dateUpdated=i,this}},{key:"updateDateExpires",value:function(t){this.descriptor.dateExpires=t}}]),e}(),Mp=function(){function e(n,t,r,a){kt.default(this,e),this.prevToken=r,this.nextToken=a,this.items=n,this.source=t}return Et.default(e,[{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}},{key:"nextPage",value:function(){var n=Te.default(G.default.mark(function r(){return G.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.hasNextPage){i.next=2;break}throw new Error("No next page");case 2:return i.abrupt("return",this.source(this.nextToken));case 3:case"end":return i.stop()}},r,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"prevPage",value:function(){var n=Te.default(G.default.mark(function r(){return G.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.hasPrevPage){i.next=2;break}throw new Error("No previous page");case 2:return i.abrupt("return",this.source(this.prevToken));case 3:case"end":return i.stop()}},r,this)}));function t(){return n.apply(this,arguments)}return t}()}]),e}();function v8(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=h8(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function h8(e,n){if(e){if(typeof e=="string")return h_(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return h_(e,n)}}function h_(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var y8=function(){function e(n,t){kt.default(this,e),this.balanceFactor=0,this.key=n,this.value=t,this.parent=null,this.left=null,this.right=null}return Et.default(e,[{key:"isRoot",get:function(){return this.parent===null}},{key:"isLeaf",get:function(){return this.left===null&&this.right===null}},{key:"isLeftChild",get:function(){return this.parent.left===this}},{key:"update",value:function(t){this.value=t}},{key:"replace",value:function(t,r){t&&(this.left===r?this.left=r:this.right===r&&(this.right=r))}}]),e}(),g8=function(){function e(n,t){kt.default(this,e),this.isLessThan=n||function(r,a){return r<a},this.isEqual=t||function(r,a){return r===a},this.root=null,this.count=null}return Et.default(e,[{key:"size",get:function(){return this.count}},{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(t,r){var a=this.getNode(t);a?a.update(r):this.insert(t,r)}},{key:"insert",value:function(t,r){var a=new y8(t,r);if(this.count++,!this.root){this.root=a;return}for(var i=this.root;;)if(this.isLessThan(t,i.key))if(i.left)i=i.left;else{i.left=a;break}else if(i.right)i=i.right;else{i.right=a;break}for(a.parent=i,i=a;i.parent;){var s=i.parent,o=s.balanceFactor;if(i.isLeftChild?s.balanceFactor++:s.balanceFactor--,Math.abs(s.balanceFactor)<Math.abs(o))break;if(s.balanceFactor<-1||s.balanceFactor>1){this.rebalance(s);break}i=s}}},{key:"get",value:function(t){for(var r=this.root;r;){if(this.isEqual(t,r.key))return r.value;this.isLessThan(t,r.key)?r=r.left:r=r.right}return null}},{key:"delete",value:function(t){var r=this.getNode(t);if(!r||r.key!==t)return null;var a=r.parent,i=r.left,s=r.right;if(!!i!=!!s){var o=i||s;!a&&!o?this.root=null:a&&!o?this.root=o:(a.replace(r,null),this.rebalance(a))}else{for(var u=r.left;u.right;)u=u.right;if(r.left===u)r.isRoot?(this.root=u,u.parent=null):(r.isLeftChild?r.parent.left=u:r.parent.right=u,u.parent=r.parent),u.right=r.right,u.right.parent=u,u.balanceFactor=r.balanceFactor,r={parent:u,isLeftChild:!0};else{var l=u.parent,c=u.left;l.right=c,c&&(c.parent=l),r.isRoot?(this.root=u,u.parent=null):(r.isLeftChild?r.parent.left=u:r.parent.right=u,u.parent=r.parent),u.right=r.right,u.right.parent=u,u.left=r.left,u.left.parent=u,u.balanceFactor=r.balanceFactor,r={parent:l,isLeftChild:!1}}}for(this.count--;r.parent;){var p=r.parent,S=p.balanceFactor;if(r.isLeftChild?p.balanceFactor-=1:p.balanceFactor+=1,Math.abs(p.balanceFactor)>Math.abs(S))if(p.balanceFactor<-1||p.balanceFactor>1)if(this.rebalance(p),p.parent.balanceFactor===0)r=p.parent;else break;else break;else r=p}return null}},{key:"getNode",value:function(t){for(var r=this.root;r;){if(this.isEqual(t,r.key))return r;this.isLessThan(t,r.key)?r=r.left:r=r.right}return null}},{key:"rebalance",value:function(t){t.balanceFactor<0?t.right.balanceFactor>0?(this.rotateRight(t.right),this.rotateLeft(t)):this.rotateLeft(t):t.balanceFactor>0&&(t.left.balanceFactor<0?(this.rotateLeft(t.left),this.rotateRight(t)):this.rotateRight(t))}},{key:"rotateLeft",value:function(t){var r=t.right;t.right=r.left,r.left!==null&&(r.left.parent=t),r.parent=t.parent,r.parent===null?this.root=r:t.isLeftChild?r.parent.left=r:r.parent.right=r,r.left=t,t.parent=r,t.balanceFactor=t.balanceFactor+1-Math.min(r.balanceFactor,0),r.balanceFactor=r.balanceFactor+1-Math.max(t.balanceFactor,0)}},{key:"rotateRight",value:function(t){var r=t.left;t.left=r.right,r.right!==null&&(r.right.parent=t),r.parent=t.parent,r.parent===null?this.root=r:t.isLeftChild?r.parent.left=r:r.parent.right=r,r.right=t,t.parent=r,t.balanceFactor=t.balanceFactor-1-Math.min(r.balanceFactor,0),r.balanceFactor=r.balanceFactor-1-Math.max(t.balanceFactor,0)}},{key:Symbol.iterator,value:G.default.mark(function n(){var t,r,a;return G.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:t=v8(this.getIterator()),s.prev=1,t.s();case 3:if((r=t.n()).done){s.next=9;break}return a=r.value,s.next=7,a;case 7:s.next=3;break;case 9:s.next=14;break;case 11:s.prev=11,s.t0=s.catch(1),t.e(s.t0);case 14:return s.prev=14,t.f(),s.finish(14);case 17:case"end":return s.stop()}},n,this,[[1,11,14,17]])})},{key:"getIterator",value:G.default.mark(function n(){var t,r,a,i=arguments;return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:t=i.length>0&&i[0]!==void 0?i[0]:null,r=this.root;case 2:if(!r){o.next=8;break}if(!(this.isEqual(t,r.key)||t===null&&!r.left)){o.next=5;break}return o.abrupt("break",8);case 5:this.isLessThan(t,r.key)||t===null?r=r.left:r=r.right,o.next=2;break;case 8:if(r){o.next=10;break}return o.abrupt("return",null);case 10:a=!0;case 11:if(!a){o.next=29;break}return o.next=14,[r.key,r.value];case 14:if(a=!1,!r.right){o.next=21;break}for(r=r.right;r.left;)r=r.left;a=!0,o.next=27;break;case 21:if(!r.parent){o.next=26;break}a=r.parent.left===r,r=r.parent,o.next=27;break;case 26:return o.abrupt("break",37);case 27:o.next=35;break;case 29:if(!r.parent){o.next=34;break}a=r.parent.left===r,r=r.parent,o.next=35;break;case 34:return o.abrupt("break",37);case 35:o.next=11;break;case 37:return o.abrupt("return",null);case 38:case"end":return o.stop()}},n,this)})},{key:"getReverseIterator",value:G.default.mark(function n(){var t,r,a,i=arguments;return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:t=i.length>0&&i[0]!==void 0?i[0]:null,r=this.root;case 2:if(!r){o.next=8;break}if(!(this.isEqual(t,r.key)||t===null&&!r.right)){o.next=5;break}return o.abrupt("break",8);case 5:!this.isLessThan(t,r.key)||t===null?r=r.right:r=r.left,o.next=2;break;case 8:if(r){o.next=10;break}return o.abrupt("return",null);case 10:a=!0;case 11:if(!a){o.next=29;break}return o.next=14,[r.key,r.value];case 14:if(a=!1,!r.left){o.next=21;break}for(r=r.left;r.right;)r=r.right;a=!0,o.next=27;break;case 21:if(!r.parent){o.next=26;break}a=r.parent.right===r,r=r.parent,o.next=27;break;case 26:return o.abrupt("break",37);case 27:o.next=35;break;case 29:if(!r.parent){o.next=34;break}a=r.parent.right===r,r=r.parent,o.next=35;break;case 34:return o.abrupt("break",37);case 35:o.next=11;break;case 37:return o.abrupt("return",null);case 38:case"end":return o.stop()}},n,this)})}]),e}();function m8(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=b8(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var l=t.next();return i=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function b8(e,n){if(e){if(typeof e=="string")return y_(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return y_(e,n)}}function y_(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var w8=function(){function e(n,t){kt.default(this,e),this.value=n,this.revision=t||0}return Et.default(e,[{key:"isValid",get:function(){return!0}}]),e}(),S8=function(){function e(n){kt.default(this,e),this.revision=n}return Et.default(e,[{key:"isValid",get:function(){return!1}}]),e}(),Np=function(){function e(){kt.default(this,e),this.items=new g8}return Et.default(e,[{key:"store",value:function(t,r,a){var i=this.items.get(t);return i&&i.revision>a?i.isValid?i.value:null:(this.items.set(t,new w8(r,a)),r)}},{key:"delete",value:function(t,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.items.get(t);(!i||i.revision<r||i&&a===!0)&&this.items.set(t,new S8(r))}},{key:"isKnown",value:function(t,r){var a=this.items.get(t);return a&&a.revision>=r}},{key:"get",value:function(t){var r=this.items.get(t);return r&&r.isValid?r.value:null}},{key:"has",value:function(t){var r=this.items.get(t);return r&&r.isValid}},{key:"forEach",value:function(t){if(this.items){var r=m8(this.items),a;try{for(r.s();!(a=r.n()).done;){var i=t_.default(a.value,2),s=i[0],o=i[1];o.isValid&&t(s,o.value)}}catch(u){r.e(u)}finally{r.f()}}}}]),e}();function g_(e){var n=_8();return function(){var r=Qt.default(e),a;if(n){var i=Qt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return Na.default(this,a)}}function _8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xp=function(e){Tr.default(t,e);var n=g_(t);function t(r,a,i){var s;kt.default(this,t),s=n.call(this,r,i);var o=function(l,c){return typeof c.ttl=="number"?{ttl:c.ttl}:l};return s.updateMergingQueue=new p_(o),s.cache=new Np,s.descriptor=a,s.descriptor.date_updated=new Date(s.descriptor.date_updated),s}return Et.default(t,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"_addOrUpdateItemOnServer",value:function(){var r=Te.default(G.default.mark(function i(s,o,u,l){var c,p;return G.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return c={data:o},l!==void 0&&(c.ttl=l),T.next=4,this.services.network.post(s,c,u);case 4:return p=T.sent,p.body.data=o,p.body.date_updated=new Date(p.body.date_updated),T.abrupt("return",p.body);case 8:case"end":return T.stop()}},i,this)}));function a(i,s,o,u){return r.apply(this,arguments)}return a}()},{key:"push",value:function(){var r=Te.default(G.default.mark(function i(s,o){var u,l,c;return G.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=(o||{}).ttl,S.next=3,this._addOrUpdateItemOnServer(this.links.items,s,void 0,u);case 3:return l=S.sent,c=Number(l.index),this._handleItemMutated(c,l.url,l.last_event_id,l.revision,s,l.date_updated,l.date_expires,!0,!1),S.abrupt("return",this.cache.get(c));case 7:case"end":return S.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"set",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){var l=this,c;return G.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return c=u||{},S.abrupt("return",this.updateMergingQueue.squashAndAdd(s,c,function(T){return l._updateItemUnconditionally(s,o,T.ttl)}));case 2:case"end":return S.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"_updateItemUnconditionally",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){var l,c;return G.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,this.get(s);case 2:return l=S.sent,S.next=5,this._addOrUpdateItemOnServer(l.uri,o,void 0,u);case 5:return c=S.sent,this._handleItemMutated(s,c.url,c.last_event_id,c.revision,c.data,c.date_updated,c.date_expires,!1,!1),S.abrupt("return",this.cache.get(s));case 8:case"end":return S.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"_updateItemWithIfMatch",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){var l,c,p,S;return G.default.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.get(s);case 2:if(l=I.sent,c=o(hn(l.data)),!c){I.next=25;break}return p=l.revision,I.prev=6,I.next=9,this._addOrUpdateItemOnServer(l.uri,c,p,u);case 9:return S=I.sent,this._handleItemMutated(s,S.url,S.last_event_id,S.revision,S.data,S.date_updated,S.date_expires,!1,!1),I.abrupt("return",this.cache.get(s));case 14:if(I.prev=14,I.t0=I.catch(6),I.t0.status!==412){I.next=22;break}return I.next=19,this._getItemFromServer(s);case 19:return I.abrupt("return",this._updateItemWithIfMatch(s,o,u));case 22:throw I.t0;case 23:I.next=26;break;case 25:return I.abrupt("return",l);case 26:case"end":return I.stop()}},i,this,[[6,14]])}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){var l=this,c;return G.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return c=u||{},S.abrupt("return",this.updateMergingQueue.add(s,c,function(T){return l._updateItemWithIfMatch(s,o,T.ttl)}));case 2:case"end":return S.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.mutate(s,function(p){return Object.assign(p,o)},u));case 1:case"end":return c.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"remove",value:function(){var r=Te.default(G.default.mark(function i(s){var o,u,l;return G.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.get(s);case 2:return o=p.sent,u=hn(o.data),p.next=6,this.services.network.delete(o.uri);case 6:l=p.sent,this._handleItemRemoved(s,l.body.last_event_id,u,new Date(l.body.date_updated),!1);case 8:case"end":return p.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"get",value:function(){var r=Te.default(G.default.mark(function i(s){var o;return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(o=this.cache.get(s),!o){l.next=5;break}return l.abrupt("return",o);case 5:return l.abrupt("return",this._getItemFromServer(s));case 6:case"end":return l.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_getItemFromServer",value:function(){var r=Te.default(G.default.mark(function i(s){var o;return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.queryItems({index:s});case 2:if(o=l.sent,!(o.items.length<1)){l.next=7;break}throw new Nr("No item with index ".concat(s," found"),404,54151);case 7:return l.abrupt("return",o.items[0]);case 8:case"end":return l.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"queryItems",value:function(){var r=Te.default(G.default.mark(function i(s){var o=this,u,l,c,p;return G.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return s=s||{},u=new rs(this.links.items).queryParam("From",s.from).queryParam("PageSize",s.limit).queryParam("Index",s.index).queryParam("PageToken",s.pageToken).queryParam("Order",s.order).build(),T.next=4,this.services.network.get(u);case 4:return l=T.sent,c=l.body.items.map(function(I){I.date_updated=new Date(I.date_updated);var x=o.cache.get(I.index);return x?o._handleItemMutated(I.index,I.url,I.last_event_id,I.revision,I.data,I.date_updated,I.date_expires,!1,!0):o.cache.store(Number(I.index),new Pp({index:Number(I.index),uri:I.url,revision:I.revision,lastEventId:I.last_event_id,dateUpdated:I.date_updated,dateExpires:I.date_expires,data:I.data}),I.last_event_id),o.cache.get(I.index)}),p=l.body.meta,T.abrupt("return",new Mp(c,function(I){return o.queryItems({pageToken:I})},p.previous_token,p.next_token));case 8:case"end":return T.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s=s||{},u_(s.pageSize),s.limit=s.pageSize||s.limit||50,s.order=s.order||"asc",u.abrupt("return",this.queryItems(s));case 5:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"getContext",value:function(){var r=Te.default(G.default.mark(function i(){var s;return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.context){u.next=5;break}return u.next=3,this.services.network.get(this.links.context);case 3:s=u.sent,this._updateContextIfRequired(s.body.data,s.body.last_event_id);case 5:return u.abrupt("return",this.context);case 6:case"end":return u.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=Te.default(G.default.mark(function i(s){var o,u;return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,o={ttl:s},c.next=4,this.services.network.post(this.uri,o);case 4:u=c.sent,this.descriptor.date_expires=u.body.date_expires,c.next=12;break;case 8:throw c.prev=8,c.t0=c.catch(0),c.t0.status===404&&this.onRemoved(!1),c.t0;case 12:case"end":return c.stop()}},i,this,[[0,8]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var r=Te.default(G.default.mark(function i(s,o){var u,l,c;return G.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,this.get(s);case 2:return u=S.sent,l={ttl:o},S.next=6,this.services.network.post(u.uri,l);case 6:c=S.sent,u.updateDateExpires(c.body.date_expires);case 8:case"end":return S.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"removeList",value:function(){var r=Te.default(G.default.mark(function i(){return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"onRemoved",value:function(a){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a})}},{key:"shouldIgnoreEvent",value:function(a,i){return this.cache.isKnown(a,i)}},{key:"_update",value:function(a,i){var s=Number(a.item_index);switch(a.date_created=new Date(a.date_created),a.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(s,a.item_url,a.id,a.item_revision,a.item_data,a.date_created,void 0,a.type==="list_item_added",!0);break;case"list_item_removed":this._handleItemRemoved(s,a.id,a.item_data,a.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(a.context_data,a.id,a.date_created);break;case"list_removed":this.onRemoved(!1);break}i&&this._advanceLastEventId(a.id,a.list_revision)}},{key:"_advanceLastEventId",value:function(a,i){this.lastEventId<a&&(this.descriptor.last_event_id=a,i&&(this.descriptor.revision=i))}},{key:"_updateRootDateUpdated",value:function(a){(!this.descriptor.date_updated||a.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=a,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:a}))}},{key:"_handleItemMutated",value:function(a,i,s,o,u,l,c,p,S){if(this.shouldIgnoreEvent(a,s)){Tt.trace("Item ".concat(a," update skipped, current: ").concat(this.lastEventId,", remote: ").concat(s));return}this._updateRootDateUpdated(l);var T=this.cache.get(a);if(!T){var I=new Pp({index:a,uri:i,lastEventId:s,revision:o,data:u,dateUpdated:l,dateExpires:c});this.cache.store(a,I,s),this.emitItemMutationEvent(I,S,p);return}var x=hn(T.data);T.update(s,o,u,l),this.cache.store(a,T,s),c!==void 0&&T.updateDateExpires(c),this.emitItemMutationEvent(T,S,!1,x)}},{key:"emitItemMutationEvent",value:function(a,i,s){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=s?"itemAdded":"itemUpdated",l={item:a,isLocal:!i};s||(l.previousItemData=o),this.broadcastEventToListeners(u,l)}},{key:"_handleItemRemoved",value:function(a,i,s,o,u){this._updateRootDateUpdated(o),this.cache.delete(a,i),this.broadcastEventToListeners("itemRemoved",{index:a,isLocal:!u,previousItemData:s})}},{key:"_handleContextUpdate",value:function(a,i,s){this._updateRootDateUpdated(s),this._updateContextIfRequired(a,i)&&this.broadcastEventToListeners("contextUpdated",{context:a,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(a,i){return!this.contextEventId||i>this.contextEventId?(this.context=a,this.contextEventId=i,!0):(Tt.trace("Context update skipped, current:",this.lastEventId,", remote:",i),!1)}}],[{key:"type",get:function(){return"list"}}]),t}(mu),Zt=function(e){Tr.default(t,e);var n=g_(t);function t(r){var a;return kt.default(this,t),a=n.call(this),a.syncListImpl=r,a.syncListImpl.attach(Fn.default(a)),a}return Et.default(t,[{key:"uri",get:function(){return this.syncListImpl.uri}},{key:"revision",get:function(){return this.syncListImpl.revision}},{key:"lastEventId",get:function(){return this.syncListImpl.lastEventId}},{key:"links",get:function(){return this.syncListImpl.links}},{key:"dateExpires",get:function(){return this.syncListImpl.dateExpires}},{key:"type",get:function(){return xp.type}},{key:"sid",get:function(){return this.syncListImpl.sid}},{key:"uniqueName",get:function(){return this.syncListImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncListImpl.dateUpdated}},{key:"push",value:function(){var r=Te.default(G.default.mark(function i(s,o){return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.ensureNotClosed(),l.abrupt("return",this.syncListImpl.push(s,o));case 2:case"end":return l.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"set",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncListImpl.set(s,o,u));case 2:case"end":return c.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncListImpl.mutate(s,o,u));case 2:case"end":return c.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncListImpl.update(s,o,u));case 2:case"end":return c.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"remove",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncListImpl.remove(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"get",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncListImpl.get(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"getContext",value:function(){var r=Te.default(G.default.mark(function i(){return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.ensureNotClosed(),o.abrupt("return",this.syncListImpl.getContext());case 2:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncListImpl.getItems(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncListImpl.setTtl(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var r=Te.default(G.default.mark(function i(s,o){return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.ensureNotClosed(),l.abrupt("return",this.syncListImpl.setItemTtl(s,o));case 2:case"end":return l.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"removeList",value:function(){var r=Te.default(G.default.mark(function i(){return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.ensureNotClosed(),o.abrupt("return",this.syncListImpl.removeList());case 2:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"close",value:function(){pu.default(Qt.default(t.prototype),"close",this).call(this),this.syncListImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return xp.type}}]),t}(bu);Rt.default(Zt,"itemAdded","itemAdded"),Rt.default(Zt,"itemUpdated","itemUpdated"),Rt.default(Zt,"itemRemoved","itemRemoved"),Rt.default(Zt,"removed","removed"),$t([he.validateTypesAsync(he.pureObject,["undefined",he.objectSchema("item metadata",{ttl:[he.nonNegativeInteger,"undefined"]})]),we("design:type",Function),we("design:paramtypes",[Object,Object]),we("design:returntype",Promise)],Zt.prototype,"push",null),$t([he.validateTypesAsync(he.nonNegativeInteger,he.pureObject,["undefined",he.objectSchema("item metadata",{ttl:[he.nonNegativeInteger,"undefined"]})]),we("design:type",Function),we("design:paramtypes",[Number,Object,Object]),we("design:returntype",Promise)],Zt.prototype,"set",null),$t([he.validateTypesAsync(he.nonNegativeInteger,"function",["undefined",he.objectSchema("item metadata",{ttl:[he.nonNegativeInteger,"undefined"]})]),we("design:type",Function),we("design:paramtypes",[Number,Function,Object]),we("design:returntype",Promise)],Zt.prototype,"mutate",null),$t([he.validateTypesAsync(he.nonNegativeInteger,he.pureObject,["undefined",he.objectSchema("item metadata",{ttl:[he.nonNegativeInteger,"undefined"]})]),we("design:type",Function),we("design:paramtypes",[Number,Object,Object]),we("design:returntype",Promise)],Zt.prototype,"update",null),$t([he.validateTypesAsync(he.nonNegativeInteger),we("design:type",Function),we("design:paramtypes",[Number]),we("design:returntype",Promise)],Zt.prototype,"remove",null),$t([he.validateTypesAsync(he.nonNegativeInteger),we("design:type",Function),we("design:paramtypes",[Number]),we("design:returntype",Promise)],Zt.prototype,"get",null),$t([he.validateTypesAsync(["undefined",he.objectSchema("query options",{from:[he.nonNegativeInteger,"undefined"],pageSize:[he.custom(function(e){return[Op(e),"a positive integer"]}),"undefined"]})]),we("design:type",Function),we("design:paramtypes",[Object]),we("design:returntype",Promise)],Zt.prototype,"getItems",null),$t([he.validateTypesAsync(he.nonNegativeInteger),we("design:type",Function),we("design:paramtypes",[Number]),we("design:returntype",Promise)],Zt.prototype,"setTtl",null),$t([he.validateTypesAsync(he.nonNegativeInteger,he.nonNegativeInteger),we("design:type",Function),we("design:paramtypes",[Number,Number]),we("design:returntype",Promise)],Zt.prototype,"setItemTtl",null);var wu=function(){function e(n){kt.default(this,e),this.descriptor=n}return Et.default(e,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"update",value:function(t,r,a,i){return this.descriptor.last_event_id=t,this.descriptor.revision=r,this.descriptor.data=a,this.descriptor.date_updated=i,this}},{key:"updateDateExpires",value:function(t){this.descriptor.date_expires=t}}]),e}();function m_(e){var n=k8();return function(){var r=Qt.default(e),a;if(n){var i=Qt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return Na.default(this,a)}}function k8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Lp=function(e){Tr.default(t,e);var n=m_(t);function t(r,a,i){var s;kt.default(this,t),s=n.call(this,r,i);var o=function(l,c){return typeof c.ttl=="number"?{ttl:c.ttl}:l};return s.updateMergingQueue=new p_(o),s.cache=new Np,s.descriptor=a,s.descriptor.date_updated=new Date(s.descriptor.date_updated),a.items&&a.items.forEach(function(u){u.date_updated=new Date(u.date_updated),s.cache.store(u.key,new wu(u),u.last_event_id)}),s}return Et.default(t,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"set",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){var l=this,c;return G.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return c=u||{},S.abrupt("return",this.updateMergingQueue.squashAndAdd(s,c,function(T){return l._putItemUnconditionally(s,o,T.ttl)}));case 2:case"end":return S.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"get",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(s!=null){u.next=2;break}throw new Nr("SyncMapItem key may not be empty",400,54209);case 2:if(!this.cache.has(s)){u.next=6;break}return u.abrupt("return",this.cache.get(s));case 6:return u.abrupt("return",this._getItemFromServer(s));case 7:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_getItemFromServer",value:function(){var r=Te.default(G.default.mark(function i(s){var o;return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.queryItems({key:s});case 2:if(o=l.sent,!(o.items.length<1)){l.next=7;break}throw new Nr("The specified Map Item does not exist",404,54201);case 7:return l.abrupt("return",o.items[0]);case 8:case"end":return l.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){var l=this,c;return G.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return c=u||{},S.abrupt("return",this.updateMergingQueue.add(s,c,function(T){return l._putItemWithIfMatch(s,o,T.ttl)}));case 2:case"end":return S.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",this.mutate(s,function(p){return Object.assign(p,o)},u));case 1:case"end":return c.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"_putItemUnconditionally",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){var l,c;return G.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,this._putItemToServer(s,o,void 0,u);case 2:return l=S.sent,c=l.item,this._handleItemMutated(c.key,c.url,c.last_event_id,c.revision,c.data,c.date_updated,c.date_expires,l.added,!1),S.abrupt("return",this.cache.get(c.key));case 6:case"end":return S.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"_putItemWithIfMatch",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){var l,c,p,S,T;return G.default.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.get(s).catch(function(U){if(U.status===404)return new wu({key:s,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw U});case 2:if(l=x.sent,c=o(hn(l.data)),!c){x.next=26;break}return p=l.revision,x.prev=6,x.next=9,this._putItemToServer(s,c,p,u);case 9:return S=x.sent,T=S.item,this._handleItemMutated(T.key,T.url,T.last_event_id,T.revision,T.data,T.date_updated,T.date_expires,S.added,!1),x.abrupt("return",this.cache.get(T.key));case 15:if(x.prev=15,x.t0=x.catch(6),x.t0.status!==412){x.next=23;break}return x.next=20,this._getItemFromServer(s);case 20:return x.abrupt("return",this._putItemWithIfMatch(s,o,u));case 23:throw x.t0;case 24:x.next=27;break;case 26:return x.abrupt("return",l);case 27:case"end":return x.stop()}},i,this,[[6,15]])}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"_putItemToServer",value:function(){var r=Te.default(G.default.mark(function i(s,o,u,l){var c,p,S,T,I;return G.default.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return c=new rs(this.links.items).pathSegment(s).build(),p={data:o},l!==void 0&&(p.ttl=l),U.prev=3,U.next=6,this.services.network.put(c,p,u);case 6:return S=U.sent,T=S.body,T.data=o,T.date_updated=new Date(T.date_updated),I=S.status.code===201,U.abrupt("return",{added:I,item:T});case 14:throw U.prev=14,U.t0=U.catch(3),U.t0.status===404&&this.onRemoved(!1),U.t0;case 18:case"end":return U.stop()}},i,this,[[3,14]])}));function a(i,s,o,u){return r.apply(this,arguments)}return a}()},{key:"remove",value:function(){var r=Te.default(G.default.mark(function i(s){var o,u,l;return G.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.get(s);case 2:return o=p.sent,u=hn(o.data),p.next=6,this.services.network.delete(o.uri);case 6:l=p.sent,this._handleItemRemoved(s,l.body.last_event_id,u,new Date(l.body.date_updated),!1);case 8:case"end":return p.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"queryItems",value:function(){var r=Te.default(G.default.mark(function i(s){var o=this,u,l,c,p;return G.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return s=s||{},u=new rs(this.links.items).queryParam("From",s.from).queryParam("PageSize",s.limit).queryParam("Key",s.key).queryParam("PageToken",s.pageToken).queryParam("Order",s.order).build(),T.next=4,this.services.network.get(u);case 4:return l=T.sent,c=l.body.items.map(function(I){I.date_updated=new Date(I.date_updated);var x=o.cache.get(I.key);return x?o._handleItemMutated(I.key,I.url,I.last_event_id,I.revision,I.data,I.date_updated,I.date_expires,!1,!0):o.cache.store(I.key,new wu(I),I.last_event_id),o.cache.get(I.key)}),p=l.body.meta,T.abrupt("return",new Mp(c,function(I){return o.queryItems({pageToken:I})},p.previous_token,p.next_token));case 8:case"end":return T.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s=s||{},u_(s.pageSize),s.limit=s.pageSize||s.limit||50,s.order=s.order||"asc",u.abrupt("return",this.queryItems(s));case 5:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"shouldIgnoreEvent",value:function(a,i){return this.cache.isKnown(a,i)}},{key:"_update",value:function(a,i){switch(a.date_created=new Date(a.date_created),a.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(a.item_key,a.item_url,a.id,a.item_revision,a.item_data,a.date_created,void 0,a.type==="map_item_added",!0);break;case"map_item_removed":this._handleItemRemoved(a.item_key,a.id,a.item_data,a.date_created,!0);break;case"map_removed":this.onRemoved(!1);break}i&&this._advanceLastEventId(a.id,a.map_revision)}},{key:"_advanceLastEventId",value:function(a,i){this.lastEventId<a&&(this.descriptor.last_event_id=a,i&&(this.descriptor.revision=i))}},{key:"_updateRootDateUpdated",value:function(a){(!this.descriptor.date_updated||a.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=a,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:a}))}},{key:"_handleItemMutated",value:function(a,i,s,o,u,l,c,p,S){if(this.shouldIgnoreEvent(a,s)){Tt.trace("SyncMapItem ",a," update skipped, current:",this.lastEventId,", remote:",s);return}this._updateRootDateUpdated(l);var T=this.cache.get(a);if(!T){var I=new wu({key:a,url:i,last_event_id:s,revision:o,data:u,date_updated:l,date_expires:c});this.cache.store(a,I,s),this.emitItemMutationEvent(I,S,p);return}var x=hn(T.data);T.update(s,o,u,l),this.cache.store(a,T,s),c!==void 0&&T.updateDateExpires(c),this.emitItemMutationEvent(T,S,!1,x)}},{key:"emitItemMutationEvent",value:function(a,i,s){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=s?"itemAdded":"itemUpdated",l={item:a,isLocal:!i};s||(l.previousItemData=o),this.broadcastEventToListeners(u,l)}},{key:"_handleItemRemoved",value:function(a,i,s,o,u){this._updateRootDateUpdated(o),this.cache.delete(a,i),this.broadcastEventToListeners("itemRemoved",{key:a,isLocal:!u,previousItemData:s})}},{key:"onRemoved",value:function(a){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a})}},{key:"setTtl",value:function(){var r=Te.default(G.default.mark(function i(s){var o,u;return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,o={ttl:s},c.next=4,this.services.network.post(this.uri,o);case 4:u=c.sent,this.descriptor.date_expires=u.body.date_expires,c.next=12;break;case 8:throw c.prev=8,c.t0=c.catch(0),c.t0.status===404&&this.onRemoved(!1),c.t0;case 12:case"end":return c.stop()}},i,this,[[0,8]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var r=Te.default(G.default.mark(function i(s,o){var u,l,c;return G.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,this.get(s);case 2:return u=S.sent,l={ttl:o},S.next=6,this.services.network.post(u.uri,l);case 6:c=S.sent,u.updateDateExpires(c.body.date_expires);case 8:case"end":return S.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"removeMap",value:function(){var r=Te.default(G.default.mark(function i(){return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()}],[{key:"type",get:function(){return"map"}}]),t}(mu),nr=function(e){Tr.default(t,e);var n=m_(t);function t(r){var a;return kt.default(this,t),a=n.call(this),a.syncMapImpl=r,a.syncMapImpl.attach(Fn.default(a)),a}return Et.default(t,[{key:"uri",get:function(){return this.syncMapImpl.uri}},{key:"links",get:function(){return this.syncMapImpl.links}},{key:"revision",get:function(){return this.syncMapImpl.revision}},{key:"lastEventId",get:function(){return this.syncMapImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncMapImpl.dateExpires}},{key:"type",get:function(){return Lp.type}},{key:"sid",get:function(){return this.syncMapImpl.sid}},{key:"uniqueName",get:function(){return this.syncMapImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncMapImpl.dateUpdated}},{key:"set",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncMapImpl.set(s,o,u));case 2:case"end":return c.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"get",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncMapImpl.get(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncMapImpl.mutate(s,o,u));case 2:case"end":return c.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=Te.default(G.default.mark(function i(s,o,u){return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.ensureNotClosed(),c.abrupt("return",this.syncMapImpl.update(s,o,u));case 2:case"end":return c.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"remove",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncMapImpl.remove(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncMapImpl.getItems(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncMapImpl.setTtl(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var r=Te.default(G.default.mark(function i(s,o){return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.ensureNotClosed(),l.abrupt("return",this.syncMapImpl.setItemTtl(s,o));case 2:case"end":return l.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"removeMap",value:function(){var r=Te.default(G.default.mark(function i(){return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.ensureNotClosed(),o.next=3,this.syncMapImpl.removeMap();case 3:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"close",value:function(){pu.default(Qt.default(t.prototype),"close",this).call(this),this.syncMapImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return Lp.type}}]),t}(bu);Rt.default(nr,"itemAdded","itemAdded"),Rt.default(nr,"itemUpdated","itemUpdated"),Rt.default(nr,"itemRemoved","itemRemoved"),Rt.default(nr,"removed","removed"),$t([he.validateTypesAsync("string",he.pureObject,["undefined",he.objectSchema("item metadata",{ttl:[he.nonNegativeInteger,"undefined"]})]),we("design:type",Function),we("design:paramtypes",[String,Object,Object]),we("design:returntype",Promise)],nr.prototype,"set",null),$t([he.validateTypesAsync("string"),we("design:type",Function),we("design:paramtypes",[String]),we("design:returntype",Promise)],nr.prototype,"get",null),$t([he.validateTypesAsync("string","function",["undefined",he.objectSchema("item metadata",{ttl:[he.nonNegativeInteger,"undefined"]})]),we("design:type",Function),we("design:paramtypes",[String,Function,Object]),we("design:returntype",Promise)],nr.prototype,"mutate",null),$t([he.validateTypesAsync("string",he.pureObject,["undefined",he.objectSchema("item metadata",{ttl:[he.nonNegativeInteger,"undefined"]})]),we("design:type",Function),we("design:paramtypes",[String,Object,Object]),we("design:returntype",Promise)],nr.prototype,"update",null),$t([he.validateTypesAsync("string"),we("design:type",Function),we("design:paramtypes",[String]),we("design:returntype",Promise)],nr.prototype,"remove",null),$t([he.validateTypesAsync(["undefined",he.objectSchema("query options",{from:["string","undefined"],pageSize:[he.custom(function(e){return[Op(e),"a positive integer"]}),"undefined"]})]),we("design:type",Function),we("design:paramtypes",[Object]),we("design:returntype",Promise)],nr.prototype,"getItems",null),$t([he.validateTypesAsync(he.nonNegativeInteger),we("design:type",Function),we("design:paramtypes",[Number]),we("design:returntype",Promise)],nr.prototype,"setTtl",null),$t([he.validateTypesAsync("string",he.nonNegativeInteger),we("design:type",Function),we("design:paramtypes",[String,Number]),we("design:returntype",Promise)],nr.prototype,"setItemTtl",null);function b_(e){var n=$8();return function(){var r=Qt.default(e),a;if(n){var i=Qt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return Na.default(this,a)}}function $8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Su=function(e){Tr.default(t,e);var n=b_(t);function t(r,a,i){var s;return kt.default(this,t),s=n.call(this,r,i),s.descriptor=a,s}return Et.default(t,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"publishMessage",value:function(){var r=Te.default(G.default.mark(function i(s){var o,u,l,c;return G.default.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return o={data:s},S.next=3,this.services.network.post(this.links.messages,o);case 3:return u=S.sent,l=u.body,c=this._handleMessagePublished(l.sid,s,!1),S.abrupt("return",c);case 7:case"end":return S.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=Te.default(G.default.mark(function i(s){var o,u;return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,o={ttl:s},c.next=4,this.services.network.post(this.uri,o);case 4:u=c.sent,this.descriptor.date_expires=u.body.date_expires,c.next=12;break;case 8:throw c.prev=8,c.t0=c.catch(0),c.t0.status===404&&this.onRemoved(!1),c.t0;case 12:case"end":return c.stop()}},i,this,[[0,8]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"removeStream",value:function(){var r=Te.default(G.default.mark(function i(){return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"_update",value:function(a){switch(a.type){case"stream_message_published":{this._handleMessagePublished(a.message_sid,a.message_data,!0);break}case"stream_removed":{this.onRemoved(!1);break}}}},{key:"_handleMessagePublished",value:function(a,i,s){var o={sid:a,data:i};return this.broadcastEventToListeners("messagePublished",{message:o,isLocal:!s}),o}},{key:"onRemoved",value:function(a){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a})}}],[{key:"type",get:function(){return"stream"}}]),t}(mu);$t([he.validateTypesAsync(he.pureObject),we("design:type",Function),we("design:paramtypes",[Object]),we("design:returntype",Promise)],Su.prototype,"publishMessage",null),$t([he.validateTypesAsync(he.nonNegativeInteger),we("design:type",Function),we("design:paramtypes",[Number]),we("design:returntype",Promise)],Su.prototype,"setTtl",null);var Dn=function(e){Tr.default(t,e);var n=b_(t);function t(r){var a;return kt.default(this,t),a=n.call(this),a.syncStreamImpl=r,a.syncStreamImpl.attach(Fn.default(a)),a}return Et.default(t,[{key:"uri",get:function(){return this.syncStreamImpl.uri}},{key:"links",get:function(){return this.syncStreamImpl.links}},{key:"dateExpires",get:function(){return this.syncStreamImpl.dateExpires}},{key:"type",get:function(){return Su.type}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.syncStreamImpl.sid}},{key:"uniqueName",get:function(){return this.syncStreamImpl.uniqueName}},{key:"publishMessage",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncStreamImpl.publishMessage(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncStreamImpl.setTtl(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"removeStream",value:function(){var r=Te.default(G.default.mark(function i(){return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.ensureNotClosed(),o.abrupt("return",this.syncStreamImpl.removeStream());case 2:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"close",value:function(){pu.default(Qt.default(t.prototype),"close",this).call(this),this.syncStreamImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return Su.type}}]),t}(bu);Rt.default(Dn,"messagePublished","messagePublished"),Rt.default(Dn,"removed","removed"),$t([he.validateTypesAsync(he.pureObject),we("design:type",Function),we("design:paramtypes",[Object]),we("design:returntype",Promise)],Dn.prototype,"publishMessage",null),$t([he.validateTypesAsync(he.nonNegativeInteger),we("design:type",Function),we("design:paramtypes",[Number]),we("design:returntype",Promise)],Dn.prototype,"setTtl",null);var T8=function e(n){kt.default(this,e),this.sdk="js",this.sdkVer=n,this.os=Cl.os.family,this.osVer=Cl.os.version,this.pl=Cl.name,this.plVer=Cl.version},C8=function(){function e(){kt.default(this,e),this.names=new Map,this.entities=new Map}return Et.default(e,[{key:"store",value:function(t){var r=this.entities.get(t.sid);return r||(this.entities.set(t.sid,t),t.uniqueName&&this.names.set(t.type+"::"+t.uniqueName,t.sid),t)}},{key:"getResolved",value:function(t,r){var a=this.names.get(r+"::"+t);return a?this.entities.get(a):null}},{key:"get",value:function(t,r){return this.entities.get(t)||this.getResolved(t,r)||null}},{key:"remove",value:function(t){var r=this.entities.get(t);r&&(this.entities.delete(t),r.uniqueName&&this.names.delete(r.type+"::"+r.uniqueName))}}]),e}();function jp(e){var n=E8();return function(){var r=Qt.default(e),a;if(n){var i=Qt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return Na.default(this,a)}}function E8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var I8=function e(){kt.default(this,e)},Up=function(e){Tr.default(t,e);var n=jp(t);function t(r,a,i,s){var o;return kt.default(this,t),o=n.call(this,a,i),o.descriptor=r,o.cache=new Np,s&&s.forEach(function(u){o.cache.store(u.key,{key:u.key,value:u.data},u.revision)}),o}return Et.default(t,[{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return null}},{key:"type",get:function(){return t.type}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"indexName",get:function(){return this.descriptor.indexName}},{key:"queryString",get:function(){return this.descriptor.queryExpression}},{key:"queryUri",get:function(){return this.descriptor.queryUri}},{key:"liveQueryDescriptor",get:function(){return this.descriptor}},{key:"onRemoved",value:function(){}},{key:"getItems",value:function(){var a={};return this.cache.forEach(function(i,s){a[i]=s.value}),a}},{key:"_update",value:function(a,i){switch(a.type){case"live_query_item_updated":this.handleItemMutated(a.item_key,a.item_data,a.item_revision);break;case"live_query_item_removed":this.handleItemRemoved(a.item_key,a.item_revision);break;case"live_query_updated":this.handleBatchUpdate(a.items);break}i&&this._advanceLastEventId(a.last_event_id)}},{key:"handleItemMutated",value:function(a,i,s){if(this.shouldIgnoreEvent(a,s))Tt.trace("Item ".concat(a," update skipped, revision: ").concat(s));else{var o={key:a,value:i};this.cache.store(a,o,s),this.broadcastEventToListeners("itemUpdated",o)}}},{key:"handleItemRemoved",value:function(a,i){var s=i===null;this.shouldIgnoreEvent(a,i)?Tt.trace("Item ".concat(a," delete skipped, revision: ").concat(i)):(this.cache.delete(a,i,s),this.broadcastEventToListeners("itemRemoved",{key:a}))}},{key:"handleBatchUpdate",value:function(a){var i=this,s={};a!=null&&a.forEach(function(u){s[u.key]={data:u.data,revision:u.revision}}),this.cache.forEach(function(u,l){var c=s[u];c!=null?i.handleItemMutated(u,c.data,c.revision):i.handleItemRemoved(u,null),delete s[u]});for(var o in s)this.handleItemMutated(o,s[o].data,s[o].revision)}},{key:"shouldIgnoreEvent",value:function(a,i){return a!=null&&i!=null&&this.cache.isKnown(a,i)}},{key:"_advanceLastEventId",value:function(a,i){this.lastEventId<a&&(this.descriptor.last_event_id=a)}}],[{key:"type",get:function(){return"live_query"}}]),t}(mu);function w_(e){return Fp.apply(this,arguments)}function Fp(){return Fp=Te.default(G.default.mark(function e(n){var t,r,a,i,s,o;return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(t=n.network,r=n.queryString,a=n.uri,i=n.type,r!=null){l.next=3;break}throw new Nr("Invalid query",400,54507);case 3:return s={query_string:r},i===fa.type&&(s.type=i),l.next=7,t.post(a,s,void 0,!0);case 7:return o=l.sent,l.abrupt("return",o.body);case 9:case"end":return l.stop()}},e)})),Fp.apply(this,arguments)}var fa=function(e){Tr.default(t,e);var n=jp(t);function t(r){var a;return kt.default(this,t),a=n.call(this),a.liveQueryImpl=r,a.liveQueryImpl.attach(Fn.default(a)),a}return Et.default(t,[{key:"type",get:function(){return Up.type}},{key:"lastEventId",get:function(){return this.liveQueryImpl.lastEventId}},{key:"sid",get:function(){return this.liveQueryImpl.sid}},{key:"close",value:function(){pu.default(Qt.default(t.prototype),"close",this).call(this),this.liveQueryImpl.detach(this.listenerUuid)}},{key:"getItems",value:function(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}}],[{key:"type",get:function(){return Up.type}}]),t}(bu);Rt.default(fa,"itemUpdated","itemUpdated"),Rt.default(fa,"itemRemoved","itemRemoved");var _u=function(e){Tr.default(t,e);var n=jp(t);function t(r){var a;return kt.default(this,t),a=n.call(this),Rt.default(Fn.default(a),"queryExpression",null),Rt.default(Fn.default(a),"items",{}),Object.assign(Fn.default(a),r),a.updateIndexName(r.indexName),a}return Et.default(t,[{key:"type",get:function(){return t.type}},{key:"search",value:function(){var r=Te.default(G.default.mark(function i(s){var o=this;return G.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.items={},l.abrupt("return",w_({network:this.network,uri:this.queryUri,queryString:s}).then(function(c){o.queryExpression=s,c.items&&c.items.forEach(function(p){o.items[p.key]=p.data}),o.emit("searchResult",o.getItems())}).catch(function(c){throw Tt.error("Error '".concat(c.message,"' while executing query '").concat(s,"'")),o.queryExpression=null,c}));case 2:case"end":return l.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"subscribe",value:function(){var r=Te.default(G.default.mark(function i(){return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.queryExpression!=null){o.next=2;break}return o.abrupt("return",Promise.reject(new Nr("Invalid query",400,54507)));case 2:return o.abrupt("return",this.liveQueryCreator(this.indexName,this.queryExpression));case 3:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"getItems",value:function(){return this.items}},{key:"updateIndexName",value:function(a){this.indexName=a,this.queryUri=this.generateQueryUri(this.indexName)}},{key:"generateQueryUri",value:function(a){return new rs(this.insightsUri).pathSegment(a).pathSegment("Items").build()}}],[{key:"type",get:function(){return"instant_query"}}]),t}(Ot);Rt.default(_u,"searchResult","searchResult"),$t([he.validateTypesAsync("string"),we("design:type",Function),we("design:paramtypes",[String]),we("design:returntype",Promise)],_u.prototype,"search",null),$t([he.validateTypes(he.nonEmptyString),we("design:type",Function),we("design:paramtypes",[String]),we("design:returntype",void 0)],_u.prototype,"updateIndexName",null);var R8="3.1.0";function O8(e){var n=A8();return function(){var r=Qt.default(e),a;if(n){var i=Qt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return Na.default(this,a)}}function A8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S_(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function __(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?S_(Object(t),!0).forEach(function(r){Rt.default(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S_(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var P8="data_sync",Dp=R8;function El(e){if(e){if(typeof e=="string")return{id:e,mode:"open_or_create"};var n=e.mode||(e.id?"open_or_create":"create_new");return __(__({},e),{},{mode:n})}else return{mode:"create_new"}}var k_="com.twilio.rtd.cds.document",$_="com.twilio.rtd.cds.list",T_="com.twilio.rtd.cds.map",C_="twilio.sync.event",Wr=function(e){Tr.default(t,e);var n=O8(t);function t(r){var a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(kt.default(this,t),a=n.call(this),!r)throw new Error("Sync library needs a valid Twilio token to be passed");i.hasOwnProperty("logLevel")?Tt.setLevel(i.logLevel):Tt.setLevel("silent");var s=i.productId=i.productId||P8;i.clientMetadata=i.clientMetadata||{},i.clientMetadata.hasOwnProperty("type")||(i.clientMetadata.type="sync"),i.clientMetadata.hasOwnProperty("sdk")||(i.clientMetadata.sdk="JS",i.clientMetadata.sdkv=Dp);var o=!i.twilsockClient;if(!i.initRegistrations){var u=new Tl.InitRegistration(s);t.populateInitRegistrations(u),i.initRegistrations=[u]}var l=i.twilsockClient=i.twilsockClient||new Tl.Twilsock(r,s,i);l.on("tokenAboutToExpire",function(T){return a.emit("tokenAboutToExpire",T)}),l.on("tokenExpired",function(){return a.emit("tokenExpired")}),l.on("connectionError",function(T){return a.emit("connectionError",T)}),l.on("stateChanged",function(T){a.emit("connectionStateChanged",T),a.services.subscriptions.onConnectionStateChanged(T==="connected")}),l.on("message",function(T,I){return a._routeMessage(T,I)});var c=new Z5(i),p=new u8(new T8(Dp),c,l),S=new o8(c);return a.services={config:c,twilsock:l,network:p,storage:S,router:Fn.default(a),subscriptions:null},a.services.subscriptions=new r8(a.services),a.entities=new C8,o&&l.connect(),a}return Et.default(t,[{key:"_routeMessage",value:function(a,i){switch(Tt.trace("Notification type:",a,"content:",i),a){case k_:case $_:case T_:this.services.subscriptions.acceptMessage(i,!1);break;case C_:this.services.subscriptions.acceptMessage(i,!0);break}}},{key:"_subscribe",value:function(a,i){this.services.subscriptions.add(a,i)}},{key:"_unsubscribe",value:function(a){this.services.subscriptions.remove(a)}},{key:"connectionState",get:function(){return this.services.twilsock.state}},{key:"ensureReady",value:function(){var r=Te.default(G.default.mark(function i(){var s;return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.services.config.sessionStorageEnabled){u.next=2;break}return u.abrupt("return");case 2:return u.prev=2,u.next=5,this.services.twilsock.storageId();case 5:s=u.sent,this.services.storage.updateStorageId(s.id),u.next=12;break;case 9:u.prev=9,u.t0=u.catch(2),Tt.warn("Failed to initialize storage",u.t0);case 12:case"end":return u.stop()}},i,this,[[2,9]])}));function a(){return r.apply(this,arguments)}return a}()},{key:"storeRootInSessionCache",value:function(a,i,s){if(!(!this.services.config.sessionStorageEnabled||!i)){var o=hn(s);(a===Zt.type||a===nr.type)&&(o.last_event_id=null,delete o.items),this.services.storage.store(a,i,o)}}},{key:"readRootFromSessionCache",value:function(a,i){return!this.services.config.sessionStorageEnabled||!i?null:this.services.storage.read(a,i)}},{key:"_get",value:function(){var r=Te.default(G.default.mark(function i(s,o){var u,l,c,p=arguments;return G.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(u=p.length>2&&p[2]!==void 0?p[2]:!1,o){T.next=3;break}throw new Nr("Cannot get entity without id",404);case 3:return l=new rs(s).pathSegment(o).queryParam("Include",u?"items":void 0).build(),T.next=6,this.services.network.get(l);case 6:return c=T.sent,T.abrupt("return",c.body);case 8:case"end":return T.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"_createDocument",value:function(a,i,s){var o={unique_name:a,data:i||{}};return s!==void 0&&(o.ttl=s),this.services.network.post(this.services.config.documentsUri,o).then(function(u){return u.body.data=o.data,u.body})}},{key:"_getDocument",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.readRootFromSessionCache(Qr.type,s)||this._get(this.services.config.documentsUri,s));case 1:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_createList",value:function(a,i,s,o){var u={unique_name:a,purpose:i,context:s};return o!==void 0&&(u.ttl=o),this.services.network.post(this.services.config.listsUri,u).then(function(l){return l.body})}},{key:"_getList",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.readRootFromSessionCache(Zt.type,s)||this._get(this.services.config.listsUri,s));case 1:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_createMap",value:function(a,i){var s={unique_name:a};return i!==void 0&&(s.ttl=i),this.services.network.post(this.services.config.mapsUri,s).then(function(o){return o.body})}},{key:"_getMap",value:function(){var r=Te.default(G.default.mark(function i(s){var o,u=arguments;return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=u.length>1&&u[1]!==void 0?u[1]:!1,c.abrupt("return",this.readRootFromSessionCache(nr.type,s)||this._get(this.services.config.mapsUri,s,o));case 2:case"end":return c.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_getStream",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.readRootFromSessionCache(Dn.type,s)||this._get(this.services.config.streamsUri,s,!1));case 1:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_createStream",value:function(){var r=Te.default(G.default.mark(function i(s,o){var u,l;return G.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u={unique_name:s},o!==void 0&&(u.ttl=o),p.next=4,this.services.network.post(this.services.config.streamsUri,u);case 4:return l=p.sent,p.abrupt("return",l.body);case 6:case"end":return p.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"_getLiveQuery",value:function(a){return this.readRootFromSessionCache(fa.type,a)}},{key:"getCached",value:function(a,i){return a&&this.entities.get(a,i)||null}},{key:"removeFromCacheAndSession",value:function(a,i,s){this.entities.remove(i),this.services.config.sessionStorageEnabled&&this.services.storage.remove(a,i,s)}},{key:"document",value:function(){var r=Te.default(G.default.mark(function i(s){var o=this,u,l,c,p;return G.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.ensureReady();case 2:if(u=El(s),u.mode!=="create_new"){T.next=9;break}return T.next=6,this._createDocument(u.id,u.data,u.ttl);case 6:l=T.sent,T.next=39;break;case 9:if(c=this.getCached(u.id,Qr.type),!c){T.next=14;break}return T.abrupt("return",new Qr(c));case 14:return T.prev=14,T.next=17,this._getDocument(u.id);case 17:l=T.sent,T.next=39;break;case 20:if(T.prev=20,T.t0=T.catch(14),!(T.t0.status!==404||u.mode==="open_existing")){T.next=26;break}throw T.t0;case 26:return T.prev=26,T.next=29,this._createDocument(u.id,u.data,u.ttl);case 29:l=T.sent,T.next=39;break;case 32:if(T.prev=32,T.t1=T.catch(26),T.t1.status!==409){T.next=38;break}return T.abrupt("return",this.document(s));case 38:throw T.t1;case 39:return this.storeRootInSessionCache(Qr.type,u.id,l),p=new Ap(this.services,l,function(I,x,U){return o.removeFromCacheAndSession(I,x,U)}),p=this.entities.store(p),T.abrupt("return",new Qr(p));case 43:case"end":return T.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"map",value:function(){var r=Te.default(G.default.mark(function i(s){var o=this,u,l,c,p;return G.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.ensureReady();case 2:if(u=El(s),u.mode!=="create_new"){T.next=9;break}return T.next=6,this._createMap(u.id,u.ttl);case 6:l=T.sent,T.next=39;break;case 9:if(c=this.getCached(u.id,nr.type),!c){T.next=14;break}return T.abrupt("return",new nr(c));case 14:return T.prev=14,T.next=17,this._getMap(u.id,u.includeItems);case 17:l=T.sent,T.next=39;break;case 20:if(T.prev=20,T.t0=T.catch(14),!(T.t0.status!==404||u.mode==="open_existing")){T.next=26;break}throw T.t0;case 26:return T.prev=26,T.next=29,this._createMap(u.id,u.ttl);case 29:l=T.sent,T.next=39;break;case 32:if(T.prev=32,T.t1=T.catch(26),T.t1.status!==409){T.next=38;break}return T.abrupt("return",this.map(s));case 38:throw T.t1;case 39:return this.storeRootInSessionCache(nr.type,u.id,l),p=new Lp(this.services,l,function(I,x,U){return o.removeFromCacheAndSession(I,x,U)}),p=this.entities.store(p),T.abrupt("return",new nr(p));case 43:case"end":return T.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"list",value:function(){var r=Te.default(G.default.mark(function i(s){var o=this,u,l,c,p;return G.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.ensureReady();case 2:if(u=El(s),u.mode!=="create_new"){T.next=9;break}return T.next=6,this._createList(u.id,u.purpose,u.context,u.ttl);case 6:l=T.sent,T.next=39;break;case 9:if(c=this.getCached(u.id,Zt.type),!c){T.next=14;break}return T.abrupt("return",new Zt(c));case 14:return T.prev=14,T.next=17,this._getList(u.id);case 17:l=T.sent,T.next=39;break;case 20:if(T.prev=20,T.t0=T.catch(14),!(T.t0.status!==404||u.mode==="open_existing")){T.next=26;break}throw T.t0;case 26:return T.prev=26,T.next=29,this._createList(u.id,u.purpose,u.context,u.ttl);case 29:l=T.sent,T.next=39;break;case 32:if(T.prev=32,T.t1=T.catch(26),T.t1.status!==409){T.next=38;break}return T.abrupt("return",this.list(s));case 38:throw T.t1;case 39:return this.storeRootInSessionCache(Zt.type,u.id,l),p=new xp(this.services,l,function(I,x,U){return o.removeFromCacheAndSession(I,x,U)}),p=this.entities.store(p),T.abrupt("return",new Zt(p));case 43:case"end":return T.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"stream",value:function(){var r=Te.default(G.default.mark(function i(s){var o=this,u,l,c,p,S;return G.default.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.ensureReady();case 2:if(u=El(s),u.mode!=="create_new"){I.next=9;break}return I.next=6,this._createStream(u.id,u.ttl);case 6:l=I.sent,I.next=39;break;case 9:if(c=this.getCached(u.id,Dn.type),!c){I.next=14;break}return I.abrupt("return",new Dn(c));case 14:return I.prev=14,I.next=17,this._getStream(u.id);case 17:l=I.sent,I.next=39;break;case 20:if(I.prev=20,I.t0=I.catch(14),!(I.t0.status!==404||u.mode==="open_existing")){I.next=26;break}throw I.t0;case 26:return I.prev=26,I.next=29,this._createStream(u.id,u.ttl);case 29:l=I.sent,I.next=39;break;case 32:if(I.prev=32,I.t1=I.catch(26),I.t1.status!==409){I.next=38;break}return I.abrupt("return",this.stream(s));case 38:throw I.t1;case 39:return this.storeRootInSessionCache(Dn.type,u.id,l),p=function(U,F,V){return o.removeFromCacheAndSession(U,F,V)},S=new Su(this.services,l,p),S=this.entities.store(S),I.abrupt("return",new Dn(S));case 44:case"end":return I.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"shutdown",value:function(){var r=Te.default(G.default.mark(function i(){return G.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.services.subscriptions.shutdown();case 2:return o.next=4,this.services.twilsock.disconnect();case 4:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"updateToken",value:function(){var r=Te.default(G.default.mark(function i(s){return G.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.services.twilsock.updateToken(s).catch(function(l){var c,p=l==null||(c=l.reply)===null||c===void 0?void 0:c.status;throw(p==null?void 0:p.code)===401&&(p==null?void 0:p.status)==="UNAUTHORIZED"?new Nr("Updated token was rejected by server",400,51130):l}));case 1:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"liveQuery",value:function(){var r=Te.default(G.default.mark(function i(s,o){var u=this,l,c,p,S,T;return G.default.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.ensureReady();case 2:return l=new rs(this.services.config.insightsUri).pathSegment(s).pathSegment("Items").build(),x.next=5,w_({network:this.services.network,uri:l,queryString:o,type:fa.type});case 5:return c=x.sent,p=this.getCached(c.query_id,fa.type),p||(S=this._getLiveQuery(c.query_id),S||(S={indexName:s,queryExpression:o,sid:c.query_id,queryUri:l,last_event_id:c.last_event_id}),T=function(F,V,Ae){return u.removeFromCacheAndSession(F,V,Ae)},p=new Up(S,this.services,T,c.items)),this.storeRootInSessionCache(fa.type,c.query_id,p.liveQueryDescriptor),p=this.entities.store(p),x.abrupt("return",new fa(p));case 11:case"end":return x.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"instantQuery",value:function(){var r=Te.default(G.default.mark(function i(s){var o=this,u;return G.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.ensureReady();case 2:return u=function(S,T){return o.liveQuery(S,T)},c.abrupt("return",new _u({indexName:s,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:u}));case 4:case"end":return c.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()}],[{key:"populateInitRegistrations",value:function(a){a.populateInitRegistrations([C_,k_,$_,T_])}},{key:"version",get:function(){return Dp}}]),t}(Ot);Rt.default(Wr,"connectionStateChanged","connectionStateChanged"),Rt.default(Wr,"connectionError","connectionError"),Rt.default(Wr,"tokenAboutToExpire","tokenAboutToExpire"),Rt.default(Wr,"tokenExpired","tokenExpired"),$t([he.validateTypesAsync(["undefined","string",he.objectSchema("open document options",{id:["string","undefined"],mode:[he.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[he.nonNegativeInteger,"undefined"],data:[he.pureObject,"undefined",he.literal(null)]})]),we("design:type",Function),we("design:paramtypes",[Object]),we("design:returntype",Promise)],Wr.prototype,"document",null),$t([he.validateTypesAsync(["undefined","string",he.objectSchema("open map options",{id:["string","undefined"],mode:[he.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[he.nonNegativeInteger,"undefined"],data:[he.pureObject,"undefined",he.literal(null)],includeItems:["boolean","undefined"]})]),we("design:type",Function),we("design:paramtypes",[Object]),we("design:returntype",Promise)],Wr.prototype,"map",null),$t([he.validateTypesAsync(["undefined","string",he.objectSchema("open list options",{id:["string","undefined"],mode:[he.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[he.nonNegativeInteger,"undefined"],data:[he.pureObject,"undefined",he.literal(null)],purpose:["string","undefined"],context:[he.pureObject,"undefined"],includeItems:["boolean","undefined"]})]),we("design:type",Function),we("design:paramtypes",[Object]),we("design:returntype",Promise)],Wr.prototype,"list",null),$t([he.validateTypesAsync(["undefined","string",he.objectSchema("open stream options",{id:["string","undefined"],mode:[he.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[he.nonNegativeInteger,"undefined"],data:[he.pureObject,"undefined",he.literal(null)]})]),we("design:type",Function),we("design:paramtypes",[Object]),we("design:returntype",Promise)],Wr.prototype,"stream",null),$t([he.validateTypesAsync(he.nonEmptyString),we("design:type",Function),we("design:paramtypes",[String]),we("design:returntype",Promise)],Wr.prototype,"updateToken",null),$t([he.validateTypesAsync(he.nonEmptyString,"string"),we("design:type",Function),we("design:paramtypes",[String,String]),we("design:returntype",Promise)],Wr.prototype,"liveQuery",null),$t([he.validateTypesAsync(he.nonEmptyString),we("design:type",Function),we("design:paramtypes",[String]),we("design:returntype",Promise)],Wr.prototype,"instantQuery",null),Mr.Client=Wr,Mr.InsightsItem=I8,Mr.InstantQuery=_u,Mr.LiveQuery=fa,Mr.Paginator=Mp,Mr.SyncClient=Wr,Mr.SyncDocument=Qr,Mr.SyncList=Zt,Mr.SyncListItem=Pp,Mr.SyncMap=nr,Mr.SyncMapItem=wu,Mr.SyncStream=Dn;var E_={},M8=qt,N8=In,x8=Nt,L8=x8("match"),j8=function(e){var n;return M8(e)&&((n=e[L8])!==void 0?!!n:N8(e)==="RegExp")},U8=j8,F8=TypeError,I_=function(e){if(U8(e))throw new F8("The method doesn't accept regular expressions");return e},D8=Nt,B8=D8("match"),R_=function(e){var n=/./;try{"/./"[e](n)}catch{try{return n[B8]=!1,"/./"[e](n)}catch{}}return!1},q8=ft,W8=xc,z8=Hn.f,G8=Yn,O_=rr,H8=I_,V8=fn,K8=R_,Y8=W8("".slice),J8=Math.min,A_=K8("startsWith"),Q8=!A_&&!!function(){var e=z8(String.prototype,"startsWith");return e&&!e.writable}();q8({target:"String",proto:!0,forced:!Q8&&!A_},{startsWith:function(n){var t=O_(V8(this));H8(n);var r=G8(J8(arguments.length>1?arguments[1]:void 0,t.length)),a=O_(n);return Y8(t,r,r+a.length)===a}});var X8=at,Z8=Nt,eq=Lt,P_=Vv,tq=Z8("iterator"),M_=!X8(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),n=e.searchParams,t=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",n.forEach(function(a,i){n.delete("b"),r+=i+a}),t.delete("a",2),t.delete("b",void 0),P_&&(!e.toJSON||!t.has("a",1)||t.has("a",2)||!t.has("a",void 0)||t.has("b"))||!n.size&&(P_||!eq)||!n.sort||e.href!=="https://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[tq]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://ÑÐµÑÑ").host!=="xn--e1aybc"||new URL("https://a#Ð±").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),hi=lt,Bp=2147483647,ku=36,N_=1,qp=26,rq=38,nq=700,aq=72,iq=128,sq="-",uq=/[^\0-\u007E]/,x_=/[.\u3002\uFF0E\uFF61]/g,L_="Overflow: input needs wider integers to process",Wp=ku-N_,j_=RangeError,oq=hi(x_.exec),as=Math.floor,zp=String.fromCharCode,U_=hi("".charCodeAt),F_=hi([].join),La=hi([].push),lq=hi("".replace),cq=hi("".split),fq=hi("".toLowerCase),dq=function(e){for(var n=[],t=0,r=e.length;t<r;){var a=U_(e,t++);if(a>=55296&&a<=56319&&t<r){var i=U_(e,t++);(i&64512)===56320?La(n,((a&1023)<<10)+(i&1023)+65536):(La(n,a),t--)}else La(n,a)}return n},D_=function(e){return e+22+75*(e<26)},pq=function(e,n,t){var r=0;for(e=t?as(e/nq):e>>1,e+=as(e/n);e>Wp*qp>>1;)e=as(e/Wp),r+=ku;return as(r+(Wp+1)*e/(e+rq))},vq=function(e){var n=[];e=dq(e);var t=e.length,r=iq,a=0,i=aq,s,o;for(s=0;s<e.length;s++)o=e[s],o<128&&La(n,zp(o));var u=n.length,l=u;for(u&&La(n,sq);l<t;){var c=Bp;for(s=0;s<e.length;s++)o=e[s],o>=r&&o<c&&(c=o);var p=l+1;if(c-r>as((Bp-a)/p))throw new j_(L_);for(a+=(c-r)*p,r=c,s=0;s<e.length;s++){if(o=e[s],o<r&&++a>Bp)throw new j_(L_);if(o===r){for(var S=a,T=ku;;){var I=T<=i?N_:T>=i+qp?qp:T-i;if(S<I)break;var x=S-I,U=ku-I;La(n,zp(D_(I+x%U))),S=as(x/U),T+=ku}La(n,zp(D_(S))),i=pq(a,p,l===u),a=0,l++}}a++,r++}return F_(n,"")},hq=function(e){var n=[],t=cq(lq(fq(e),x_,"."),"."),r,a;for(r=0;r<t.length;r++)a=t[r],La(n,oq(uq,a)?"xn--"+vq(a):a);return F_(n,".")},yq=ft,gq=lt,mq=Ja,bq=RangeError,B_=String.fromCharCode,q_=String.fromCodePoint,wq=gq([].join),Sq=!!q_&&q_.length!==1;yq({target:"String",stat:!0,arity:1,forced:Sq},{fromCodePoint:function(n){for(var t=[],r=arguments.length,a=0,i;r>a;){if(i=+arguments[a++],mq(i,1114111)!==i)throw new bq(i+" is not a valid code point");t[a]=i<65536?B_(i):B_(((i-=65536)>>10)+55296,i%1024+56320)}return wq(t,"")}});var Gp=ft,W_=yt,Hp=mg,_q=Hr,Il=Pt,yn=lt,$u=Lt,z_=M_,G_=Sr,kq=Mn,$q=Yo,Tq=An,Cq=bm,Vp=Fr,H_=ka,Kp=Mt,Eq=Vt,Iq=Qn,Rq=Jn,Oq=Jt,V_=qt,Cr=rr,Aq=ba,K_=Ha,Y_=To,Pq=Vs,Rl=Oo,is=tf,Mq=Nt,Nq=hp,xq=Mq("iterator"),ss="URLSearchParams",J_=ss+"Iterator",Q_=Vp.set,Xr=Vp.getterFor(ss),Lq=Vp.getterFor(J_),X_=Hp("fetch"),Ol=Hp("Request"),Tu=Hp("Headers"),Yp=Ol&&Ol.prototype,Z_=Tu&&Tu.prototype,jq=W_.TypeError,Uq=W_.encodeURIComponent,Fq=String.fromCharCode,Dq=_q("String","fromCodePoint"),Bq=parseInt,Al=yn("".charAt),ek=yn([].join),ja=yn([].push),tk=yn("".replace),qq=yn([].shift),rk=yn([].splice),nk=yn("".split),ak=yn("".slice),Wq=yn(/./.exec),zq=/\+/g,Jp="ï¿½",Gq=/^[0-9a-f]+$/i,ik=function(e,n){var t=ak(e,n,n+2);return Wq(Gq,t)?Bq(t,16):NaN},Hq=function(e){for(var n=0,t=128;t>0&&e&t;t>>=1)n++;return n},Vq=function(e){var n=null;switch(e.length){case 1:n=e[0];break;case 2:n=(e[0]&31)<<6|e[1]&63;break;case 3:n=(e[0]&15)<<12|(e[1]&63)<<6|e[2]&63;break;case 4:n=(e[0]&7)<<18|(e[1]&63)<<12|(e[2]&63)<<6|e[3]&63;break}return n>1114111?null:n},sk=function(e){e=tk(e,zq," ");for(var n=e.length,t="",r=0;r<n;){var a=Al(e,r);if(a==="%"){if(Al(e,r+1)==="%"||r+3>n){t+="%",r++;continue}var i=ik(e,r+1);if(i!==i){t+=a,r++;continue}r+=2;var s=Hq(i);if(s===0)a=Fq(i);else{if(s===1||s>4){t+=Jp,r++;continue}for(var o=[i],u=1;u<s&&(r++,!(r+3>n||Al(e,r)!=="%"));){var l=ik(e,r+1);if(l!==l){r+=3;break}if(l>191||l<128)break;ja(o,l),r+=2,u++}if(o.length!==s){t+=Jp;continue}var c=Vq(o);c===null?t+=Jp:a=Dq(c)}}t+=a,r++}return t},Kq=/[!'()~]|%20/g,Yq={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Jq=function(e){return Yq[e]},uk=function(e){return tk(Uq(e),Kq,Jq)},Qp=Cq(function(n,t){Q_(this,{type:J_,target:Xr(n).entries,index:0,kind:t})},ss,function(){var n=Lq(this),t=n.target,r=n.index++;if(!t||r>=t.length)return n.target=null,Rl(void 0,!0);var a=t[r];switch(n.kind){case"keys":return Rl(a.key,!1);case"values":return Rl(a.value,!1)}return Rl([a.key,a.value],!1)},!0),ok=function(e){this.entries=[],this.url=null,e!==void 0&&(V_(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Al(e,0)==="?"?ak(e,1):e:Cr(e)))};ok.prototype={type:ss,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var n=this.entries,t=Pq(e),r,a,i,s,o,u,l;if(t)for(r=Y_(e,t),a=r.next;!(i=Il(a,r)).done;){if(s=Y_(Oq(i.value)),o=s.next,(u=Il(o,s)).done||(l=Il(o,s)).done||!Il(o,s).done)throw new jq("Expected sequence with length 2");ja(n,{key:Cr(u.value),value:Cr(l.value)})}else for(var c in e)Eq(e,c)&&ja(n,{key:c,value:Cr(e[c])})},parseQuery:function(e){if(e)for(var n=this.entries,t=nk(e,"&"),r=0,a,i;r<t.length;)a=t[r++],a.length&&(i=nk(a,"="),ja(n,{key:sk(qq(i)),value:sk(ek(i,"="))}))},serialize:function(){for(var e=this.entries,n=[],t=0,r;t<e.length;)r=e[t++],ja(n,uk(r.key)+"="+uk(r.value));return ek(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Pl=function(){H_(this,us);var n=arguments.length>0?arguments[0]:void 0,t=Q_(this,new ok(n));$u||(this.size=t.entries.length)},us=Pl.prototype;if($q(us,{append:function(n,t){var r=Xr(this);is(arguments.length,2),ja(r.entries,{key:Cr(n),value:Cr(t)}),$u||this.length++,r.updateURL()},delete:function(e){for(var n=Xr(this),t=is(arguments.length,1),r=n.entries,a=Cr(e),i=t<2?void 0:arguments[1],s=i===void 0?i:Cr(i),o=0;o<r.length;){var u=r[o];if(u.key===a&&(s===void 0||u.value===s)){if(rk(r,o,1),s!==void 0)break}else o++}$u||(this.size=r.length),n.updateURL()},get:function(n){var t=Xr(this).entries;is(arguments.length,1);for(var r=Cr(n),a=0;a<t.length;a++)if(t[a].key===r)return t[a].value;return null},getAll:function(n){var t=Xr(this).entries;is(arguments.length,1);for(var r=Cr(n),a=[],i=0;i<t.length;i++)t[i].key===r&&ja(a,t[i].value);return a},has:function(n){for(var t=Xr(this).entries,r=is(arguments.length,1),a=Cr(n),i=r<2?void 0:arguments[1],s=i===void 0?i:Cr(i),o=0;o<t.length;){var u=t[o++];if(u.key===a&&(s===void 0||u.value===s))return!0}return!1},set:function(n,t){var r=Xr(this);is(arguments.length,1);for(var a=r.entries,i=!1,s=Cr(n),o=Cr(t),u=0,l;u<a.length;u++)l=a[u],l.key===s&&(i?rk(a,u--,1):(i=!0,l.value=o));i||ja(a,{key:s,value:o}),$u||(this.size=a.length),r.updateURL()},sort:function(){var n=Xr(this);Nq(n.entries,function(t,r){return t.key>r.key?1:-1}),n.updateURL()},forEach:function(n){for(var t=Xr(this).entries,r=Iq(n,arguments.length>1?arguments[1]:void 0),a=0,i;a<t.length;)i=t[a++],r(i.value,i.key,this)},keys:function(){return new Qp(this,"keys")},values:function(){return new Qp(this,"values")},entries:function(){return new Qp(this,"entries")}},{enumerable:!0}),G_(us,xq,us.entries,{name:"entries"}),G_(us,"toString",function(){return Xr(this).serialize()},{enumerable:!0}),$u&&kq(us,"size",{get:function(){return Xr(this).entries.length},configurable:!0,enumerable:!0}),Tq(Pl,ss),Gp({global:!0,constructor:!0,forced:!z_},{URLSearchParams:Pl}),!z_&&Kp(Tu)){var Qq=yn(Z_.has),Xq=yn(Z_.set),lk=function(e){if(V_(e)){var n=e.body,t;if(Rq(n)===ss)return t=e.headers?new Tu(e.headers):new Tu,Qq(t,"content-type")||Xq(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Aq(e,{body:K_(0,Cr(n)),headers:K_(0,t)})}return e};if(Kp(X_)&&Gp({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(n){return X_(n,arguments.length>1?lk(arguments[1]):{})}}),Kp(Ol)){var Xp=function(n){return H_(this,Yp),new Ol(n,arguments.length>1?lk(arguments[1]):{})};Yp.constructor=Xp,Xp.prototype=Yp,Gp({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Xp})}}var Zq={URLSearchParams:Pl,getState:Xr},eW=ft,Zp=Lt,tW=M_,ev=yt,ck=Qn,Zr=lt,Ml=Sr,en=Mn,rW=ka,tv=Vt,rv=WS,os=dm,gn=Pn,nW=Of.codeAt,aW=hq,da=rr,iW=An,sW=tf,fk=Zq,dk=Fr,uW=dk.set,Nl=dk.getterFor("URL"),oW=fk.URLSearchParams,lW=fk.getState,Cu=ev.URL,nv=ev.TypeError,xl=ev.parseInt,cW=Math.floor,pk=Math.pow,tn=Zr("".charAt),mn=Zr(/./.exec),Eu=Zr([].join),fW=Zr(1 .toString),dW=Zr([].pop),ls=Zr([].push),av=Zr("".replace),pW=Zr([].shift),vW=Zr("".split),Iu=Zr("".slice),Ll=Zr("".toLowerCase),hW=Zr([].unshift),yW="Invalid authority",iv="Invalid scheme",yi="Invalid host",vk="Invalid port",hk=/[a-z]/i,gW=/[\d+-.a-z]/i,sv=/\d/,mW=/^0x/i,bW=/^[0-7]+$/,wW=/^\d+$/,yk=/^[\da-f]+$/i,SW=/[\0\t\n\r #%/:<>?@[\\\]^|]/,_W=/[\0\t\n\r #/:<>?@[\\\]^|]/,kW=/^[\u0000-\u0020]+/,$W=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,TW=/[\t\n\r]/g,rn,CW=function(e){var n=vW(e,"."),t,r,a,i,s,o,u;if(n.length&&n[n.length-1]===""&&n.length--,t=n.length,t>4)return e;for(r=[],a=0;a<t;a++){if(i=n[a],i==="")return e;if(s=10,i.length>1&&tn(i,0)==="0"&&(s=mn(mW,i)?16:8,i=Iu(i,s===8?1:2)),i==="")o=0;else{if(!mn(s===10?wW:s===8?bW:yk,i))return e;o=xl(i,s)}ls(r,o)}for(a=0;a<t;a++)if(o=r[a],a===t-1){if(o>=pk(256,5-t))return null}else if(o>255)return null;for(u=dW(r),a=0;a<r.length;a++)u+=r[a]*pk(256,3-a);return u},EW=function(e){var n=[0,0,0,0,0,0,0,0],t=0,r=null,a=0,i,s,o,u,l,c,p,S=function(){return tn(e,a)};if(S()===":"){if(tn(e,1)!==":")return;a+=2,t++,r=t}for(;S();){if(t===8)return;if(S()===":"){if(r!==null)return;a++,t++,r=t;continue}for(i=s=0;s<4&&mn(yk,S());)i=i*16+xl(S(),16),a++,s++;if(S()==="."){if(s===0||(a-=s,t>6))return;for(o=0;S();){if(u=null,o>0)if(S()==="."&&o<4)a++;else return;if(!mn(sv,S()))return;for(;mn(sv,S());){if(l=xl(S(),10),u===null)u=l;else{if(u===0)return;u=u*10+l}if(u>255)return;a++}n[t]=n[t]*256+u,o++,(o===2||o===4)&&t++}if(o!==4)return;break}else if(S()===":"){if(a++,!S())return}else if(S())return;n[t++]=i}if(r!==null)for(c=t-r,t=7;t!==0&&c>0;)p=n[t],n[t--]=n[r+c-1],n[r+--c]=p;else if(t!==8)return;return n},IW=function(e){for(var n=null,t=1,r=null,a=0,i=0;i<8;i++)e[i]!==0?(a>t&&(n=r,t=a),r=null,a=0):(r===null&&(r=i),++a);return a>t?r:n},Ru=function(e){var n,t,r,a;if(typeof e=="number"){for(n=[],t=0;t<4;t++)hW(n,e%256),e=cW(e/256);return Eu(n,".")}if(typeof e=="object"){for(n="",r=IW(e),t=0;t<8;t++)a&&e[t]===0||(a&&(a=!1),r===t?(n+=t?":":"::",a=!0):(n+=fW(e[t],16),t<7&&(n+=":")));return"["+n+"]"}return e},jl={},gk=rv({},jl,{" ":1,'"':1,"<":1,">":1,"`":1}),mk=rv({},gk,{"#":1,"?":1,"{":1,"}":1}),uv=rv({},mk,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ua=function(e,n){var t=nW(e,0);return t>32&&t<127&&!tv(n,e)?e:encodeURIComponent(e)},Ul={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Ou=function(e,n){var t;return e.length===2&&mn(hk,tn(e,0))&&((t=tn(e,1))===":"||!n&&t==="|")},bk=function(e){var n;return e.length>1&&Ou(Iu(e,0,2))&&(e.length===2||(n=tn(e,2))==="/"||n==="\\"||n==="?"||n==="#")},RW=function(e){return e==="."||Ll(e)==="%2e"},OW=function(e){return e=Ll(e),e===".."||e==="%2e."||e===".%2e"||e==="%2e%2e"},ov={},wk={},lv={},Sk={},_k={},cv={},kk={},$k={},Fl={},Dl={},fv={},dv={},pv={},vv={},Tk={},hv={},cs={},Bn={},Ck={},gi={},pa={},yv=function(e,n,t){var r=da(e),a,i,s;if(n){if(i=this.parse(r),i)throw new nv(i);this.searchParams=null}else{if(t!==void 0&&(a=new yv(t,!0)),i=this.parse(r,null,a),i)throw new nv(i);s=lW(new oW),s.bindURL(this),this.searchParams=s}};yv.prototype={type:"URL",parse:function(e,n,t){var r=this,a=n||ov,i=0,s="",o=!1,u=!1,l=!1,c,p,S,T;for(e=da(e),n||(r.scheme="",r.username="",r.password="",r.host=null,r.port=null,r.path=[],r.query=null,r.fragment=null,r.cannotBeABaseURL=!1,e=av(e,kW,""),e=av(e,$W,"$1")),e=av(e,TW,""),c=os(e);i<=c.length;){switch(p=c[i],a){case ov:if(p&&mn(hk,p))s+=Ll(p),a=wk;else{if(n)return iv;a=lv;continue}break;case wk:if(p&&(mn(gW,p)||p==="+"||p==="-"||p==="."))s+=Ll(p);else if(p===":"){if(n&&(r.isSpecial()!==tv(Ul,s)||s==="file"&&(r.includesCredentials()||r.port!==null)||r.scheme==="file"&&!r.host))return;if(r.scheme=s,n){r.isSpecial()&&Ul[r.scheme]===r.port&&(r.port=null);return}s="",r.scheme==="file"?a=vv:r.isSpecial()&&t&&t.scheme===r.scheme?a=Sk:r.isSpecial()?a=$k:c[i+1]==="/"?(a=_k,i++):(r.cannotBeABaseURL=!0,ls(r.path,""),a=Ck)}else{if(n)return iv;s="",a=lv,i=0;continue}break;case lv:if(!t||t.cannotBeABaseURL&&p!=="#")return iv;if(t.cannotBeABaseURL&&p==="#"){r.scheme=t.scheme,r.path=gn(t.path),r.query=t.query,r.fragment="",r.cannotBeABaseURL=!0,a=pa;break}a=t.scheme==="file"?vv:cv;continue;case Sk:if(p==="/"&&c[i+1]==="/")a=Fl,i++;else{a=cv;continue}break;case _k:if(p==="/"){a=Dl;break}else{a=Bn;continue}case cv:if(r.scheme=t.scheme,p===rn)r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=gn(t.path),r.query=t.query;else if(p==="/"||p==="\\"&&r.isSpecial())a=kk;else if(p==="?")r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=gn(t.path),r.query="",a=gi;else if(p==="#")r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=gn(t.path),r.query=t.query,r.fragment="",a=pa;else{r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=gn(t.path),r.path.length--,a=Bn;continue}break;case kk:if(r.isSpecial()&&(p==="/"||p==="\\"))a=Fl;else if(p==="/")a=Dl;else{r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,a=Bn;continue}break;case $k:if(a=Fl,p!=="/"||tn(s,i+1)!=="/")continue;i++;break;case Fl:if(p!=="/"&&p!=="\\"){a=Dl;continue}break;case Dl:if(p==="@"){o&&(s="%40"+s),o=!0,S=os(s);for(var I=0;I<S.length;I++){var x=S[I];if(x===":"&&!l){l=!0;continue}var U=Ua(x,uv);l?r.password+=U:r.username+=U}s=""}else if(p===rn||p==="/"||p==="?"||p==="#"||p==="\\"&&r.isSpecial()){if(o&&s==="")return yW;i-=os(s).length+1,s="",a=fv}else s+=p;break;case fv:case dv:if(n&&r.scheme==="file"){a=hv;continue}else if(p===":"&&!u){if(s==="")return yi;if(T=r.parseHost(s),T)return T;if(s="",a=pv,n===dv)return}else if(p===rn||p==="/"||p==="?"||p==="#"||p==="\\"&&r.isSpecial()){if(r.isSpecial()&&s==="")return yi;if(n&&s===""&&(r.includesCredentials()||r.port!==null))return;if(T=r.parseHost(s),T)return T;if(s="",a=cs,n)return;continue}else p==="["?u=!0:p==="]"&&(u=!1),s+=p;break;case pv:if(mn(sv,p))s+=p;else if(p===rn||p==="/"||p==="?"||p==="#"||p==="\\"&&r.isSpecial()||n){if(s!==""){var F=xl(s,10);if(F>65535)return vk;r.port=r.isSpecial()&&F===Ul[r.scheme]?null:F,s=""}if(n)return;a=cs;continue}else return vk;break;case vv:if(r.scheme="file",p==="/"||p==="\\")a=Tk;else if(t&&t.scheme==="file")switch(p){case rn:r.host=t.host,r.path=gn(t.path),r.query=t.query;break;case"?":r.host=t.host,r.path=gn(t.path),r.query="",a=gi;break;case"#":r.host=t.host,r.path=gn(t.path),r.query=t.query,r.fragment="",a=pa;break;default:bk(Eu(gn(c,i),""))||(r.host=t.host,r.path=gn(t.path),r.shortenPath()),a=Bn;continue}else{a=Bn;continue}break;case Tk:if(p==="/"||p==="\\"){a=hv;break}t&&t.scheme==="file"&&!bk(Eu(gn(c,i),""))&&(Ou(t.path[0],!0)?ls(r.path,t.path[0]):r.host=t.host),a=Bn;continue;case hv:if(p===rn||p==="/"||p==="\\"||p==="?"||p==="#"){if(!n&&Ou(s))a=Bn;else if(s===""){if(r.host="",n)return;a=cs}else{if(T=r.parseHost(s),T)return T;if(r.host==="localhost"&&(r.host=""),n)return;s="",a=cs}continue}else s+=p;break;case cs:if(r.isSpecial()){if(a=Bn,p!=="/"&&p!=="\\")continue}else if(!n&&p==="?")r.query="",a=gi;else if(!n&&p==="#")r.fragment="",a=pa;else if(p!==rn&&(a=Bn,p!=="/"))continue;break;case Bn:if(p===rn||p==="/"||p==="\\"&&r.isSpecial()||!n&&(p==="?"||p==="#")){if(OW(s)?(r.shortenPath(),p!=="/"&&!(p==="\\"&&r.isSpecial())&&ls(r.path,"")):RW(s)?p!=="/"&&!(p==="\\"&&r.isSpecial())&&ls(r.path,""):(r.scheme==="file"&&!r.path.length&&Ou(s)&&(r.host&&(r.host=""),s=tn(s,0)+":"),ls(r.path,s)),s="",r.scheme==="file"&&(p===rn||p==="?"||p==="#"))for(;r.path.length>1&&r.path[0]==="";)pW(r.path);p==="?"?(r.query="",a=gi):p==="#"&&(r.fragment="",a=pa)}else s+=Ua(p,mk);break;case Ck:p==="?"?(r.query="",a=gi):p==="#"?(r.fragment="",a=pa):p!==rn&&(r.path[0]+=Ua(p,jl));break;case gi:!n&&p==="#"?(r.fragment="",a=pa):p!==rn&&(p==="'"&&r.isSpecial()?r.query+="%27":p==="#"?r.query+="%23":r.query+=Ua(p,jl));break;case pa:p!==rn&&(r.fragment+=Ua(p,gk));break}i++}},parseHost:function(e){var n,t,r;if(tn(e,0)==="["){if(tn(e,e.length-1)!=="]"||(n=EW(Iu(e,1,-1)),!n))return yi;this.host=n}else if(this.isSpecial()){if(e=aW(e),mn(SW,e)||(n=CW(e),n===null))return yi;this.host=n}else{if(mn(_W,e))return yi;for(n="",t=os(e),r=0;r<t.length;r++)n+=Ua(t[r],jl);this.host=n}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return tv(Ul,this.scheme)},shortenPath:function(){var e=this.path,n=e.length;n&&(this.scheme!=="file"||n!==1||!Ou(e[0],!0))&&e.length--},serialize:function(){var e=this,n=e.scheme,t=e.username,r=e.password,a=e.host,i=e.port,s=e.path,o=e.query,u=e.fragment,l=n+":";return a!==null?(l+="//",e.includesCredentials()&&(l+=t+(r?":"+r:"")+"@"),l+=Ru(a),i!==null&&(l+=":"+i)):n==="file"&&(l+="//"),l+=e.cannotBeABaseURL?s[0]:s.length?"/"+Eu(s,"/"):"",o!==null&&(l+="?"+o),u!==null&&(l+="#"+u),l},setHref:function(e){var n=this.parse(e);if(n)throw new nv(n);this.searchParams.update()},getOrigin:function(){var e=this.scheme,n=this.port;if(e==="blob")try{return new fs(e.path[0]).origin}catch{return"null"}return e==="file"||!this.isSpecial()?"null":e+"://"+Ru(this.host)+(n!==null?":"+n:"")},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(da(e)+":",ov)},getUsername:function(){return this.username},setUsername:function(e){var n=os(da(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var t=0;t<n.length;t++)this.username+=Ua(n[t],uv)}},getPassword:function(){return this.password},setPassword:function(e){var n=os(da(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var t=0;t<n.length;t++)this.password+=Ua(n[t],uv)}},getHost:function(){var e=this.host,n=this.port;return e===null?"":n===null?Ru(e):Ru(e)+":"+n},setHost:function(e){this.cannotBeABaseURL||this.parse(e,fv)},getHostname:function(){var e=this.host;return e===null?"":Ru(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,dv)},getPort:function(){var e=this.port;return e===null?"":da(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(e=da(e),e===""?this.port=null:this.parse(e,pv))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Eu(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,cs))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){e=da(e),e===""?this.query=null:(tn(e,0)==="?"&&(e=Iu(e,1)),this.query="",this.parse(e,gi)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){if(e=da(e),e===""){this.fragment=null;return}tn(e,0)==="#"&&(e=Iu(e,1)),this.fragment="",this.parse(e,pa)},update:function(){this.query=this.searchParams.serialize()||null}};var fs=function(n){var t=rW(this,Er),r=sW(arguments.length,1)>1?arguments[1]:void 0,a=uW(t,new yv(n,!1,r));Zp||(t.href=a.serialize(),t.origin=a.getOrigin(),t.protocol=a.getProtocol(),t.username=a.getUsername(),t.password=a.getPassword(),t.host=a.getHost(),t.hostname=a.getHostname(),t.port=a.getPort(),t.pathname=a.getPathname(),t.search=a.getSearch(),t.searchParams=a.getSearchParams(),t.hash=a.getHash())},Er=fs.prototype,nn=function(e,n){return{get:function(){return Nl(this)[e]()},set:n&&function(t){return Nl(this)[n](t)},configurable:!0,enumerable:!0}};if(Zp&&(en(Er,"href",nn("serialize","setHref")),en(Er,"origin",nn("getOrigin")),en(Er,"protocol",nn("getProtocol","setProtocol")),en(Er,"username",nn("getUsername","setUsername")),en(Er,"password",nn("getPassword","setPassword")),en(Er,"host",nn("getHost","setHost")),en(Er,"hostname",nn("getHostname","setHostname")),en(Er,"port",nn("getPort","setPort")),en(Er,"pathname",nn("getPathname","setPathname")),en(Er,"search",nn("getSearch","setSearch")),en(Er,"searchParams",nn("getSearchParams")),en(Er,"hash",nn("getHash","setHash"))),Ml(Er,"toJSON",function(){return Nl(this).serialize()},{enumerable:!0}),Ml(Er,"toString",function(){return Nl(this).serialize()},{enumerable:!0}),Cu){var Ek=Cu.createObjectURL,Ik=Cu.revokeObjectURL;Ek&&Ml(fs,"createObjectURL",ck(Ek,Cu)),Ik&&Ml(fs,"revokeObjectURL",ck(Ik,Cu))}iW(fs,"URL"),eW({global:!0,constructor:!0,forced:!tW,sham:!Zp},{URL:fs});/*
	@license
	Copyright (c) 2018, Twilio, Inc.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted, provided that the above
	copyright notice and this permission notice appear in all copies.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
	WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
	MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
	SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
	WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
	OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
	CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

	*/(function(e){var n=typeof n<"u"?n:typeof self<"u"?self:typeof window<"u"?window:{};Object.defineProperty(e,"__esModule",{value:!0});var t=Ln,r=_a,a=Nn,i=xn,s=Jr,o=_l,u=ti,l=Ds,c=Ys,p=Yr,S=Zs,T=ia,I=ur;function x(H){return H&&typeof H=="object"&&"default"in H?H:{default:H}}function U(H){if(H&&H.__esModule)return H;var ee=Object.create(null);return H&&Object.keys(H).forEach(function(D){if(D!=="default"){var Y=Object.getOwnPropertyDescriptor(H,D);Object.defineProperty(ee,D,Y.get?Y:{enumerable:!0,get:function(){return H[D]}})}}),ee.default=H,Object.freeze(ee)}var F=x(t),V=x(r),Ae=x(a),de=x(i),Ge=x(s),Ee=x(o),Ue=x(u),B=x(l),ce=x(c),ke=x(p),pe=U(S),Le={exports:{}},Z=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(Z){var Pe=new Uint8Array(16);Le.exports=function(){return Z(Pe),Pe}}else{var Fe=new Array(16);Le.exports=function(){for(var ee=0,D;ee<16;ee++)ee&3||(D=Math.random()*4294967296),Fe[ee]=D>>>((ee&3)<<3)&255;return Fe}}for(var wt=[],mt=0;mt<256;++mt)wt[mt]=(mt+256).toString(16).substr(1);function Ce(H,ee){var D=ee||0,Y=wt;return[Y[H[D++]],Y[H[D++]],Y[H[D++]],Y[H[D++]],"-",Y[H[D++]],Y[H[D++]],"-",Y[H[D++]],Y[H[D++]],"-",Y[H[D++]],Y[H[D++]],"-",Y[H[D++]],Y[H[D++]],Y[H[D++]],Y[H[D++]],Y[H[D++]],Y[H[D++]]].join("")}var se=Ce,ie=Le.exports,O=se,Ie,Je,Me=0,be=0;function z(H,ee,D){var Y=ee&&D||0,q=ee||[];H=H||{};var Re=H.node||Ie,me=H.clockseq!==void 0?H.clockseq:Je;if(Re==null||me==null){var De=ie();Re==null&&(Re=Ie=[De[0]|1,De[1],De[2],De[3],De[4],De[5]]),me==null&&(me=Je=(De[6]<<8|De[7])&16383)}var je=H.msecs!==void 0?H.msecs:new Date().getTime(),Be=H.nsecs!==void 0?H.nsecs:be+1,Ve=je-Me+(Be-be)/1e4;if(Ve<0&&H.clockseq===void 0&&(me=me+1&16383),(Ve<0||je>Me)&&H.nsecs===void 0&&(Be=0),Be>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Me=je,be=Be,Je=me,je+=122192928e5;var Ke=((je&268435455)*1e4+Be)%4294967296;q[Y++]=Ke>>>24&255,q[Y++]=Ke>>>16&255,q[Y++]=Ke>>>8&255,q[Y++]=Ke&255;var ze=je/4294967296*1e4&268435455;q[Y++]=ze>>>8&255,q[Y++]=ze&255,q[Y++]=ze>>>24&15|16,q[Y++]=ze>>>16&255,q[Y++]=me>>>8|128,q[Y++]=me&255;for(var He=0;He<6;++He)q[Y+He]=Re[He];return ee||O(q)}var xt=z,ye=Le.exports,te=se;function St(H,ee,D){var Y=ee&&D||0;typeof H=="string"&&(ee=H==="binary"?new Array(16):null,H=null),H=H||{};var q=H.random||(H.rng||ye)();if(q[6]=q[6]&15|64,q[8]=q[8]&63|128,ee)for(var Re=0;Re<16;++Re)ee[Y+Re]=q[Re];return ee||te(q)}var Ne=St,zt=xt,dt=Ne,_e=dt;_e.v1=zt,_e.v4=dt;var it=_e;function bt(H){var ee=$e();return function(){var Y=Ge.default(H),q;if(ee){var Re=Ge.default(this).constructor;q=Reflect.construct(Y,arguments,Re)}else q=Y.apply(this,arguments);return de.default(this,q)}}function $e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Kt=function(H){Ae.default(D,H);var ee=bt(D);function D(Y){var q;F.default(this,D);var Re=it.v4(),me;return q=ee.call(this,function(De,je){return me=je,Y(function(Be){D.cancellationMap.delete(Re),De(Be)},function(Be){D.cancellationMap.delete(Re),je(Be)},function(Be){D.cancellationMap.set(Re,Be)})}),q.id=Re,q.rejectPromise=me,q}return V.default(D,[{key:"cancel",value:function(){var q=D.cancellationMap.get(this.id);return q==null||q(),this.rejectPromise&&(this.catch(function(){}),this.rejectPromise(new Error("Promise was cancelled"))),this}}]),D}(Ee.default(Promise));Ue.default(Kt,"cancellationMap",new Map);function pt(H,ee,D,Y){var q=arguments.length,Re=q<3?ee:Y===null?Y=Object.getOwnPropertyDescriptor(ee,D):Y,me;if((typeof Reflect>"u"?"undefined":ke.default(Reflect))==="object"&&typeof Reflect.decorate=="function")Re=Reflect.decorate(H,ee,D,Y);else for(var De=H.length-1;De>=0;De--)(me=H[De])&&(Re=(q<3?me(Re):q>3?me(ee,D,Re):me(ee,D))||Re);return q>3&&Re&&Object.defineProperty(ee,D,Re),Re}function Wt(H,ee){if((typeof Reflect>"u"?"undefined":ke.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(H,ee)}function er(H,ee){return["".concat(new Date().toISOString()," MCS Client ").concat(H,":")].concat(Array.from(ee))}var xe=function(){function H(ee){F.default(this,H),Ue.default(this,"prefix",""),this.prefix=ee!=null&&ee.length>0?ee+" ":""}return V.default(H,[{key:"setLevel",value:function(D){pe.setLevel(D)}},{key:"trace",value:function(){if(pe.getLevel()==pe.levels.TRACE){for(var D=arguments.length,Y=new Array(D),q=0;q<D;q++)Y[q]=arguments[q];pe.debug.apply(null,er(this.prefix+"T",Y))}}},{key:"debug",value:function(){for(var D=arguments.length,Y=new Array(D),q=0;q<D;q++)Y[q]=arguments[q];pe.debug.apply(null,er(this.prefix+"D",Y))}},{key:"info",value:function(){for(var D=arguments.length,Y=new Array(D),q=0;q<D;q++)Y[q]=arguments[q];pe.info.apply(null,er(this.prefix+"I",Y))}},{key:"warn",value:function(){for(var D=arguments.length,Y=new Array(D),q=0;q<D;q++)Y[q]=arguments[q];pe.warn.apply(null,er(this.prefix+"W",Y))}},{key:"error",value:function(){for(var D=arguments.length,Y=new Array(D),q=0;q<D;q++)Y[q]=arguments[q];pe.error.apply(null,er(this.prefix+"E",Y))}}],[{key:"scope",value:function(D){return new H(D)}},{key:"setLevel",value:function(D){pe.setLevel(D)}},{key:"trace",value:function(){if(pe.getLevel()==pe.levels.TRACE){for(var D=arguments.length,Y=new Array(D),q=0;q<D;q++)Y[q]=arguments[q];pe.debug.apply(null,er("T",Y))}}},{key:"debug",value:function(){for(var D=arguments.length,Y=new Array(D),q=0;q<D;q++)Y[q]=arguments[q];pe.debug.apply(null,er("D",Y))}},{key:"info",value:function(){for(var D=arguments.length,Y=new Array(D),q=0;q<D;q++)Y[q]=arguments[q];pe.info.apply(null,er("I",Y))}},{key:"warn",value:function(){for(var D=arguments.length,Y=new Array(D),q=0;q<D;q++)Y[q]=arguments[q];pe.warn.apply(null,er("W",Y))}},{key:"error",value:function(){for(var D=arguments.length,Y=new Array(D),q=0;q<D;q++)Y[q]=arguments[q];pe.error.apply(null,er("E",Y))}}]),H}(),zr=1e3,bn=4e3,Ct=3,Dt=!0,gt=function(ee){return"https://mcs.".concat(ee??"us1",".twilio.com")},tt=function(ee){return ee.startsWith("http")},Ft=function(ee,D){return"".concat(tt(ee)?"":gt(D)).concat(ee)},At=function(){function H(ee,D,Y,q){var Re,me,De,je,Be,Ve;F.default(this,H);var Ke=(Re=(me=q.MCS)!==null&&me!==void 0?me:q)!==null&&Re!==void 0?Re:{};this.region=(De=(je=Ke.region)!==null&&je!==void 0?je:q.region)!==null&&De!==void 0?De:"us1",this.mediaUrl=Ft(D,this.region),this.mediaSetUrl=Y?Ft(Y):"".concat(this.mediaUrl,"Set"),this.token=ee,this.retryWhenThrottledOverride=(Be=Ke.retryWhenThrottledOverride)!==null&&Be!==void 0?Be:Dt,this.backoffConfigOverride=(Ve=Ke.backoffConfigOverride)!==null&&Ve!==void 0?Ve:H.backoffConfigDefault}return V.default(H,[{key:"updateToken",value:function(D){this.token=D}}],[{key:"backoffConfigDefault",get:function(){return{min:zr,max:bn,maxAttemptsCount:Ct}}},{key:"retryWhenThrottledDefault",get:function(){return Dt}}]),H}(),ar=function(){function H(ee,D,Y){F.default(this,H),this.config=ee,this.network=D,this._update(Y)}return V.default(H,[{key:"sid",get:function(){return this.state.sid}},{key:"serviceSid",get:function(){return this.state.serviceSid}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"fileName",get:function(){return this.state.filename}},{key:"filename",get:function(){return this.state.filename}},{key:"category",get:function(){return this.state.category}},{key:"getContentUrl",value:function(){var D=this;return new Kt(function(){var Y=B.default(ce.default.mark(function q(Re,me,De){var je,Be;return ce.default.wrap(function(Ke){for(;;)switch(Ke.prev=Ke.next){case 0:return je=D.network.get("".concat(D.config.mediaUrl,"/").concat(D.sid)),De(function(){return je.cancel()}),Ke.prev=2,Ke.next=5,je;case 5:Be=Ke.sent,D._update(Be.body),Re(D.state.contentDirectUrl),Ke.next=13;break;case 10:Ke.prev=10,Ke.t0=Ke.catch(2),me(Ke.t0);case 13:case"end":return Ke.stop()}},q,null,[[2,10]])}));return function(q,Re,me){return Y.apply(this,arguments)}}())}},{key:"_update",value:function(D){var Y,q,Re,me;this.state={sid:D.sid,serviceSid:D.service_sid,channelSid:D.channel_sid,messageSid:D.message_sid,dateCreated:D.date_created?new Date(D.date_created):null,dateUploadUpdated:D.date_upload_updated?new Date(D.date_upload_updated):null,dateUpdated:D.date_updated?new Date(D.date_updated):null,size:D.size,contentType:D.content_type,author:D.author,url:D.url,contentUrl:D.links.content,contentDirectUrl:(Y=D.links.content_direct_temporary)!==null&&Y!==void 0?Y:null,filename:(q=D.filename)!==null&&q!==void 0?q:null,category:(Re=D.category)!==null&&Re!==void 0?Re:"media",isMultipartUpstream:(me=D.is_multipart_upstream)!==null&&me!==void 0?me:!1}}},{key:"_state",value:function(){var D;return{sid:this.state.sid,category:this.state.category,filename:(D=this.state.filename)!==null&&D!==void 0?D:null,contentType:this.state.contentType,size:this.state.size}}}]),H}();function Gr(H){var ee=wn();return function(){var Y=Ge.default(H),q;if(ee){var Re=Ge.default(this).constructor;q=Reflect.construct(Y,arguments,Re)}else q=Y.apply(this,arguments);return de.default(this,q)}}function wn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var qn=function(H){Ae.default(D,H);var ee=Gr(D);function D(Y,q,Re,me,De){var je;return F.default(this,D),je=ee.call(this,Y),je.code=q,je.body=Re,je.status=me,je.headers=De,je}return V.default(D)}(Ee.default(Error)),xr=n.XMLHttpRequest||{};function or(H){return H?H.split(`\r
`).map(function(ee){return ee.split(": ")}).filter(function(ee){return ee.length===2&&ee[1].length>0}).reduce(function(ee,D){return ee[D[0]]=D[1],ee},{}):{}}function ue(H){var ee=H.getResponseHeader("Content-Type");if(!ee||ee.indexOf("application/json")!==0||H.responseText.length===0)return H.responseText;try{return JSON.parse(H.responseText)}catch{return H.responseText}}var fe=function(){function H(){F.default(this,H)}return V.default(H,[{key:"get",value:function(D,Y){return H.request("GET",D,Y)}},{key:"post",value:function(D,Y,q){return H.request("POST",D,Y,q)}}],[{key:"request",value:function(D,Y,q,Re){return new Kt(function(me,De,je){var Be=new xr,Ve=!1;je(function(){Be.abort(),Ve=!0}),Be.open(D,Y,!0),Be.onreadystatechange=function(){if(!(Be.readyState!==4||Ve)){var He=or(Be.getAllResponseHeaders()),Qe=ue(Be);if(200<=Be.status&&Be.status<300)me({status:Be.status,headers:He,body:Qe});else{var rt,fr=(rt=Be.statusText)!==null&&rt!==void 0?rt:"NONE",Lr;if(typeof Qe=="string")if(Qe&&Qe.split(`
`,2).length===1)Lr=Qe;else{var nt,an=(nt=Qe.replace(/<.*?>/g,"").split(/\r\n/g).filter(function(mi){return mi.length})[0])===null||nt===void 0?void 0:nt.split(" ");Lr=(an==null?void 0:an.length)>2?an==null?void 0:an.slice(1).join(" "):""}else Lr=JSON.stringify(Qe);var qa="".concat(Be.status,": [").concat(fr,"] ").concat(Lr);De(new qn(qa,Be.status,Qe,fr,He))}}};for(var Ke in q)Be.setRequestHeader(Ke,q[Ke]),Ke==="Content-Type"&&q[Ke]==="application/json"&&(Re=JSON.stringify(Re));Be.send(Re)})}}]),H}(),J=xe.scope("Network"),ne=function(){function H(ee,D){F.default(this,H),this.config=ee,this.transport=D}return V.default(H,[{key:"backoffConfig",value:function(){return Object.assign(At.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){var D,Y;return(D=(Y=this.config.retryWhenThrottledOverride)!==null&&Y!==void 0?Y:At.retryWhenThrottledDefault)!==null&&D!==void 0?D:!1}},{key:"executeWithRetry",value:function(D,Y){var q=this;return new Kt(function(){var Re=B.default(ce.default.mark(function me(De,je,Be){var Ve,Ke;return ce.default.wrap(function(He){for(;;)switch(He.prev=He.next){case 0:Ve=new T.Retrier(q.backoffConfig()),Ke=[502,503,504],Y&&Ke.push(429),Be(function(){Ve.cancel(),Ve.removeAllListeners()}),Ve.on("attempt",B.default(ce.default.mark(function Qe(){var rt,fr;return ce.default.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:return nt.prev=0,rt=D(),Be(function(){rt.cancel(),Ve.cancel(),Ve.removeAllListeners()}),nt.next=5,rt;case 5:fr=nt.sent,Ve.succeeded(fr),nt.next=12;break;case 9:nt.prev=9,nt.t0=nt.catch(0),Ke.indexOf(nt.t0.status)>-1||nt.t0.message==="Twilsock disconnected"?Ve.failed(nt.t0):(Ve.removeAllListeners(),Ve.cancel(),je(nt.t0));case 12:case"end":return nt.stop()}},Qe,null,[[0,9]])}))),Ve.on("succeeded",function(Qe){De(Qe)}),Ve.on("cancelled",function(Qe){return je(Qe)}),Ve.on("failed",function(Qe){return je(Qe)}),Ve.start();case 9:case"end":return He.stop()}},me)}));return function(me,De,je){return Re.apply(this,arguments)}}())}},{key:"get",value:function(D){var Y=this;return new Kt(function(){var q=B.default(ce.default.mark(function Re(me,De,je){var Be,Ve,Ke;return ce.default.wrap(function(He){for(;;)switch(He.prev=He.next){case 0:return Be={"X-Twilio-Token":Y.config.token},Ve=Y.executeWithRetry(function(){return Y.transport.get(D,Be)},Y.retryWhenThrottled()),J.trace("sending GET request to ",D," headers ",Be),je(function(){return Ve.cancel()}),He.prev=4,He.next=7,Ve;case 7:Ke=He.sent,J.trace("response",Ke),me(Ke),He.next=16;break;case 12:He.prev=12,He.t0=He.catch(4),J.debug("get() error ".concat(He.t0)),De(He.t0);case 16:case"end":return He.stop()}},Re,null,[[4,12]])}));return function(Re,me,De){return q.apply(this,arguments)}}())}},{key:"post",value:function(D,Y,q,Re,me){var De=this,je={"X-Twilio-Token":this.config.token};(typeof FormData>"u"||!(q instanceof FormData))&&Re&&Object.assign(je,{"Content-Type":Re});var Be=new URL(D);return Y&&Be.searchParams.append("Category",Y),me&&Be.searchParams.append("Filename",me),new Kt(function(){var Ve=B.default(ce.default.mark(function Ke(ze,He,Qe){var rt,fr;return ce.default.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:return rt=De.transport.post(Be.href,je,q),Qe(function(){return rt.cancel()}),J.trace("sending POST request to ".concat(D," with headers ").concat(je)),nt.prev=3,nt.next=6,rt;case 6:fr=nt.sent,nt.next=17;break;case 9:if(nt.prev=9,nt.t0=nt.catch(3),!(n.XMLHttpRequest===void 0&&q instanceof FormData)){nt.next=14;break}return He(new TypeError("Posting FormData supported only with browser engine's FormData")),nt.abrupt("return");case 14:return J.debug("post() error ".concat(nt.t0)),He(nt.t0),nt.abrupt("return");case 17:J.trace("response",fr),ze(fr);case 19:case"end":return nt.stop()}},Ke,null,[[3,9]])}));return function(Ke,ze,He){return Ve.apply(this,arguments)}}())}}]),H}(),X="0.6.8",le,ge=xe.scope("");e.default=(le=function(){function H(ee,D,Y){var q,Re,me=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};F.default(this,H),this.options=me,this.options.logLevel=(q=this.options.logLevel)!==null&&q!==void 0?q:"silent",this.config=new At(ee,D,Y,this.options),ge.setLevel(this.options.logLevel),this.options.transport=(Re=this.options.transport)!==null&&Re!==void 0?Re:new fe,this.transport=this.options.transport,this.network=new ne(this.config,this.transport)}return V.default(H,[{key:"updateToken",value:function(D){ge.info("updateToken"),this.config.updateToken(D)}},{key:"get",value:function(D){var Y=this;return new Kt(function(){var q=B.default(ce.default.mark(function Re(me,De,je){var Be,Ve;return ce.default.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:return Be=Y.network.get("".concat(Y.config.mediaUrl,"/").concat(D)),je(function(){return Be.cancel()}),ze.prev=2,ze.next=5,Be;case 5:Ve=ze.sent,me(new ar(Y.config,Y.network,Ve.body)),ze.next=12;break;case 9:ze.prev=9,ze.t0=ze.catch(2),De(ze.t0);case 12:case"end":return ze.stop()}},Re,null,[[2,9]])}));return function(Re,me,De){return q.apply(this,arguments)}}())}},{key:"post",value:function(D,Y,q,Re){var me=this;return new Kt(function(){var De=B.default(ce.default.mark(function je(Be,Ve,Ke){var ze,He;return ce.default.wrap(function(rt){for(;;)switch(rt.prev=rt.next){case 0:return ze=me.network.post(me.config.mediaUrl,q??"media",Y,D,Re),Ke(function(){return ze.cancel()}),rt.prev=2,rt.next=5,ze;case 5:He=rt.sent,Be(new ar(me.config,me.network,He.body)),rt.next=12;break;case 9:rt.prev=9,rt.t0=rt.catch(2),Ve(rt.t0);case 12:case"end":return rt.stop()}},je,null,[[2,9]])}));return function(je,Be,Ve){return De.apply(this,arguments)}}())}},{key:"postFormData",value:function(D,Y){var q=this;return new Kt(function(){var Re=B.default(ce.default.mark(function me(De,je,Be){var Ve,Ke;return ce.default.wrap(function(He){for(;;)switch(He.prev=He.next){case 0:return Ve=q.network.post(q.config.mediaUrl,Y??"media",D),Be(function(){return Ve.cancel()}),He.prev=2,He.next=5,Ve;case 5:Ke=He.sent,De(new ar(q.config,q.network,Ke.body)),He.next=12;break;case 9:He.prev=9,He.t0=He.catch(2),je(He.t0);case 12:case"end":return He.stop()}},me,null,[[2,9]])}));return function(me,De,je){return Re.apply(this,arguments)}}())}},{key:"mediaSetGet",value:function(D){var Y=this;return new Kt(function(){var q=B.default(ce.default.mark(function Re(me,De,je){var Be,Ve,Ke,ze;return ce.default.wrap(function(Qe){for(;;)switch(Qe.prev=Qe.next){case 0:return Be={command:"get",list:D.map(function(rt){return{media_sid:rt}})},Ve=Y.network.post("".concat(Y.config.mediaSetUrl),null,Be,"application/json"),je(function(){return Ve.cancel()}),Qe.prev=3,Qe.next=6,Ve;case 6:Ke=Qe.sent,ze=Ke.body.map(function(rt){if(rt.code!==200){De("Failed to obtain detailed information about Media items (failed SID ".concat(rt.media_record.sid,")"));return}return new ar(Y.config,Y.network,rt.media_record)}),me(ze),Qe.next=14;break;case 11:Qe.prev=11,Qe.t0=Qe.catch(3),De(Qe.t0);case 14:case"end":return Qe.stop()}},Re,null,[[3,11]])}));return function(Re,me,De){return q.apply(this,arguments)}}())}},{key:"mediaSetGetContentUrls",value:function(D){var Y=this;return new Kt(function(){var q=B.default(ce.default.mark(function Re(me,De,je){var Be,Ve,Ke,ze;return ce.default.wrap(function(Qe){for(;;)switch(Qe.prev=Qe.next){case 0:return Be={command:"get",list:D.map(function(rt){return{media_sid:rt}})},Ve=Y.network.post("".concat(Y.config.mediaSetUrl),null,Be,"application/json"),je(function(){return Ve.cancel()}),Qe.prev=3,Qe.next=6,Ve;case 6:Ke=Qe.sent,ze=new Map,Ke.body.forEach(function(rt){if(rt.code!==200){De("Failed to obtain detailed information about Media items (failed SID ".concat(rt.media_record.sid,")"));return}ze.set(rt.media_record.sid,rt.media_record.links.content_direct_temporary)}),me(ze),Qe.next=15;break;case 12:Qe.prev=12,Qe.t0=Qe.catch(3),De(Qe.t0);case 15:case"end":return Qe.stop()}},Re,null,[[3,12]])}));return function(Re,me,De){return q.apply(this,arguments)}}())}}]),H}(),Ue.default(le,"version",X),le),pt([I.validateTypes(I.nonEmptyString),Wt("design:type",Function),Wt("design:paramtypes",[String]),Wt("design:returntype",void 0)],e.default.prototype,"updateToken",null),pt([I.validateTypesAsync(I.nonEmptyString),Wt("design:type",Function),Wt("design:paramtypes",[String]),Wt("design:returntype",Kt)],e.default.prototype,"get",null),e.default=pt([I.validateConstructorTypes(I.nonEmptyString,I.nonEmptyString,[I.nonEmptyString,I.literal(null)],[I.pureObject,"undefined"]),Wt("design:paramtypes",[String,String,Object,Object])],e.default),e.CancellablePromise=Kt,e.Client=e.default,e.McsClient=e.default,e.McsMedia=ar,e.Media=ar})(E_);var Rk=Ut,AW=hr,PW=On,MW=Rk.aTypedArray,NW=Rk.exportTypedArrayMethod;NW("at",function(n){var t=MW(this),r=AW(t),a=PW(n),i=a>=0?a:r+a;return i<0||i>=r?void 0:t[i]});var xW=ft,LW=yt,jW=d0,UW=po,gv="ArrayBuffer",Ok=jW[gv],FW=LW[gv];xW({global:!0,constructor:!0,forced:FW!==Ok},{ArrayBuffer:Ok}),UW(gv);var DW=ft,Ak=lt,BW=Vr,qW=vr,Pk=hr,WW=rp,Mk=rr,mv=at,zW=hp,GW=co,Nk=pS,HW=vS,xk=_i,Lk=yS,Fa=[],jk=Ak(Fa.sort),VW=Ak(Fa.push),KW=mv(function(){Fa.sort(void 0)}),YW=mv(function(){Fa.sort(null)}),JW=GW("sort"),Uk=!mv(function(){if(xk)return xk<70;if(!(Nk&&Nk>3)){if(HW)return!0;if(Lk)return Lk<603;var e="",n,t,r,a;for(n=65;n<76;n++){switch(t=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(a=0;a<47;a++)Fa.push({k:t+a,v:r})}for(Fa.sort(function(i,s){return s.v-i.v}),a=0;a<Fa.length;a++)t=Fa[a].k.charAt(0),e.charAt(e.length-1)!==t&&(e+=t);return e!=="DGBEFHACIJK"}}),QW=KW||!YW||!JW||!Uk,XW=function(e){return function(n,t){return t===void 0?-1:n===void 0?1:e!==void 0?+e(n,t)||0:Mk(n)>Mk(t)?1:-1}};DW({target:"Array",proto:!0,forced:QW},{sort:function(n){n!==void 0&&BW(n);var t=qW(this);if(Uk)return n===void 0?jk(t):jk(t,n);var r=[],a=Pk(t),i,s;for(s=0;s<a;s++)s in t&&VW(r,t[s]);for(zW(r,XW(n)),i=Pk(r),s=0;s<i;)t[s]=r[s++];for(;s<a;)WW(t,s++);return t}});var ZW=ft,ez=lt,tz=I_,rz=fn,Fk=rr,nz=R_,az=ez("".indexOf);ZW({target:"String",proto:!0,forced:!nz("includes")},{includes:function(n){return!!~az(Fk(rz(this)),Fk(tz(n)),arguments.length>1?arguments[1]:void 0)}});var iz=lt,Dk=Yo,Bl=Ko.getWeakData,sz=ka,uz=Jt,oz=cn,bv=qt,lz=Ks,Bk=Or,qk=Vt,Wk=Fr,cz=Wk.set,fz=Wk.getterFor,dz=Bk.find,pz=Bk.findIndex,vz=iz([].splice),hz=0,ql=function(e){return e.frozen||(e.frozen=new zk)},zk=function(){this.entries=[]},wv=function(e,n){return dz(e.entries,function(t){return t[0]===n})};zk.prototype={get:function(e){var n=wv(this,e);if(n)return n[1]},has:function(e){return!!wv(this,e)},set:function(e,n){var t=wv(this,e);t?t[1]=n:this.entries.push([e,n])},delete:function(e){var n=pz(this.entries,function(t){return t[0]===e});return~n&&vz(this.entries,n,1),!!~n}};var yz={getConstructor:function(e,n,t,r){var a=e(function(u,l){sz(u,i),cz(u,{type:n,id:hz++,frozen:null}),oz(l)||lz(l,u[r],{that:u,AS_ENTRIES:t})}),i=a.prototype,s=fz(n),o=function(u,l,c){var p=s(u),S=Bl(uz(l),!0);return S===!0?ql(p).set(l,c):S[p.id]=c,u};return Dk(i,{delete:function(u){var l=s(this);if(!bv(u))return!1;var c=Bl(u);return c===!0?ql(l).delete(u):c&&qk(c,l.id)&&delete c[l.id]},has:function(l){var c=s(this);if(!bv(l))return!1;var p=Bl(l);return p===!0?ql(c).has(l):p&&qk(p,c.id)}}),Dk(i,t?{get:function(l){var c=s(this);if(bv(l)){var p=Bl(l);if(p===!0)return ql(c).get(l);if(p)return p[c.id]}},set:function(l,c){return o(this,l,c)}}:{add:function(l){return o(this,l,!0)}}),a}},gz=Sd,mz=yz;gz("WeakSet",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},mz);var Wl={},Gk={exports:{}};(function(e){(function(n,t){e.exports?e.exports=t():n.log=t()})(Rr,function(){var n=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"];function i(x,U){var F=x[U];if(typeof F.bind=="function")return F.bind(x);try{return Function.prototype.bind.call(F,x)}catch{return function(){return Function.prototype.apply.apply(F,[x,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(x){return x==="debug"&&(x="log"),typeof console===t?!1:x==="trace"&&r?s:console[x]!==void 0?i(console,x):console.log!==void 0?i(console,"log"):n}function u(x,U){for(var F=0;F<a.length;F++){var V=a[F];this[V]=F<x?n:this.methodFactory(V,x,U)}this.log=this.debug}function l(x,U,F){return function(){typeof console!==t&&(u.call(this,U,F),this[x].apply(this,arguments))}}function c(x,U,F){return o(x)||l.apply(this,arguments)}function p(x,U,F){var V=this,Ae;U=U??"WARN";var de="loglevel";typeof x=="string"?de+=":"+x:typeof x=="symbol"&&(de=void 0);function Ge(ce){var ke=(a[ce]||"silent").toUpperCase();if(!(typeof window===t||!de)){try{window.localStorage[de]=ke;return}catch{}try{window.document.cookie=encodeURIComponent(de)+"="+ke+";"}catch{}}}function Ee(){var ce;if(!(typeof window===t||!de)){try{ce=window.localStorage[de]}catch{}if(typeof ce===t)try{var ke=window.document.cookie,pe=ke.indexOf(encodeURIComponent(de)+"=");pe!==-1&&(ce=/^([^;]+)/.exec(ke.slice(pe))[1])}catch{}return V.levels[ce]===void 0&&(ce=void 0),ce}}function Ue(){if(!(typeof window===t||!de)){try{window.localStorage.removeItem(de);return}catch{}try{window.document.cookie=encodeURIComponent(de)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}V.name=x,V.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},V.methodFactory=F||c,V.getLevel=function(){return Ae},V.setLevel=function(ce,ke){if(typeof ce=="string"&&V.levels[ce.toUpperCase()]!==void 0&&(ce=V.levels[ce.toUpperCase()]),typeof ce=="number"&&ce>=0&&ce<=V.levels.SILENT){if(Ae=ce,ke!==!1&&Ge(ce),u.call(V,ce,x),typeof console===t&&ce<V.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+ce},V.setDefaultLevel=function(ce){U=ce,Ee()||V.setLevel(ce,!1)},V.resetLevel=function(){V.setLevel(U,!1),Ue()},V.enableAll=function(ce){V.setLevel(V.levels.TRACE,ce)},V.disableAll=function(ce){V.setLevel(V.levels.SILENT,ce)};var B=Ee();B==null&&(B=U),V.setLevel(B,!1)}var S=new p,T={};S.getLogger=function(U){if(typeof U!="symbol"&&typeof U!="string"||U==="")throw new TypeError("You must supply a name when creating a logger.");var F=T[U];return F||(F=T[U]=new p(U,S.getLevel(),S.methodFactory)),F};var I=typeof window!==t?window.log:void 0;return S.noConflict=function(){return typeof window!==t&&window.log===S&&(window.log=I),S},S.getLoggers=function(){return T},S.default=S,S})})(Gk);var bz=Gk.exports;/*
	@license
	Copyright (c) 2022 Twilio Inc.

	Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


	*/Object.defineProperty(Wl,"__esModule",{value:!0});var wz=bz;function Sz(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var zl=Sz(wz),_z=function(n,t,r){return function(a,i,s){if(typeof s.value!="function"&&(s==null?void 0:s.get)===void 0)throw new Error("The deprecated decorator can only be applied to methods or getters");if(typeof s.value=="function"){var o=s.value;s.value=function(){Sv("The method ".concat(n," is deprecated").concat(t?", use "+t+" instead":"").concat(r?", "+r:"."));for(var l=arguments.length,c=new Array(l),p=0;p<l;p++)c[p]=arguments[p];return o.apply(this,c)};return}var u=s.get;s.get=function(){return Sv("The getter ".concat(n," is deprecated").concat(t?", use "+t+" instead":"").concat(r?", "+r:".")),u==null?void 0:u.apply(this)}}},Sv=function(n){var t=zl.default.getLevel();zl.default.setLevel("warn"),zl.default.warn(n),zl.default.setLevel(t)};Wl.deprecated=_z,Wl.deprecationWarning=Sv;var kz=ft,$z=Or.find,Tz=Bf,_v="find",Hk=!0;_v in[]&&Array(1)[_v](function(){Hk=!1}),kz({target:"Array",proto:!0,forced:Hk},{find:function(n){return $z(this,n,arguments.length>1?arguments[1]:void 0)}}),Tz(_v);var Cz=ft,Ez=Yb,Iz=at,Rz=qt,Oz=Ko.onFreeze,kv=Object.freeze,Az=Iz(function(){kv(1)});Cz({target:"Object",stat:!0,forced:Az,sham:!Ez},{freeze:function(n){return kv&&Rz(n)?kv(Oz(n)):n}});/*
	@license
	The following license applies to all parts of this software except as
	documented below.

	    Copyright (c) 2019, Twilio, inc.
	    All rights reserved.

	    Redistribution and use in source and binary forms, with or without
	    modification, are permitted provided that the following conditions are
	    met:

	      1. Redistributions of source code must retain the above copyright
	         notice, this list of conditions and the following disclaimer.

	      2. Redistributions in binary form must reproduce the above copyright
	         notice, this list of conditions and the following disclaimer in
	         the documentation and/or other materials provided with the
	         distribution.

	      3. Neither the name of Twilio nor the names of its contributors may
	         be used to endorse or promote products derived from this software
	         without specific prior written permission.

	    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
	    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
	    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
	    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
	    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
	    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
	    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
	    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
	    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
	    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
	    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

	This software includes javascript-state-machine under the following license.

	    Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

	    Permission is hereby granted, free of charge, to any person obtaining a copy
	    of this software and associated documentation files (the "Software"), to deal
	    in the Software without restriction, including without limitation the rights
	    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	    copies of the Software, and to permit persons to whom the Software is
	    furnished to do so, subject to the following conditions:

	    The above copyright notice and this permission notice shall be included in all
	    copies or substantial portions of the Software.

	    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

	This software includes loglevel under the following license.

	    Copyright (c) 2013 Tim Perry

	    Permission is hereby granted, free of charge, to any person
	    obtaining a copy of this software and associated documentation
	    files (the "Software"), to deal in the Software without
	    restriction, including without limitation the rights to use,
	    copy, modify, merge, publish, distribute, sublicense, and/or sell
	    copies of the Software, and to permit persons to whom the
	    Software is furnished to do so, subject to the following
	    conditions:

	    The above copyright notice and this permission notice shall be
	    included in all copies or substantial portions of the Software.

	    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
	    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
	    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
	    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
	    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
	    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
	    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
	    OTHER DEALINGS IN THE SOFTWARE.

	This software includes q under the following license.

	    Copyright 2009â2014 Kristopher Michael Kowal. All rights reserved.
	    Permission is hereby granted, free of charge, to any person obtaining a copy
	    of this software and associated documentation files (the "Software"), to
	    deal in the Software without restriction, including without limitation the
	    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
	    sell copies of the Software, and to permit persons to whom the Software is
	    furnished to do so, subject to the following conditions:

	    The above copyright notice and this permission notice shall be included in
	    all copies or substantial portions of the Software.

	    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
	    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
	    IN THE SOFTWARE.

	This software includes platform.js under the following license.

	    Copyright 2014 Benjamin Tan <https://d10.github.io/>
	    Copyright 2011-2015 John-David Dalton <http://allyoucanleet.com/>

	    Permission is hereby granted, free of charge, to any person obtaining
	    a copy of this software and associated documentation files (the
	    "Software"), to deal in the Software without restriction, including
	    without limitation the rights to use, copy, modify, merge, publish,
	    distribute, sublicense, and/or sell copies of the Software, and to
	    permit persons to whom the Software is furnished to do so, subject to
	    the following conditions:

	    The above copyright notice and this permission notice shall be
	    included in all copies or substantial portions of the Software.

	    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
	    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
	    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
	    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
	    LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
	    OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
	    WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

	*/(function(e){var n=typeof n<"u"?n:typeof self<"u"?self:typeof window<"u"?window:{};Object.defineProperty(e,"__esModule",{value:!0});var t=Ds,r=ei,a=Nn,i=xn,s=Jr,o=ti,u=_a,l=Ln,c=Ys,p=Yr,S=Zs,T=W2,I=ur,x=Wi,U=vd,F=ij,V=qi,Ae=ia,de=Zo,Ge=DS,Ee=Mr,Ue=E_,B=Wl,ce=_l,ke=rl;function pe(C){return C&&typeof C=="object"&&"default"in C?C:{default:C}}function Le(C){if(C&&C.__esModule)return C;var E=Object.create(null);return C&&Object.keys(C).forEach(function(g){if(g!=="default"){var d=Object.getOwnPropertyDescriptor(C,g);Object.defineProperty(E,g,d.get?d:{enumerable:!0,get:function(){return C[g]}})}}),E.default=C,Object.freeze(E)}var Z=pe(t),Pe=pe(r),Fe=pe(a),wt=pe(i),mt=pe(s),Ce=pe(o),se=pe(u),ie=pe(l),O=pe(c),Ie=pe(p),Je=Le(S),Me=pe(x),be=pe(F),z=pe(V),xt=pe(ce);function ye(C,E,g,d){var f=arguments.length,m=f<3?E:d===null?d=Object.getOwnPropertyDescriptor(E,g):d,v;if((typeof Reflect>"u"?"undefined":Ie.default(Reflect))==="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(C,E,g,d);else for(var h=C.length-1;h>=0;h--)(v=C[h])&&(m=(f<3?v(m):f>3?v(E,g,m):v(E,g))||m);return f>3&&m&&Object.defineProperty(E,g,m),m}function te(C,E){if((typeof Reflect>"u"?"undefined":Ie.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(C,E)}function St(C,E){return["".concat(new Date().toISOString()," Conversations ").concat(C,":")].concat(Array.from(E))}var Ne=Je.getLogger("twilio-conversations"),zt=function(){function C(E){ie.default(this,C),Ce.default(this,"prefix",""),this.prefix=E!=null&&E.length>0?E+" ":""}return se.default(C,[{key:"setLevel",value:function(g){Ne.setLevel(g)}},{key:"trace",value:function(){if(Ne.getLevel()==Ne.levels.TRACE){for(var g=arguments.length,d=new Array(g),f=0;f<g;f++)d[f]=arguments[f];Ne.debug.apply(null,St(this.prefix+"T",d))}}},{key:"debug",value:function(){for(var g=arguments.length,d=new Array(g),f=0;f<g;f++)d[f]=arguments[f];Ne.debug.apply(null,St(this.prefix+"D",d))}},{key:"info",value:function(){for(var g=arguments.length,d=new Array(g),f=0;f<g;f++)d[f]=arguments[f];Ne.info.apply(null,St(this.prefix+"I",d))}},{key:"warn",value:function(){for(var g=arguments.length,d=new Array(g),f=0;f<g;f++)d[f]=arguments[f];Ne.warn.apply(null,St(this.prefix+"W",d))}},{key:"error",value:function(){for(var g=arguments.length,d=new Array(g),f=0;f<g;f++)d[f]=arguments[f];Ne.error.apply(null,St(this.prefix+"E",d))}}],[{key:"scope",value:function(g){return new C(g)}},{key:"setLevel",value:function(g){Ne.setLevel(g)}},{key:"trace",value:function(){if(Ne.getLevel()==Ne.levels.TRACE){for(var g=arguments.length,d=new Array(g),f=0;f<g;f++)d[f]=arguments[f];Ne.debug.apply(null,St("T",d))}}},{key:"debug",value:function(){for(var g=arguments.length,d=new Array(g),f=0;f<g;f++)d[f]=arguments[f];Ne.debug.apply(null,St("D",d))}},{key:"info",value:function(){for(var g=arguments.length,d=new Array(g),f=0;f<g;f++)d[f]=arguments[f];Ne.info.apply(null,St("I",d))}},{key:"warn",value:function(){for(var g=arguments.length,d=new Array(g),f=0;f<g;f++)d[f]=arguments[f];Ne.warn.apply(null,St("W",d))}},{key:"error",value:function(){for(var g=arguments.length,d=new Array(g),f=0;f<g;f++)d[f]=arguments[f];Ne.error.apply(null,St("E",d))}}]),C}();function dt(C,E){var g=Object.keys(C);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(C);E&&(d=d.filter(function(f){return Object.getOwnPropertyDescriptor(C,f).enumerable})),g.push.apply(g,d)}return g}function _e(C){for(var E=1;E<arguments.length;E++){var g=arguments[E]!=null?arguments[E]:{};E%2?dt(Object(g),!0).forEach(function(d){Ce.default(C,d,g[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(g)):dt(Object(g)).forEach(function(d){Object.defineProperty(C,d,Object.getOwnPropertyDescriptor(g,d))})}return C}var it=5,bt="PT5S",$e="PT5S",Kt=100,pt=1e3,Wt=4e3,er=3,xe=!0,zr=100,bn=1e3,Ct=se.default(function C(){var E,g,d,f,m,v,h,y,b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},w=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;ie.default(this,C),Ce.default(this,"typingIndicatorTimeoutDefault",it*1e3);var L=b.Chat||b.IPMessaging||b||{};this.productId=L.productId,this.links={myConversations:w.links.my_conversations,conversations:w.links.conversations,users:w.links.users,currentUser:w.links.current_user,typing:w.links.typing,mediaService:w.links.media_service,mediaSetService:w.links.media_set_service,messagesReceipts:w.links.messages_receipts},this.limits={mediaAttachmentsCountLimit:w.options.media_attachments_count_limit,mediaAttachmentSizeLimitInMb:w.options.media_attachment_size_limit_in_mb,mediaAttachmentsTotalSizeLimitInMb:w.options.media_attachments_total_size_limit_in_mb,emailHistoriesAllowedContentTypes:w.options.email_histories_allowed_mime_types,emailBodiesAllowedContentTypes:w.options.email_bodies_allowed_mime_types},this.typingIndicatorTimeoutOverride=L.typingIndicatorTimeoutOverride,this.backoffConfiguration=_e({min:pt,max:Wt,maxAttemptsCount:er},L.backoffConfigOverride),this.retryWhenThrottled=L.retryWhenThrottledOverride!==void 0?L.retryWhenThrottledOverride:xe,this.userInfosToSubscribe=(E=(g=L.userInfosToSubscribeOverride)!==null&&g!==void 0?g:w.options.user_infos_to_subscribe)!==null&&E!==void 0?E:Kt,this.reachabilityEnabled=w.options.reachability_enabled,this.userIdentity=w.identity,this.userInfo=w.sync_objects.my_user_info,this.myConversations=w.sync_objects.my_conversations;var W=(d=(f=L.httpCacheIntervalOverride)!==null&&f!==void 0?f:w.options.http_cache_interval)!==null&&d!==void 0?d:bt;try{this.httpCacheInterval=T.toSeconds(T.parse(W))}catch{j.error("Failed to parse http cache interval ".concat(W,", using default value ").concat(bt)),this.httpCacheInterval=T.toSeconds(T.parse(bt))}var Q=(m=(v=L.consumptionReportIntervalOverride)!==null&&v!==void 0?v:w.options.consumption_report_interval)!==null&&m!==void 0?m:$e;try{this.consumptionReportInterval=T.toSeconds(T.parse(Q))}catch{j.error("Failed to parse consumption report interval ".concat(Q,", using default value ").concat($e)),this.consumptionReportInterval=T.toSeconds(T.parse($e))}this.channelMetadataCacheCapacity=(h=b.channelMetadataCacheCapacity)!==null&&h!==void 0?h:zr,this.messageRecipientsCacheCapacity=(y=b.messageRecipientsCacheCapacity)!==null&&y!==void 0?y:bn});function Dt(C){return JSON.parse(JSON.stringify(C))}function gt(C){return typeof C<"u"&&!isNaN(Number(C))?Number(C):null}function tt(C){try{return new Date(C)}catch{return null}}function Ft(C,E,g){var d={};if(C)try{d=JSON.parse(C)}catch(f){g.warn(E,f)}return d}var At=function(){function C(E){ie.default(this,C),this.base=E.replace(/\/$/,""),this.args=[],this.paths=[]}return se.default(C,[{key:"arg",value:function(g,d){return typeof d<"u"&&this.args.push(encodeURIComponent(g)+"="+encodeURIComponent(d)),this}},{key:"path",value:function(g){return this.paths.push(encodeURIComponent(g)),this}},{key:"build",value:function(){var g=this.base;return this.paths.length&&(g+="/"+this.paths.join("/")),this.args.length&&(g+="?"+this.args.join("&")),g}}]),C}(),ar=I.custom(function(C){return[["string","number","boolean","object"].includes(Ie.default(C)),"a JSON type"]}),Gr=I.custom(function(C){return[["undefined","string","number","boolean","object"].includes(Ie.default(C)),"an optional JSON type"]}),wn=I.objectSchema("send media options",{contentType:[I.literal(null),"string"],filename:["string","undefined"],media:[I.literal("null"),"string"].concat(Me.default(typeof Buffer=="function"?[Buffer]:[]),Me.default(typeof Blob=="function"?[Blob]:[]))});function qn(C){var E=xr();return function(){var d=mt.default(C),f;if(E){var m=mt.default(this).constructor;f=Reflect.construct(d,arguments,m)}else f=d.apply(this,arguments);return wt.default(this,f)}}function xr(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var or=zt.scope("User"),ue=function(C){Fe.default(g,C);var E=qn(g);function g(d,f,m,v){var h;return ie.default(this,g),h=E.call(this),Ce.default(Pe.default(h),"promiseToFetch",null),Ce.default(Pe.default(h),"updated","updated"),Ce.default(Pe.default(h),"userSubscribed","userSubscribed"),Ce.default(Pe.default(h),"userUnsubscribed","userUnsubscribed"),h.services=v,h.subscribed="initializing",h.setMaxListeners(0),h.state={identity:d,entityName:f,friendlyName:null,attributes:{},online:null,notifiable:null},h._initializationPromise=new Promise(function(y){h._resolveInitializationPromise=y}),m!==null&&h._resolveInitialization(m,d,f,!1),h}return se.default(g,[{key:"identity",get:function(){return this.state.identity},set:function(f){this.state.identity=f}},{key:"entityName",set:function(f){this.state.entityName=f}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"isOnline",get:function(){return this.state.online}},{key:"isNotifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return this.subscribed=="subscribed"}},{key:"_update",value:function(){var d=Z.default(O.default.mark(function m(v,h){var y,b;return O.default.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,this._initializationPromise;case 2:y=[],or.debug("User for",this.state.identity,"updated:",v,h),j.t0=v,j.next=j.t0==="friendlyName"?7:j.t0==="attributes"?9:j.t0==="reachability"?12:15;break;case 7:return this.state.friendlyName!==h.value&&(y.push("friendlyName"),this.state.friendlyName=h.value),j.abrupt("break",16);case 9:return b=Ft(h.value,"Retrieved malformed attributes from the server for user: ".concat(this.state.identity),or),be.default(this.state.attributes,b)||(this.state.attributes=b,y.push("attributes")),j.abrupt("break",16);case 12:return this.state.online!==h.online&&(this.state.online=h.online,y.push("reachabilityOnline")),this.state.notifiable!==h.notifiable&&(this.state.notifiable=h.notifiable,y.push("reachabilityNotifiable")),j.abrupt("break",16);case 15:return j.abrupt("return");case 16:y.length>0&&this.emit("updated",{user:this,updateReasons:y});case 17:case"end":return j.stop()}},m,this)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"_updateReachabilityInfo",value:function(){var d=Z.default(O.default.mark(function m(v,h){var y=this;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this._initializationPromise;case 2:if(this.configuration.reachabilityEnabled){w.next=4;break}return w.abrupt("return",Promise.resolve());case 4:return w.abrupt("return",v.get("reachability").then(h).catch(function(j){or.warn("Failed to get reachability info for ",y.state.identity,j)}));case 5:case"end":return w.stop()}},m,this)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"_fetch",value:function(){var d=Z.default(O.default.mark(function m(){var v=this;return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._initializationPromise;case 2:if(this.state.entityName){y.next=4;break}return y.abrupt("return",this);case 4:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then(function(b){return v.entity=b,b.on("itemUpdated",function(w){return or.debug(v.state.entityName+" ("+v.state.identity+") itemUpdated: "+w.item.key),v._update(w.item.key,w.item.data)}),b.on("itemAdded",function(w){return or.debug(v.state.entityName+" ("+v.state.identity+") itemAdded: "+w.item.key),v._update(w.item.key,w.item.data)}),Promise.all([b.get("friendlyName").then(function(w){return v._update(w.key,w.data)}),b.get("attributes").then(function(w){return v._update(w.key,w.data)}),v._updateReachabilityInfo(b,function(w){return v._update(w.key,w.data)})])}).then(function(){return or.debug("Fetched for",v.identity),v.subscribed="subscribed",v.emit("userSubscribed",v),v}).catch(function(b){throw v.promiseToFetch=null,b}),y.abrupt("return",this.promiseToFetch);case 6:case"end":return y.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"_ensureFetched",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._initializationPromise;case 2:return h.abrupt("return",this.promiseToFetch||this._fetch());case 3:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"updateAttributes",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._initializationPromise;case 2:if(this.subscribed!="unsubscribed"){y.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return y.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(v)});case 6:return y.abrupt("return",this);case 7:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"updateFriendlyName",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._initializationPromise;case 2:if(this.subscribed!="unsubscribed"){y.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return y.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{friendly_name:v});case 6:return y.abrupt("return",this);case 7:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"unsubscribe",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._initializationPromise;case 2:if(!this.promiseToFetch){h.next=9;break}return h.next=5,this.promiseToFetch;case 5:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 9:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"_resolveInitialization",value:function(f,m,v,h){this.configuration=f,this.identity=m,this.entityName=v,this.links={self:"".concat(this.configuration.links.users,"/").concat(encodeURIComponent(this.identity))},this._resolveInitializationPromise(),h&&this.emit("updated",{user:this,updateReasons:["friendlyName","attributes","reachabilityOnline","reachabilityNotifiable"]})}}]),g}(U.ReplayEventEmitter);ye([I.validateTypesAsync(ar),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",Promise)],ue.prototype,"updateAttributes",null),ye([I.validateTypesAsync(["string"]),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],ue.prototype,"updateFriendlyName",null);function fe(C,E){var g=typeof Symbol<"u"&&C[Symbol.iterator]||C["@@iterator"];if(!g){if(Array.isArray(C)||(g=J(C))||E){g&&(C=g);var d=0,f=function(){};return{s:f,n:function(){return d>=C.length?{done:!0}:{done:!1,value:C[d++]}},e:function(b){throw b},f}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,v=!1,h;return{s:function(){g=g.call(C)},n:function(){var b=g.next();return m=b.done,b},e:function(b){v=!0,h=b},f:function(){try{!m&&g.return!=null&&g.return()}finally{if(v)throw h}}}}function J(C,E){if(C){if(typeof C=="string")return ne(C,E);var g=Object.prototype.toString.call(C).slice(8,-1);if(g==="Object"&&C.constructor&&(g=C.constructor.name),g==="Map"||g==="Set")return Array.from(C);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return ne(C,E)}}function ne(C,E){(E==null||E>C.length)&&(E=C.length);for(var g=0,d=new Array(E);g<E;g++)d[g]=C[g];return d}var X=function(){function C(E,g){ie.default(this,C),this.configuration=E,this.services=g,this.cache=new Map,this.cacheLifetime=this.configuration.httpCacheInterval*100,this.cleanupCache()}return se.default(C,[{key:"isExpired",value:function(g){return!this.cacheLifetime||Date.now()-g>this.cacheLifetime}},{key:"cleanupCache",value:function(){var g=fe(this.cache),d;try{for(g.s();!(d=g.n()).done;){var f=z.default(d.value,2),m=f[0],v=f[1];this.isExpired(v.timestamp)&&this.cache.delete(m)}}catch(h){g.e(h)}finally{g.f()}this.cache.size===0&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var g=this;this.timer=this.timer||setInterval(function(){return g.cleanupCache()},this.cacheLifetime*2)}},{key:"executeWithRetry",value:function(g){var d=this,f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return new Promise(function(m,v){var h=[502,503,504];f&&h.push(429);var y=new Ae.Retrier(d.configuration.backoffConfiguration);y.on("attempt",function(){g().then(function(b){return y.succeeded(b)}).catch(function(b){h.indexOf(b.status)>-1||b.message==="Twilsock disconnected"?y.failed(b):(y.removeAllListeners(),y.cancel(),v(b))})}),y.on("succeeded",function(b){m(b)}),y.on("cancelled",function(b){return v(b)}),y.on("failed",function(b){return v(b)}),y.start()})}},{key:"get",value:function(){var E=Z.default(O.default.mark(function d(f){var m=this,v,h,y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(v=this.cache.get(f),!(v&&!this.isExpired(v.timestamp))){w.next=3;break}return w.abrupt("return",v.response);case 3:return h={},w.next=6,this.executeWithRetry(function(){return m.services.transport.get(f,h,m.configuration.productId)},this.configuration.retryWhenThrottled);case 6:return y=w.sent,this.cache.set(f,{response:y,timestamp:Date.now()}),this.pokeTimer(),w.abrupt("return",y);case 10:case"end":return w.stop()}},d,this)}));function g(d){return E.apply(this,arguments)}return g}()}]),C}(),le=se.default(function C(){ie.default(this,C)});Ce.default(le,"TYPING_INDICATOR","twilio.ipmsg.typing_indicator"),Ce.default(le,"NEW_MESSAGE","twilio.conversations.new_message"),Ce.default(le,"ADDED_TO_CONVERSATION","twilio.conversations.added_to_conversation"),Ce.default(le,"REMOVED_FROM_CONVERSATION","twilio.conversations.removed_from_conversation"),Ce.default(le,"CONSUMPTION_UPDATE","twilio.channel.consumption_update");function ge(C){var E=H();return function(){var d=mt.default(C),f;if(E){var m=mt.default(this).constructor;f=Reflect.construct(d,arguments,m)}else f=d.apply(this,arguments);return wt.default(this,f)}}function H(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ee=zt.scope("Participant"),D=function(C){Fe.default(g,C);var E=ge(g);function g(d,f,m,v,h){var y,b,w;if(ie.default(this,g),w=E.call(this),w.conversation=m,w.links=v,w.services=h,w.state={attributes:Ft(d.attributes,"Retrieved malformed attributes from the server for participant: "+f,ee),dateCreated:d.dateCreated?tt(d.dateCreated):null,dateUpdated:d.dateCreated?tt(d.dateUpdated):null,sid:f,typingTimeout:null,isTyping:!1,identity:d.identity,roleSid:(y=d.roleSid)!==null&&y!==void 0?y:"",lastReadMessageIndex:Number.isInteger(d.lastConsumedMessageIndex)?d.lastConsumedMessageIndex:null,lastReadTimestamp:d.lastConsumptionTimestamp?tt(d.lastConsumptionTimestamp):null,type:d.type||"chat",userInfo:d.userInfo,bindings:(b=d.bindings)!==null&&b!==void 0?b:{}},!d.identity&&!d.type)throw new Error("Received invalid Participant object from server: Missing identity or type of Participant.");return w}return se.default(g,[{key:"sid",get:function(){return this.state.sid}},{key:"attributes",get:function(){return this.state.attributes}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastReadMessageIndex",get:function(){return this.state.lastReadMessageIndex}},{key:"lastReadTimestamp",get:function(){return this.state.lastReadTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}},{key:"type",get:function(){return this.state.type}},{key:"bindings",get:function(){var f;return(f=this.state.bindings)!==null&&f!==void 0?f:{}}},{key:"_startTyping",value:function(f){var m=this;return this.state.typingTimeout&&clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit(g.typingStarted,this),this.conversation.emit(_t.typingStarted,this),this.state.typingTimeout=Number(setTimeout(function(){return m._endTyping()},f)),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit(g.typingEnded,this),this.conversation.emit(_t.typingEnded,this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(f){var m=[],v=Ft(f.attributes,"Retrieved malformed attributes from the server for participant: "+this.state.sid,ee);f.attributes&&!be.default(this.state.attributes,v)&&(this.state.attributes=v,m.push("attributes"));var h=tt(f.dateUpdated);f.dateUpdated&&(h==null?void 0:h.getTime())!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=h,m.push("dateUpdated"));var y=tt(f.dateCreated);if(f.dateCreated&&(y==null?void 0:y.getTime())!==(this.state.dateCreated&&this.state.dateCreated.getTime())&&(this.state.dateCreated=y,m.push("dateCreated")),f.roleSid&&this.state.roleSid!==f.roleSid&&(this.state.roleSid=f.roleSid,m.push("roleSid")),(Number.isInteger(f.lastConsumedMessageIndex)||f.lastConsumedMessageIndex===null)&&this.state.lastReadMessageIndex!==f.lastConsumedMessageIndex&&(this.state.lastReadMessageIndex=f.lastConsumedMessageIndex,m.push("lastReadMessageIndex")),f.lastConsumptionTimestamp){var b=new Date(f.lastConsumptionTimestamp);(!this.state.lastReadTimestamp||this.state.lastReadTimestamp.getTime()!==b.getTime())&&(this.state.lastReadTimestamp=b,m.push("lastReadTimestamp"))}return f.bindings&&!be.default(this.state.bindings,f.bindings)&&(this.state.bindings=f.bindings,m.push("bindings")),m.length>0&&this.emit(g.updated,{participant:this,updateReasons:m}),this}},{key:"getUser",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.type=="chat"){h.next=2;break}throw new Error("Getting User is not supported for this Participant type: "+this.type);case 2:return h.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 3:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"remove",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",this.conversation.removeParticipant(this));case 1:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"updateAttributes",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(v)});case 2:return y.abrupt("return",this);case 3:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()}]),g}(U.ReplayEventEmitter);Ce.default(D,"typingStarted","typingStarted"),Ce.default(D,"typingEnded","typingEnded"),Ce.default(D,"updated","updated"),ye([I.validateTypesAsync(ar),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",Promise)],D.prototype,"updateAttributes",null);function Y(C){var E=q();return function(){var d=mt.default(C),f;if(E){var m=mt.default(this).constructor;f=Reflect.construct(d,arguments,m)}else f=d.apply(this,arguments);return wt.default(this,f)}}function q(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Re=zt.scope("Participants"),me=function(C){Fe.default(g,C);var E=Y(g);function g(d,f,m,v){var h;return ie.default(this,g),h=E.call(this),Ce.default(Pe.default(h),"rosterEntityPromise",null),h.conversation=d,h.participants=f,h.links=m,h.services=v,h}return se.default(g,[{key:"unsubscribe",value:function(){var d=Z.default(O.default.mark(function m(){var v;return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!this.rosterEntityPromise){y.next=6;break}return y.next=3,this.rosterEntityPromise;case 3:v=y.sent,v.close(),this.rosterEntityPromise=null;case 6:case"end":return y.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"subscribe",value:function(f){var m=this,v=typeof f=="string"?this.services.syncClient.map({id:f,mode:"open_existing"}):Promise.resolve(f);return this.rosterEntityPromise=this.rosterEntityPromise||v.then(function(h){h.on(Ee.SyncMap.itemAdded,function(w){Re.debug(m.conversation.sid+" itemAdded: "+w.item.key),m.upsertParticipant(w.item.key,w.item.data).then(function(j){m.emit(_t.participantJoined,j)})}),h.on(Ee.SyncMap.itemRemoved,function(w){Re.debug(m.conversation.sid+" itemRemoved: "+w.key);var j=w.key;if(m.participants.has(j)){var L=m.participants.get(j);m.participants.delete(j),L&&m.emit(_t.participantLeft,L)}}),h.on(Ee.SyncMap.itemUpdated,function(w){Re.debug(m.conversation.sid+" itemUpdated: "+w.item.key),m.upsertParticipant(w.item.key,w.item.data).catch(function(j){return Re.error(j)})});var y=[],b=function w(j){return j.items.forEach(function(L){y.push(m.upsertParticipant(L.key,L.data))}),j.hasNextPage?j.nextPage().then(w):null};return h.getItems().then(b).then(function(){return Promise.all(y)}).then(function(){return h})}).catch(function(h){throw m.rosterEntityPromise=null,m.services.syncClient.connectionState!="disconnected"&&Re.error("Failed to get roster object for conversation",m.conversation.sid,h),Re.debug("ERROR: Failed to get roster object for conversation",m.conversation.sid,h),h})}},{key:"upsertParticipantFromResponse",value:function(){var d=Z.default(O.default.mark(function m(v){var h,y,b,w,j,L,W,Q;return O.default.wrap(function(Ye){for(;;)switch(Ye.prev=Ye.next){case 0:return y=v.sid,b=v.attributes,w=v.date_created,j=v.date_updated,L=v.identity,W=v.role_sid,Q=v.messaging_binding,Ye.next=3,this.upsertParticipant(y,{attributes:b,dateCreated:new Date(w),dateUpdated:new Date(j),identity:L,roleSid:W,lastConsumedMessageIndex:null,lastConsumptionTimestamp:null,type:(h=Q==null?void 0:Q.type)!==null&&h!==void 0?h:"chat"});case 3:return Ye.abrupt("return",Ye.sent);case 4:case"end":return Ye.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"upsertParticipant",value:function(){var d=Z.default(O.default.mark(function m(v,h){var y=this,b,w;return O.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(b=this.participants.get(v),!b){L.next=3;break}return L.abrupt("return",b._update(h));case 3:return w={self:"".concat(this.links.participants,"/").concat(v)},b=new D(h,v,this.conversation,w,this.services),this.participants.set(v,b),b.on(D.updated,function(W){return y.emit(_t.participantUpdated,W)}),L.abrupt("return",b);case 8:case"end":return L.stop()}},m,this)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"getParticipants",value:function(){var d=Z.default(O.default.mark(function m(){var v=this;return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){var b=[];return v.participants.forEach(function(w){return b.push(w)}),b}):[]);case 1:case"end":return y.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getParticipantBySid",value:function(){var d=Z.default(O.default.mark(function m(v){var h=this;return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){var w=h.participants.get(v);if(!w)throw new Error("Participant with SID "+v+" was not found");return w}):null);case 1:case"end":return b.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getParticipantByIdentity",value:function(){var d=Z.default(O.default.mark(function m(v){var h=this,y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return y=null,w.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){if(h.participants.forEach(function(j){j.identity===v&&(y=j)}),!y)throw new Error("Participant with identity "+v+" was not found");return y}):null);case 2:case"end":return w.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"add",value:function(){var d=Z.default(O.default.mark(function m(v,h){return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this.services.commandExecutor.mutateResource("post",this.links.participants,{identity:v,attributes:typeof h<"u"?JSON.stringify(h):void 0});case 2:return b.abrupt("return",b.sent);case 3:case"end":return b.stop()}},m,this)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"addNonChatParticipant",value:function(){var d=Z.default(O.default.mark(function m(v,h){var y,b,w,j,L=arguments;return O.default.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return w=L.length>2&&L[2]!==void 0?L[2]:{},j=L.length>3&&L[3]!==void 0?L[3]:{},Q.next=4,this.services.commandExecutor.mutateResource("post",this.links.participants,{attributes:typeof w<"u"?JSON.stringify(w):void 0,messaging_binding:{address:h,proxy_address:v,name:j==null||(y=j.email)===null||y===void 0?void 0:y.name,level:j==null||(b=j.email)===null||b===void 0?void 0:b.level}});case 4:return Q.abrupt("return",Q.sent);case 5:case"end":return Q.stop()}},m,this)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"remove",value:function(f){return this.services.commandExecutor.mutateResource("delete","".concat(this.links.participants,"/").concat(encodeURIComponent(f)))}}]),g}(U.ReplayEventEmitter),De=function(){function C(E,g){var d;ie.default(this,C),Ce.default(this,"mcsMedia",null),this.services=g,E instanceof Ue.McsMedia&&(this.mcsMedia=E),this.state={sid:E.sid,category:E.category,filename:(d=E.filename)!==null&&d!==void 0?d:null,contentType:E.contentType,size:E.size}}return se.default(C,[{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"category",get:function(){return this.state.category}},{key:"getContentTemporaryUrl",value:function(){var g=this;return new Ue.CancellablePromise(function(){var d=Z.default(O.default.mark(function f(m,v,h){var y,b,w,j;return O.default.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(b=g.mcsMedia?void 0:g._fetchMcsMedia(),w=(y=g.mcsMedia)===null||y===void 0?void 0:y.getContentUrl(),h(function(){b&&b.cancel(),w&&w.cancel()}),W.prev=3,w){W.next=9;break}return W.next=7,b;case 7:j=W.sent,w=j==null?void 0:j.getContentUrl();case 9:if(W.t0=m,!w){W.next=16;break}return W.next=13,w;case 13:W.t1=W.sent,W.next=17;break;case 16:W.t1=null;case 17:W.t2=W.t1,(0,W.t0)(W.t2),W.next=24;break;case 21:W.prev=21,W.t3=W.catch(3),v(W.t3);case 24:case"end":return W.stop()}},f,null,[[3,21]])}));return function(f,m,v){return d.apply(this,arguments)}}())}},{key:"_fetchMcsMedia",value:function(){var g=this;return new Ue.CancellablePromise(function(){var d=Z.default(O.default.mark(function f(m,v,h){var y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return g.services.mcsClient===null&&v(new Error("Media Content Service is unavailable")),y=g.services.mcsClient.get(g.state.sid),h(function(){return y.cancel()}),w.prev=3,w.next=6,y;case 6:g.mcsMedia=w.sent,g.state=g.mcsMedia._state(),m(g.mcsMedia),w.next=14;break;case 11:w.prev=11,w.t0=w.catch(3),v(w.t0);case 14:case"end":return w.stop()}},f,null,[[3,11]])}));return function(f,m,v){return d.apply(this,arguments)}}())}},{key:"_state",value:function(){return this.state}}]),C}(),je=function(){function C(E){ie.default(this,C),this.state=E}return se.default(C,[{key:"total",get:function(){return this.state.total}},{key:"sent",get:function(){return this.state.sent}},{key:"delivered",get:function(){return this.state.delivered}},{key:"read",get:function(){return this.state.read}},{key:"undelivered",get:function(){return this.state.undelivered}},{key:"failed",get:function(){return this.state.failed}},{key:"_update",value:function(g){this.state=g}},{key:"_isEquals",value:function(g){var d=this.total===g.total,f=this.sent===g.sent,m=this.delivered===g.delivered,v=this.read===g.read,h=this.undelivered===g.undelivered,y=this.failed===g.failed;return d&&f&&m&&v&&h&&y}}]),C}(),Be=function(){function C(E,g,d,f){ie.default(this,C),this.state={prevToken:d,nextToken:f,source:g,items:E}}return se.default(C,[{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}},{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):Promise.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):Promise.reject(new Error("No previous page"))}}]),C}(),Ve=se.default(function C(E){ie.default(this,C),this.sid=E.sid,this.messageSid=E.message_sid,this.conversationSid=E.conversation_sid,this.channelMessageSid=E.channel_message_sid,this.participantSid=E.participant_sid,this.status=E.status||"queued",this.errorCode=E.error_code||0,this.dateCreated=E.date_created,this.dateUpdated=E.date_updated}),Ke=function(E){return E.map(function(g){var d,f,m,v,h=JSON.stringify(g);switch(g.type){case"QUICK_REPLY":return{type:"reply",title:g.title,id:(d=g.id)!==null&&d!==void 0?d:"",index:(f=g.index)!==null&&f!==void 0?f:0,rawData:h};case"PHONE_NUMBER":return{type:"phone",title:g.title,phone:(m=g.phone)!==null&&m!==void 0?m:"",rawData:h};case"URL":return{type:"url",title:g.title,url:(v=g.url)!==null&&v!==void 0?v:"",rawData:h};default:return{type:"other",rawData:h}}})},ze=function(E,g){var d=JSON.stringify(g);switch(E){case"twilio/text":{var f=g;return{type:"text",body:f.body,rawData:d}}case"twilio/media":{var m=g;return{type:"media",body:m.body,media:m.media,rawData:d}}case"twilio/location":{var v=g;return{type:"location",longitude:v.longitude,latitude:v.latitude,label:v.label,rawData:d}}case"twilio/quick-reply":{var h=g;return{type:"quickReply",body:h.body,replies:h.actions,rawData:d}}case"twilio/call-to-action":{var y=g;return{type:"callToAction",body:y.body,actions:Ke(y.actions),rawData:d}}case"twilio/list-picker":{var b=g;return{type:"listPicker",body:b.body,button:b.button,items:b.items,rawData:d}}case"twilio/card":{var w,j,L=g;return{type:"card",title:L.title,subtitle:L.subtitle,media:(w=L.media)!==null&&w!==void 0?w:[],actions:Ke((j=L.actions)!==null&&j!==void 0?j:[]),rawData:d}}default:return{type:"other",rawData:d}}},He=function(E){for(var g=new Map,d=0,f=Object.entries(E);d<f.length;d++){var m=z.default(f[d],2),v=m[0],h=m[1];g.set(v,ze(v,h))}return g},Qe=function(){function C(E,g){ie.default(this,C),this.name=E,this.value=g}return se.default(C,[{key:"copyWithValue",value:function(g){return new C(this.name,g)}}]),C}(),rt=se.default(function C(E){ie.default(this,C),this.sid=E.sid,this.friendlyName=E.friendly_name,this.variables=Object.entries(JSON.parse(E.variables)).map(function(g){var d=z.default(g,2),f=d[0],m=d[1];return new Qe(f,m)}),this.variants=He(E.variants),this.dateCreated=new Date(E.date_created),this.dateUpdated=new Date(E.date_updated)});function fr(C,E){var g=Object.keys(C);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(C);E&&(d=d.filter(function(f){return Object.getOwnPropertyDescriptor(C,f).enumerable})),g.push.apply(g,d)}return g}function Lr(C){for(var E=1;E<arguments.length;E++){var g=arguments[E]!=null?arguments[E]:{};E%2?fr(Object(g),!0).forEach(function(d){Ce.default(C,d,g[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(g)):fr(Object(g)).forEach(function(d){Object.defineProperty(C,d,Object.getOwnPropertyDescriptor(g,d))})}return C}function nt(C){var E=an();return function(){var d=mt.default(C),f;if(E){var m=mt.default(this).constructor;f=Reflect.construct(d,arguments,m)}else f=d.apply(this,arguments);return wt.default(this,f)}}function an(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function qa(C,E){mi(C,E),E.add(C)}function mi(C,E){if(E.has(C))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Sn(C,E,g){if(!E.has(C))throw new TypeError("attempted to get private field on non-instance");return g}var Wa=zt.scope("Message"),_n=n.XMLHttpRequest||{},Wn=new WeakSet,bi=new WeakSet,yr=function(C){Fe.default(g,C);var E=nt(g);function g(d,f,m,v,h,y){var b,w,j,L,W,Q,We,Ye;return ie.default(this,g),Ye=E.call(this),qa(Pe.default(Ye),bi),qa(Pe.default(Ye),Wn),Ye.conversation=m,Ye.links=v,Ye.configuration=h,Ye.services=y,Ye.state={sid:f.sid,index:d,author:f.author,subject:f.subject,contentSid:f.contentSid,body:(b=f.text)!==null&&b!==void 0?b:null,timestamp:f.timestamp?new Date(f.timestamp):null,dateUpdated:f.dateUpdated?new Date(f.dateUpdated):null,lastUpdatedBy:(w=f.lastUpdatedBy)!==null&&w!==void 0?w:null,attributes:Ft(f.attributes,"Got malformed attributes for the message ".concat(f.sid),Wa),type:(j=f.type)!==null&&j!==void 0?j:"text",media:null,medias:null,participantSid:(L=f.memberSid)!==null&&L!==void 0?L:null,aggregatedDeliveryReceipt:f.delivery?new je(f.delivery):null,hasChannelMetadata:(W=f.channelMetadata)!==null&&W!==void 0?W:!1},Sn(Pe.default(Ye),bi,ds).call(Pe.default(Ye),(Q=f.medias)!==null&&Q!==void 0?Q:null,(We=f.media)!==null&&We!==void 0?We:null),Ye}return se.default(g,[{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"subject",get:function(){return this.state.subject}},{key:"contentSid",get:function(){return this.state.contentSid}},{key:"body",get:function(){return this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"dateCreated",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}},{key:"attachedMedia",get:function(){return this.getMediaByCategories(["media"])}},{key:"participantSid",get:function(){return this.state.participantSid}},{key:"aggregatedDeliveryReceipt",get:function(){return this.state.aggregatedDeliveryReceipt}},{key:"getMediaByCategory",value:function(f){return this.getMediaByCategories(f)}},{key:"getMediaByCategories",value:function(f){var m;return((m=this.state.medias)!==null&&m!==void 0?m:[]).filter(function(v){return f.includes(v.category)})}},{key:"getEmailBody",value:function(){var f,m,v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"text/plain";return(f=(m=this.getMediaByCategories(["body"]))===null||m===void 0?void 0:m.filter(function(h){return h.contentType==v}).shift())!==null&&f!==void 0?f:null}},{key:"getEmailHistory",value:function(){var f,m,v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"text/plain";return(f=(m=this.getMediaByCategories(["history"]))===null||m===void 0?void 0:m.filter(function(h){return h.contentType==v}).shift())!==null&&f!==void 0?f:null}},{key:"_update",value:function(f){var m,v=this,h,y,b,w=[];(f.text||typeof f.text=="string")&&f.text!==this.state.body&&(this.state.body=f.text,w.push("body")),f.subject&&f.subject!==this.state.subject&&(this.state.subject=f.subject,w.push("subject")),f.lastUpdatedBy&&f.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=f.lastUpdatedBy,w.push("lastUpdatedBy")),f.author&&f.author!==this.state.author&&(this.state.author=f.author,w.push("author")),f.dateUpdated&&new Date(f.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(f.dateUpdated),w.push("dateUpdated")),f.timestamp&&new Date(f.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(f.timestamp),w.push("dateCreated"));var j=Ft(f.attributes,"Got malformed attributes for the message ".concat(this.sid),Wa);be.default(this.state.attributes,j)||(this.state.attributes=j,w.push("attributes"));var L=f.delivery,W=this.state.aggregatedDeliveryReceipt,Q=!!L&&!!L.total&&!!L.delivered&&!!L.failed&&!!L.read&&!!L.sent&&!!L.undelivered;Q&&(W?W._isEquals(L)||(W._update(L),w.push("deliveryReceipt")):(this.state.aggregatedDeliveryReceipt=new je(L),w.push("deliveryReceipt")));var We=((m=f.medias)!==null&&m!==void 0?m:[]).map(function(cr){var Ht;return(Ht=Sn(v,Wn,va).call(v,cr))===null||Ht===void 0?void 0:Ht._state()}).filter(function(cr){return cr!==null}),Ye=((h=this.state.medias)!==null&&h!==void 0?h:[]).map(function(cr){return cr._state()}).filter(function(cr){return cr!==null});if(!be.default(We,Ye)||!be.default((y=Sn(this,Wn,va).call(this,f.media))===null||y===void 0?void 0:y._state(),(b=this.state.media)===null||b===void 0?void 0:b._state())){var ct,ht;Sn(this,bi,ds).call(this,(ct=f.medias)!==null&&ct!==void 0?ct:null,(ht=f.media)!==null&&ht!==void 0?ht:null),w.push("media")}w.length>0&&this.emit("updated",{message:this,updateReasons:w})}},{key:"getParticipant",value:function(){var d=Z.default(O.default.mark(function m(){var v=this,h,y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(h=null,!this.state.participantSid){w.next=5;break}return w.next=4,this.conversation.getParticipantBySid(this.state.participantSid).catch(function(){return Wa.debug('Participant with sid "'.concat(v.participantSid,'" not found for message ').concat(v.sid)),null});case 4:h=w.sent;case 5:if(!(!h&&this.state.author)){w.next=9;break}return w.next=8,this.conversation.getParticipantByIdentity(this.state.author).catch(function(){return Wa.debug('Participant with identity "'.concat(v.author,'" not found for message ').concat(v.sid)),null});case 8:h=w.sent;case 9:if(!h){w.next=11;break}return w.abrupt("return",h);case 11:throw y="Participant with ",this.state.participantSid&&(y+="SID '"+this.state.participantSid+"' "),this.state.author&&(this.state.participantSid&&(y+="or "),y+="identity '"+this.state.author+"' "),y==="Participant with "&&(y="Participant "),y+="was not found",new Error(y);case 17:case"end":return w.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getDetailedDeliveryReceipts",value:function(){var d=Z.default(O.default.mark(function m(){var v,h;return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._getDetailedDeliveryReceiptsPaginator();case 2:v=b.sent,h=v.items;case 4:if(!v.hasNextPage){b.next=11;break}return b.next=7,v.nextPage();case 7:v=b.sent,h=[].concat(Me.default(h),Me.default(v.items)),b.next=4;break;case 11:return b.abrupt("return",h);case 12:case"end":return b.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"remove",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.services.commandExecutor.mutateResource("delete",this.links.self);case 2:return h.abrupt("return",this);case 3:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"updateBody",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{body:v});case 2:return y.abrupt("return",this);case 3:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"updateAttributes",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:typeof v<"u"?JSON.stringify(v):void 0});case 2:return y.abrupt("return",this);case 3:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"attachTemporaryUrlsFor",value:function(){var d=Z.default(O.default.mark(function m(v){var h=this,y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(y=v==null?void 0:v.map(function(j){return j.sid}),!(this.services.mcsClient&&y)){w.next=7;break}return w.next=4,this.services.mcsClient.mediaSetGet(y);case 4:return w.abrupt("return",w.sent.map(function(j){return new De(j,h.services)}));case 7:throw new Error("Media Content Service is unavailable");case 8:case"end":return w.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getTemporaryContentUrlsForMedia",value:function(f){var m=f.map(function(v){return v.sid});return this.getTemporaryContentUrlsForMediaSids(m)}},{key:"getTemporaryContentUrlsForMediaSids",value:function(f){var m=this;return new Ue.CancellablePromise(function(){var v=Z.default(O.default.mark(function h(y,b,w){var j,L;return O.default.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(j=m.services.mcsClient.mediaSetGetContentUrls(f??[]),!(!m.services.mcsClient||!f)){Q.next=4;break}return b(new Error("Media Content Service is unavailable")),Q.abrupt("return");case 4:return w(function(){j.cancel()}),Q.prev=5,Q.next=8,j;case 8:L=Q.sent,y(L),Q.next=15;break;case 12:Q.prev=12,Q.t0=Q.catch(5),b(Q.t0);case 15:case"end":return Q.stop()}},h,null,[[5,12]])}));return function(h,y,b){return v.apply(this,arguments)}}())}},{key:"getTemporaryContentUrlsForAttachedMedia",value:function(){var f,m=this.attachedMedia,v=(f=m==null?void 0:m.map(function(h){return h.sid}))!==null&&f!==void 0?f:[];return this.getTemporaryContentUrlsForMediaSids(v)}},{key:"_getDetailedDeliveryReceiptsPaginator",value:function(){var d=Z.default(O.default.mark(function m(v){var h=this,y,b,w;return O.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return y=this.configuration.links.messagesReceipts.replace("%s",this.conversation.sid).replace("%s",this.sid),b=new At(y).arg("PageToken",v==null?void 0:v.pageToken).arg("PageSize",v==null?void 0:v.pageSize).build(),L.next=4,this.services.network.get(b);case 4:return w=L.sent,L.abrupt("return",new Be(w.body.delivery_receipts.map(function(W){return new Ve(W)}),function(W,Q){return h._getDetailedDeliveryReceiptsPaginator({pageToken:W,pageSize:Q})},w.body.meta.previous_token,w.body.meta.next_token));case 6:case"end":return L.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getContentData",value:function(){var f=this;return new Ue.CancellablePromise(function(){var m=Z.default(O.default.mark(function v(h,y,b){var w,j,L,W,Q,We,Ye,ct,ht,cr;return O.default.wrap(function(ut){for(;;)switch(ut.prev=ut.next){case 0:if(f.state.contentSid!==null){ut.next=3;break}return h(null),ut.abrupt("return");case 3:if(w=f.getMediaByCategories(["body"]),w!==null){ut.next=7;break}return h(null),ut.abrupt("return");case 7:if(j="application/x-vnd.com.twilio.rich.",L=w.filter(function(on){return on.contentType.startsWith(j)}),L.length!==0){ut.next=12;break}return h(null),ut.abrupt("return");case 12:return W=L[0],Q=W.getContentTemporaryUrl(),b(function(){Q.cancel()}),ut.prev=15,ut.next=18,Q;case 18:We=ut.sent,ut.next=25;break;case 21:return ut.prev=21,ut.t0=ut.catch(15),y(ut.t0),ut.abrupt("return");case 25:if(We!==null){ut.next=28;break}return h(null),ut.abrupt("return");case 28:return Ye=new Promise(function(on,Vl){var et,Ga=!1,ln=new _n;ln.open("GET",(et=We)!==null&&et!==void 0?et:"",!0),ln.responseType="text",ln.onreadystatechange=function(){ln.readyState!==4||Ga||on(ln.responseText)},ln.onerror=function(){Vl(ln.statusText)},b(function(){Ga=!0,ln.abort(),Vl(new Error("XHR has been aborted"))}),ln.send()}),ut.prev=29,ut.next=32,Ye;case 32:ht=ut.sent,ct=JSON.parse(ht),ut.next=40;break;case 36:return ut.prev=36,ut.t1=ut.catch(29),y(ut.t1),ut.abrupt("return");case 40:cr=W.contentType.replace(j,"").replace(".","/"),h(ze(cr,ct.data));case 42:case"end":return ut.stop()}},v,null,[[15,21],[29,36]])}));return function(v,h,y){return m.apply(this,arguments)}}())}},{key:"getChannelMetadata",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.state.hasChannelMetadata){h.next=2;break}return h.abrupt("return",null);case 2:return h.next=4,this.services.channelMetadataClient.getChannelMetadata(this.conversation.sid,this.sid);case 4:return h.abrupt("return",h.sent);case 5:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getMessageRecipients",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.services.messageRecipientsClient.getRecipientsFromMessage(this.conversation.sid,this.sid);case 2:return h.abrupt("return",h.sent);case 3:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()}]),g}(U.ReplayEventEmitter);function va(C){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return C?E?new De(Lr(Lr({},C),{},{category:E}),this.services):new De(C,this.services):null}function ds(C,E){var g=this;this.state.media=Sn(this,Wn,va).call(this,E),this.state.medias=C?C.map(function(d){return Sn(g,Wn,va).call(g,d)}).filter(function(d){return d!==null}):E&&!C?[Sn(this,Wn,va).call(this,E,"media")].filter(function(d){return d!==null}):null}Ce.default(yr,"updated","updated"),ye([B.deprecated("getMediaByCategory","getMediaByCategories"),te("design:type",Function),te("design:paramtypes",[Array]),te("design:returntype",Array)],yr.prototype,"getMediaByCategory",null),ye([I.validateTypes([I.nonEmptyString,"undefined"]),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",De)],yr.prototype,"getEmailBody",null),ye([I.validateTypes([I.nonEmptyString,"undefined"]),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",De)],yr.prototype,"getEmailHistory",null),ye([I.validateTypesAsync("string"),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],yr.prototype,"updateBody",null),ye([I.validateTypesAsync(ar),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",Promise)],yr.prototype,"updateAttributes",null),ye([B.deprecated("attachTemporaryUrlsFor","getTemporaryContentUrlsForMedia"),te("design:type",Function),te("design:paramtypes",[Array]),te("design:returntype",Promise)],yr.prototype,"attachTemporaryUrlsFor",null),ye([I.validateTypesAsync(I.nonEmptyArray("media",De)),te("design:type",Function),te("design:paramtypes",[Array]),te("design:returntype",Ue.CancellablePromise)],yr.prototype,"getTemporaryContentUrlsForMedia",null),ye([I.validateTypesAsync(I.nonEmptyArray("strings","string")),te("design:type",Function),te("design:paramtypes",[Array]),te("design:returntype",Ue.CancellablePromise)],yr.prototype,"getTemporaryContentUrlsForMediaSids",null);function ha(C,E){var g=Object.keys(C);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(C);E&&(d=d.filter(function(f){return Object.getOwnPropertyDescriptor(C,f).enumerable})),g.push.apply(g,d)}return g}function ps(C){for(var E=1;E<arguments.length;E++){var g=arguments[E]!=null?arguments[E]:{};E%2?ha(Object(g),!0).forEach(function(d){Ce.default(C,d,g[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(g)):ha(Object(g)).forEach(function(d){Object.defineProperty(C,d,Object.getOwnPropertyDescriptor(g,d))})}return C}function Au(C,E){var g=typeof Symbol<"u"&&C[Symbol.iterator]||C["@@iterator"];if(!g){if(Array.isArray(C)||(g=sn(C))||E){g&&(C=g);var d=0,f=function(){};return{s:f,n:function(){return d>=C.length?{done:!0}:{done:!1,value:C[d++]}},e:function(b){throw b},f}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,v=!1,h;return{s:function(){g=g.call(C)},n:function(){var b=g.next();return m=b.done,b},e:function(b){v=!0,h=b},f:function(){try{!m&&g.return!=null&&g.return()}finally{if(v)throw h}}}}function sn(C,E){if(C){if(typeof C=="string")return vs(C,E);var g=Object.prototype.toString.call(C).slice(8,-1);if(g==="Object"&&C.constructor&&(g=C.constructor.name),g==="Map"||g==="Set")return Array.from(C);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return vs(C,E)}}function vs(C,E){(E==null||E>C.length)&&(E=C.length);for(var g=0,d=new Array(E);g<E;g++)d[g]=C[g];return d}function Pu(C){var E=Mu();return function(){var d=mt.default(C),f;if(E){var m=mt.default(this).constructor;f=Reflect.construct(d,arguments,m)}else f=d.apply(this,arguments);return wt.default(this,f)}}function Mu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ir=zt.scope("Messages"),Nu=function(C){Fe.default(g,C);var E=Pu(g);function g(d,f,m){var v;return ie.default(this,g),v=E.call(this),v.conversation=d,v.configuration=f,v.services=m,v.messagesByIndex=new Map,v.messagesListPromise=null,v}return se.default(g,[{key:"subscribe",value:function(){var d=Z.default(O.default.mark(function m(v){var h=this,y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!this.messagesListPromise){w.next=2;break}return w.abrupt("return",this.messagesListPromise);case 2:return this.messagesListPromise=typeof v=="string"?this.services.syncClient.list({id:v,mode:"open_existing"}):Promise.resolve(v),w.prev=3,w.next=6,this.messagesListPromise;case 6:return y=w.sent,y.on("itemAdded",function(j){Ir.debug("".concat(h.conversation.sid," itemAdded: ").concat(j.item.index));var L={self:"".concat(h.conversation._links.messages,"/").concat(j.item.data.sid),conversation:h.conversation._links.self,messages_receipts:"".concat(h.conversation._links.messages,"/").concat(j.item.data.sid,"/Receipts")},W=new yr(j.item.index,j.item.data,h.conversation,L,h.configuration,h.services);if(h.messagesByIndex.has(W.index)){Ir.debug("Message arrived, but is already known and ignored",h.conversation.sid,W.index);return}h.messagesByIndex.set(W.index,W),W.on("updated",function(Q){return h.emit("messageUpdated",Q)}),h.emit("messageAdded",W)}),y.on("itemRemoved",function(j){Ir.debug("#{this.conversation.sid} itemRemoved: ".concat(j.index));var L=j.index;if(h.messagesByIndex.has(L)){var W=h.messagesByIndex.get(L);if(!W)return;h.messagesByIndex.delete(W.index),W.removeAllListeners("updated"),h.emit("messageRemoved",W)}}),y.on("itemUpdated",function(j){Ir.debug("".concat(h.conversation.sid," itemUpdated: ").concat(j.item.index));var L=h.messagesByIndex.get(j.item.index);L&&L._update(j.item.data)}),w.abrupt("return",y);case 13:throw w.prev=13,w.t0=w.catch(3),this.messagesListPromise=null,this.services.syncClient.connectionState!=="disconnected"&&Ir.error("Failed to get messages object for conversation",this.conversation.sid,w.t0),Ir.debug("ERROR: Failed to get messages object for conversation",this.conversation.sid,w.t0),w.t0;case 19:case"end":return w.stop()}},m,this,[[3,13]])}));function f(m){return d.apply(this,arguments)}return f}()},{key:"unsubscribe",value:function(){var d=Z.default(O.default.mark(function m(){var v;return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(this.messagesListPromise){y.next=2;break}return y.abrupt("return");case 2:return y.next=4,this.messagesListPromise;case 4:v=y.sent,v.close(),this.messagesListPromise=null;case 7:case"end":return y.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"sendV2",value:function(f){var m=this;return Ir.debug("Sending message V2",f.mediaContent,f.attributes,f.emailOptions),new Ue.CancellablePromise(function(){var v=Z.default(O.default.mark(function h(y,b,w){var j,L,W,Q,We,Ye,ct,ht,cr,Ht,ut,on;return O.default.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:L=[],W=[],w(function(){W.forEach(function(Ga){return Ga.cancel()})}),Q=Au(f.mediaContent),et.prev=4,Q.s();case 6:if((We=Q.n()).done){et.next=25;break}return Ye=z.default(We.value,2),ct=Ye[0],ht=Ye[1],et.prev=8,Ir.debug("Adding media to a message as ".concat(ht instanceof FormData?"FormData":"SendMediaOptions"),ht),ut=ht instanceof FormData?m.services.mcsClient.postFormData(ht,ct):m.services.mcsClient.post((cr=ht.contentType)!==null&&cr!==void 0?cr:"",(Ht=ht.media)!==null&&Ht!==void 0?Ht:"",ct,ht.filename),W.push(ut),et.t0=L,et.next=15,ut;case 15:et.t1=et.sent,et.t0.push.call(et.t0,et.t1),et.next=23;break;case 19:return et.prev=19,et.t2=et.catch(8),b(et.t2),et.abrupt("return");case 23:et.next=6;break;case 25:et.next=30;break;case 27:et.prev=27,et.t3=et.catch(4),Q.e(et.t3);case 30:return et.prev=30,Q.f(),et.finish(30);case 33:return on=m.services.commandExecutor.mutateResource("post",m.conversation._links.messages,{body:f.text,subject:(j=f.emailOptions)===null||j===void 0?void 0:j.subject,media_sids:L.map(function(Ga){return Ga.sid}),attributes:typeof f.attributes<"u"?JSON.stringify(f.attributes):void 0,content_sid:f.contentSid,content_variables:typeof f.contentVariables<"u"?JSON.stringify(f.contentVariables.reduce(function(Ga,ln){return ps(ps({},Ga),{},Ce.default({},ln.name,ln.value))},{})):void 0}),et.prev=34,et.t4=y,et.next=38,on;case 38:et.t5=et.sent,(0,et.t4)(et.t5),et.next=45;break;case 42:et.prev=42,et.t6=et.catch(34),b(et.t6);case 45:case"end":return et.stop()}},h,null,[[4,27,30,33],[8,19],[34,42]])}));return function(h,y,b){return v.apply(this,arguments)}}())}},{key:"send",value:function(){var d=Z.default(O.default.mark(function m(v){var h,y,b=arguments;return O.default.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return h=b.length>1&&b[1]!==void 0?b[1]:{},y=b.length>2?b[2]:void 0,Ir.debug("Sending text message",v,h,y),j.abrupt("return",this.services.commandExecutor.mutateResource("post",this.conversation._links.messages,{body:v??"",attributes:typeof h<"u"?JSON.stringify(h):void 0,subject:y==null?void 0:y.subject}));case 4:case"end":return j.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"sendMedia",value:function(){var d=Z.default(O.default.mark(function m(v){var h,y,b,w,j,L=arguments;return O.default.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(b=L.length>1&&L[1]!==void 0?L[1]:{},w=L.length>2?L[2]:void 0,Ir.debug("Sending media message",v,b,w),Ir.debug("Sending media message as ".concat(v instanceof FormData?"FormData":"SendMediaOptions"),v,b),!(v instanceof FormData)){Q.next=10;break}return Q.next=7,this.services.mcsClient.postFormData(v);case 7:Q.t0=Q.sent,Q.next=13;break;case 10:return Q.next=12,this.services.mcsClient.post((h=v.contentType)!==null&&h!==void 0?h:"",(y=v.media)!==null&&y!==void 0?y:"","media",v.filename);case 12:Q.t0=Q.sent;case 13:return j=Q.t0,Q.next=16,this.services.commandExecutor.mutateResource("post",this.conversation._links.messages,{media_sids:[j.sid],attributes:typeof b<"u"?JSON.stringify(b):void 0});case 16:return Q.abrupt("return",Q.sent);case 17:case"end":return Q.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getMessages",value:function(){var d=Z.default(O.default.mark(function m(v,h){var y,b=arguments;return O.default.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return y=b.length>2&&b[2]!==void 0?b[2]:"backwards",j.abrupt("return",this._getMessages(v,h,y));case 2:case"end":return j.stop()}},m,this)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"_wrapPaginator",value:function(f,m,v){var h=this,y=f==="desc",b=function(){return m.nextPage().then(function(L){return h._wrapPaginator(f,L,v)})},w=function(){return m.prevPage().then(function(L){return h._wrapPaginator(f,L,v)})};return v(m.items).then(function(j){return{items:j.sort(function(L,W){return L.index-W.index}),hasPrevPage:y?m.hasNextPage:m.hasPrevPage,hasNextPage:y?m.hasPrevPage:m.hasNextPage,prevPage:y?b:w,nextPage:y?w:b}})}},{key:"_upsertMessage",value:function(f,m){var v=this,h=this.messagesByIndex.get(f);if(h)return h;var y={self:"".concat(this.conversation._links.messages,"/").concat(m.sid),conversation:this.conversation._links.self,messages_receipts:"".concat(this.conversation._links.messages,"/").concat(m.sid,"/Receipts")},b=new yr(f,m,this.conversation,y,this.configuration,this.services);return this.messagesByIndex.set(b.index,b),b.on("updated",function(w){return v.emit("messageUpdated",w)}),b}},{key:"_getMessages",value:function(){var d=Z.default(O.default.mark(function m(){var v=this,h,y,b,w,j,L,W=arguments;return O.default.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:return h=W.length>0&&W[0]!==void 0?W[0]:30,y=W.length>1&&W[1]!==void 0?W[1]:"end",b=W.length>2&&W[2]!==void 0?W[2]:"forward",w=b==="backwards"?"desc":"asc",We.next=6,this.messagesListPromise;case 6:return j=We.sent,We.next=9,j==null?void 0:j.getItems({from:y!=="end"?y:void 0,pageSize:h,order:w,limit:h});case 9:return L=We.sent,We.next=12,this._wrapPaginator(w,L,function(Ye){return Promise.all(Ye.map(function(ct){return v._upsertMessage(ct.index,ct.data)}))});case 12:return We.abrupt("return",We.sent);case 13:case"end":return We.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()}]),g}(U.ReplayEventEmitter),hs=function(){function C(E){ie.default(this,C),Ce.default(this,"attributes",{}),Ce.default(this,"mediaContent",[]),Ce.default(this,"emailOptions",{}),this.messagesEntity=E}return se.default(C,[{key:"send",value:function(){var g=this;return new Ue.CancellablePromise(function(){var d=Z.default(O.default.mark(function f(m,v,h){var y,b;return O.default.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return y=g.messagesEntity.sendV2(g),h(function(){return y.cancel()}),j.prev=2,j.next=5,y;case 5:b=j.sent,m(gt(b.index)),j.next=12;break;case 9:j.prev=9,j.t0=j.catch(2),v(j.t0);case 12:case"end":return j.stop()}},f,null,[[2,9]])}));return function(f,m,v){return d.apply(this,arguments)}}())}}]),C}(),Yt=function(){function C(E,g){ie.default(this,C),this.limits=E,this.message=new hs(g),this.emailBodies=new Map,this.emailHistories=new Map}return se.default(C,[{key:"setBody",value:function(g){return this.message.text=g,this}},{key:"setSubject",value:function(g){return this.message.emailOptions.subject=g,this}},{key:"setAttributes",value:function(g){return this.message.attributes=g,this}},{key:"setEmailBody",value:function(g,d){return this.emailBodies.set(g,d),this}},{key:"setEmailHistory",value:function(g,d){return this.emailHistories.set(g,d),this}},{key:"setContentTemplate",value:function(g){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return this.message.contentSid=g,this.message.contentVariables=d,this}},{key:"addMedia",value:function(g){if(typeof FormData>"u"&&g instanceof FormData)throw new Error("Could not add FormData content whilst not in a browser");if(!(g instanceof FormData)){var d=g;if(!d.contentType||!d.media)throw new Error("Media content in SendMediaOptions must contain non-empty contentType and media")}return this.message.mediaContent.push(["media",g]),this}},{key:"build",value:function(){var g=this;if(this.emailBodies.forEach(function(d,f){if(!g.limits.emailBodiesAllowedContentTypes.includes(f))throw new Error("Unsupported email body content type ".concat(f))}),this.emailHistories.forEach(function(d,f){if(!g.limits.emailHistoriesAllowedContentTypes.includes(f))throw new Error("Unsupported email history content type ".concat(f))}),this.emailBodies.size>this.limits.emailBodiesAllowedContentTypes.length)throw new Error("Too many email bodies attached to the message (".concat(this.emailBodies.size," > ").concat(this.limits.emailBodiesAllowedContentTypes.length,")"));if(this.emailHistories.size>this.limits.emailHistoriesAllowedContentTypes.length)throw new Error("Too many email histories attached to the message (".concat(this.emailHistories.size," > ").concat(this.limits.emailHistoriesAllowedContentTypes.length,")"));if(this.message.mediaContent.length>this.limits.mediaAttachmentsCountLimit)throw new Error("Too many media attachments in the message (".concat(this.message.mediaContent.length," > ").concat(this.limits.mediaAttachmentsCountLimit,")"));return this.emailBodies.forEach(function(d){g.message.mediaContent.push(["body",d])}),this.emailHistories.forEach(function(d){g.message.mediaContent.push(["history",d])}),this.message}},{key:"buildAndSend",value:function(){return this.build().send()}}]),C}();ye([I.validateTypes("string"),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Yt)],Yt.prototype,"setBody",null),ye([I.validateTypes("string"),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Yt)],Yt.prototype,"setSubject",null),ye([I.validateTypes(ar),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",Yt)],Yt.prototype,"setAttributes",null),ye([I.validateTypes("string",[FormData,wn]),te("design:type",Function),te("design:paramtypes",[String,Object]),te("design:returntype",Yt)],Yt.prototype,"setEmailBody",null),ye([I.validateTypes("string",[FormData,wn]),te("design:type",Function),te("design:paramtypes",[String,Object]),te("design:returntype",Yt)],Yt.prototype,"setEmailHistory",null),ye([I.validateTypes("string",[I.array("content variables",Qe),"undefined"]),te("design:type",Function),te("design:paramtypes",[String,Array]),te("design:returntype",Yt)],Yt.prototype,"setContentTemplate",null),ye([I.validateTypes([FormData,wn]),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",Yt)],Yt.prototype,"addMedia",null);function xu(C,E){var g=typeof Symbol<"u"&&C[Symbol.iterator]||C["@@iterator"];if(!g){if(Array.isArray(C)||(g=kn(C))||E){g&&(C=g);var d=0,f=function(){};return{s:f,n:function(){return d>=C.length?{done:!0}:{done:!1,value:C[d++]}},e:function(b){throw b},f}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,v=!1,h;return{s:function(){g=g.call(C)},n:function(){var b=g.next();return m=b.done,b},e:function(b){v=!0,h=b},f:function(){try{!m&&g.return!=null&&g.return()}finally{if(v)throw h}}}}function kn(C,E){if(C){if(typeof C=="string")return wi(C,E);var g=Object.prototype.toString.call(C).slice(8,-1);if(g==="Object"&&C.constructor&&(g=C.constructor.name),g==="Map"||g==="Set")return Array.from(C);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return wi(C,E)}}function wi(C,E){(E==null||E>C.length)&&(E=C.length);for(var g=0,d=new Array(E);g<E;g++)d[g]=C[g];return d}function ys(C){var E=Lu();return function(){var d=mt.default(C),f;if(E){var m=mt.default(this).constructor;f=Reflect.construct(d,arguments,m)}else f=d.apply(this,arguments);return wt.default(this,f)}}function Lu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $n={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",notificationLevel:"notificationLevel",sid:"sid",status:"status",uniqueName:"uniqueName",state:"state",bindings:"bindings"},_t=function(C){Fe.default(g,C);var E=ys(g);function g(d,f,m,v,h){var y,b,w;ie.default(this,g),w=E.call(this),w.sid=f,w._links=m,w._configuration=v,w._services=h,w._entityName=d.channel,w._internalState={uniqueName:d.uniqueName||null,status:"notParticipating",attributes:(y=d.attributes)!==null&&y!==void 0?y:{},createdBy:d.createdBy,dateCreated:tt(d.dateCreated),dateUpdated:tt(d.dateUpdated),friendlyName:d.friendlyName||null,lastReadMessageIndex:Number.isInteger(d.lastConsumedMessageIndex)?d.lastConsumedMessageIndex:null,bindings:(b=d.bindings)!==null&&b!==void 0?b:{}},d.notificationLevel&&(w._internalState.notificationLevel=d.notificationLevel);var j={participants:w._links.participants};return w._participants=new Map,w._participantsEntity=new me(Pe.default(w),w._participants,j,w._services),w._participantsEntity.on(g.participantJoined,function(L){return w.emit(g.participantJoined,L)}),w._participantsEntity.on(g.participantLeft,function(L){return w.emit(g.participantLeft,L)}),w._participantsEntity.on(g.participantUpdated,function(L){return w.emit(g.participantUpdated,L)}),w._messagesEntity=new Nu(Pe.default(w),v,h),w._messagesEntity.on(g.messageAdded,function(L){return w._onMessageAdded(L)}),w._messagesEntity.on(g.messageUpdated,function(L){return w.emit(g.messageUpdated,L)}),w._messagesEntity.on(g.messageRemoved,function(L){return w.emit(g.messageRemoved,L)}),w}return se.default(g,[{key:"uniqueName",get:function(){return this._internalState.uniqueName}},{key:"status",get:function(){return this._internalState.status}},{key:"friendlyName",get:function(){return this._internalState.friendlyName}},{key:"dateUpdated",get:function(){return this._internalState.dateUpdated}},{key:"dateCreated",get:function(){return this._internalState.dateCreated}},{key:"createdBy",get:function(){var f;return(f=this._internalState.createdBy)!==null&&f!==void 0?f:""}},{key:"attributes",get:function(){return this._internalState.attributes}},{key:"lastReadMessageIndex",get:function(){return this._internalState.lastReadMessageIndex}},{key:"lastMessage",get:function(){var f;return(f=this._internalState.lastMessage)!==null&&f!==void 0?f:void 0}},{key:"notificationLevel",get:function(){var f;return(f=this._internalState.notificationLevel)!==null&&f!==void 0?f:"default"}},{key:"bindings",get:function(){return this._internalState.bindings}},{key:"limits",get:function(){return this._configuration.limits}},{key:"state",get:function(){return this._internalState.state}},{key:"_statusSource",get:function(){return this._dataSource}},{key:"add",value:function(){var d=Z.default(O.default.mark(function m(v,h){return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",this._participantsEntity.add(v,h??{}));case 1:case"end":return b.stop()}},m,this)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"addNonChatParticipant",value:function(){var d=Z.default(O.default.mark(function m(v,h){var y,b,w=arguments;return O.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return y=w.length>2&&w[2]!==void 0?w[2]:{},b=w.length>3&&w[3]!==void 0?w[3]:{},L.abrupt("return",this._participantsEntity.addNonChatParticipant(v,h,y??{},b??{}));case 3:case"end":return L.stop()}},m,this)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"advanceLastReadMessageIndex",value:function(){var d=Z.default(O.default.mark(function m(v){var h;return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._subscribeStreams();case 2:if(!(v<((h=this.lastReadMessageIndex)!==null&&h!==void 0?h:0))){b.next=6;break}return b.next=5,this._setLastReadMessageIndex(this.lastReadMessageIndex);case 5:return b.abrupt("return",b.sent);case 6:return b.next=8,this._setLastReadMessageIndex(v);case 8:return b.abrupt("return",b.sent);case 9:case"end":return b.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"delete",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._services.commandExecutor.mutateResource("delete",this._links.self);case 2:return h.abrupt("return",this);case 3:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getAttributes",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._subscribe();case 2:return h.abrupt("return",this.attributes);case 3:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getMessages",value:function(){var d=Z.default(O.default.mark(function m(v,h,y){return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this._subscribeStreams();case 2:return w.abrupt("return",this._messagesEntity.getMessages(v,h,y));case 3:case"end":return w.stop()}},m,this)}));function f(m,v,h){return d.apply(this,arguments)}return f}()},{key:"getParticipants",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._subscribeStreams();case 2:return h.abrupt("return",this._participantsEntity.getParticipants());case 3:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getParticipantsCount",value:function(){var d=Z.default(O.default.mark(function m(){var v,h,y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return h=new At(this._configuration.links.conversations).path(this.sid).build(),w.next=3,this._services.network.get(h);case 3:return y=w.sent,w.abrupt("return",(v=y.body.participants_count)!==null&&v!==void 0?v:0);case 5:case"end":return w.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getParticipantBySid",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",this._participantsEntity.getParticipantBySid(v));case 1:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getParticipantByIdentity",value:function(){var d=Z.default(O.default.mark(function m(){var v,h=arguments;return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return v=h.length>0&&h[0]!==void 0?h[0]:"",b.abrupt("return",this._participantsEntity.getParticipantByIdentity(v??""));case 2:case"end":return b.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getMessagesCount",value:function(){var d=Z.default(O.default.mark(function m(){var v,h,y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return h=new At(this._configuration.links.conversations).path(this.sid).build(),w.next=3,this._services.network.get(h);case 3:return y=w.sent,w.abrupt("return",(v=y.body.messages_count)!==null&&v!==void 0?v:0);case 5:case"end":return w.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getUnreadMessagesCount",value:function(){var d=Z.default(O.default.mark(function m(){var v,h,y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return v=new At(this._configuration.links.myConversations).path(this.sid).build(),w.next=3,this._services.network.get(v);case 3:if(h=w.sent,h.body.conversation_sid===this.sid){w.next=6;break}throw new Error("Conversation was not found in the user conversations list");case 6:if(y=h.body.unread_messages_count,typeof y!="number"){w.next=9;break}return w.abrupt("return",y);case 9:return w.abrupt("return",null);case 10:case"end":return w.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"join",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._services.commandExecutor.mutateResource("post",this._links.participants,{identity:this._configuration.userIdentity});case 2:return h.abrupt("return",this);case 3:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"leave",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this._internalState.status!=="joined"){h.next=3;break}return h.next=3,this._services.commandExecutor.mutateResource("delete","".concat(this._links.participants,"/").concat(encodeURIComponent(this._configuration.userIdentity)));case 3:return h.abrupt("return",this);case 4:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"removeParticipant",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._participantsEntity.remove(typeof v=="string"?v:v.sid);case 2:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"sendMessage",value:function(){var d=Z.default(O.default.mark(function m(v,h,y){var b,w,j,L;return O.default.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(!(typeof v=="string"||v===null)){Q.next=5;break}return Q.next=3,this._messagesEntity.send(v,h,y);case 3:return j=Q.sent,Q.abrupt("return",(w=gt(j.index))!==null&&w!==void 0?w:0);case 5:return Q.next=7,this._messagesEntity.sendMedia(v,h,y);case 7:return L=Q.sent,Q.abrupt("return",(b=gt(L.index))!==null&&b!==void 0?b:0);case 9:case"end":return Q.stop()}},m,this)}));function f(m,v,h){return d.apply(this,arguments)}return f}()},{key:"prepareMessage",value:function(){return new Yt(this.limits,this._messagesEntity)}},{key:"setAllMessagesRead",value:function(){var d=Z.default(O.default.mark(function m(){var v;return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._subscribeStreams();case 2:return y.next=4,this.getMessages(1);case 4:if(v=y.sent,!(v.items.length>0)){y.next=7;break}return y.abrupt("return",this.advanceLastReadMessageIndex(v.items[0].index));case 7:return y.abrupt("return",0);case 8:case"end":return y.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"setAllMessagesUnread",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._subscribeStreams();case 2:return h.next=4,this._setLastReadMessageIndex(null);case 4:return h.abrupt("return",h.sent);case 5:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"setUserNotificationLevel",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._services.commandExecutor.mutateResource("post","".concat(this._configuration.links.myConversations,"/").concat(this.sid),{notification_level:v});case 2:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"typing",value:function(){return this._services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._services.commandExecutor.mutateResource("post",this._links.self,{attributes:v!==void 0?JSON.stringify(v):void 0});case 2:return y.abrupt("return",this);case 3:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"updateFriendlyName",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(this._internalState.friendlyName===v){y.next=3;break}return y.next=3,this._services.commandExecutor.mutateResource("post",this._links.self,{friendly_name:v});case 3:return y.abrupt("return",this);case 4:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"updateLastReadMessageIndex",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._subscribeStreams();case 2:return y.abrupt("return",this._setLastReadMessageIndex(v));case 3:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"updateUniqueName",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(this._internalState.uniqueName===v){y.next=4;break}return v||(v=""),y.next=4,this._services.commandExecutor.mutateResource("post",this._links.self,{unique_name:v});case 4:return y.abrupt("return",this);case 5:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getMessageRecipients",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._services.messageRecipientsClient.getRecipientsFromConversation(this.sid,v);case 2:return y.abrupt("return",y.sent);case 3:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"_subscribe",value:function(){var d=Z.default(O.default.mark(function m(){var v=this;return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!this._entityPromise){y.next=2;break}return y.abrupt("return",this._entityPromise);case 2:return this._entityPromise=this._services.syncClient.document({id:this._entityName,mode:"open_existing"}),y.prev=3,y.next=6,this._entityPromise;case 6:return this._entity=y.sent,this._entity.on(Ee.SyncDocument.updated,function(b){return v._update(b.data)}),this._entity.on(Ee.SyncDocument.removed,function(){return v.emit(g.removed,v)}),this._update(this._entity.data),y.abrupt("return",this._entity);case 13:throw y.prev=13,y.t0=y.catch(3),this._entity=null,this._entityPromise=null,this._services.syncClient.connectionState!="disconnected"&&g._logger.error("Failed to get conversation object",y.t0),g._logger.debug("ERROR: Failed to get conversation object",y.t0),y.t0;case 20:case"end":return y.stop()}},m,this,[[3,13]])}));function f(){return d.apply(this,arguments)}return f}()},{key:"_fetchStreams",value:function(){var d=Z.default(O.default.mark(function m(){var v,h,y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this._subscribe();case 2:return g._logger.trace("_streamsAvailable, this.entity.data=",(v=this._entity)===null||v===void 0?void 0:v.data),y=(h=this._entity)===null||h===void 0?void 0:h.data,w.next=6,this._services.syncClient.list({id:y.messages,mode:"open_existing"});case 6:return this._messagesList=w.sent,w.next=9,this._services.syncClient.map({id:y.roster,mode:"open_existing"});case 9:this._participantsMap=w.sent;case 10:case"end":return w.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"_subscribeStreams",value:function(){var d=Z.default(O.default.mark(function m(){var v,h,y,b,w,j,L;return O.default.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.prev=0,Q.next=3,this._subscribe();case 3:return g._logger.trace("_subscribeStreams, this.entity.data=",(v=this._entity)===null||v===void 0?void 0:v.data),w=(h=this._entity)===null||h===void 0?void 0:h.data,j=w.messages,L=w.roster,Q.next=9,Promise.all([this._messagesEntity.subscribe((y=this._messagesList)!==null&&y!==void 0?y:j),this._participantsEntity.subscribe((b=this._participantsMap)!==null&&b!==void 0?b:L)]);case 9:Q.next=16;break;case 11:throw Q.prev=11,Q.t0=Q.catch(0),this._services.syncClient.connectionState!=="disconnected"&&g._logger.error("Failed to subscribe on conversation objects",this.sid,Q.t0),g._logger.debug("ERROR: Failed to subscribe on conversation objects",this.sid,Q.t0),Q.t0;case 16:case"end":return Q.stop()}},m,this,[[0,11]])}));function f(){return d.apply(this,arguments)}return f}()},{key:"_unsubscribe",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this._entity&&(this._entity.close(),this._entity=null,this._entityPromise=null),h.abrupt("return",Promise.all([this._participantsEntity.unsubscribe(),this._messagesEntity.unsubscribe()]));case 2:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"_setStatus",value:function(f,m){var v=this;if(this._dataSource=m,this._internalState.status!==f){if(this._internalState.status=f,f==="joined"){this._subscribeStreams().catch(function(h){if(g._logger.debug("ERROR while setting conversation status "+f,h),v._services.syncClient.connectionState!=="disconnected")throw h});return}this._entityPromise&&this._unsubscribe().catch(function(h){if(g._logger.debug("ERROR while setting conversation status "+f,h),v._services.syncClient.connectionState!=="disconnected")throw h})}}},{key:"_update",value:function(f){var m,v,h,y,b;g._logger.trace("_update",f),g.preprocessUpdate(f,this.sid);for(var w=new Set,j=0,L=Object.keys(f);j<L.length;j++){var W=L[j],Q=$n[W];if(Q)switch(Q){case $n.status:if(!f.status||f.status==="unknown"||this._internalState.status===f.status)break;this._internalState.status=f.status,w.add(Q);break;case $n.attributes:if(be.default(this._internalState.attributes,f.attributes))break;this._internalState.attributes=f.attributes,w.add(Q);break;case $n.lastConsumedMessageIndex:if(f.lastConsumedMessageIndex===void 0||f.lastConsumedMessageIndex===this._internalState.lastReadMessageIndex)break;this._internalState.lastReadMessageIndex=f.lastConsumedMessageIndex,w.add("lastReadMessageIndex");break;case $n.lastMessage:if(this._internalState.lastMessage&&!f.lastMessage){delete this._internalState.lastMessage,w.add(Q);break}this._internalState.lastMessage=this._internalState.lastMessage||{},((m=f.lastMessage)===null||m===void 0?void 0:m.index)!==void 0&&f.lastMessage.index!==this._internalState.lastMessage.index&&(this._internalState.lastMessage.index=f.lastMessage.index,w.add(Q)),((v=f.lastMessage)===null||v===void 0?void 0:v.timestamp)!==void 0&&((h=this._internalState.lastMessage)===null||h===void 0||(y=h.dateCreated)===null||y===void 0?void 0:y.getTime())!==f.lastMessage.timestamp.getTime()&&(this._internalState.lastMessage.dateCreated=f.lastMessage.timestamp,w.add(Q)),be.default(this._internalState.lastMessage,{})&&delete this._internalState.lastMessage;break;case $n.state:var We=f.state||void 0;if(We!==void 0&&(We.dateUpdated=new Date(We.dateUpdated)),be.default(this._internalState.state,We))break;this._internalState.state=We,w.add(Q);break;case $n.bindings:if(be.default(this._internalState.bindings,f.bindings))break;this._internalState.bindings=f.bindings,w.add(Q);break;default:var Ye=f[W]instanceof Date,ct=Ye&&((b=this._internalState[Q])===null||b===void 0?void 0:b.getTime())===f[W].getTime(),ht=!Ye&&this[Q]===f[W];if(ct||ht)break;this._internalState[Q]=f[W],w.add(Q)}}w.size>0&&this.emit(g.updated,{conversation:this,updateReasons:Me.default(w)})}},{key:"_onMessageAdded",value:function(f){var m=xu(this._participants.values()),v;try{for(m.s();!(v=m.n()).done;){var h=v.value;if(h.identity===f.author){h._endTyping();break}}}catch(y){m.e(y)}finally{m.f()}this.emit(g.messageAdded,f)}},{key:"_setLastReadMessageIndex",value:function(){var d=Z.default(O.default.mark(function m(v){var h;return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._services.commandExecutor.mutateResource("post","".concat(this._configuration.links.myConversations,"/").concat(this.sid),{last_read_message_index:v});case 2:return h=b.sent,b.abrupt("return",h.unread_messages_count);case 4:case"end":return b.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()}],[{key:"preprocessUpdate",value:function(f,m){try{typeof f.attributes=="string"?f.attributes=JSON.parse(f.attributes):f.attributes&&JSON.stringify(f.attributes)}catch{g._logger.warn("Retrieved malformed attributes from the server for conversation: "+m),f.attributes={}}try{f.dateCreated&&(f.dateCreated=new Date(f.dateCreated))}catch{g._logger.warn("Retrieved malformed dateCreated from the server for conversation: "+m),delete f.dateCreated}try{f.dateUpdated&&(f.dateUpdated=new Date(f.dateUpdated))}catch{g._logger.warn("Retrieved malformed dateUpdated from the server for conversation: "+m),delete f.dateUpdated}try{f.lastMessage&&f.lastMessage.timestamp&&(f.lastMessage.timestamp=new Date(f.lastMessage.timestamp))}catch{g._logger.warn("Retrieved malformed lastMessage.timestamp from the server for conversation: "+m),delete f.lastMessage.timestamp}}}]),g}(U.ReplayEventEmitter);Ce.default(_t,"participantJoined","participantJoined"),Ce.default(_t,"participantLeft","participantLeft"),Ce.default(_t,"participantUpdated","participantUpdated"),Ce.default(_t,"messageAdded","messageAdded"),Ce.default(_t,"messageRemoved","messageRemoved"),Ce.default(_t,"messageUpdated","messageUpdated"),Ce.default(_t,"typingEnded","typingEnded"),Ce.default(_t,"typingStarted","typingStarted"),Ce.default(_t,"updated","updated"),Ce.default(_t,"removed","removed"),Ce.default(_t,"_logger",zt.scope("Conversation")),ye([I.validateTypesAsync(I.nonEmptyString,Gr),te("design:type",Function),te("design:paramtypes",[String,Object]),te("design:returntype",Promise)],_t.prototype,"add",null),ye([I.validateTypesAsync(I.nonEmptyString,I.nonEmptyString,Gr,Gr),te("design:type",Function),te("design:paramtypes",[String,String,Object,Object]),te("design:returntype",Promise)],_t.prototype,"addNonChatParticipant",null),ye([I.validateTypesAsync(I.nonNegativeInteger),te("design:type",Function),te("design:paramtypes",[Number]),te("design:returntype",Promise)],_t.prototype,"advanceLastReadMessageIndex",null),ye([I.validateTypesAsync(["undefined",I.nonNegativeInteger],["undefined",I.nonNegativeInteger],["undefined",I.literal("backwards","forward")]),te("design:type",Function),te("design:paramtypes",[Number,Number,String]),te("design:returntype",Promise)],_t.prototype,"getMessages",null),ye([I.validateTypesAsync(I.nonEmptyString),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],_t.prototype,"getParticipantBySid",null),ye([I.validateTypesAsync(I.nonEmptyString),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],_t.prototype,"getParticipantByIdentity",null),ye([I.validateTypesAsync([I.nonEmptyString,D]),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",Promise)],_t.prototype,"removeParticipant",null),ye([I.validateTypesAsync(["string",FormData,I.literal(null),I.objectSchema("media options",{contentType:I.nonEmptyString,media:I.custom(function(C){var E=typeof C=="string"&&C.length>0||C instanceof Uint8Array||C instanceof ArrayBuffer;return typeof Blob=="function"&&(E=E||C instanceof Blob),[E,"a non-empty string, an instance of Buffer or an instance of Blob"]})})],Gr,["undefined",I.literal(null),I.objectSchema("email attributes",{subject:[I.nonEmptyString,"undefined"]})]),te("design:type",Function),te("design:paramtypes",[Object,Object,Object]),te("design:returntype",Promise)],_t.prototype,"sendMessage",null),ye([I.validateTypesAsync(I.literal("default","muted")),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],_t.prototype,"setUserNotificationLevel",null),ye([I.validateTypesAsync(ar),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",Promise)],_t.prototype,"updateAttributes",null),ye([I.validateTypesAsync("string"),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],_t.prototype,"updateFriendlyName",null),ye([I.validateTypesAsync([I.literal(null),I.nonNegativeInteger]),te("design:type",Function),te("design:paramtypes",[Number]),te("design:returntype",Promise)],_t.prototype,"updateLastReadMessageIndex",null),ye([I.validateTypesAsync(["string",I.literal(null)]),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],_t.prototype,"updateUniqueName",null);var ju=function(){function C(){var E=this;ie.default(this,C),this._promise=new Promise(function(g,d){E._resolve=g,E._reject=d})}return se.default(C,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(g){this._resolve(g)}},{key:"set",value:function(g){this.current=g,this._resolve(g)}},{key:"fail",value:function(g){this._reject(g)}}]),C}();function gs(C,E){var g=typeof Symbol<"u"&&C[Symbol.iterator]||C["@@iterator"];if(!g){if(Array.isArray(C)||(g=Uu(C))||E){g&&(C=g);var d=0,f=function(){};return{s:f,n:function(){return d>=C.length?{done:!0}:{done:!1,value:C[d++]}},e:function(b){throw b},f}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,v=!1,h;return{s:function(){g=g.call(C)},n:function(){var b=g.next();return m=b.done,b},e:function(b){v=!0,h=b},f:function(){try{!m&&g.return!=null&&g.return()}finally{if(v)throw h}}}}function Uu(C,E){if(C){if(typeof C=="string")return ms(C,E);var g=Object.prototype.toString.call(C).slice(8,-1);if(g==="Object"&&C.constructor&&(g=C.constructor.name),g==="Map"||g==="Set")return Array.from(C);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return ms(C,E)}}function ms(C,E){(E==null||E>C.length)&&(E=C.length);for(var g=0,d=new Array(E);g<E;g++)d[g]=C[g];return d}function za(C,E){var g=Object.keys(C);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(C);E&&(d=d.filter(function(f){return Object.getOwnPropertyDescriptor(C,f).enumerable})),g.push.apply(g,d)}return g}function ya(C){for(var E=1;E<arguments.length;E++){var g=arguments[E]!=null?arguments[E]:{};E%2?za(Object(g),!0).forEach(function(d){Ce.default(C,d,g[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(g)):za(Object(g)).forEach(function(d){Object.defineProperty(C,d,Object.getOwnPropertyDescriptor(g,d))})}return C}function dr(C){var E=bs();return function(){var d=mt.default(C),f;if(E){var m=mt.default(this).constructor;f=Reflect.construct(d,arguments,m)}else f=d.apply(this,arguments);return wt.default(this,f)}}function bs(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gr=zt.scope("Conversations"),un=function(C){Fe.default(g,C);var E=dr(g);function g(d,f){var m;return ie.default(this,g),m=E.call(this),Ce.default(Pe.default(m),"conversations",new Map),Ce.default(Pe.default(m),"myConversationsRead",new ju),Ce.default(Pe.default(m),"tombstones",new Set),Ce.default(Pe.default(m),"myConversationsFetched",!1),m.configuration=d,m.services=f,m}return se.default(g,[{key:"addConversation",value:function(){var d=Z.default(O.default.mark(function m(v){var h,y,b,w,j,L,W,Q,We,Ye;return O.default.wrap(function(ht){for(;;)switch(ht.prev=ht.next){case 0:return w=typeof(v==null?void 0:v.attributes)<"u"?v.attributes:{},ht.next=3,this.services.commandExecutor.mutateResource("post",this.configuration.links.conversations,{friendly_name:v.friendlyName,unique_name:v.uniqueName,attributes:typeof w<"u"?JSON.stringify(w):void 0});case 3:if(j=ht.sent,L=(h=j.sid)!==null&&h!==void 0?h:null,W=(y=(b=j.sync_objects)===null||b===void 0?void 0:b.conversation)!==null&&y!==void 0?y:null,Q=ya({self:j.url},j.links),We=this.conversations.get(L),!We){ht.next=12;break}return ht.next=11,We._subscribe();case 11:return ht.abrupt("return",We);case 12:return Ye=new _t({channel:W,entityName:"",uniqueName:"",attributes:null,createdBy:"",friendlyName:"",lastConsumedMessageIndex:0,dateCreated:null,dateUpdated:null},L,Q,this.configuration,this.services),this.conversations.set(Ye.sid,Ye),this._registerForEvents(Ye),ht.next=17,Ye._subscribe();case 17:return this.emit("conversationAdded",Ye),ht.abrupt("return",Ye);case 19:case"end":return ht.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"fetchConversations",value:function(){var d=Z.default(O.default.mark(function m(){var v=this,h,y,b,w,j,L,W;return O.default.wrap(function(We){for(;;)switch(We.prev=We.next){case 0:return We.prev=0,We.next=3,this._getMap();case 3:return h=We.sent,h.on(Ee.SyncMap.itemAdded,function(Ye){gr.debug("itemAdded: ".concat(Ye.item.key)),v._upsertConversation("sync",Ye.item.key,Ye.item.data)}),h.on(Ee.SyncMap.itemRemoved,function(Ye){gr.debug("itemRemoved: ".concat(Ye.key));var ct=Ye.key;v.myConversationsFetched||v.tombstones.add(ct);var ht=v.conversations.get(ct);ht&&(ht.status==="joined"&&(ht._setStatus("notParticipating","sync"),v.emit("conversationLeft",ht)),v.conversations.delete(ct),v.emit("conversationRemoved",ht),ht.emit("removed",ht))}),h.on(Ee.SyncMap.itemUpdated,function(Ye){gr.debug("itemUpdated: ".concat(Ye.item.key)),v._upsertConversation("sync",Ye.item.key,Ye.item.data)}),We.next=9,this._fetchMyConversations();case 9:y=We.sent,b=[],w=gs(y);try{for(w.s();!(j=w.n()).done;)L=j.value,b.push(this._upsertConversation("rest",L.channel_sid,L))}catch(Ye){w.e(Ye)}finally{w.f()}return this.myConversationsRead.set(!0),We.next=16,Promise.all(b);case 16:return this.myConversationsFetched=!0,this.tombstones.clear(),gr.debug("The conversations list has been successfully fetched"),We.abrupt("return",this);case 22:throw We.prev=22,We.t0=We.catch(0),W="Failed to fetch the conversations list",this.services.syncClient.connectionState!=="disconnected"&&gr.error(W,We.t0),gr.debug("ERROR: ".concat(W),We.t0),We.t0;case 28:case"end":return We.stop()}},m,this,[[0,22]])}));function f(){return d.apply(this,arguments)}return f}()},{key:"getConversations",value:function(){var d=Z.default(O.default.mark(function m(){var v=this,h,y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this._getMap();case 2:return h=w.sent,w.next=5,h.getItems();case 5:return y=w.sent,w.abrupt("return",this._wrapPaginator(y,function(j){return Promise.all(j.map(function(L){return v._upsertConversation("sync",L.key,L.data)}))}));case 7:case"end":return w.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getConversation",value:function(){var d=Z.default(O.default.mark(function m(v){var h=this,y,b,w;return O.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,this._getMap();case 2:return y=L.sent,L.next=5,y.getItems({key:v});case 5:return b=L.sent,w=b.items.map(function(W){return h._upsertConversation("sync",W.key,W.data)}),L.abrupt("return",w.length>0?w[0]:null);case 8:case"end":return L.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getConversationByUniqueName",value:function(){var d=Z.default(O.default.mark(function m(v){var h,y,b,w,j;return O.default.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return h=new At(this.configuration.links.myConversations).path(v).build(),W.next=3,this.services.network.get(h);case 3:return y=W.sent,b=y.body,w=b.conversation_sid,j={entityName:null,lastConsumedMessageIndex:b.last_read_message_index,status:(b==null?void 0:b.status)||"unknown",friendlyName:b.friendly_name,dateUpdated:b.date_updated,dateCreated:b.date_created,uniqueName:b.unique_name,createdBy:b.created_by,attributes:b.attributes,channel:b.sync_objects.conversation,notificationLevel:b==null?void 0:b.notification_level,sid:w},W.abrupt("return",w?this._upsertConversation("sync",w,j):null);case 8:case"end":return W.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"peekConversation",value:function(){var d=Z.default(O.default.mark(function m(v){var h,y,b,w;return O.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return h=new At(this.configuration.links.conversations).path(v).build(),L.next=3,this.services.network.get(h);case 3:return y=L.sent,b=y.body,w={entityName:null,status:(b==null?void 0:b.status)||"unknown",friendlyName:b.friendly_name,dateUpdated:b.date_updated,dateCreated:b.date_created,uniqueName:b.unique_name,createdBy:b.created_by,attributes:b.attributes,channel:"".concat(v,".channel"),sid:v},L.abrupt("return",this._upsertConversation("sync",v,w));case 7:case"end":return L.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"_getMap",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.services.syncClient.map({id:this.configuration.myConversations,mode:"open_existing"});case 2:return h.abrupt("return",h.sent);case 3:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"_wrapPaginator",value:function(){var d=Z.default(O.default.mark(function m(v,h){var y=this,b;return O.default.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,h(v.items);case 2:return b=j.sent,j.abrupt("return",{items:b.filter(function(L){return L!==null}),hasNextPage:v.hasNextPage,hasPrevPage:v.hasPrevPage,nextPage:function(){return v.nextPage().then(function(W){return y._wrapPaginator(W,h)})},prevPage:function(){return v.prevPage().then(function(W){return y._wrapPaginator(W,h)})}});case 4:case"end":return j.stop()}},m)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"_updateConversation",value:function(){var d=Z.default(O.default.mark(function m(v,h,y){var b,w,j;return O.default.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(b=h._statusSource!==void 0&&v!==h._statusSource,w=v!=="rest"||h._statusSource==="sync",!(b&&w&&v!=="sync")){W.next=5;break}return gr.trace("upsertConversation: conversation is known from sync and came from REST, ignoring",{sid:h.sid,data:y.status,conversation:h.status}),W.abrupt("return");case 5:if(!(y.status==="joined"&&h.status!=="joined")){W.next=15;break}return h._setStatus("joined",v),j={},typeof y.notificationLevel<"u"&&(j.notificationLevel=y.notificationLevel),typeof y.lastConsumedMessageIndex<"u"&&(j.lastConsumedMessageIndex=y.lastConsumedMessageIndex),be.default(j,{})||h._update(j),W.next=13,h._subscribe();case 13:return this.emit("conversationJoined",h),W.abrupt("return");case 15:if(!(y.status==="notParticipating"&&h.status==="joined")){W.next=22;break}return h._setStatus("notParticipating",v),h._update(y),W.next=20,h._subscribe();case 20:return this.emit("conversationLeft",h),W.abrupt("return");case 22:if(y.status!=="notParticipating"){W.next=26;break}return W.next=25,h._subscribe();case 25:return W.abrupt("return");case 26:h._update(y);case 27:case"end":return W.stop()}},m,this)}));function f(m,v,h){return d.apply(this,arguments)}return f}()},{key:"_upsertConversation",value:function(){var d=Z.default(O.default.mark(function m(v,h,y){var b,w,j,L;return O.default.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(gr.trace("upsertConversation called for ".concat(h),y),b=this.conversations.get(h),!b){Q.next=9;break}return gr.trace("upsertConversation: the conversation ".concat(b.sid," is known;")+"its status is known from the source ".concat(b._statusSource," ")+"and the update came from the source ".concat(v),b),Q.next=6,this._updateConversation(v,b,y);case 6:return Q.next=8,b._subscribe();case 8:return Q.abrupt("return",b);case 9:if(!(v==="rest"&&this.tombstones.has(h))){Q.next=12;break}return gr.trace("upsertChannel: the conversation is deleted but reappeared again from REST, ignoring",h),Q.abrupt("return",null);case 12:return gr.trace("upsertConversation: creating a local conversation object with sid "+h,y),w="".concat(this.configuration.links.conversations,"/").concat(h),j={self:w,messages:"".concat(w,"/Messages"),participants:"".concat(w,"/Participants")},L=new _t(y,h,j,this.configuration,this.services),this.conversations.set(h,L),Q.prev=17,Q.next=20,L._subscribe();case 20:if(y.status!=="joined"){Q.next=23;break}return Q.next=23,L._fetchStreams();case 23:Q.next=32;break;case 25:if(Q.prev=25,Q.t0=Q.catch(17),Q.t0.name==="SyncError"){Q.next=29;break}throw Q.t0;case 29:return gr.trace("upsertChannel: the conversation is missing some Sync entity(ies), ignoring",h,Q.t0),this.conversations.delete(h),Q.abrupt("return",null);case 32:return this._registerForEvents(L),this.emit("conversationAdded",L),y.status==="joined"&&(L._setStatus("joined",v),this.emit("conversationJoined",L)),Q.abrupt("return",L);case 36:case"end":return Q.stop()}},m,this,[[17,25]])}));function f(m,v,h){return d.apply(this,arguments)}return f}()},{key:"_fetchMyConversations",value:function(){var d=Z.default(O.default.mark(function m(){var v,h,y,b,w,j;return O.default.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:v=[],h=null;case 2:return b=new At(this.configuration.links.myConversations),h&&b.arg("PageToken",h),W.next=6,this.services.network.get(b.build());case 6:w=W.sent,j=(y=w.body)===null||y===void 0?void 0:y.conversations.map(function(Q){return{descriptor:Q,channel_sid:Q.conversation_sid,status:Q.status,channel:Q.sync_objects.conversation,messages:Q.sync_objects.messages,roster:"".concat(Q.conversation_sid,".roster"),lastConsumedMessageIndex:Q.last_read_message_index,notificationLevel:Q.notification_level}}),h=w.body.meta.next_token,v=[].concat(Me.default(v),Me.default(j));case 10:if(h){W.next=2;break}case 11:return W.abrupt("return",v);case 12:case"end":return W.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"_onConversationRemoved",value:function(f){var m=this.conversations.get(f);m&&(this.conversations.delete(f),this.emit("conversationRemoved",m))}},{key:"_registerForEvents",value:function(f){var m=this;f.on("removed",function(){return m._onConversationRemoved(f.sid)}),f.on("updated",function(v){return m.emit("conversationUpdated",v)}),f.on("participantJoined",function(v){return m.emit("participantJoined",v)}),f.on("participantLeft",function(v){return m.emit("participantLeft",v)}),f.on("participantUpdated",function(v){return m.emit("participantUpdated",v)}),f.on("messageAdded",function(v){return m.emit("messageAdded",v)}),f.on("messageUpdated",function(v){return m.emit("messageUpdated",v)}),f.on("messageRemoved",function(v){return m.emit("messageRemoved",v)}),f.on("typingStarted",function(v){return m.emit("typingStarted",v)}),f.on("typingEnded",function(v){return m.emit("typingEnded",v)})}}]),g}(U.ReplayEventEmitter);function Tn(C){var E=Fu();return function(){var d=mt.default(C),f;if(E){var m=mt.default(this).constructor;f=Reflect.construct(d,arguments,m)}else f=d.apply(this,arguments);return wt.default(this,f)}}function Fu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var A=function(C){Fe.default(g,C);var E=Tn(g);function g(d,f,m){var v;return ie.default(this,g),v=E.call(this),v.configuration=f,v.services=m,v.fifoStack=[],v.myself=d,v.myself.on("updated",function(h){return v.emit("userUpdated",h)}),v.myself.on("userSubscribed",function(){return v.emit("userSubscribed",v.myself)}),v.myself.on("userUnsubscribed",function(){v.emit("userUnsubscribed",v.myself),v.myself._ensureFetched()}),v.subscribedUsers=new Map,v}return se.default(g,[{key:"handleUnsubscribeUser",value:function(f){this.subscribedUsers.has(f.identity)&&this.subscribedUsers.delete(f.identity);var m=0,v=this.fifoStack.find(function(h,y){return h==f.identity?(m=y,!0):!1});v&&this.fifoStack.splice(m,1),this.emit("userUnsubscribed",f)}},{key:"handleSubscribeUser",value:function(f){if(!this.subscribedUsers.has(f.identity)){if(this.fifoStack.length>=this.configuration.userInfosToSubscribe){var m,v,h=this.fifoStack.shift();(m=this.subscribedUsers)===null||m===void 0||(v=m.get(h))===null||v===void 0||v.unsubscribe()}this.fifoStack.push(f.identity),this.subscribedUsers.set(f.identity,f),this.emit("userSubscribed",f)}}},{key:"getUser",value:function(){var d=Z.default(O.default.mark(function m(v,h){var y,b=this,w,j;return O.default.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,this.myself._ensureFetched();case 2:if(v!=this.myself.identity){W.next=4;break}return W.abrupt("return",this.myself);case 4:if(w=this.subscribedUsers.get(v),!w){W.next=7;break}return W.abrupt("return",w);case 7:if(!((y=h)!==null&&y!==void 0)){W.next=11;break}W.next=14;break;case 11:return W.next=13,this.getSyncUniqueName(v);case 13:h=W.sent;case 14:return j=new ue(v,h,this.configuration,this.services),j.on("updated",function(Q){return b.emit("userUpdated",Q)}),j.on("userSubscribed",function(){return b.handleSubscribeUser(j)}),j.on("userUnsubscribed",function(){return b.handleUnsubscribeUser(j)}),W.next=20,j._ensureFetched();case 20:return W.abrupt("return",j);case 21:case"end":return W.stop()}},m,this)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"getSubscribedUsers",value:function(){var d=Z.default(O.default.mark(function m(){var v;return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this.myself._ensureFetched();case 2:return v=[this.myself],this.subscribedUsers.forEach(function(b){return v.push(b)}),y.abrupt("return",v);case 5:case"end":return y.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getSyncUniqueName",value:function(){var d=Z.default(O.default.mark(function m(v){var h,y,b,w;return O.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return b=new At(this.configuration.links.users).path(v).build(),L.next=3,this.services.network.get(b);case 3:return w=L.sent,L.abrupt("return",(h=(y=w.body)===null||y===void 0?void 0:y.sync_objects.user_info_map)!==null&&h!==void 0?h:"");case 5:case"end":return L.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()}]),g}(U.ReplayEventEmitter),N=zt.scope("TypingIndicator"),$=function(){function C(E,g,d){ie.default(this,C),this.configuration=g,this.services=d,this.getConversation=E,this.serviceTypingTimeout=null,this.sentUpdates=new Map}return se.default(C,[{key:"typingTimeout",get:function(){return this.configuration.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.configuration.typingIndicatorTimeoutDefault}},{key:"initialize",value:function(){var g=this;this.services.notificationClient.on("message",function(){var d=Z.default(O.default.mark(function f(m,v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(m!==le.TYPING_INDICATOR){y.next=3;break}return y.next=3,g._handleRemoteTyping(v);case 3:case"end":return y.stop()}},f)}));return function(f,m){return d.apply(this,arguments)}}())}},{key:"_handleRemoteTyping",value:function(){var E=Z.default(O.default.mark(function d(f){var m=this;return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:N.trace("Got new typing indicator ",f),this.getConversation(f.channel_sid).then(function(y){y&&y._participants.forEach(function(b){if(b.identity===f.identity){var w=m.configuration.typingIndicatorTimeoutOverride?m.configuration.typingIndicatorTimeoutOverride+1e3:f.typing_timeout*1e3;b._startTyping(w)}})}).catch(function(y){throw N.error(y),y});case 2:case"end":return h.stop()}},d,this)}));function g(d){return E.apply(this,arguments)}return g}()},{key:"send",value:function(g){var d=this.sentUpdates.get(g);return d&&d>Date.now()-this.typingTimeout?Promise.resolve():(this.sentUpdates.set(g,Date.now()),this._send(g))}},{key:"_send",value:function(g){var d=this;N.trace("Sending typing indicator");var f=this.configuration.links.typing,m={"Content-Type":"application/x-www-form-urlencoded"},v="ChannelSid=".concat(g);return this.services.twilsockClient.post(f,m,v,this.configuration.productId).then(function(h){h.body.hasOwnProperty("typing_timeout")&&(d.serviceTypingTimeout=h.body.typing_timeout*1e3)}).catch(function(h){throw N.error("Failed to send typing indicator:",h),h})}}]),C}(),k=se.default(function C(E){ie.default(this,C),this.title=E.title||null,this.body=E.body||null,this.sound=E.sound||null,this.badge=E.badge||null,this.action=E.action||null,this.type=E.type||null,this.data=E.data||{}}),_="2.6.0";function P(C,E){var g=Object.keys(C);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(C);E&&(d=d.filter(function(f){return Object.getOwnPropertyDescriptor(C,f).enumerable})),g.push.apply(g,d)}return g}function R(C){for(var E=1;E<arguments.length;E++){var g=arguments[E]!=null?arguments[E]:{};E%2?P(Object(g),!0).forEach(function(d){Ce.default(C,d,g[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(g)):P(Object(g)).forEach(function(d){Object.defineProperty(C,d,Object.getOwnPropertyDescriptor(g,d))})}return C}function ae(C){var E=re();return function(){var d=mt.default(C),f;if(E){var m=mt.default(this).constructor;f=Reflect.construct(d,arguments,m)}else f=d.apply(this,arguments);return wt.default(this,f)}}function re(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Se=function(E){return E.replace(/(^\/+|\/+$)/g,"")},Oe=function(E){return E.status.code===202},Xe=function(C){Fe.default(g,C);var E=ae(g);function g(d){return ie.default(this,g),E.call(this,d)}return se.default(g)}(xt.default(Error)),pr=function(){function C(E,g,d){ie.default(this,C),this._serviceUrl=E,this._services=g,this._productId=d}return se.default(C,[{key:"_preProcessUrl",value:function(g){var d=Se(g);return/^https?:\/\//.test(g)?d:"".concat(Se(this._serviceUrl),"/").concat(d)}},{key:"_makeRequest",value:function(){var E=Z.default(O.default.mark(function d(f,m,v,h){var y,b,w,j;return O.default.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:y=this._preProcessUrl(m),b=R({"Content-Type":"application/json; charset=utf-8"},h||{}),W.t0=f,W.next=W.t0==="get"?5:W.t0==="post"?11:W.t0==="delete"?15:19;break;case 5:return j=y,v&&(j+="?"+Object.entries(v).map(function(Q){return Q.map(encodeURIComponent).join("=")}).join("&")),W.next=9,this._services.transport.get(j,b,this._productId);case 9:return w=W.sent,W.abrupt("break",19);case 11:return W.next=13,this._services.transport.post(y,b,JSON.stringify(v),this._productId);case 13:return w=W.sent,W.abrupt("break",19);case 15:return W.next=17,this._services.transport.delete(y,b,{},this._productId);case 17:return w=W.sent,W.abrupt("break",19);case 19:if(!(w.status.code<200||w.status.code>=300)){W.next=21;break}throw new Error("Request responded with a non-success code ".concat(w.status.code));case 21:return W.abrupt("return",w);case 22:case"end":return W.stop()}},d,this)}));function g(d,f,m,v){return E.apply(this,arguments)}return g}()},{key:"fetchResource",value:function(){var E=Z.default(O.default.mark(function d(f,m){var v=this,h,y,b;return O.default.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return h=6,y=new Ae.AsyncRetrier({min:50,max:1600,maxAttemptsCount:h}),j.prev=2,j.next=5,y.run(Z.default(O.default.mark(function L(){var W,Q,We;return O.default.wrap(function(ct){for(;;)switch(ct.prev=ct.next){case 0:return ct.prev=0,ct.next=3,v._makeRequest("get",f,m);case 3:return W=ct.sent,ct.abrupt("return",{type:"success",data:W.body});case 7:if(ct.prev=7,ct.t0=ct.catch(0),!((ct.t0===null||ct.t0===void 0||(Q=ct.t0.body)===null||Q===void 0?void 0:Q.status)===404&&(ct.t0===null||ct.t0===void 0||(We=ct.t0.body)===null||We===void 0?void 0:We.code)===50530)){ct.next=11;break}return ct.abrupt("return",{type:"noMetadata"});case 11:throw ct.t0;case 12:case"end":return ct.stop()}},L,null,[[0,7]])})));case 5:b=j.sent,j.next=11;break;case 8:throw j.prev=8,j.t0=j.catch(2),new Error('Fetch resource from "'.concat(f,'" failed.'));case 11:if(b.type!=="noMetadata"){j.next=13;break}throw new Xe("No metadata found.");case 13:return j.abrupt("return",b.data);case 14:case"end":return j.stop()}},d,null,[[2,8]])}));function g(d,f){return E.apply(this,arguments)}return g}()},{key:"mutateResource",value:function(){var E=Z.default(O.default.mark(function d(f,m,v){var h;return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._makeRequest(f,m,v,{"X-Twilio-Mutation-Id":ke.v4()});case 2:if(h=b.sent,!Oe(h)){b.next=7;break}return b.next=6,this.fetchResource(h.body.resource_url);case 6:return b.abrupt("return",b.sent);case 7:return b.abrupt("return",h.body);case 8:case"end":return b.stop()}},d,this)}));function g(d,f,m){return E.apply(this,arguments)}return g}()}]),C}(),Cn=function(){function C(E){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:5e3;ie.default(this,C),Ce.default(this,"_cachedTemplates",null),this._services=E,this._pageSize=g,this._cacheTtlMs=d}return se.default(C,[{key:"getContentTemplates",value:function(){var E=Z.default(O.default.mark(function d(){var f=this,m,v,h,y,b,w,j;return O.default.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(this._cachedTemplates===null){W.next=2;break}return W.abrupt("return",this._cachedTemplates);case 2:return W.next=4,this._fetchContentTemplates();case 4:m=W.sent,v=z.default(m,2),h=v[0],y=v[1],b=h;case 9:if(y===null){W.next=19;break}return W.next=12,this._fetchContentTemplates(y);case 12:w=W.sent,j=z.default(w,2),h=j[0],y=j[1],b=[].concat(Me.default(b),Me.default(h)),W.next=9;break;case 19:return this._cachedTemplates=Object.freeze(b),setTimeout(function(){f._cachedTemplates=null},this._cacheTtlMs),W.abrupt("return",b);case 22:case"end":return W.stop()}},d,this)}));function g(){return E.apply(this,arguments)}return g}()},{key:"_fetchContentTemplates",value:function(){var E=Z.default(O.default.mark(function d(f){var m,v,h;return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return m="Client/v2/ContentTemplates",v=new At(m),v.arg("PageSize",this._pageSize),f!==void 0&&v.arg("PageToken",f),b.next=6,this._services.commandExecutor.fetchResource(v.build());case 6:return h=b.sent,b.abrupt("return",[h.templates.map(function(w){return new rt(w)}),h.meta.next_token]);case 8:case"end":return b.stop()}},d,this)}));function g(d){return E.apply(this,arguments)}return g}()}]),C}();function tr(C,E){var g=typeof Symbol<"u"&&C[Symbol.iterator]||C["@@iterator"];if(!g){if(Array.isArray(C)||(g=En(C))||E){g&&(C=g);var d=0,f=function(){};return{s:f,n:function(){return d>=C.length?{done:!0}:{done:!1,value:C[d++]}},e:function(b){throw b},f}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,v=!1,h;return{s:function(){g=g.call(C)},n:function(){var b=g.next();return m=b.done,b},e:function(b){v=!0,h=b},f:function(){try{!m&&g.return!=null&&g.return()}finally{if(v)throw h}}}}function En(C,E){if(C){if(typeof C=="string")return Hl(C,E);var g=Object.prototype.toString.call(C).slice(8,-1);if(g==="Object"&&C.constructor&&(g=C.constructor.name),g==="Map"||g==="Set")return Array.from(C);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return Hl(C,E)}}function Hl(C,E){(E==null||E>C.length)&&(E=C.length);for(var g=0,d=new Array(E);g<E;g++)d[g]=C[g];return d}var Cv=function(C){function E(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ie.default(this,E),!(g.maxSize&&g.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=g.maxSize,this.onEviction=g.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}return se.default(E,[{key:"_set",value:function(d,f){if(this.cache.set(d,f),this._size++,this._size>=this.maxSize){if(this._size=0,typeof this.onEviction=="function"){var m=tr(this.oldCache.entries()),v;try{for(m.s();!(v=m.n()).done;){var h=z.default(v.value,2),y=h[0],b=h[1];this.onEviction(y,b)}}catch(w){m.e(w)}finally{m.f()}}this.oldCache=this.cache,this.cache=new Map}}},{key:"get",value:function(d){if(this.cache.has(d))return this.cache.get(d);if(this.oldCache.has(d)){var f=this.oldCache.get(d);return this.oldCache.delete(d),this._set(d,f),f}}},{key:"set",value:function(d,f){return this.cache.has(d)?this.cache.set(d,f):this._set(d,f),this}},{key:"has",value:function(d){return this.cache.has(d)||this.oldCache.has(d)}},{key:"peek",value:function(d){if(this.cache.has(d))return this.cache.get(d);if(this.oldCache.has(d))return this.oldCache.get(d)}},{key:"delete",value:function(d){var f=this.cache.delete(d);return f&&this._size--,this.oldCache.delete(d)||f}},{key:"clear",value:function(){this.cache.clear(),this.oldCache.clear(),this._size=0}},{key:"keys",value:O.default.mark(function g(){var d,f,m,v;return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:d=tr(this),y.prev=1,d.s();case 3:if((f=d.n()).done){y.next=9;break}return m=z.default(f.value,1),v=m[0],y.next=7,v;case 7:y.next=3;break;case 9:y.next=14;break;case 11:y.prev=11,y.t0=y.catch(1),d.e(y.t0);case 14:return y.prev=14,d.f(),y.finish(14);case 17:case"end":return y.stop()}},g,this,[[1,11,14,17]])})},{key:"values",value:O.default.mark(function g(){var d,f,m,v;return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:d=tr(this),y.prev=1,d.s();case 3:if((f=d.n()).done){y.next=9;break}return m=z.default(f.value,2),v=m[1],y.next=7,v;case 7:y.next=3;break;case 9:y.next=14;break;case 11:y.prev=11,y.t0=y.catch(1),d.e(y.t0);case 14:return y.prev=14,d.f(),y.finish(14);case 17:case"end":return y.stop()}},g,this,[[1,11,14,17]])})},{key:C,value:O.default.mark(function g(){var d,f,m,v,h,y,b,w;return O.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:d=tr(this.cache),L.prev=1,d.s();case 3:if((f=d.n()).done){L.next=9;break}return m=f.value,L.next=7,m;case 7:L.next=3;break;case 9:L.next=14;break;case 11:L.prev=11,L.t0=L.catch(1),d.e(L.t0);case 14:return L.prev=14,d.f(),L.finish(14);case 17:v=tr(this.oldCache),L.prev=18,v.s();case 20:if((h=v.n()).done){L.next=28;break}if(y=h.value,b=z.default(y,1),w=b[0],this.cache.has(w)){L.next=26;break}return L.next=26,y;case 26:L.next=20;break;case 28:L.next=33;break;case 30:L.prev=30,L.t1=L.catch(18),v.e(L.t1);case 33:return L.prev=33,v.f(),L.finish(33);case 36:case"end":return L.stop()}},g,this,[[1,11,14,17],[18,30,33,36]])})},{key:"size",get:function(){var d=0,f=tr(this.oldCache.keys()),m;try{for(f.s();!(m=f.n()).done;){var v=m.value;this.cache.has(v)||d++}}catch(h){f.e(h)}finally{f.f()}return Math.min(this._size+d,this.maxSize)}}]),E}(Symbol.iterator),M=Cv,K=se.default(function C(E,g){ie.default(this,C),this.type=E,this.data=g,Object.freeze(g)}),ve=function(){function C(E,g){ie.default(this,C),this._services=E,this._configuration=g,this._cache=new M({maxSize:g.channelMetadataCacheCapacity})}return se.default(C,[{key:"getChannelMetadata",value:function(){var E=Z.default(O.default.mark(function d(f,m){var v,h,y,b,w;return O.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(v="".concat(f,",").concat(m),h=this._cache.get(v),!h){L.next=4;break}return L.abrupt("return",h.item);case 4:return y="".concat(this._configuration.links.conversations,"/").concat(f,"/Messages/").concat(m,"/ChannelMetadata"),L.prev=5,L.next=8,this._services.commandExecutor.fetchResource(y);case 8:b=L.sent,L.next=17;break;case 11:if(L.prev=11,L.t0=L.catch(5),!(L.t0 instanceof Xe)){L.next=16;break}return this._cache.set(v,{item:null}),L.abrupt("return",null);case 16:throw new Error(L.t0);case 17:return w=new K(b.type,b.data),this._cache.set(v,{item:w}),L.abrupt("return",w);case 20:case"end":return L.stop()}},d,this,[[5,11]])}));function g(d,f){return E.apply(this,arguments)}return g}()}]),C}();function qe(C,E){var g=typeof Symbol<"u"&&C[Symbol.iterator]||C["@@iterator"];if(!g){if(Array.isArray(C)||(g=Bt(C))||E){g&&(C=g);var d=0,f=function(){};return{s:f,n:function(){return d>=C.length?{done:!0}:{done:!1,value:C[d++]}},e:function(b){throw b},f}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m=!0,v=!1,h;return{s:function(){g=g.call(C)},n:function(){var b=g.next();return m=b.done,b},e:function(b){v=!0,h=b},f:function(){try{!m&&g.return!=null&&g.return()}finally{if(v)throw h}}}}function Bt(C,E){if(C){if(typeof C=="string")return vt(C,E);var g=Object.prototype.toString.call(C).slice(8,-1);if(g==="Object"&&C.constructor&&(g=C.constructor.name),g==="Map"||g==="Set")return Array.from(C);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return vt(C,E)}}function vt(C,E){(E==null||E>C.length)&&(E=C.length);for(var g=0,d=new Array(E);g<E;g++)d[g]=C[g];return d}var Gt=se.default(function C(E){ie.default(this,C),Ce.default(this,"type","email"),this.messageSid=E.message_sid,this.level=E.level,this.name=E.name,this.address=E.address}),Xt=se.default(function C(E){ie.default(this,C),this.type=E.type,this.messageSid=E.message_sid,this.rawData=JSON.stringify(E)}),ir=function(){function C(E,g){ie.default(this,C),this._services=E,this._configuration=g,this._cache=new M({maxSize:g.messageRecipientsCacheCapacity})}return se.default(C,[{key:"getRecipientsFromMessage",value:function(){var E=Z.default(O.default.mark(function d(f,m){var v=this,h,y,b,w,j;return O.default.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(h="".concat(f,",").concat(m),y=this._cache.get(h),!y){W.next=4;break}return W.abrupt("return",y.item);case 4:return b=new At(this._configuration.links.conversations).path(f).path("MessageRecipients").arg("MessageSid",m).build(),W.next=7,this._services.commandExecutor.fetchResource(b);case 7:return w=W.sent,j=w.message_recipients.map(function(Q){return v._wrapResponse(Q)}),j.length>0&&this._cache.set(h,{item:j}),W.abrupt("return",j);case 11:case"end":return W.stop()}},d,this)}));function g(d,f){return E.apply(this,arguments)}return g}()},{key:"getRecipientsFromConversation",value:function(){var E=Z.default(O.default.mark(function d(f,m){var v,h,y=this,b,w,j,L,W,Q,We,Ye,ct,ht;return O.default.wrap(function(Ht){for(;;)switch(Ht.prev=Ht.next){case 0:return b=new At(this._configuration.links.conversations).path(f).path("MessageRecipients").arg("PageToken",(v=m==null?void 0:m.pageToken)!==null&&v!==void 0?v:void 0).arg("PageSize",(h=m==null?void 0:m.pageSize)!==null&&h!==void 0?h:void 0).build(),Ht.next=3,this._services.commandExecutor.fetchResource(b);case 3:w=Ht.sent,j=w.message_recipients.map(function(ut){return y._wrapResponse(ut)}),L=qe(j);try{for(L.s();!(W=L.n()).done;)Ye=W.value,ct="".concat(f,",").concat(Ye.messageSid),ht=(Q=(We=this._cache.get(ct))===null||We===void 0?void 0:We.item)!==null&&Q!==void 0?Q:[],this._cache.set(ct,{item:[].concat(Me.default(ht),[Ye])})}catch(ut){L.e(ut)}finally{L.f()}return Ht.abrupt("return",new Be(j,function(ut,on){return y.getRecipientsFromConversation(f,{pageToken:ut,pageSize:on})},w.meta.previous_token,w.meta.next_token));case 8:case"end":return Ht.stop()}},d,this)}));function g(d,f){return E.apply(this,arguments)}return g}()},{key:"_wrapResponse",value:function(g){switch(g.type){case"email":return new Gt(g);default:return new Xt(g)}}}]),C}(),Ze;function mr(C,E){var g=Object.keys(C);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(C);E&&(d=d.filter(function(f){return Object.getOwnPropertyDescriptor(C,f).enumerable})),g.push.apply(g,d)}return g}function br(C){for(var E=1;E<arguments.length;E++){var g=arguments[E]!=null?arguments[E]:{};E%2?mr(Object(g),!0).forEach(function(d){Ce.default(C,d,g[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(g)):mr(Object(g)).forEach(function(d){Object.defineProperty(C,d,Object.getOwnPropertyDescriptor(g,d))})}return C}function lr(C){var E=jr();return function(){var d=mt.default(C),f;if(E){var m=mt.default(this).constructor;f=Reflect.construct(d,arguments,m)}else f=d.apply(this,arguments);return wt.default(this,f)}}function jr(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var st,zn=se.default(function C(){ie.default(this,C)});e.Client=st=(Ze=function(C){Fe.default(g,C);var E=lr(g);function g(d){var f,m,v,h,y,b,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ie.default(this,g),b=E.call(this),Ce.default(Pe.default(b),"version",_),Ce.default(Pe.default(b),"connectionState","unknown"),Ce.default(Pe.default(b),"parsePushNotification",st.parsePushNotification),b._fpaToken=d??"",b._options=w??{},!b._options.disableDeepClone){var j=br(br({},b._options),{},{transport:void 0,twilsockClient:void 0});j=Dt(j),j.transport=b._options.transport,j.twilsockClient=b._options.twilsockClient,b._options=j}b._options.logLevel=(f=b._options.logLevel)!==null&&f!==void 0?f:"silent",st._logger.setLevel(b._options.logLevel);var L=b._options.productId="ip_messaging";if(b._options.clientMetadata=b._options.clientMetadata||{},b._options.clientMetadata.hasOwnProperty("type")||(b._options.clientMetadata.type="conversations"),b._options.clientMetadata.hasOwnProperty("sdk")||(b._options.clientMetadata.sdk="JS",b._options.clientMetadata.sdkv=_),b._options.Sync=b._options.Sync||{},typeof b._options.Sync.enableSessionStorage>"u"&&(b._options.Sync.enableSessionStorage=!0),b._options.region&&(b._options.Sync.region=b._options.region),!d)throw new Error("A valid Twilio token should be provided");b._services=new zn,b._myself=new ue("","",null,b._services);var W=!b._options.twilsockClient;if(!b._options.initRegistrations){var Q=new de.InitRegistration(L);st.populateInitRegistrations(Q),b._options.initRegistrations=[Q]}b._services.twilsockClient=b._options.twilsockClient=(m=b._options.twilsockClient)!==null&&m!==void 0?m:new de.TwilsockClient(d,L,b._options),b._services.twilsockClient.on(st.tokenAboutToExpire,function(){return b.emit(st.tokenAboutToExpire)}),b._services.twilsockClient.on(st.tokenExpired,function(){return b.emit(st.tokenExpired)}),b._services.twilsockClient.on(st.connectionError,function(Ht){return b.emit(st.connectionError,Ht)}),b._services.twilsockClient.on("stateChanged",function(Ht){st._logger.debug("Handling stateChanged for ConversationsClient: new state ".concat(Ht)),Ht!==b.connectionState&&(b.connectionState=Ht,b.emit(st.connectionStateChanged,b.connectionState))}),b._services.transport=b._options.transport=(v=b._options.transport)!==null&&v!==void 0?v:b._options.twilsockClient,b._services.notificationClient=b._options.notificationsClient=(h=b._options.notificationsClient)!==null&&h!==void 0?h:new Ge.Notifications(d,b._options),b._services.syncClient=b._options.syncClient=(y=b._options.syncClient)!==null&&y!==void 0?y:new Ee.SyncClient(d,b._options);var We=(w==null?void 0:w.Chat)||(w==null?void 0:w.IPMessaging)||w||{},Ye=We.region||(w==null?void 0:w.region),ct=We.apiUri||We.typingUri||"https://aim.".concat(Ye||"us1",".twilio.com");b._services.commandExecutor=new pr(ct,{transport:b._options.transport},L),b._services.contentClient=new Cn(b._services);var ht=function(ut){b._rejectEnsureReady(ut),b.emit(st.stateChanged,"failed"),b.emit(st.initFailed,{error:ut})},cr=function(){ht({terminal:!0,message:"Twilsock has disconnected."}),b._initializeEnsureReady((w==null?void 0:w.throwErrorsAlways)||!1)};return b._services.twilsockClient.once("connectionError",ht),b._services.twilsockClient.once("disconnected",cr),b._services.twilsockClient.once("connected",Z.default(O.default.mark(function Ht(){var ut,on;return O.default.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:return st._logger.debug("ConversationsClient started INITIALIZING"),b._services.twilsockClient.off("connectionError",ht),b._services.twilsockClient.off("disconnected",cr),et.prev=3,ut="conversations.client.startup",b._services.twilsockClient.addPartialTelemetryEvent(new de.TelemetryEventDescription(ut,"Conversations client startup",new Date),ut,de.TelemetryPoint.Start),et.next=8,b._initialize();case 8:b._services.twilsockClient.addPartialTelemetryEvent(new de.TelemetryEventDescription("","",new Date),ut,de.TelemetryPoint.End),et.next=17;break;case 11:et.prev=11,et.t0=et.catch(3),on={terminal:!0,message:et.t0.message},b._rejectEnsureReady(on),b.emit(st.stateChanged,"failed"),b.emit(st.initFailed,{error:on});case 17:case"end":return et.stop()}},Ht,null,[[3,11]])}))),b._initializeEnsureReady((w==null?void 0:w.throwErrorsAlways)||!1),W&&b._services.twilsockClient.connect(),b}return se.default(g,[{key:"user",get:function(){return this._myself}},{key:"reachabilityEnabled",get:function(){if(!this._configuration)throw new Error("Reachability information could not yet be accessed as the client has not yet been initialized. Subscribe to the 'stateChanged' event to properly react to the client initialization.");return this._configuration.reachabilityEnabled}},{key:"token",get:function(){return this._fpaToken}},{key:"shutdown",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._ensureReady;case 2:return h.next=4,this._services.twilsockClient.disconnect();case 4:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"updateToken",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._ensureReady;case 2:if(st._logger.info("updateToken"),this._fpaToken!==v){y.next=5;break}return y.abrupt("return",this);case 5:return y.next=7,this._services.twilsockClient.updateToken(v);case 7:return y.next=9,this._services.notificationClient.updateToken(v);case 9:return y.next=11,this._services.mcsClient.updateToken(v);case 11:return this._fpaToken=v,y.abrupt("return",this);case 13:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getConversationBySid",value:function(){var d=Z.default(O.default.mark(function m(v){var h;return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._ensureReady;case 2:return b.next=4,this._conversationsEntity.myConversationsRead.promise;case 4:return b.next=6,this._conversationsEntity.getConversation(v);case 6:if(h=b.sent,h){b.next=12;break}return b.next=10,this.peekConversationBySid(v);case 10:h=b.sent,h&&B.deprecationWarning("The method getConversationBySid is deprecated to retrieve conversations you're not part of. Use peekConversationBySid instead.");case 12:if(h){b.next=14;break}throw new Error("Conversation with SID ".concat(v," was not found."));case 14:return b.abrupt("return",h);case 15:case"end":return b.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"peekConversationBySid",value:function(){var d=Z.default(O.default.mark(function m(v){var h;return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._ensureReady;case 2:return b.next=4,this._conversationsEntity.peekConversation(v);case 4:if(h=b.sent,h){b.next=7;break}throw new Error("Conversation with SID ".concat(v," was not found."));case 7:return b.abrupt("return",h);case 8:case"end":return b.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getConversationByUniqueName",value:function(){var d=Z.default(O.default.mark(function m(v){var h;return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._ensureReady;case 2:return b.next=4,this._conversationsEntity.myConversationsRead.promise;case 4:return b.next=6,this._conversationsEntity.getConversationByUniqueName(v);case 6:if(h=b.sent,h){b.next=9;break}throw new Error("Conversation with unique name ".concat(v," was not found."));case 9:return b.abrupt("return",h);case 10:case"end":return b.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getSubscribedConversations",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._ensureReady;case 2:return h.abrupt("return",this._conversationsPromise.then(function(y){return y.getConversations()}));case 3:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"createConversation",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._ensureReady;case 2:return v=v||{},y.abrupt("return",this._conversationsPromise.then(function(b){return b.addConversation(v)}));case 4:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"setPushRegistrationId",value:function(){var d=Z.default(O.default.mark(function m(v,h){return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._ensureReady;case 2:return this._subscribeToPushNotifications(v),this._services.notificationClient.setPushRegistrationId(v,h),b.next=6,this._services.notificationClient.commitChanges();case 6:case"end":return b.stop()}},m,this)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"unsetPushRegistrationId",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._ensureReady;case 2:return this._unsubscribeFromPushNotifications(v),y.next=5,this._services.notificationClient.commitChanges();case 5:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"removePushRegistrations",value:function(){var d=Z.default(O.default.mark(function m(v,h){return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._services.notificationClient.removeRegistrations(v,h);case 2:case"end":return b.stop()}},m,this)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"handlePushNotification",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._ensureReady;case 2:st._logger.debug("handlePushNotification, notificationPayload=",v),this.emit("pushNotification",st.parsePushNotification(v));case 4:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getUser",value:function(){var d=Z.default(O.default.mark(function m(v){return O.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._ensureReady;case 2:return y.abrupt("return",this._services.users.getUser(v));case 3:case"end":return y.stop()}},m,this)}));function f(m){return d.apply(this,arguments)}return f}()},{key:"getSubscribedUsers",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._ensureReady;case 2:return h.abrupt("return",this._services.users.getSubscribedUsers());case 3:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"getTemporaryContentUrlsForMediaSids",value:function(f){var m=this;return new Ue.CancellablePromise(function(){var v=Z.default(O.default.mark(function h(y,b,w){var j,L;return O.default.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(!(!m._services.mcsClient||!f)){Q.next=3;break}return b(new Error("Media Content Service is unavailable")),Q.abrupt("return");case 3:return j=m._services.mcsClient.mediaSetGetContentUrls(f),w(function(){j.cancel()}),Q.prev=5,Q.next=8,j;case 8:L=Q.sent,y(L),Q.next=15;break;case 12:Q.prev=12,Q.t0=Q.catch(5),b(Q.t0);case 15:case"end":return Q.stop()}},h,null,[[5,12]])}));return function(h,y,b){return v.apply(this,arguments)}}())}},{key:"getTemporaryContentUrlsForMedia",value:function(f){var m=f.map(function(v){return v.sid});return this.getTemporaryContentUrlsForMediaSids(m)}},{key:"getContentTemplates",value:function(){var d=Z.default(O.default.mark(function m(){return O.default.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this._ensureReady;case 2:return h.next=4,this._services.contentClient.getContentTemplates();case 4:return h.abrupt("return",h.sent);case 5:case"end":return h.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"_initialize",value:function(){var d=Z.default(O.default.mark(function m(){var v=this,h;return O.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._services.commandExecutor.fetchResource("Client/v2/Configuration");case 2:return h=b.sent,this._configuration=new Ct(this._options,h,st._logger),this._services.channelMetadataClient=new ve(this._services,this._configuration),this._services.messageRecipientsClient=new ir(this._services,this._configuration),this._myself._resolveInitialization(this._configuration,this._configuration.userIdentity,this._configuration.userInfo,!0),this._services.typingIndicator=new $(this.getConversationBySid.bind(this),this._configuration,this._services),this._services.network=new X(this._configuration,this._services),this._services.users=new A(this._myself,this._configuration,this._services),this._services.users.on("userSubscribed",function(w){v.emit("userSubscribed",w)}),this._services.users.on("userUpdated",function(w){return v.emit("userUpdated",w)}),this._services.users.on("userUnsubscribed",function(w){v.emit("userUnsubscribed",w)}),this._conversationsEntity=new un(this._configuration,this._services),this._conversationsEntity.on("conversationAdded",function(w){v.emit("conversationAdded",w)}),this._conversationsEntity.on("conversationRemoved",function(w){v.emit("conversationRemoved",w)}),this._conversationsEntity.on("conversationJoined",function(w){v.emit("conversationJoined",w)}),this._conversationsEntity.on("conversationLeft",function(w){v.emit("conversationLeft",w)}),this._conversationsEntity.on("conversationUpdated",function(w){return v.emit("conversationUpdated",w)}),this._conversationsEntity.on("participantJoined",function(w){v.emit("participantJoined",w)}),this._conversationsEntity.on("participantLeft",function(w){v.emit("participantLeft",w)}),this._conversationsEntity.on("participantUpdated",function(w){return v.emit("participantUpdated",w)}),this._conversationsEntity.on("messageAdded",function(w){return v.emit("messageAdded",w)}),this._conversationsEntity.on("messageUpdated",function(w){return v.emit("messageUpdated",w)}),this._conversationsEntity.on("messageRemoved",function(w){return v.emit("messageRemoved",w)}),this._conversationsEntity.on("typingStarted",function(w){return v.emit("typingStarted",w)}),this._conversationsEntity.on("typingEnded",function(w){return v.emit("typingEnded",w)}),this._conversationsPromise=this._conversationsEntity.fetchConversations().then(function(){return v._conversationsEntity}).catch(function(w){throw w}),b.next=30,this._services.users.myself._ensureFetched();case 30:st._supportedPushChannels.forEach(function(w){return v._subscribeToPushNotifications(w)}),this._services.typingIndicator.initialize(),this._services.mcsClient=new Ue.McsClient(this._fpaToken,this._configuration.links.mediaService,this._configuration.links.mediaSetService,br(br({},this._options),{},{transport:void 0})),this._resolveEnsureReady(),this.emit(st.stateChanged,"initialized"),this.emit(st.initialized);case 36:case"end":return b.stop()}},m,this)}));function f(){return d.apply(this,arguments)}return f}()},{key:"_subscribeToPushNotifications",value:function(f){var m=this;[le.NEW_MESSAGE,le.ADDED_TO_CONVERSATION,le.REMOVED_FROM_CONVERSATION,le.TYPING_INDICATOR,le.CONSUMPTION_UPDATE].forEach(function(v){m._services.notificationClient.subscribe(f,v)})}},{key:"_unsubscribeFromPushNotifications",value:function(f){var m=this;[le.NEW_MESSAGE,le.ADDED_TO_CONVERSATION,le.REMOVED_FROM_CONVERSATION,le.TYPING_INDICATOR,le.CONSUMPTION_UPDATE].forEach(function(v){m._services.notificationClient.unsubscribe(f,v)})}},{key:"_initializeEnsureReady",value:function(f){var m=this;this._ensureReady=new Promise(function(v,h){m._resolveEnsureReady=v,m._rejectEnsureReady=h}).catch(function(v){if(f)throw v})}}],[{key:"create",value:function(){var d=Z.default(O.default.mark(function m(v,h){var y;return O.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!(h!=null&&h.twilsockClient)){w.next=2;break}throw new Error("Obsolete usage of ConversationsClient.create() factory method: if you pass twilsock from the outside then you must use ConversationsClient constructor and be prepared to work with uninitialized client.");case 2:return y=new st(v,h),w.next=5,y._ensureReady;case 5:return w.abrupt("return",y);case 6:case"end":return w.stop()}},m)}));function f(m,v){return d.apply(this,arguments)}return f}()},{key:"parsePushNotification",value:function(f){if(st._logger.debug("parsePushNotification, notificationPayload=",f),typeof f.aps<"u"){if(!f.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var m=st._parsePushNotificationChatData(f),v=f.aps,h,y=null;if(typeof v.alert=="string")h=v.alert||null;else{var b,w;h=((b=v.alert)===null||b===void 0?void 0:b.body)||null,y=((w=v.alert)===null||w===void 0?void 0:w.title)||null}return new k({title:y,body:h,sound:v.sound||null,badge:v.badge||null,action:v.category||null,type:f.twi_message_type,data:m})}if(typeof f.data<"u"){var j=f.data;if(!j.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var L=st._parsePushNotificationChatData(f.data);return new k({title:j.twi_title||null,body:j.twi_body||null,sound:j.twi_sound||null,badge:null,action:j.twi_action||null,type:j.twi_message_type,data:L})}throw new Error("Provided push notification payload is not Programmable Chat notification")}},{key:"_parsePushNotificationChatData",value:function(f){var m={};for(var v in st._supportedPushDataFields){var h=f[v];if(!(typeof h>"u"||h===null)){if(v==="message_index"||v==="media_count"){var y=gt(h);y!==null&&(m[st._supportedPushDataFields[v]]=y);continue}if(v==="media"){if(typeof h=="string")try{m[st._supportedPushDataFields[v]]=JSON.parse(h)}catch{st._logger.debug("Media message notification parsing error")}continue}m[st._supportedPushDataFields[v]]=h}}return m}},{key:"populateInitRegistrations",value:function(f){f.populateInitRegistrations([le.TYPING_INDICATOR]),Ee.SyncClient.populateInitRegistrations(f)}}]),g}(U.ReplayEventEmitter),Ce.default(Ze,"conversationAdded","conversationAdded"),Ce.default(Ze,"conversationJoined","conversationJoined"),Ce.default(Ze,"conversationLeft","conversationLeft"),Ce.default(Ze,"conversationRemoved","conversationRemoved"),Ce.default(Ze,"conversationUpdated","conversationUpdated"),Ce.default(Ze,"participantJoined","participantJoined"),Ce.default(Ze,"participantLeft","participantLeft"),Ce.default(Ze,"participantUpdated","participantUpdated"),Ce.default(Ze,"messageAdded","messageAdded"),Ce.default(Ze,"messageRemoved","messageRemoved"),Ce.default(Ze,"messageUpdated","messageUpdated"),Ce.default(Ze,"tokenAboutToExpire","tokenAboutToExpire"),Ce.default(Ze,"tokenExpired","tokenExpired"),Ce.default(Ze,"typingEnded","typingEnded"),Ce.default(Ze,"typingStarted","typingStarted"),Ce.default(Ze,"pushNotification","pushNotification"),Ce.default(Ze,"userSubscribed","userSubscribed"),Ce.default(Ze,"userUnsubscribed","userUnsubscribed"),Ce.default(Ze,"userUpdated","userUpdated"),Ce.default(Ze,"stateChanged","stateChanged"),Ce.default(Ze,"initialized","initialized"),Ce.default(Ze,"initFailed","initFailed"),Ce.default(Ze,"connectionStateChanged","connectionStateChanged"),Ce.default(Ze,"connectionError","connectionError"),Ce.default(Ze,"version",_),Ce.default(Ze,"_logger",zt.scope("Client")),Ce.default(Ze,"_supportedPushChannels",["fcm","apn"]),Ce.default(Ze,"_supportedPushDataFields",{conversation_sid:"conversationSid",conversation_title:"conversationTitle",message_sid:"messageSid",message_index:"messageIndex",media_count:"mediaCount",media:"media"}),Ze),ye([B.deprecated("token"),te("design:type",String),te("design:paramtypes",[])],e.Client.prototype,"token",null),ye([I.validateTypesAsync(I.nonEmptyString),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],e.Client.prototype,"updateToken",null),ye([I.validateTypesAsync(I.nonEmptyString),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],e.Client.prototype,"getConversationBySid",null),ye([I.validateTypesAsync(I.nonEmptyString),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],e.Client.prototype,"peekConversationBySid",null),ye([I.validateTypesAsync(I.nonEmptyString),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],e.Client.prototype,"getConversationByUniqueName",null),ye([I.validateTypesAsync(["undefined",I.objectSchema("conversation options",{friendlyName:["string","undefined"],isPrivate:["boolean","undefined"],uniqueName:["string","undefined"]})]),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",Promise)],e.Client.prototype,"createConversation",null),ye([I.validateTypesAsync(I.literal("fcm","apn"),"string"),te("design:type",Function),te("design:paramtypes",[String,String]),te("design:returntype",Promise)],e.Client.prototype,"setPushRegistrationId",null),ye([I.validateTypesAsync(I.literal("fcm","apn")),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],e.Client.prototype,"unsetPushRegistrationId",null),ye([I.validateTypesAsync(I.literal("fcm","apn"),I.nonEmptyString),te("design:type",Function),te("design:paramtypes",[String,String]),te("design:returntype",Promise)],e.Client.prototype,"removePushRegistrations",null),ye([I.validateTypesAsync(I.pureObject),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",Promise)],e.Client.prototype,"handlePushNotification",null),ye([I.validateTypesAsync(I.nonEmptyString),te("design:type",Function),te("design:paramtypes",[String]),te("design:returntype",Promise)],e.Client.prototype,"getUser",null),ye([I.validateTypesAsync(I.nonEmptyArray("strings","string")),te("design:type",Function),te("design:paramtypes",[Array]),te("design:returntype",Ue.CancellablePromise)],e.Client.prototype,"getTemporaryContentUrlsForMediaSids",null),ye([I.validateTypesAsync(I.nonEmptyArray("media",De)),te("design:type",Function),te("design:paramtypes",[Array]),te("design:returntype",Ue.CancellablePromise)],e.Client.prototype,"getTemporaryContentUrlsForMedia",null),ye([B.deprecated("Client.create()","new Client()"),I.validateTypesAsync("string",["undefined",I.pureObject]),te("design:type",Function),te("design:paramtypes",[String,Object]),te("design:returntype",Promise)],e.Client,"create",null),ye([I.validateTypes(I.pureObject),te("design:type",Function),te("design:paramtypes",[Object]),te("design:returntype",k)],e.Client,"parsePushNotification",null),e.Client=st=ye([I.validateConstructorTypes(I.nonEmptyString,[I.pureObject,"undefined"]),te("design:paramtypes",[String,Object])],e.Client),Object.defineProperty(e,"CancellablePromise",{enumerable:!0,get:function(){return Ue.CancellablePromise}}),e.AggregatedDeliveryReceipt=je,e.ChannelMetadata=K,e.ContentTemplate=rt,e.ContentTemplateVariable=Qe,e.Conversation=_t,e.DetailedDeliveryReceipt=Ve,e.EmailRecipientDescriptor=Gt,e.Media=De,e.Message=yr,e.MessageBuilder=Yt,e.NotificationTypes=le,e.Participant=D,e.PushNotification=k,e.RestPaginator=Be,e.UnknownRecipientDescriptor=Xt,e.UnsentMessage=hs,e.User=ue})(Av);function Gl(){var t;if(!((t=window.CHAT_CONFIG)!=null&&t.businessId))throw new Error("Business ID is required in CHAT_CONFIG");if(!window.CHAT_CONFIG.submitUri)throw new Error("Submit URI is required in CHAT_CONFIG");if(!window.CHAT_CONFIG.tokenUri)throw new Error("Token URI is required in CHAT_CONFIG");const n=getComputedStyle(document.documentElement).getPropertyValue("--color_8").trim();return{businessId:window.CHAT_CONFIG.businessId,clientId:window.CHAT_CONFIG.clientId,primaryColor:n||window.CHAT_CONFIG.primaryColor||"#2563EB",submitUri:window.CHAT_CONFIG.submitUri,tokenUri:`${window.CHAT_CONFIG.tokenUri}?method=generateCustomerToken`}}class Pz{constructor(){Gn(this,"client",null);Gn(this,"currentToken",null);Gn(this,"serviceSid",null);Gn(this,"config",Gl());Gn(this,"initializationPromise",null);Gn(this,"businessName",null);Gn(this,"refreshToken",async()=>{if(this.client)try{const n=this.client.user.identity,{token:t,businessName:r}=await this.fetchToken(n,this.config.businessId);if(!t)throw new Error("No token received during refresh");this.currentToken=t,this.businessName=r,await this.client.updateToken(t)}catch(n){throw console.error("Token refresh failed:",n),this.client=null,this.currentToken=null,this.businessName=null,n}})}getToken(){return this.currentToken}getServiceSid(){return this.serviceSid}getBusinessName(){return this.businessName}async initializeClient(n){if(!n)throw new Error("Authentication token is required");return this.initializationPromise?this.initializationPromise:(this.initializationPromise=(async()=>{try{console.log("Initializing Twilio client..."),this.currentToken=n,this.client=new Av.Client(n),this.client.on("tokenAboutToExpire",this.refreshToken),this.client.on("tokenExpired",this.refreshToken),this.client.on("connectionStateChanged",r=>{console.log("Connection state changed:",r)});const t=await this.client.getSubscribedConversations();t.items[0]&&(this.serviceSid=t.items[0].sid),console.log("Twilio client initialized successfully")}catch(t){throw console.error("Failed to initialize Twilio client:",t),this.client=null,this.currentToken=null,this.serviceSid=null,this.businessName=null,t}finally{this.initializationPromise=null}})(),this.initializationPromise)}async fetchToken(n,t){var r,a,i;if(!n||!t)throw new Error("Client ID and Business ID are required");try{const s={businessId:t,params:{clientId:n}};console.log("Fetching token with payload:",s);const o=await fetch(this.config.tokenUri,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)});if(!o.ok){const c=await o.text();throw new Error(`Server error (${o.status}): ${c}`)}const u=await o.text();let l;try{l=JSON.parse(u)}catch{throw new Error(`Invalid JSON response: ${u}`)}if(!l.success||!((r=l.data)!=null&&r.token)||!((a=l.data)!=null&&a.identity)||!((i=l.data)!=null&&i.businessName))throw new Error("Invalid response format: missing token, identity, or businessName");return this.businessName=l.data.businessName,console.log("Token fetched successfully"),{token:l.data.token,identity:l.data.identity,businessName:l.data.businessName}}catch(s){throw console.error("Token fetch error:",s),s}}async getConversations(){if(!this.client)throw new Error("Chat service not initialized");try{console.log("Fetching subscribed conversations...");const t=(await this.client.getSubscribedConversations()).items||[];return console.log(`Found ${t.length} conversations`),t}catch(n){return console.error("Error fetching conversations:",n),[]}}async getExistingConversation(){if(!this.client)throw new Error("Chat service not initialized");try{const n=await this.getConversations();return n.length>0?n[0]:null}catch(n){return console.error("Error getting existing conversation:",n),null}}async leaveConversation(n){if(!this.client)throw new Error("Chat service not initialized");try{console.log("Leaving conversation:",n.sid),(await n.getParticipants()).some(a=>{var i;return a.identity===((i=this.client)==null?void 0:i.user.identity)})?(await n.leave(),console.log("Successfully left conversation")):console.log("Not a participant in conversation, skipping leave")}catch(t){throw console.error("Error leaving conversation:",t),new Error("Failed to leave conversation")}}async deleteConversation(n){if(!this.client)throw new Error("Chat service not initialized");try{console.log("Deleting conversation:",n),await(await this.client.getConversationBySid(n)).delete(),console.log("Conversation deleted successfully")}catch(t){throw console.error("Error deleting conversation:",t),t}}async sendSystemMessage(n,t){try{await n.sendMessage(t,{isSystem:!0})}catch(r){console.warn("Failed to send system message:",r)}}async createConversation(n,t,r){if(!this.client)throw new Error("Chat service not initialized");if(!this.businessName)throw new Error("Business name not available");try{console.log("Creating new conversation for client:",n);const a=await this.client.createConversation({friendlyName:`Chat with ${r||n}`,uniqueName:`${n}-${Date.now()}`,attributes:{participants:{[n]:{friendlyName:r||n},[t]:{friendlyName:this.businessName}}}});console.log("Joining conversation..."),await a.join(),console.log("Adding business participant:",t),await a.add(t);const i=`${r||"Client"} has joined the chat`;return await this.sendSystemMessage(a,i),console.log("Conversation created and initialized successfully"),a}catch(a){throw console.error("Error creating conversation:",a),a}}}const Da=new Pz,Mz=({status:e,error:n,onRetry:t})=>{const r=()=>{switch(e){case"connected":return"sl-bg-green-500";case"connecting":return"sl-bg-yellow-500";case"error":return"sl-bg-red-500";default:return"sl-bg-gray-500"}};return e==="error"&&n?oe.jsxs("div",{className:"sl-p-4 sl-bg-red-50",children:[oe.jsxs("div",{className:"sl-flex sl-items-center sl-mb-2",children:[oe.jsx("div",{className:`sl-w-2 sl-h-2 sl-rounded-full ${r()} sl-mr-2`}),oe.jsx("span",{className:"sl-text-red-700 sl-font-medium",children:"Connection Error"})]}),oe.jsx("p",{className:"sl-text-sm sl-text-red-600 sl-mb-3",children:n}),t&&oe.jsx("button",{onClick:t,className:"sl-text-sm sl-bg-red-100 sl-text-red-700 sl-px-3 sl-py-1 sl-rounded hover:sl-bg-red-200 sl-transition-colors",children:"Try Again"})]}):oe.jsxs("div",{className:"sl-px-4 sl-py-2 sl-bg-gray-50 sl-border-b sl-flex sl-items-center",children:[oe.jsx("div",{className:`sl-w-2 sl-h-2 sl-rounded-full ${r()} sl-mr-2`}),oe.jsx("span",{className:"sl-text-sm sl-text-gray-600",children:e==="connected"?"Connected":"Connecting..."})]})},Nz=({show:e,onStartNewChat:n,onShowPreviousChats:t})=>e?oe.jsxs("div",{className:"sl-absolute sl-top-14 sl-left-4 sl-bg-white sl-rounded-lg sl-shadow-lg sl-border sl-border-gray-200 sl-w-48 sl-py-1 sl-z-50",children:[oe.jsxs("button",{onClick:n,className:"sl-w-full sl-px-4 sl-py-2 sl-text-left sl-text-sm sl-text-gray-700 hover:sl-bg-gray-100 sl-flex sl-items-center sl-space-x-2",children:[oe.jsx("svg",{className:"sl-w-4 sl-h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),oe.jsx("span",{children:"Start New Chat"})]}),oe.jsxs("button",{onClick:t,className:"sl-w-full sl-px-4 sl-py-2 sl-text-left sl-text-sm sl-text-gray-700 hover:sl-bg-gray-100 sl-flex sl-items-center sl-space-x-2",children:[oe.jsx("svg",{className:"sl-w-4 sl-h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),oe.jsx("span",{children:"Previous Chats"})]})]}):null,xz=({onClose:e,onMenuClick:n,showMenuButton:t,primaryColor:r})=>oe.jsxs("div",{className:"sl-text-white sl-p-4 sl-flex sl-items-center sl-justify-between sl-flex-shrink-0",style:{backgroundColor:"var(--color_8, "+(r||"#2563EB")+")"},children:[oe.jsxs("div",{className:"sl-flex sl-items-center sl-space-x-2",children:[oe.jsx("span",{className:"sl-font-semibold",children:"Live Chat"}),t&&oe.jsx("button",{onClick:n,className:"sl-text-white/90 hover:sl-text-white focus:sl-outline-none sl-transition-colors sl-w-6 sl-h-6 sl-flex sl-items-center sl-justify-center sl-rounded-full hover:sl-bg-white/10",children:oe.jsx("svg",{className:"sl-w-4 sl-h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]}),oe.jsx("button",{onClick:e,className:"sl-text-white/90 hover:sl-text-white focus:sl-outline-none sl-transition-colors sl-w-6 sl-h-6 sl-flex sl-items-center sl-justify-center sl-rounded-full hover:sl-bg-white/10","aria-label":"Close chat window",children:oe.jsx("svg",{className:"sl-w-4 sl-h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),Lz=({onSelectConversation:e})=>{const[n,t]=ot.useState([]),[r,a]=ot.useState(!1),[i,s]=ot.useState(null),[o,u]=ot.useState({}),[l,c]=ot.useState(null);ot.useEffect(()=>{p()},[]);const p=async()=>{a(!0),s(null);try{const x=await Da.getConversations();t(x);const U={};for(const F of x)try{const V=await F.getMessages();U[F.sid]=V.items.length}catch(V){console.error("Error loading message count:",V),U[F.sid]=0}u(U)}catch(x){const U=x instanceof Error?x.message:"Failed to load conversations";s(U),console.error("Error loading conversations:",x)}finally{a(!1)}},S=x=>new Date(x).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),T=async(x,U)=>{U.stopPropagation();try{await Da.deleteConversation(x),t(F=>F.filter(V=>V.sid!==x))}catch(F){const V=F instanceof Error?F.message:"Failed to delete conversation";s(V),console.error("Error deleting conversation:",F)}},I=async(x,U)=>{U.stopPropagation();try{c(x.sid),await Da.leaveConversation(x),t(F=>F.filter(V=>V.sid!==x.sid))}catch(F){const V=F instanceof Error?F.message:"Failed to leave conversation";s(V),console.error("Error leaving conversation:",F)}finally{c(null)}};return r?oe.jsx("div",{className:"sl-p-4 sl-flex sl-items-center sl-justify-center sl-min-h-[300px]",children:oe.jsx("div",{className:"sl-animate-spin sl-rounded-full sl-h-8 sl-w-8 sl-border-b-2 sl-border-blue-500"})}):i?oe.jsxs("div",{className:"sl-p-4",children:[oe.jsx("div",{className:"sl-bg-red-100 sl-border-l-4 sl-border-red-500 sl-text-red-700 sl-p-4 sl-mb-4",role:"alert",children:i}),oe.jsx("button",{onClick:p,className:"sl-text-blue-500 hover:sl-underline",children:"Try Again"})]}):oe.jsxs("div",{className:"sl-p-4 sl-flex-1 sl-overflow-y-auto",children:[oe.jsx("h3",{className:"sl-text-lg sl-font-semibold sl-mb-4 sl-text-gray-800",children:"Previous Conversations"}),n.length>0?oe.jsx("div",{className:"sl-space-y-2",children:n.map(x=>oe.jsx("div",{onClick:()=>e(x),className:"sl-group sl-bg-white sl-rounded-lg sl-border sl-border-gray-200 hover:sl-border-blue-300 hover:sl-shadow-md sl-transition-all sl-duration-200 sl-cursor-pointer",children:oe.jsxs("div",{className:"sl-p-3 sl-flex sl-items-center sl-justify-between",children:[oe.jsxs("div",{className:"sl-flex sl-items-center sl-space-x-3",children:[oe.jsx("div",{className:"sl-flex-shrink-0",children:oe.jsx("div",{className:"sl-w-10 sl-h-10 sl-bg-blue-100 sl-rounded-full sl-flex sl-items-center sl-justify-center",children:oe.jsx("svg",{className:"sl-w-5 sl-h-5 sl-text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 12h.01M12 12h.01M16 12h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})})}),oe.jsxs("div",{className:"sl-flex sl-flex-col sl-gap-0.5",children:[oe.jsxs("h4",{className:"sl-text-sm sl-font-medium sl-text-gray-900",children:["Chat on ",S(x.dateCreated)]}),oe.jsxs("p",{className:"sl-text-xs sl-text-gray-500 sl-leading-none",children:[o[x.sid]||0," messages"]})]})]}),oe.jsxs("div",{className:"sl-flex sl-items-center sl-space-x-1 sl-opacity-40 sl-group-hover:sl-opacity-100 sl-transition-opacity",children:[oe.jsx("button",{onClick:U=>I(x,U),className:"sl-p-2 sl-bg-yellow-50 hover:sl-bg-yellow-100 sl-rounded-full sl-relative",title:"Leave conversation",disabled:l===x.sid,children:l===x.sid?oe.jsx("div",{className:"sl-animate-spin sl-rounded-full sl-h-5 sl-w-5 sl-border-2 sl-border-yellow-500 sl-border-t-transparent"}):oe.jsx("svg",{className:"sl-w-5 sl-h-5 sl-text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),oe.jsx("button",{onClick:U=>T(x.sid,U),className:"sl-p-2 sl-bg-red-50 hover:sl-bg-red-100 sl-rounded-full",title:"Delete conversation",children:oe.jsx("svg",{className:"sl-w-5 sl-h-5 sl-text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},x.sid))}):oe.jsxs("div",{className:"sl-text-center sl-py-8",children:[oe.jsx("div",{className:"sl-w-16 sl-h-16 sl-bg-gray-100 sl-rounded-full sl-flex sl-items-center sl-justify-center sl-mx-auto sl-mb-4",children:oe.jsx("svg",{className:"sl-w-8 sl-h-8 sl-text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 12h.01M12 12h.01M16 12h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),oe.jsx("p",{className:"sl-text-gray-500 sl-mb-4",children:"No previous conversations"})]}),oe.jsxs("button",{onClick:()=>e(null),className:"sl-mt-4 sl-w-full sl-bg-blue-500 sl-text-white sl-py-2 sl-px-4 sl-rounded-lg hover:sl-bg-blue-600 sl-transition-colors sl-duration-200 sl-flex sl-items-center sl-justify-center sl-space-x-2",children:[oe.jsx("svg",{className:"sl-w-5 sl-h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:oe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),oe.jsx("span",{children:"Start New Conversation"})]})]})},jz=Gl(),Uz=({onClose:e,conversation:n,setConversation:t,identity:r,clientId:a,clientName:i,onPreFormSubmit:s,error:o,primaryColor:u,loading:l,showPreForm:c,status:p,onRetry:S,isOpen:T})=>{const[I,x]=ot.useState([]),[U,F]=ot.useState(null),[V,Ae]=ot.useState(!1),[de,Ge]=ot.useState(!1),[Ee,Ue]=ot.useState(!1);ot.useEffect(()=>{if(T){Ae(!0);const Pe=setTimeout(()=>Ae(!1),300);return()=>clearTimeout(Pe)}},[T]),ot.useEffect(()=>(n&&(B(n),n.on("messageAdded",ce)),()=>{n&&n.off("messageAdded",ce)}),[n]);const B=async Pe=>{F(null);try{const Fe=await Pe.getMessages();x(Fe.items)}catch(Fe){const wt=Fe instanceof Error?Fe.message:"Failed to load messages";F(wt),console.error("Error loading messages:",Fe)}},ce=Pe=>{x(Fe=>[...Fe,Pe])},ke=async(Pe,Fe)=>{if(n)try{if(Fe&&Fe.length>0)for(const wt of Fe)await n.sendMessage({contentType:wt.type,media:wt});else Pe&&await n.sendMessage(Pe)}catch(wt){const mt=wt instanceof Error?wt.message:"Failed to send message";F(mt),console.error("Failed to send message:",wt)}},pe=async()=>{if(n)try{await n.leave();const Pe=await Da.createConversation(a,jz.businessId,i||void 0);t(Pe),Ge(!1),Ue(!1)}catch(Pe){console.error("Error starting new chat:",Pe),F("Failed to start new chat")}},Le=async Pe=>{Pe===null?pe():(t(Pe),Ue(!1)),Ge(!1)},Z=()=>l?oe.jsx("div",{className:"sl-flex-1 sl-flex sl-items-center sl-justify-center sl-p-8",children:oe.jsxs("div",{className:"sl-text-center",children:[oe.jsx("div",{className:"sl-animate-spin sl-rounded-full sl-h-8 sl-w-8 sl-border-b-2 sl-border-blue-500 sl-mx-auto sl-mb-4"}),oe.jsx("p",{className:"sl-text-gray-600",children:"Initializing chat..."})]})}):c?oe.jsx("div",{className:"sl-flex-1 sl-overflow-y-auto",children:oe.jsx(i$,{onSubmit:s})}):Ee?oe.jsx(Lz,{onSelectConversation:Le,clientId:a}):n?oe.jsxs(oe.Fragment,{children:[oe.jsx("div",{className:"sl-flex-1 sl-flex sl-flex-col sl-min-h-0",children:I.length===0?oe.jsx("div",{className:"sl-flex-1 sl-flex sl-items-center sl-justify-center sl-p-8 sl-bg-gray-50",children:oe.jsxs("div",{className:"sl-text-center",children:[oe.jsx("p",{className:"sl-text-gray-600 sl-mb-2",children:"Welcome to the chat!"}),oe.jsx("p",{className:"sl-text-sm sl-text-gray-500",children:"Send a message to start the conversation."})]})}):oe.jsx(n$,{messages:I,identity:r,clientName:i})}),oe.jsx(a$,{onSendMessage:ke,primaryColor:u})]}):null;return T?oe.jsxs("div",{className:`sl-fixed sl-bottom-0 sl-right-0 sl-w-full md:sl-w-80 md:sl-bottom-4 md:sl-right-4 
        sl-bg-white sl-border sl-border-gray-300 sl-shadow-lg sl-flex sl-flex-col sl-overflow-hidden sl-z-50 
        sl-transition-all sl-duration-300 sl-transform ${V?"sl-scale-up-tr":""} 
        md:sl-rounded-lg sl-h-full md:sl-max-h-[min(600px,calc(100vh-2rem))]`,children:[oe.jsx(xz,{onClose:e,onMenuClick:()=>Ge(!de),showMenuButton:!!n,primaryColor:u}),oe.jsx(Nz,{show:de&&!!n,onStartNewChat:pe,onShowPreviousChats:()=>{Ue(!0),Ge(!1)}}),oe.jsx(Mz,{status:p,error:o||U,onRetry:S}),oe.jsx("div",{className:"sl-flex-1 sl-flex sl-flex-col sl-overflow-hidden",children:Z()})]}):null};function Fz(){return document.cookie.replace(/(?:(?:^|.*;\s*)_ga\s*\=\s*([^;]*).*$)|^.*$/,"$1").substring(6)??""}class Dz{constructor(){Gn(this,"config",Gl())}async generateClientId(n,t,r){const a=new URLSearchParams({formId:"ChatWidget",businessId:r}),i={SYSTEMname:n.trim(),SYSTEMemail:t.trim(),SYSTEManalyticsClientId:Fz()};try{const s=await fetch(`${this.config.submitUri}?${a.toString()}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)});if(!s.ok){const u=await s.text();throw new Error(`Failed to generate client ID: ${u}`)}const o=await s.json();if(!o.clientId)throw new Error("Response missing clientId");return o.clientId}catch(s){throw console.error("Error generating client ID:",s),s instanceof Error?s:new Error("Failed to generate client ID")}}}const Bz=new Dz;class qz{constructor(){Gn(this,"STORAGE_KEY","chat_session")}saveSession(n){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}catch(t){console.error("Error saving chat session:",t)}}getSession(){try{const n=localStorage.getItem(this.STORAGE_KEY);return n?JSON.parse(n):null}catch(n){return console.error("Error retrieving chat session:",n),null}}clearSession(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(n){console.error("Error clearing chat session:",n)}}}const $v=new qz,Ba=Gl(),Wz=()=>{const[e,n]=ot.useState(!1),[t,r]=ot.useState(Ba.clientId||null),[a,i]=ot.useState(null),[s,o]=ot.useState(null),[u,l]=ot.useState(!1),[c,p]=ot.useState(null),[S,T]=ot.useState("connecting"),[I,x]=ot.useState(null),[U,F]=ot.useState(!1);ot.useEffect(()=>{const Ee=$v.getSession();Ee&&Ee.businessId===Ba.businessId&&(r(Ee.clientId),x(Ee.name))},[]),ot.useEffect(()=>{e&&t&&!U&&de(t)},[e,t]);const V=()=>{n(!e),p(null)},Ae=async(Ee,Ue)=>{try{l(!0),p(null);const B=await Bz.generateClientId(Ee,Ue,Ba.businessId);$v.saveSession({clientId:B,name:Ee,businessId:Ba.businessId}),r(B),x(Ee),T("connecting"),await de(B,Ee)}catch(B){console.error("Error handling form submission:",B),p("Failed to initialize chat. Please try again."),T("error")}finally{l(!1)}},de=async(Ee,Ue)=>{if(!U)try{F(!0),l(!0),T("connecting"),p(null);const{token:B,identity:ce}=await Da.fetchToken(Ee,Ba.businessId);i(ce),await Da.initializeClient(B);const ke=await Da.getExistingConversation();if(ke)o(ke);else{const pe=await Da.createConversation(Ee,Ba.businessId,Ue);o(pe)}T("connected")}catch(B){console.error("Error initializing chat:",B);const ce=B instanceof Error?B.message:"Failed to connect to chat service";p(`${ce}. Please try again.`),T("error"),B instanceof Error&&B.message.includes("Authentication")&&($v.clearSession(),r(null),x(null))}finally{l(!1),F(!1)}},Ge=()=>{t&&de(t)};return oe.jsxs("div",{className:"sl-font-sans",children:[oe.jsx(e$,{onClick:V,primaryColor:Ba.primaryColor,isOpen:e}),oe.jsx(Uz,{onClose:V,conversation:s,setConversation:o,identity:a,clientId:t,clientName:I,onPreFormSubmit:Ae,error:c,primaryColor:Ba.primaryColor,loading:u,showPreForm:!t,status:S,onRetry:Ge,isOpen:e})]})},Tv=()=>{var r;if(!((r=window.CHAT_CONFIG)!=null&&r.businessId)){console.error("CHAT_CONFIG.businessId is required");return}if(!window.CHAT_CONFIG.submitUri){console.error("CHAT_CONFIG.submitUri is required");return}if(!window.CHAT_CONFIG.tokenUri){console.error("CHAT_CONFIG.tokenUri is required");return}const e=document.createElement("div");e.id="chat-widget-root",document.body.appendChild(e);const n=document.createElement("style");n.textContent=`
    #chat-widget-root {
      position: fixed;
      z-index: 9999;
      bottom: 0;
      right: 0;
      width: 0;
      height: 0;
    }
  `,document.head.appendChild(n),Rv(e).render(oe.jsx(ot.StrictMode,{children:oe.jsx(Wz,{})}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Tv):Tv(),ga.initChatWidget=Tv,Object.defineProperty(ga,Symbol.toStringTag,{value:"Module"})})(this.ChatWidget=this.ChatWidget||{},React,ReactDOM);
